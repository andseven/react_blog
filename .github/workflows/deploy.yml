# .github/workflows/deploy.yml

name: Deploy React App to GitHub Pages

on:
    # 只在 push 到 main 分支时触发
    push:
        branches:
            - main
    # 允许手动触发
    workflow_dispatch:

# 需要写入 gh-pages 分支的权限
permissions:
    contents: write

jobs:
    build-and-deploy: # 给 job 一个更清晰的名字
        name: Build and Deploy
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            # 使用 pnpm/action-setup 来安装和缓存 pnpm
            - name: Setup pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 8 # 指定 pnpm 版本

            # 使用 setup-node 的缓存功能
            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "pnpm" # 缓存 pnpm 的依赖项

            - name: Install dependencies and Build
              run: |
                  pnpm install
                  pnpm run build

            - name: Deploy to gh-pages
              uses: JamesIves/github-pages-deploy-action@v4
              with:
                  branch: gh-pages # 部署到 gh-pages 分支
                  folder: dist # 从 dist 目录部署
