import{r as f,j as s,R as M}from"./index-hf0eMul1.js";import{a as y,d as b}from"./cloudbase-dTM1oF_C.js";const k=b.collection("articles"),A=()=>{const[o,t]=f.useState("请选择一个 Markdown 文件进行批量导入。"),[n,c]=f.useState(!1),h=f.useRef(null),j=async I=>{const x=I.target.files?.[0];if(!x)return;c(!0),t("正在读取和解析文件...");const w=new FileReader;w.onload=async R=>{let i=R.target?.result;if(!i){t("错误：无法读取文件内容。"),c(!1);return}i.startsWith("### ")&&(i=`
`+i);const g=i.split(`
### `).slice(1);if(g.length===0){t("未找到以 '### ' 开头的文章片段，请检查文件格式。"),c(!1);return}t(`已解析出 ${g.length} 篇文章，准备插入数据库...`);const S=g.map(a=>{const l=a.indexOf(`
`),d=a.substring(0,l).trim(),r=`### ${a.trim()}`,u=r.substring(0,100).replace(/\s+/g," ").trim()+"...";return{title:d,content:r,date:new Date,author:"批量导入",summary:u,likes:0,comments:[]}});try{await y.getLoginState()||await y.signInAnonymously(),t("正在获取云端文章列表以防重复...");const l=100,d=[];let r=0;for(;;){const e=await k.field({title:!0}).skip(r).limit(l).get();if(e.data.length===0||(e.data.forEach($=>d.push($.title)),r+=e.data.length,e.data.length<l))break}const u=new Set(d);t(`云端存在 ${u.size} 篇文章。开始对比并插入新文章...`);let p=0,m=0;for(const e of S){if(u.has(e.title)){m++,console.log(`标题: "${e.title}" 已存在，跳过插入。`);continue}await k.add(e),p++,t(`正在插入... (成功: ${p} / 跳过: ${m})`)}t(`批量导入完成！成功插入 ${p} 篇新文章，因标题重复跳过 ${m} 篇。`)}catch(a){console.error("数据库操作失败:",a),t("导入过程中发生错误，请查看控制台。")}finally{c(!1),h.current&&(h.current.value="")}},w.readAsText(x)};return s.jsxs("div",{style:{border:"1px solid #ccc",padding:"20px",borderRadius:"8px",textAlign:"center"},children:[s.jsx("h4",{children:"Markdown 批量导入工具"}),s.jsx("p",{style:{color:"#666",minHeight:"40px"},children:o}),s.jsx("input",{type:"file",accept:".md, .markdown",onChange:j,disabled:n,ref:h,style:{display:"block",margin:"20px auto"}})]})};function v(){const[o]=M.useState("88ce883568c9122900e1cc2b0af12e23");return f.useEffect(()=>{(async()=>{try{const n=await b.collection("articles").doc(o).get();n.data?console.log("Fetched article:",n.data[0]):console.log("No article found with the given ID.")}catch(n){console.error("Failed to fetch article:",n)}})()},[o]),s.jsxs("div",{children:[s.jsx("h1",{children:"欢迎来到首页"}),s.jsx(A,{})]})}export{v as default};
