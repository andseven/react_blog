import{az as mm,ar as vn,ae as Lc}from"./index-9jiko7gg.js";var lv="@cloudbase/js-sdk";function gm(t){lv=t}function qo(){return lv}var fv="https:";function _m(t){fv=t}function bm(){return fv}var Fo="https://support.qq.com/products/148793",rt={INVALID_PARAMS:"INVALID_PARAMS",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL"},so;(function(t){t.local="local",t.none="none",t.session="session"})(so||(so={}));var Uc=(function(){function t(){}return t})(),dv=(function(){function t(){}return t})();function Xn(t,e,r){r===void 0&&(r={});var n=/\?/.test(e),o="";for(var i in r)o===""?!n&&(e+="?"):o+="&",o+=i+"="+encodeURIComponent(r[i]);return e+=o,/^http(s)?\:\/\//.test(e)?e:""+t+e}const wm=Object.freeze(Object.defineProperty({__proto__:null,AbstractSDKRequest:Uc,AbstractStorage:dv,get StorageType(){return so},formatUrl:Xn},Symbol.toStringTag,{value:"Module"}));function hv(t){return Object.prototype.toString.call(t)==="[object Array]"}function pv(t){return typeof t=="string"}function Em(t){return Object.prototype.toString.call(t)==="[object Object]"}function Sm(t,e){return t instanceof e}function vv(t){return Object.prototype.toString.call(t)==="[object FormData]"}function Im(){return Math.random().toString(16).slice(2)}function yv(){var t=new Date().getTime(),e=Date?.now&&Date.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var n=Math.random()*16;return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(e+n)%16|0,e=Math.floor(e/16)),(r==="x"?n:n&7|8).toString(16)})}function mv(t,e,r){r===void 0&&(r={});var n=/\?/.test(e),o="";return Object.keys(r).forEach(function(i){o===""?!n&&(e+="?"):o+="&",o+="".concat(i,"=").concat(encodeURIComponent(r[i]))}),e+=o,/^http(s)?:\/\//.test(e)?e:"".concat(t).concat(e)}function Om(t){t===void 0&&(t={});var e=[];return Object.keys(t).forEach(function(r){e.push("".concat(r,"=").concat(encodeURIComponent(t[r])))}),e.join("&")}function gv(t,e,r){if(r===void 0&&(r=null),t&&typeof t=="function")return t(e,r);if(e)throw e;return r}function Sn(t,e){console.warn("[".concat(qo(),"][").concat(t,"]:").concat(e))}var Am=function(t){t=t.replace(/^\?/,"");var e={},r=t.split("&");return r.forEach(function(n){var o=n.split("="),i=o[0],s=o[1];i=decodeURIComponent(i),s=decodeURIComponent(s),i&&(e[i]?Array.isArray(e[i])?e[i].push(s):e[i]=[e[i],s]:e[i]=s)}),e},Tm=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),qe=function(){return qe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},qe.apply(this,arguments)},sa=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},ua=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Rm=(function(t){Tm(e,t);function e(r){var n=t.call(this)||this,o=r.timeout,i=r.timeoutMsg,s=r.restrictedMethods;return n.timeout=o||0,n.timeoutMsg=i||"请求超时",n.restrictedMethods=s||["get","post","upload","download"],n}return e.prototype.get=function(r){return this.request(qe(qe({},r),{method:"get"}),this.restrictedMethods.includes("get"))},e.prototype.post=function(r){return this.request(qe(qe({},r),{method:"post"}),this.restrictedMethods.includes("post"))},e.prototype.put=function(r){return this.request(qe(qe({},r),{method:"put"}))},e.prototype.upload=function(r){var n=r.data,o=r.file,i=r.name,s=r.method,u=r.headers,l=u===void 0?{}:u,a={post:"post",put:"put"}[s?.toLowerCase()]||"put",c=new FormData;return a==="post"?(Object.keys(n).forEach(function(f){c.append(f,n[f])}),c.append("key",i),c.append("file",o),this.request(qe(qe({},r),{data:c,method:a}),this.restrictedMethods.includes("upload"))):this.request(qe(qe({},r),{method:"put",headers:l,body:o}),this.restrictedMethods.includes("upload"))},e.prototype.download=function(r){return sa(this,void 0,void 0,function(){var n,o,i,s;return ua(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.get(qe(qe({},r),{headers:{},responseType:"blob"}))];case 1:return n=u.sent().data,o=window.URL.createObjectURL(new Blob([n])),i=decodeURIComponent(new URL(r.url).pathname.split("/").pop()||""),s=document.createElement("a"),s.href=o,s.setAttribute("download",i),s.style.display="none",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(o),document.body.removeChild(s),[3,3];case 2:return u.sent(),[3,3];case 3:return[2,new Promise(function(l){l({statusCode:200,tempFilePath:r.url})})]}})})},e.prototype.fetch=function(r){var n;return sa(this,void 0,void 0,function(){var o,i,s,u,l,a,c,f,d,h,y,m=this;return ua(this,function(b){switch(b.label){case 0:return o=new AbortController,i=r.url,s=r.enableAbort,u=s===void 0?!1:s,l=r.stream,a=l===void 0?!1:l,c=r.signal,f=r.timeout,d=f??this.timeout,c&&(c.aborted&&o.abort(),c.addEventListener("abort",function(){return o.abort()})),h=null,u&&d&&(h=setTimeout(function(){console.warn(m.timeoutMsg),o.abort(new Error(m.timeoutMsg))},d)),[4,fetch(i,qe(qe({},r),{signal:o.signal})).then(function(w){return sa(m,void 0,void 0,function(){var _,E,I;return ua(this,function(R){switch(R.label){case 0:return clearTimeout(h),w.ok?(_=w,[3,3]):[3,1];case 1:return I=(E=Promise).reject,[4,w.json()];case 2:_=I.apply(E,[R.sent()]),R.label=3;case 3:return[2,_]}})})}).catch(function(w){return clearTimeout(h),Promise.reject(w)})];case 1:return y=b.sent(),[2,{data:a?y.body:!((n=y.headers.get("content-type"))===null||n===void 0)&&n.includes("application/json")?y.json():y.text(),statusCode:y.status,header:y.headers}]}})})},e.prototype.request=function(r,n){var o=this;n===void 0&&(n=!1);var i=String(r.method).toLowerCase()||"get";return new Promise(function(s){var u=r.url,l=r.headers,a=l===void 0?{}:l,c=r.data,f=r.responseType,d=r.withCredentials,h=r.body,y=r.onUploadProgress,m=mv(bm(),u,i==="get"?c:{}),b=new XMLHttpRequest;b.open(i,m),f&&(b.responseType=f),Object.keys(a).forEach(function(E){b.setRequestHeader(E,a[E])});var w;y&&b.upload.addEventListener("progress",y),b.onreadystatechange=function(){var E={};if(b.readyState===4){var I=b.getAllResponseHeaders(),R=I.trim().split(/[\r\n]+/),x={};R.forEach(function(P){var D=P.split(": "),O=D.shift().toLowerCase(),C=D.join(": ");x[O]=C}),E.header=x,E.statusCode=b.status;try{E.data=f==="blob"?b.response:JSON.parse(b.responseText)}catch{E.data=f==="blob"?b.response:b.responseText}clearTimeout(w),s(E)}},n&&o.timeout&&(w=setTimeout(function(){console.warn(o.timeoutMsg),b.abort()},o.timeout));var _;vv(c)?_=c:a["content-type"]==="application/x-www-form-urlencoded"?_=Om(c):h?_=h:_=c?JSON.stringify(c):void 0,d&&(b.withCredentials=!0),b.send(_)})},e})(Uc);function Cm(){var t={type:"default",root:window,reqClass:Rm,wsClass:WebSocket,localStorage};return t}var ac=function(){return ac=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ac.apply(this,arguments)},sc;(function(t){t.WEB="web",t.WX_MP="wx_mp"})(sc||(sc={}));function xm(t,e){for(var r=hv(t)?t:[t],n=0,o=r;n<o.length;n++){var i=o[n],s=i.isMatch,u=i.genAdapter,l=i.runtime;if(s())return{adapter:ac({isMatch:s},u(e)),runtime:l}}}function Nm(){return{adapter:Cm(),runtime:sc.WEB}}var xi={},Pm=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),ca=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,[])).next())})},la=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},fa=(function(t){Pm(e,t);function e(r){var n=t.call(this)||this;return n.root=r,r.tcbCacheObject||(r.tcbCacheObject={}),n}return e.prototype.setItem=function(r,n){this.root.tcbCacheObject[r]=n},e.prototype.getItem=function(r){return this.root.tcbCacheObject[r]},e.prototype.removeItem=function(r){delete this.root.tcbCacheObject[r]},e.prototype.clear=function(){delete this.root.tcbCacheObject},e})(dv);function Dm(t,e){switch(t){case"local":return e.localStorage?e.localStorage:(Sn(rt.INVALID_PARAMS,"localStorage is not supported on current platform"),new fa(e.root));case"none":return new fa(e.root);default:return e.localStorage?e.localStorage:(Sn(rt.INVALID_PARAMS,"localStorage is not supported on current platform"),new fa(e.root))}}var Lm=(function(){function t(e){this.keys={};var r=e.persistence,n=e.platformInfo,o=n===void 0?{}:n,i=e.keys,s=i===void 0?{}:i;this.platformInfo=o,this.storage||(this.persistenceTag=this.platformInfo.adapter.primaryStorage||r,this.storage=Dm(this.persistenceTag,this.platformInfo.adapter),this.keys=s)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this.storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this.persistenceTag},enumerable:!1,configurable:!0}),t.prototype.setStore=function(e,r,n){if(this.mode==="async"){Sn(rt.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed");return}if(this.storage)try{var o={version:n||"localCachev1",content:r};this.storage.setItem(e,JSON.stringify(o))}catch(i){throw new Error(JSON.stringify({code:rt.OPERATION_FAIL,msg:"[".concat(qo(),"][").concat(rt.OPERATION_FAIL,"]setStore failed"),info:i}))}},t.prototype.setStoreAsync=function(e,r,n){return ca(this,void 0,void 0,function(){var o;return la(this,function(i){switch(i.label){case 0:if(!this.storage)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),o={version:n||"localCachev1",content:r},[4,this.storage.setItem(e,JSON.stringify(o))];case 2:return i.sent(),[3,4];case 3:return i.sent(),[2];case 4:return[2]}})})},t.prototype.getStore=function(e,r){var n;if(this.mode==="async"){Sn(rt.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed");return}try{if(typeof process<"u"&&(!((n=xi)===null||n===void 0)&&n.tcb_token))return xi.tcb_token;if(!this.storage)return""}catch{return""}r=r||"localCachev1";var o=this.storage.getItem(e);if(!o)return"";if(o.indexOf(r)>=0){var i=JSON.parse(o);return i.content}return""},t.prototype.getStoreAsync=function(e,r){var n;return ca(this,void 0,void 0,function(){var o,i;return la(this,function(s){switch(s.label){case 0:try{if(typeof process<"u"&&(!((n=xi)===null||n===void 0)&&n.tcb_token))return[2,xi.tcb_token];if(!this.storage)return[2,""]}catch{return[2,""]}return r=r||"localCachev1",[4,this.storage.getItem(e)];case 1:return o=s.sent(),o?o.indexOf(r)>=0?(i=JSON.parse(o),[2,i.content]):[2,""]:[2,""]}})})},t.prototype.removeStore=function(e){if(this.mode==="async"){Sn(rt.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed");return}this.storage.removeItem(e)},t.prototype.removeStoreAsync=function(e){return ca(this,void 0,void 0,function(){return la(this,function(r){switch(r.label){case 0:return[4,this.storage.removeItem(e)];case 1:return r.sent(),[2]}})})},t})(),Um=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),qm=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))};function Fm(t,e,r){r[t]=r[t]||[],r[t].push(e)}function Bm(t,e,r){if(r?.[t]){var n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}var _v=(function(){function t(e,r){this.data=r||null,this.name=e}return t})(),jm=(function(t){Um(e,t);function e(r,n){var o=t.call(this,"error",{error:r,data:n})||this;return o.error=r,o}return e})(_v),bv=(function(){function t(){this.listeners={}}return t.prototype.on=function(e,r){return Fm(e,r,this.listeners),this},t.prototype.off=function(e,r){return Bm(e,r,this.listeners),this},t.prototype.fire=function(e,r){if(Sm(e,jm))return console.error(e.error),this;var n=pv(e)?new _v(e,r||{}):e,o=n.name;if(this.listens(o)){n.target=this;for(var i=this.listeners[o]?qm([],this.listeners[o],!0):[],s=0,u=i;s<u.length;s++){var l=u[s];l.call(this,n)}}return this},t.prototype.listens=function(e){return this.listeners[e]&&this.listeners[e].length>0},t})(),Bo=new bv,jo="lang_change";typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox");function Mo(t){return t.mode,t.customInfo,t.title,t.messages,function(e,r,n){}}function uc(t){this.message=t}uc.prototype=new Error,uc.prototype.name="InvalidCharacterError";typeof window<"u"&&window.atob&&window.atob.bind(window);function Cl(t){this.message=t}Cl.prototype=new Error,Cl.prototype.name="InvalidTokenError";/**
 * @license
 * web-streams-polyfill v4.2.0
 * Copyright 2025 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */function di(){}function Te(t){return typeof t=="object"&&t!==null||typeof t=="function"}const wv=di;function ie(t,e){try{Object.defineProperty(t,"name",{value:e,configurable:!0})}catch{}}const qc=Promise,Mm=Promise.resolve.bind(qc),km=Promise.prototype.then,$m=Promise.reject.bind(qc),Wm=Mm;function we(t){return new qc(t)}function oe(t){return we(e=>e(t))}function $(t){return $m(t)}function Wt(t,e,r){return km.call(t,e,r)}function nt(t,e,r){Wt(Wt(t,e,r),void 0,wv)}function da(t,e){nt(t,e)}function cc(t,e){nt(t,void 0,e)}function or(t,e,r){return Wt(t,e,r)}function Fn(t){Wt(t,void 0,wv)}let Kr=t=>{if(typeof queueMicrotask=="function")Kr=queueMicrotask;else{const e=oe(void 0);Kr=r=>Wt(e,r)}return Kr(t)};function Xr(t,e,r){if(typeof t!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(t,e,r)}function ar(t,e,r){try{return oe(Xr(t,e,r))}catch(n){return $(n)}}class _t{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){const r=this._back;let n=r;r._elements.length===16383&&(n={_elements:[],_next:void 0}),r._elements.push(e),n!==r&&(this._back=n,r._next=n),++this._size}shift(){const e=this._front;let r=e;const n=this._cursor;let o=n+1;const i=e._elements,s=i[n];return o===16384&&(r=e._next,o=0),--this._size,this._cursor=o,e!==r&&(this._front=r),i[n]=void 0,s}forEach(e){let r=this._cursor,n=this._front,o=n._elements;for(;!(r===o.length&&n._next===void 0||r===o.length&&(n=n._next,o=n._elements,r=0,o.length===0));)e(o[r]),++r}peek(){const e=this._front,r=this._cursor;return e._elements[r]}}const Ev=Symbol("[[AbortSteps]]"),Sv=Symbol("[[ErrorSteps]]"),Fc=Symbol("[[CancelSteps]]"),Bc=Symbol("[[PullSteps]]"),jc=Symbol("[[ReleaseSteps]]");function Iv(t,e){t._ownerReadableStream=e,e._reader=t,e._state==="readable"?lc(t):e._state==="closed"?(function(r){lc(r),Av(r)})(t):Ov(t,e._storedError)}function Mc(t,e){return Rt(t._ownerReadableStream,e)}function nr(t){const e=t._ownerReadableStream;e._state==="readable"?kc(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):(function(r,n){Ov(r,n)})(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._readableStreamController[jc](),e._reader=void 0,t._ownerReadableStream=void 0}function uo(t){return new TypeError("Cannot "+t+" a stream using a released reader")}function lc(t){t._closedPromise=we((e,r)=>{t._closedPromise_resolve=e,t._closedPromise_reject=r})}function Ov(t,e){lc(t),kc(t,e)}function kc(t,e){t._closedPromise_reject!==void 0&&(Fn(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}function Av(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}const xl=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},Gm=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};function ir(t,e){if(t!==void 0&&typeof(r=t)!="object"&&typeof r!="function")throw new TypeError(`${e} is not an object.`);var r}function bt(t,e){if(typeof t!="function")throw new TypeError(`${e} is not a function.`)}function Tv(t,e){if(!(function(r){return typeof r=="object"&&r!==null||typeof r=="function"})(t))throw new TypeError(`${e} is not an object.`)}function Zr(t,e,r){if(t===void 0)throw new TypeError(`Parameter ${e} is required in '${r}'.`)}function Nl(t,e,r){if(t===void 0)throw new TypeError(`${e} is required in '${r}'.`)}function Rv(t){return Number(t)}function Pl(t){return t===0?0:t}function $c(t,e){const r=Number.MAX_SAFE_INTEGER;let n=Number(t);if(n=Pl(n),!xl(n))throw new TypeError(`${e} is not a finite number`);if(n=(function(o){return Pl(Gm(o))})(n),n<0||n>r)throw new TypeError(`${e} is outside the accepted range of 0 to ${r}, inclusive`);return xl(n)&&n!==0?n:0}function Wc(t,e){if(!lr(t))throw new TypeError(`${e} is not a ReadableStream.`)}function In(t){return new qr(t)}function Cv(t,e){t._reader._readRequests.push(e)}function Gc(t,e,r){const n=t._reader._readRequests.shift();r?n._closeSteps():n._chunkSteps(e)}function ko(t){return t._reader._readRequests.length}function xv(t){const e=t._reader;return e!==void 0&&!!mr(e)}class qr{constructor(e){if(Zr(e,1,"ReadableStreamDefaultReader"),Wc(e,"First parameter"),gr(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Iv(this,e),this._readRequests=new _t}get closed(){return mr(this)?this._closedPromise:$(Ni("closed"))}cancel(e=void 0){return mr(this)?this._ownerReadableStream===void 0?$(uo("cancel")):Mc(this,e):$(Ni("cancel"))}read(){if(!mr(this))return $(Ni("read"));if(this._ownerReadableStream===void 0)return $(uo("read from"));let e,r;const n=we((o,i)=>{e=o,r=i});return hi(this,{_chunkSteps:o=>e({value:o,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:o=>r(o)}),n}releaseLock(){if(!mr(this))throw Ni("releaseLock");this._ownerReadableStream!==void 0&&(function(e){nr(e);const r=new TypeError("Reader was released");Nv(e,r)})(this)}}function mr(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readRequests")&&t instanceof qr}function hi(t,e){const r=t._ownerReadableStream;r._disturbed=!0,r._state==="closed"?e._closeSteps():r._state==="errored"?e._errorSteps(r._storedError):r._readableStreamController[Bc](e)}function Nv(t,e){const r=t._readRequests;t._readRequests=new _t,r.forEach(n=>{n._errorSteps(e)})}function Ni(t){return new TypeError(`ReadableStreamDefaultReader.prototype.${t} can only be used on a ReadableStreamDefaultReader`)}var ha,pa,va;function Zn(t){return t.slice()}function Pv(t,e,r,n,o){new Uint8Array(t).set(new Uint8Array(r,n,o),e)}Object.defineProperties(qr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),ie(qr.prototype.cancel,"cancel"),ie(qr.prototype.read,"read"),ie(qr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(qr.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});let en=t=>(en=typeof t.transfer=="function"?e=>e.transfer():typeof structuredClone=="function"?e=>structuredClone(e,{transfer:[e]}):e=>e,en(t)),tn=t=>(tn=typeof t.detached=="boolean"?e=>e.detached:e=>e.byteLength===0,tn(t));function Dv(t,e,r){if(t.slice)return t.slice(e,r);const n=r-e,o=new ArrayBuffer(n);return Pv(o,0,t,e,n),o}function ei(t,e){const r=t[e];if(r!=null){if(typeof r!="function")throw new TypeError(`${String(e)} is not a function`);return r}}function Dl(t){try{const e=t.done,r=t.value;return Wt(Wm(r),n=>({done:e,value:n}))}catch(e){return $(e)}}const Ai=(va=(ha=Symbol.asyncIterator)!==null&&ha!==void 0?ha:(pa=Symbol.for)===null||pa===void 0?void 0:pa.call(Symbol,"Symbol.asyncIterator"))!==null&&va!==void 0?va:"@@asyncIterator";function Lv(t,e="sync",r){if(r===void 0)if(e==="async"){if((r=ei(t,Ai))===void 0)return(function(o){const i={next(){let s;try{s=Uv(o)}catch(u){return $(u)}return Dl(s)},return(s){let u;try{const l=ei(o.iterator,"return");if(l===void 0)return oe({done:!0,value:s});u=Xr(l,o.iterator,[s])}catch(l){return $(l)}return Te(u)?Dl(u):$(new TypeError("The iterator.return() method must return an object"))}};return{iterator:i,nextMethod:i.next,done:!1}})(Lv(t,"sync",ei(t,Symbol.iterator)))}else r=ei(t,Symbol.iterator);if(r===void 0)throw new TypeError("The object is not iterable");const n=Xr(r,t,[]);if(!Te(n))throw new TypeError("The iterator method must return an object");return{iterator:n,nextMethod:n.next,done:!1}}function Uv(t){const e=Xr(t.nextMethod,t.iterator,[]);if(!Te(e))throw new TypeError("The iterator.next() method must return an object");return e}class qv{constructor(e,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=r}next(){const e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?or(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){const r=()=>this._returnSteps(e);return this._ongoingPromise=this._ongoingPromise?or(this._ongoingPromise,r,r):r(),this._ongoingPromise}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const e=this._reader;let r,n;const o=we((i,s)=>{r=i,n=s});return hi(e,{_chunkSteps:i=>{this._ongoingPromise=void 0,Kr(()=>r({value:i,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,nr(e),r({value:void 0,done:!0})},_errorSteps:i=>{this._ongoingPromise=void 0,this._isFinished=!0,nr(e),n(i)}}),o}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;const r=this._reader;if(!this._preventCancel){const n=Mc(r,e);return nr(r),or(n,()=>({value:e,done:!0}))}return nr(r),oe({value:e,done:!0})}}const Fv={next(){return Ll(this)?this._asyncIteratorImpl.next():$(Ul("next"))},return(t){return Ll(this)?this._asyncIteratorImpl.return(t):$(Ul("return"))},[Ai](){return this}};function Ll(t){if(!Te(t)||!Object.prototype.hasOwnProperty.call(t,"_asyncIteratorImpl"))return!1;try{return t._asyncIteratorImpl instanceof qv}catch{return!1}}function Ul(t){return new TypeError(`ReadableStreamAsyncIterator.${t} can only be used on a ReadableSteamAsyncIterator`)}Object.defineProperty(Fv,Ai,{enumerable:!1});const Bv=Number.isNaN||function(t){return t!=t};function ql(t){const e=Dv(t.buffer,t.byteOffset,t.byteOffset+t.byteLength);return new Uint8Array(e)}function fc(t){const e=t._queue.shift();return t._queueTotalSize-=e.size,t._queueTotalSize<0&&(t._queueTotalSize=0),e.value}function Hc(t,e,r){if(typeof(n=r)!="number"||Bv(n)||n<0||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");var n;t._queue.push({value:e,size:r}),t._queueTotalSize+=r}function Sr(t){t._queue=new _t,t._queueTotalSize=0}function jv(t){return t===DataView}class yn{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!ya(this))throw ma("view");return this._view}respond(e){if(!ya(this))throw ma("respond");if(Zr(e,1,"respond"),e=$c(e,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(tn(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");Qi(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!ya(this))throw ma("respondWithNewView");if(Zr(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(tn(e.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Xi(this._associatedReadableByteStreamController,e)}}Object.defineProperties(yn.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),ie(yn.prototype.respond,"respond"),ie(yn.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(yn.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class vr{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Fr(this))throw Wn("byobRequest");return hc(this)}get desiredSize(){if(!Fr(this))throw Wn("desiredSize");return Yv(this)}close(){if(!Fr(this))throw Wn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const e=this._controlledReadableByteStream._state;if(e!=="readable")throw new TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);ti(this)}enqueue(e){if(!Fr(this))throw Wn("enqueue");if(Zr(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(e.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(e.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError(`The stream (in ${r} state) is not in the readable state and cannot be enqueued to`);Yi(this,e)}error(e=void 0){if(!Fr(this))throw Wn("error");yt(this,e)}[Fc](e){Mv(this),Sr(this);const r=this._cancelAlgorithm(e);return $o(this),r}[Bc](e){const r=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void zv(this,e);const n=this._autoAllocateChunkSize;if(n!==void 0){let o;try{o=new ArrayBuffer(n)}catch(s){return void e._errorSteps(s)}const i={buffer:o,bufferByteLength:n,byteOffset:0,byteLength:n,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(i)}Cv(r,e),on(this)}[jc](){if(this._pendingPullIntos.length>0){const e=this._pendingPullIntos.peek();e.readerType="none",this._pendingPullIntos=new _t,this._pendingPullIntos.push(e)}}}function Fr(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledReadableByteStream")&&t instanceof vr}function ya(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_associatedReadableByteStreamController")&&t instanceof yn}function on(t){if((function(r){const n=r._controlledReadableByteStream;return n._state!=="readable"||r._closeRequested||!r._started?!1:!!(xv(n)&&ko(n)>0||Kc(n)&&Zv(n)>0||Yv(r)>0)})(t)){if(t._pulling)return void(t._pullAgain=!0);t._pulling=!0,nt(t._pullAlgorithm(),()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,on(t)),null),r=>(yt(t,r),null))}}function Mv(t){Vc(t),t._pendingPullIntos=new _t}function kv(t,e){let r=!1;t._state==="closed"&&(r=!0);const n=$v(e);e.readerType==="default"?Gc(t,n,r):(function(o,i,s){const u=o._reader,l=u._readIntoRequests.shift();s?l._closeSteps(i):l._chunkSteps(i)})(t,n,r)}function Ji(t,e){for(let r=0;r<e.length;++r)kv(t,e[r])}function $v(t){const e=t.bytesFilled,r=t.elementSize;return new t.viewConstructor(t.buffer,t.byteOffset,e/r)}function zi(t,e,r,n){t._queue.push({buffer:e,byteOffset:r,byteLength:n}),t._queueTotalSize+=n}function Wv(t,e,r,n){let o;try{o=Dv(e,r,r+n)}catch(i){throw yt(t,i),i}zi(t,o,0,n)}function Gv(t,e){e.bytesFilled>0&&Wv(t,e.buffer,e.byteOffset,e.bytesFilled),On(t)}function Hv(t,e){const r=Math.min(t._queueTotalSize,e.byteLength-e.bytesFilled),n=e.bytesFilled+r;let o=r,i=!1;const s=n-n%e.elementSize;s>=e.minimumFill&&(o=s-e.bytesFilled,i=!0);const u=t._queue;for(;o>0;){const l=u.peek(),a=Math.min(o,l.byteLength),c=e.byteOffset+e.bytesFilled;Pv(e.buffer,c,l.buffer,l.byteOffset,a),l.byteLength===a?u.shift():(l.byteOffset+=a,l.byteLength-=a),t._queueTotalSize-=a,Vv(t,a,e),o-=a}return i}function Vv(t,e,r){r.bytesFilled+=e}function Kv(t){t._queueTotalSize===0&&t._closeRequested?($o(t),Ti(t._controlledReadableByteStream)):on(t)}function Vc(t){t._byobRequest!==null&&(t._byobRequest._associatedReadableByteStreamController=void 0,t._byobRequest._view=null,t._byobRequest=null)}function dc(t){const e=[];for(;t._pendingPullIntos.length>0&&t._queueTotalSize!==0;){const r=t._pendingPullIntos.peek();Hv(t,r)&&(On(t),e.push(r))}return e}function Hm(t,e,r,n){const o=t._controlledReadableByteStream,i=e.constructor,s=(function(d){return jv(d)?1:d.BYTES_PER_ELEMENT})(i),{byteOffset:u,byteLength:l}=e,a=r*s;let c;try{c=en(e.buffer)}catch(d){return void n._errorSteps(d)}const f={buffer:c,bufferByteLength:c.byteLength,byteOffset:u,byteLength:l,bytesFilled:0,minimumFill:a,elementSize:s,viewConstructor:i,readerType:"byob"};if(t._pendingPullIntos.length>0)return t._pendingPullIntos.push(f),void Fl(o,n);if(o._state==="closed"){const d=new i(f.buffer,f.byteOffset,0);return void n._closeSteps(d)}if(t._queueTotalSize>0){if(Hv(t,f)){const d=$v(f);return Kv(t),void n._chunkSteps(d)}if(t._closeRequested){const d=new TypeError("Insufficient bytes to fill elements in the given buffer");return yt(t,d),void n._errorSteps(d)}}t._pendingPullIntos.push(f),Fl(o,n),on(t)}function Jv(t,e){const r=t._pendingPullIntos.peek();Vc(t),t._controlledReadableByteStream._state==="closed"?(function(n,o){o.readerType==="none"&&On(n);const i=n._controlledReadableByteStream;if(Kc(i)){const s=[];for(;s.length<Zv(i);)s.push(On(n));Ji(i,s)}})(t,r):(function(n,o,i){if(Vv(0,o,i),i.readerType==="none"){Gv(n,i);const l=dc(n);return void Ji(n._controlledReadableByteStream,l)}if(i.bytesFilled<i.minimumFill)return;On(n);const s=i.bytesFilled%i.elementSize;if(s>0){const l=i.byteOffset+i.bytesFilled;Wv(n,i.buffer,l-s,s)}i.bytesFilled-=s;const u=dc(n);kv(n._controlledReadableByteStream,i),Ji(n._controlledReadableByteStream,u)})(t,e,r),on(t)}function On(t){return t._pendingPullIntos.shift()}function $o(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0}function ti(t){const e=t._controlledReadableByteStream;if(!t._closeRequested&&e._state==="readable")if(t._queueTotalSize>0)t._closeRequested=!0;else{if(t._pendingPullIntos.length>0){const r=t._pendingPullIntos.peek();if(r.bytesFilled%r.elementSize!==0){const n=new TypeError("Insufficient bytes to fill elements in the given buffer");throw yt(t,n),n}}$o(t),Ti(e)}}function Yi(t,e){const r=t._controlledReadableByteStream;if(t._closeRequested||r._state!=="readable")return;const{buffer:n,byteOffset:o,byteLength:i}=e;if(tn(n))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");const s=en(n);if(t._pendingPullIntos.length>0){const u=t._pendingPullIntos.peek();if(tn(u.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Vc(t),u.buffer=en(u.buffer),u.readerType==="none"&&Gv(t,u)}xv(r)?((function(u){const l=u._controlledReadableByteStream._reader;for(;l._readRequests.length>0;){if(u._queueTotalSize===0)return;zv(u,l._readRequests.shift())}})(t),ko(r)===0?zi(t,s,o,i):(t._pendingPullIntos.length>0&&On(t),Gc(r,new Uint8Array(s,o,i),!1))):Kc(r)?(zi(t,s,o,i),Ji(r,dc(t))):zi(t,s,o,i),on(t)}function yt(t,e){const r=t._controlledReadableByteStream;r._state==="readable"&&(Mv(t),Sr(t),$o(t),_y(r,e))}function zv(t,e){const r=t._queue.shift();t._queueTotalSize-=r.byteLength,Kv(t);const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);e._chunkSteps(n)}function hc(t){if(t._byobRequest===null&&t._pendingPullIntos.length>0){const e=t._pendingPullIntos.peek(),r=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),n=Object.create(yn.prototype);(function(o,i,s){o._associatedReadableByteStreamController=i,o._view=s})(n,t,r),t._byobRequest=n}return t._byobRequest}function Yv(t){const e=t._controlledReadableByteStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function Qi(t,e){const r=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(e!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(e===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+e>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=en(r.buffer),Jv(t,e)}function Xi(t,e){const r=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(e.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(e.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==e.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==e.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+e.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const n=e.byteLength;r.buffer=en(e.buffer),Jv(t,n)}function Qv(t,e,r,n,o,i,s){e._controlledReadableByteStream=t,e._pullAgain=!1,e._pulling=!1,e._byobRequest=null,e._queue=e._queueTotalSize=void 0,Sr(e),e._closeRequested=!1,e._started=!1,e._strategyHWM=i,e._pullAlgorithm=n,e._cancelAlgorithm=o,e._autoAllocateChunkSize=s,e._pendingPullIntos=new _t,t._readableStreamController=e,nt(oe(r()),()=>(e._started=!0,on(e),null),u=>(yt(e,u),null))}function ma(t){return new TypeError(`ReadableStreamBYOBRequest.prototype.${t} can only be used on a ReadableStreamBYOBRequest`)}function Wn(t){return new TypeError(`ReadableByteStreamController.prototype.${t} can only be used on a ReadableByteStreamController`)}function Vm(t,e){if((t=`${t}`)!="byob")throw new TypeError(`${e} '${t}' is not a valid enumeration value for ReadableStreamReaderMode`);return t}function Xv(t){return new Br(t)}function Fl(t,e){t._reader._readIntoRequests.push(e)}function Zv(t){return t._reader._readIntoRequests.length}function Kc(t){const e=t._reader;return e!==void 0&&!!Gr(e)}Object.defineProperties(vr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),ie(vr.prototype.close,"close"),ie(vr.prototype.enqueue,"enqueue"),ie(vr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vr.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class Br{constructor(e){if(Zr(e,1,"ReadableStreamBYOBReader"),Wc(e,"First parameter"),gr(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Fr(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Iv(this,e),this._readIntoRequests=new _t}get closed(){return Gr(this)?this._closedPromise:$(Pi("closed"))}cancel(e=void 0){return Gr(this)?this._ownerReadableStream===void 0?$(uo("cancel")):Mc(this,e):$(Pi("cancel"))}read(e,r={}){if(!Gr(this))return $(Pi("read"));if(!ArrayBuffer.isView(e))return $(new TypeError("view must be an array buffer view"));if(e.byteLength===0)return $(new TypeError("view must have non-zero byteLength"));if(e.buffer.byteLength===0)return $(new TypeError("view's buffer must have non-zero byteLength"));if(tn(e.buffer))return $(new TypeError("view's buffer has been detached"));let n;try{n=(function(l,a){var c;return ir(l,a),{min:$c((c=l?.min)!==null&&c!==void 0?c:1,`${a} has member 'min' that`)}})(r,"options")}catch(l){return $(l)}const o=n.min;if(o===0)return $(new TypeError("options.min must be greater than 0"));if((function(l){return jv(l.constructor)})(e)){if(o>e.byteLength)return $(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(o>e.length)return $(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return $(uo("read from"));let i,s;const u=we((l,a)=>{i=l,s=a});return ey(this,e,o,{_chunkSteps:l=>i({value:l,done:!1}),_closeSteps:l=>i({value:l,done:!0}),_errorSteps:l=>s(l)}),u}releaseLock(){if(!Gr(this))throw Pi("releaseLock");this._ownerReadableStream!==void 0&&(function(e){nr(e);const r=new TypeError("Reader was released");ty(e,r)})(this)}}function Gr(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readIntoRequests")&&t instanceof Br}function ey(t,e,r,n){const o=t._ownerReadableStream;o._disturbed=!0,o._state==="errored"?n._errorSteps(o._storedError):Hm(o._readableStreamController,e,r,n)}function ty(t,e){const r=t._readIntoRequests;t._readIntoRequests=new _t,r.forEach(n=>{n._errorSteps(e)})}function Pi(t){return new TypeError(`ReadableStreamBYOBReader.prototype.${t} can only be used on a ReadableStreamBYOBReader`)}function pi(t,e){const{highWaterMark:r}=t;if(r===void 0)return e;if(Bv(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function co(t){const{size:e}=t;return e||(()=>1)}function lo(t,e){ir(t,e);const r=t?.highWaterMark,n=t?.size;return{highWaterMark:r===void 0?void 0:Rv(r),size:n===void 0?void 0:Km(n,`${e} has member 'size' that`)}}function Km(t,e){return bt(t,e),r=>Rv(t(r))}function Jm(t,e,r){return bt(t,r),n=>ar(t,e,[n])}function zm(t,e,r){return bt(t,r),()=>ar(t,e,[])}function Ym(t,e,r){return bt(t,r),n=>Xr(t,e,[n])}function Qm(t,e,r){return bt(t,r),(n,o)=>ar(t,e,[n,o])}function ry(t,e){if(!mn(t))throw new TypeError(`${e} is not a WritableStream.`)}Object.defineProperties(Br.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),ie(Br.prototype.cancel,"cancel"),ie(Br.prototype.read,"read"),ie(Br.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Br.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});class jr{constructor(e={},r={}){e===void 0?e=null:Tv(e,"First parameter");const n=lo(r,"Second parameter"),o=(function(s,u){ir(s,u);const l=s?.abort,a=s?.close,c=s?.start,f=s?.type,d=s?.write;return{abort:l===void 0?void 0:Jm(l,s,`${u} has member 'abort' that`),close:a===void 0?void 0:zm(a,s,`${u} has member 'close' that`),start:c===void 0?void 0:Ym(c,s,`${u} has member 'start' that`),write:d===void 0?void 0:Qm(d,s,`${u} has member 'write' that`),type:f}})(e,"First parameter");if(iy(this),o.type!==void 0)throw new RangeError("Invalid type is specified");const i=co(n);(function(s,u,l,a){const c=Object.create(vi.prototype);let f,d,h,y;f=u.start!==void 0?()=>u.start(c):()=>{},d=u.write!==void 0?m=>u.write(m,c):()=>oe(void 0),h=u.close!==void 0?()=>u.close():()=>oe(void 0),y=u.abort!==void 0?m=>u.abort(m):()=>oe(void 0),fy(s,c,f,d,h,y,l,a)})(this,o,pi(n,1),i)}get locked(){if(!mn(this))throw Li("locked");return An(this)}abort(e=void 0){return mn(this)?An(this)?$(new TypeError("Cannot abort a stream that already has a writer")):fo(this,e):$(Li("abort"))}close(){return mn(this)?An(this)?$(new TypeError("Cannot close a stream that already has a writer")):Gt(this)?$(new TypeError("Cannot close an already-closing stream")):oy(this):$(Li("close"))}getWriter(){if(!mn(this))throw Li("getWriter");return ny(this)}}function ny(t){return new fr(t)}function iy(t){t._state="writable",t._storedError=void 0,t._writer=void 0,t._writableStreamController=void 0,t._writeRequests=new _t,t._inFlightWriteRequest=void 0,t._closeRequest=void 0,t._inFlightCloseRequest=void 0,t._pendingAbortRequest=void 0,t._backpressure=!1}function mn(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_writableStreamController")&&t instanceof jr}function An(t){return t._writer!==void 0}function fo(t,e){var r;if(t._state==="closed"||t._state==="errored")return oe(void 0);t._writableStreamController._abortReason=e,(r=t._writableStreamController._abortController)===null||r===void 0||r.abort(e);const n=t._state;if(n==="closed"||n==="errored")return oe(void 0);if(t._pendingAbortRequest!==void 0)return t._pendingAbortRequest._promise;let o=!1;n==="erroring"&&(o=!0,e=void 0);const i=we((s,u)=>{t._pendingAbortRequest={_promise:void 0,_resolve:s,_reject:u,_reason:e,_wasAlreadyErroring:o}});return t._pendingAbortRequest._promise=i,o||Jc(t,e),i}function oy(t){const e=t._state;if(e==="closed"||e==="errored")return $(new TypeError(`The stream (in ${e} state) is not in the writable state and cannot be closed`));const r=we((i,s)=>{const u={_resolve:i,_reject:s};t._closeRequest=u}),n=t._writer;var o;return n!==void 0&&t._backpressure&&e==="writable"&&Zc(n),Hc(o=t._writableStreamController,ly,0),Wo(o),r}function pc(t,e){t._state!=="writable"?zc(t):Jc(t,e)}function Jc(t,e){const r=t._writableStreamController;t._state="erroring",t._storedError=e;const n=t._writer;n!==void 0&&sy(n,e),!(function(o){return!(o._inFlightWriteRequest===void 0&&o._inFlightCloseRequest===void 0)})(t)&&r._started&&zc(t)}function zc(t){t._state="errored",t._writableStreamController[Sv]();const e=t._storedError;if(t._writeRequests.forEach(n=>{n._reject(e)}),t._writeRequests=new _t,t._pendingAbortRequest===void 0)return void Di(t);const r=t._pendingAbortRequest;if(t._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(e),void Di(t);nt(t._writableStreamController[Ev](r._reason),()=>(r._resolve(),Di(t),null),n=>(r._reject(n),Di(t),null))}function Gt(t){return t._closeRequest!==void 0||t._inFlightCloseRequest!==void 0}function Di(t){t._closeRequest!==void 0&&(t._closeRequest._reject(t._storedError),t._closeRequest=void 0);const e=t._writer;e!==void 0&&Xc(e,t._storedError)}function Yc(t,e){const r=t._writer;r!==void 0&&e!==t._backpressure&&(e?(function(n){Go(n)})(r):Zc(r)),t._backpressure=e}Object.defineProperties(jr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),ie(jr.prototype.abort,"abort"),ie(jr.prototype.close,"close"),ie(jr.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(jr.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});class fr{constructor(e){if(Zr(e,1,"WritableStreamDefaultWriter"),ry(e,"First parameter"),An(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;const r=e._state;if(r==="writable")!Gt(e)&&e._backpressure?Go(this):Bl(this),Zi(this);else if(r==="erroring")vc(this,e._storedError),Zi(this);else if(r==="closed")Bl(this),Zi(n=this),vy(n);else{const o=e._storedError;vc(this,o),py(this,o)}var n}get closed(){return Rr(this)?this._closedPromise:$(Cr("closed"))}get desiredSize(){if(!Rr(this))throw Cr("desiredSize");if(this._ownerWritableStream===void 0)throw ri("desiredSize");return(function(e){const r=e._ownerWritableStream,n=r._state;return n==="errored"||n==="erroring"?null:n==="closed"?0:dy(r._writableStreamController)})(this)}get ready(){return Rr(this)?this._readyPromise:$(Cr("ready"))}abort(e=void 0){return Rr(this)?this._ownerWritableStream===void 0?$(ri("abort")):(function(r,n){return fo(r._ownerWritableStream,n)})(this,e):$(Cr("abort"))}close(){if(!Rr(this))return $(Cr("close"));const e=this._ownerWritableStream;return e===void 0?$(ri("close")):Gt(e)?$(new TypeError("Cannot close an already-closing stream")):ay(this)}releaseLock(){if(!Rr(this))throw Cr("releaseLock");this._ownerWritableStream!==void 0&&uy(this)}write(e=void 0){return Rr(this)?this._ownerWritableStream===void 0?$(ri("write to")):cy(this,e):$(Cr("write"))}}function Rr(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_ownerWritableStream")&&t instanceof fr}function ay(t){return oy(t._ownerWritableStream)}function Xm(t,e){t._closedPromiseState==="pending"?Xc(t,e):(function(r,n){py(r,n)})(t,e)}function sy(t,e){t._readyPromiseState==="pending"?yy(t,e):(function(r,n){vc(r,n)})(t,e)}function uy(t){const e=t._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");sy(t,r),Xm(t,r),e._writer=void 0,t._ownerWritableStream=void 0}function cy(t,e){const r=t._ownerWritableStream,n=r._writableStreamController,o=(function(u,l){if(u._strategySizeAlgorithm===void 0)return 1;try{return u._strategySizeAlgorithm(l)}catch(a){return yi(u,a),1}})(n,e);if(r!==t._ownerWritableStream)return $(ri("write to"));const i=r._state;if(i==="errored")return $(r._storedError);if(Gt(r)||i==="closed")return $(new TypeError("The stream is closing or closed and cannot be written to"));if(i==="erroring")return $(r._storedError);const s=(function(u){return we((l,a)=>{const c={_resolve:l,_reject:a};u._writeRequests.push(c)})})(r);return(function(u,l,a){try{Hc(u,l,a)}catch(f){return void yi(u,f)}const c=u._controlledWritableStream;!Gt(c)&&c._state==="writable"&&Yc(c,Qc(u)),Wo(u)})(n,e,o),s}Object.defineProperties(fr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),ie(fr.prototype.abort,"abort"),ie(fr.prototype.close,"close"),ie(fr.prototype.releaseLock,"releaseLock"),ie(fr.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(fr.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});const ly={};class vi{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ga(this))throw _a("abortReason");return this._abortReason}get signal(){if(!ga(this))throw _a("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e=void 0){if(!ga(this))throw _a("error");this._controlledWritableStream._state==="writable"&&hy(this,e)}[Ev](e){const r=this._abortAlgorithm(e);return ho(this),r}[Sv](){Sr(this)}}function ga(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledWritableStream")&&t instanceof vi}function fy(t,e,r,n,o,i,s,u){e._controlledWritableStream=t,t._writableStreamController=e,e._queue=void 0,e._queueTotalSize=void 0,Sr(e),e._abortReason=void 0,e._abortController=(function(){if(typeof AbortController=="function")return new AbortController})(),e._started=!1,e._strategySizeAlgorithm=u,e._strategyHWM=s,e._writeAlgorithm=n,e._closeAlgorithm=o,e._abortAlgorithm=i;const l=Qc(e);Yc(t,l),nt(oe(r()),()=>(e._started=!0,Wo(e),null),a=>(e._started=!0,pc(t,a),null))}function ho(t){t._writeAlgorithm=void 0,t._closeAlgorithm=void 0,t._abortAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function dy(t){return t._strategyHWM-t._queueTotalSize}function Wo(t){const e=t._controlledWritableStream;if(!t._started||e._inFlightWriteRequest!==void 0)return;if(e._state==="erroring")return void zc(e);if(t._queue.length===0)return;const r=t._queue.peek().value;r===ly?(function(n){const o=n._controlledWritableStream;(function(s){s._inFlightCloseRequest=s._closeRequest,s._closeRequest=void 0})(o),fc(n);const i=n._closeAlgorithm();ho(n),nt(i,()=>((function(s){s._inFlightCloseRequest._resolve(void 0),s._inFlightCloseRequest=void 0,s._state==="erroring"&&(s._storedError=void 0,s._pendingAbortRequest!==void 0&&(s._pendingAbortRequest._resolve(),s._pendingAbortRequest=void 0)),s._state="closed";const u=s._writer;u!==void 0&&vy(u)})(o),null),s=>((function(u,l){u._inFlightCloseRequest._reject(l),u._inFlightCloseRequest=void 0,u._pendingAbortRequest!==void 0&&(u._pendingAbortRequest._reject(l),u._pendingAbortRequest=void 0),pc(u,l)})(o,s),null))})(t):(function(n,o){const i=n._controlledWritableStream;(function(u){u._inFlightWriteRequest=u._writeRequests.shift()})(i);const s=n._writeAlgorithm(o);nt(s,()=>{(function(l){l._inFlightWriteRequest._resolve(void 0),l._inFlightWriteRequest=void 0})(i);const u=i._state;if(fc(n),!Gt(i)&&u==="writable"){const l=Qc(n);Yc(i,l)}return Wo(n),null},u=>(i._state==="writable"&&ho(n),(function(l,a){l._inFlightWriteRequest._reject(a),l._inFlightWriteRequest=void 0,pc(l,a)})(i,u),null))})(t,r)}function yi(t,e){t._controlledWritableStream._state==="writable"&&hy(t,e)}function Qc(t){return dy(t)<=0}function hy(t,e){const r=t._controlledWritableStream;ho(t),Jc(r,e)}function Li(t){return new TypeError(`WritableStream.prototype.${t} can only be used on a WritableStream`)}function _a(t){return new TypeError(`WritableStreamDefaultController.prototype.${t} can only be used on a WritableStreamDefaultController`)}function Cr(t){return new TypeError(`WritableStreamDefaultWriter.prototype.${t} can only be used on a WritableStreamDefaultWriter`)}function ri(t){return new TypeError("Cannot "+t+" a stream using a released writer")}function Zi(t){t._closedPromise=we((e,r)=>{t._closedPromise_resolve=e,t._closedPromise_reject=r,t._closedPromiseState="pending"})}function py(t,e){Zi(t),Xc(t,e)}function Xc(t,e){t._closedPromise_reject!==void 0&&(Fn(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="rejected")}function vy(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="resolved")}function Go(t){t._readyPromise=we((e,r)=>{t._readyPromise_resolve=e,t._readyPromise_reject=r}),t._readyPromiseState="pending"}function vc(t,e){Go(t),yy(t,e)}function Bl(t){Go(t),Zc(t)}function yy(t,e){t._readyPromise_reject!==void 0&&(Fn(t._readyPromise),t._readyPromise_reject(e),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="rejected")}function Zc(t){t._readyPromise_resolve!==void 0&&(t._readyPromise_resolve(void 0),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="fulfilled")}Object.defineProperties(vi.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vi.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});const jl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0,Zm=(function(){const t=jl?.DOMException;return(function(e){if(typeof e!="function"&&typeof e!="object"||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}})(t)?t:void 0})()||(function(){const t=function(e,r){this.message=e||"",this.name=r||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return ie(t,"DOMException"),t.prototype=Object.create(Error.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,configurable:!0}),t})();function Ml(t,e,r,n,o,i){const s=In(t),u=ny(e);t._disturbed=!0;let l=!1,a=oe(void 0);return we((c,f)=>{let d;if(i!==void 0){if(d=()=>{const R=i.reason!==void 0?i.reason:new Zm("Aborted","AbortError"),x=[];n||x.push(()=>e._state==="writable"?fo(e,R):oe(void 0)),o||x.push(()=>t._state==="readable"?Rt(t,R):oe(void 0)),_(()=>Promise.all(x.map(P=>P())),!0,R)},i.aborted)return void d();i.addEventListener("abort",d)}var h,y,m;if(w(t,s._closedPromise,R=>(n?E(!0,R):_(()=>fo(e,R),!0,R),null)),w(e,u._closedPromise,R=>(o?E(!0,R):_(()=>Rt(t,R),!0,R),null)),h=t,y=s._closedPromise,m=()=>(r?E():_(()=>(function(R){const x=R._ownerWritableStream,P=x._state;return Gt(x)||P==="closed"?oe(void 0):P==="errored"?$(x._storedError):ay(R)})(u)),null),h._state==="closed"?m():da(y,m),Gt(e)||e._state==="closed"){const R=new TypeError("the destination writable stream closed before all data could be piped to it");o?E(!0,R):_(()=>Rt(t,R),!0,R)}function b(){const R=a;return Wt(a,()=>R!==a?b():void 0)}function w(R,x,P){R._state==="errored"?P(R._storedError):cc(x,P)}function _(R,x,P){function D(){return nt(R(),()=>I(x,P),O=>I(!0,O)),null}l||(l=!0,e._state!=="writable"||Gt(e)?D():da(b(),D))}function E(R,x){l||(l=!0,e._state!=="writable"||Gt(e)?I(R,x):da(b(),()=>I(R,x)))}function I(R,x){return uy(u),nr(s),i!==void 0&&i.removeEventListener("abort",d),R?f(x):c(void 0),null}Fn(we((R,x)=>{(function P(D){D?R():Wt(l?oe(!0):Wt(u._readyPromise,()=>we((O,C)=>{hi(s,{_chunkSteps:A=>{a=Wt(cy(u,A),void 0,di),O(!1)},_closeSteps:()=>O(!0),_errorSteps:C})})),P,x)})(!1)}))})}class yr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ui(this))throw qi("desiredSize");return el(this)}close(){if(!Ui(this))throw qi("close");if(!Pn(this))throw new TypeError("The stream is not in a state that permits close");rn(this)}enqueue(e=void 0){if(!Ui(this))throw qi("enqueue");if(!Pn(this))throw new TypeError("The stream is not in a state that permits enqueue");return Nn(this,e)}error(e=void 0){if(!Ui(this))throw qi("error");Nt(this,e)}[Fc](e){Sr(this);const r=this._cancelAlgorithm(e);return po(this),r}[Bc](e){const r=this._controlledReadableStream;if(this._queue.length>0){const n=fc(this);this._closeRequested&&this._queue.length===0?(po(this),Ti(r)):mi(this),e._chunkSteps(n)}else Cv(r,e),mi(this)}[jc](){}}function Ui(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledReadableStream")&&t instanceof yr}function mi(t){if(my(t)){if(t._pulling)return void(t._pullAgain=!0);t._pulling=!0,nt(t._pullAlgorithm(),()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,mi(t)),null),e=>(Nt(t,e),null))}}function my(t){const e=t._controlledReadableStream;return!Pn(t)||!t._started?!1:gr(e)&&ko(e)>0?!0:el(t)>0}function po(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function rn(t){if(!Pn(t))return;const e=t._controlledReadableStream;t._closeRequested=!0,t._queue.length===0&&(po(t),Ti(e))}function Nn(t,e){if(!Pn(t))return;const r=t._controlledReadableStream;if(gr(r)&&ko(r)>0)Gc(r,e,!1);else{let n;try{n=t._strategySizeAlgorithm(e)}catch(o){throw Nt(t,o),o}try{Hc(t,e,n)}catch(o){throw Nt(t,o),o}}mi(t)}function Nt(t,e){const r=t._controlledReadableStream;r._state==="readable"&&(Sr(t),po(t),_y(r,e))}function el(t){const e=t._controlledReadableStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function Pn(t){const e=t._controlledReadableStream._state;return!t._closeRequested&&e==="readable"}function gy(t,e,r,n,o,i,s){e._controlledReadableStream=t,e._queue=void 0,e._queueTotalSize=void 0,Sr(e),e._started=!1,e._closeRequested=!1,e._pullAgain=!1,e._pulling=!1,e._strategySizeAlgorithm=s,e._strategyHWM=i,e._pullAlgorithm=n,e._cancelAlgorithm=o,t._readableStreamController=e,nt(oe(r()),()=>(e._started=!0,mi(e),null),u=>(Nt(e,u),null))}function qi(t){return new TypeError(`ReadableStreamDefaultController.prototype.${t} can only be used on a ReadableStreamDefaultController`)}function eg(t,e){return Fr(t._readableStreamController)?(function(r){let n,o,i,s,u,l=In(r),a=!1,c=!1,f=!1,d=!1,h=!1;const y=we(P=>{u=P});function m(P){cc(P._closedPromise,D=>(P!==l||(yt(i._readableStreamController,D),yt(s._readableStreamController,D),d&&h||u(void 0)),null))}function b(){Gr(l)&&(nr(l),l=In(r),m(l)),hi(l,{_chunkSteps:P=>{Kr(()=>{c=!1,f=!1;const D=P;let O=P;if(!d&&!h)try{O=ql(P)}catch(C){return yt(i._readableStreamController,C),yt(s._readableStreamController,C),void u(Rt(r,C))}d||Yi(i._readableStreamController,D),h||Yi(s._readableStreamController,O),a=!1,c?_():f&&E()})},_closeSteps:()=>{a=!1,d||ti(i._readableStreamController),h||ti(s._readableStreamController),i._readableStreamController._pendingPullIntos.length>0&&Qi(i._readableStreamController,0),s._readableStreamController._pendingPullIntos.length>0&&Qi(s._readableStreamController,0),d&&h||u(void 0)},_errorSteps:()=>{a=!1}})}function w(P,D){mr(l)&&(nr(l),l=Xv(r),m(l));const O=D?s:i,C=D?i:s;ey(l,P,1,{_chunkSteps:A=>{Kr(()=>{c=!1,f=!1;const N=D?h:d;if(D?d:h)N||Xi(O._readableStreamController,A);else{let U;try{U=ql(A)}catch(q){return yt(O._readableStreamController,q),yt(C._readableStreamController,q),void u(Rt(r,q))}N||Xi(O._readableStreamController,A),Yi(C._readableStreamController,U)}a=!1,c?_():f&&E()})},_closeSteps:A=>{a=!1;const N=D?h:d,U=D?d:h;N||ti(O._readableStreamController),U||ti(C._readableStreamController),A!==void 0&&(N||Xi(O._readableStreamController,A),!U&&C._readableStreamController._pendingPullIntos.length>0&&Qi(C._readableStreamController,0)),N&&U||u(void 0)},_errorSteps:()=>{a=!1}})}function _(){if(a)return c=!0,oe(void 0);a=!0;const P=hc(i._readableStreamController);return P===null?b():w(P._view,!1),oe(void 0)}function E(){if(a)return f=!0,oe(void 0);a=!0;const P=hc(s._readableStreamController);return P===null?b():w(P._view,!0),oe(void 0)}function I(P){if(d=!0,n=P,h){const D=Zn([n,o]),O=Rt(r,D);u(O)}return y}function R(P){if(h=!0,o=P,d){const D=Zn([n,o]),O=Rt(r,D);u(O)}return y}function x(){}return i=$l(x,_,I),s=$l(x,E,R),m(l),[i,s]})(t):(function(r){const n=In(r);let o,i,s,u,l,a=!1,c=!1,f=!1,d=!1;const h=we(_=>{l=_});function y(){return a?(c=!0,oe(void 0)):(a=!0,hi(n,{_chunkSteps:_=>{Kr(()=>{c=!1;const E=_,I=_;f||Nn(s._readableStreamController,E),d||Nn(u._readableStreamController,I),a=!1,c&&y()})},_closeSteps:()=>{a=!1,f||rn(s._readableStreamController),d||rn(u._readableStreamController),f&&d||l(void 0)},_errorSteps:()=>{a=!1}}),oe(void 0))}function m(_){if(f=!0,o=_,d){const E=Zn([o,i]),I=Rt(r,E);l(I)}return h}function b(_){if(d=!0,i=_,f){const E=Zn([o,i]),I=Rt(r,E);l(I)}return h}function w(){}return s=gi(w,y,m),u=gi(w,y,b),cc(n._closedPromise,_=>(Nt(s._readableStreamController,_),Nt(u._readableStreamController,_),f&&d||l(void 0),null)),[s,u]})(t)}function tg(t){return Te(e=t)&&e.getReader!==void 0?(function(r){let n;function o(){let s;try{s=r.read()}catch(u){return $(u)}return or(s,u=>{if(!Te(u))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(u.done)rn(n._readableStreamController);else{const l=u.value;Nn(n._readableStreamController,l)}})}function i(s){try{return oe(r.cancel(s))}catch(u){return $(u)}}return n=gi(di,o,i,0),n})(t.getReader()):(function(r){let n;const o=Lv(r,"async");function i(){let u;try{u=Uv(o)}catch(l){return $(l)}return or(oe(u),l=>{if(!Te(l))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(l.done)rn(n._readableStreamController);else{const a=l.value;Nn(n._readableStreamController,a)}})}function s(u){const l=o.iterator;let a;try{a=ei(l,"return")}catch(c){return $(c)}return a===void 0?oe(void 0):or(ar(a,l,[u]),c=>{if(!Te(c))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return n=gi(di,i,s,0),n})(t);var e}function rg(t,e,r){return bt(t,r),n=>ar(t,e,[n])}function ng(t,e,r){return bt(t,r),n=>ar(t,e,[n])}function ig(t,e,r){return bt(t,r),n=>Xr(t,e,[n])}function og(t,e){if((t=`${t}`)!="bytes")throw new TypeError(`${e} '${t}' is not a valid enumeration value for ReadableStreamType`);return t}function kl(t,e){ir(t,e);const r=t?.preventAbort,n=t?.preventCancel,o=t?.preventClose,i=t?.signal;return i!==void 0&&(function(s,u){if(!(function(l){if(typeof l!="object"||l===null)return!1;try{return typeof l.aborted=="boolean"}catch{return!1}})(s))throw new TypeError(`${u} is not an AbortSignal.`)})(i,`${e} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!n,preventClose:!!o,signal:i}}Object.defineProperties(yr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),ie(yr.prototype.close,"close"),ie(yr.prototype.enqueue,"enqueue"),ie(yr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(yr.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});let De=class{constructor(e={},r={}){e===void 0?e=null:Tv(e,"First parameter");const n=lo(r,"Second parameter"),o=(function(i,s){ir(i,s);const u=i,l=u?.autoAllocateChunkSize,a=u?.cancel,c=u?.pull,f=u?.start,d=u?.type;return{autoAllocateChunkSize:l===void 0?void 0:$c(l,`${s} has member 'autoAllocateChunkSize' that`),cancel:a===void 0?void 0:rg(a,u,`${s} has member 'cancel' that`),pull:c===void 0?void 0:ng(c,u,`${s} has member 'pull' that`),start:f===void 0?void 0:ig(f,u,`${s} has member 'start' that`),type:d===void 0?void 0:og(d,`${s} has member 'type' that`)}})(e,"First parameter");if(tl(this),o.type==="bytes"){if(n.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");(function(i,s,u){const l=Object.create(vr.prototype);let a,c,f;a=s.start!==void 0?()=>s.start(l):()=>{},c=s.pull!==void 0?()=>s.pull(l):()=>oe(void 0),f=s.cancel!==void 0?h=>s.cancel(h):()=>oe(void 0);const d=s.autoAllocateChunkSize;if(d===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Qv(i,l,a,c,f,u,d)})(this,o,pi(n,0))}else{const i=co(n);(function(s,u,l,a){const c=Object.create(yr.prototype);let f,d,h;f=u.start!==void 0?()=>u.start(c):()=>{},d=u.pull!==void 0?()=>u.pull(c):()=>oe(void 0),h=u.cancel!==void 0?y=>u.cancel(y):()=>oe(void 0),gy(s,c,f,d,h,l,a)})(this,o,pi(n,1),i)}}get locked(){if(!lr(this))throw xr("locked");return gr(this)}cancel(e=void 0){return lr(this)?gr(this)?$(new TypeError("Cannot cancel a stream that already has a reader")):Rt(this,e):$(xr("cancel"))}getReader(e=void 0){if(!lr(this))throw xr("getReader");return(function(r,n){ir(r,n);const o=r?.mode;return{mode:o===void 0?void 0:Vm(o,`${n} has member 'mode' that`)}})(e,"First parameter").mode===void 0?In(this):Xv(this)}pipeThrough(e,r={}){if(!lr(this))throw xr("pipeThrough");Zr(e,1,"pipeThrough");const n=(function(i,s){ir(i,s);const u=i?.readable;Nl(u,"readable","ReadableWritablePair"),Wc(u,`${s} has member 'readable' that`);const l=i?.writable;return Nl(l,"writable","ReadableWritablePair"),ry(l,`${s} has member 'writable' that`),{readable:u,writable:l}})(e,"First parameter"),o=kl(r,"Second parameter");if(gr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(An(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return Fn(Ml(this,n.writable,o.preventClose,o.preventAbort,o.preventCancel,o.signal)),n.readable}pipeTo(e,r={}){if(!lr(this))return $(xr("pipeTo"));if(e===void 0)return $("Parameter 1 is required in 'pipeTo'.");if(!mn(e))return $(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let n;try{n=kl(r,"Second parameter")}catch(o){return $(o)}return gr(this)?$(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):An(e)?$(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Ml(this,e,n.preventClose,n.preventAbort,n.preventCancel,n.signal)}tee(){if(!lr(this))throw xr("tee");return Zn(eg(this))}values(e=void 0){if(!lr(this))throw xr("values");return(function(r,n){const o=In(r),i=new qv(o,n),s=Object.create(Fv);return s._asyncIteratorImpl=i,s})(this,(function(r,n){return ir(r,n),{preventCancel:!!r?.preventCancel}})(e,"First parameter").preventCancel)}[Ai](e){return this.values(e)}static from(e){return tg(e)}};function gi(t,e,r,n=1,o=()=>1){const i=Object.create(De.prototype);return tl(i),gy(i,Object.create(yr.prototype),t,e,r,n,o),i}function $l(t,e,r){const n=Object.create(De.prototype);return tl(n),Qv(n,Object.create(vr.prototype),t,e,r,0,void 0),n}function tl(t){t._state="readable",t._reader=void 0,t._storedError=void 0,t._disturbed=!1}function lr(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readableStreamController")&&t instanceof De}function gr(t){return t._reader!==void 0}function Rt(t,e){if(t._disturbed=!0,t._state==="closed")return oe(void 0);if(t._state==="errored")return $(t._storedError);Ti(t);const r=t._reader;if(r!==void 0&&Gr(r)){const n=r._readIntoRequests;r._readIntoRequests=new _t,n.forEach(o=>{o._closeSteps(void 0)})}return or(t._readableStreamController[Fc](e),di)}function Ti(t){t._state="closed";const e=t._reader;if(e!==void 0&&(Av(e),mr(e))){const r=e._readRequests;e._readRequests=new _t,r.forEach(n=>{n._closeSteps()})}}function _y(t,e){t._state="errored",t._storedError=e;const r=t._reader;r!==void 0&&(kc(r,e),mr(r)?Nv(r,e):ty(r,e))}function xr(t){return new TypeError(`ReadableStream.prototype.${t} can only be used on a ReadableStream`)}Object.defineProperties(De,{from:{enumerable:!0}}),Object.defineProperties(De.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),ie(De.from,"from"),ie(De.prototype.cancel,"cancel"),ie(De.prototype.getReader,"getReader"),ie(De.prototype.pipeThrough,"pipeThrough"),ie(De.prototype.pipeTo,"pipeTo"),ie(De.prototype.tee,"tee"),ie(De.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(De.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(De.prototype,Ai,{value:De.prototype.values,writable:!0,configurable:!0});const ag=t=>t.byteLength;ie(ag,"size");const sg=()=>1;ie(sg,"size");function ug(t,e,r){return bt(t,r),n=>ar(t,e,[n])}function cg(t,e,r){return bt(t,r),n=>Xr(t,e,[n])}function lg(t,e,r){return bt(t,r),(n,o)=>ar(t,e,[n,o])}function fg(t,e,r){return bt(t,r),n=>ar(t,e,[n])}let vo=class{constructor(e={},r={},n={}){e===void 0&&(e=null);const o=lo(r,"Second parameter"),i=lo(n,"Third parameter"),s=(function(d,h){ir(d,h);const y=d?.cancel,m=d?.flush,b=d?.readableType,w=d?.start,_=d?.transform,E=d?.writableType;return{cancel:y===void 0?void 0:fg(y,d,`${h} has member 'cancel' that`),flush:m===void 0?void 0:ug(m,d,`${h} has member 'flush' that`),readableType:b,start:w===void 0?void 0:cg(w,d,`${h} has member 'start' that`),transform:_===void 0?void 0:lg(_,d,`${h} has member 'transform' that`),writableType:E}})(e,"First parameter");if(s.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(s.writableType!==void 0)throw new RangeError("Invalid writableType specified");const u=pi(i,0),l=co(i),a=pi(o,1),c=co(o);let f;(function(d,h,y,m,b,w){function _(){return h}function E(D){return(function(O,C){const A=O._transformStreamController;return O._backpressure?or(O._backpressureChangePromise,()=>{const N=O._writable;if(N._state==="erroring")throw N._storedError;return Gl(A,C)}):Gl(A,C)})(d,D)}function I(D){return(function(O,C){const A=O._transformStreamController;if(A._finishPromise!==void 0)return A._finishPromise;const N=O._readable;A._finishPromise=we((q,W)=>{A._finishPromise_resolve=q,A._finishPromise_reject=W});const U=A._cancelAlgorithm(C);return eo(A),nt(U,()=>(N._state==="errored"?sn(A,N._storedError):(Nt(N._readableStreamController,C),ba(A)),null),q=>(Nt(N._readableStreamController,q),sn(A,q),null)),A._finishPromise})(d,D)}function R(){return(function(D){const O=D._transformStreamController;if(O._finishPromise!==void 0)return O._finishPromise;const C=D._readable;O._finishPromise=we((N,U)=>{O._finishPromise_resolve=N,O._finishPromise_reject=U});const A=O._flushAlgorithm();return eo(O),nt(A,()=>(C._state==="errored"?sn(O,C._storedError):(rn(C._readableStreamController),ba(O)),null),N=>(Nt(C._readableStreamController,N),sn(O,N),null)),O._finishPromise})(d)}function x(){return(function(D){return yo(D,!1),D._backpressureChangePromise})(d)}function P(D){return(function(O,C){const A=O._transformStreamController;if(A._finishPromise!==void 0)return A._finishPromise;const N=O._writable;A._finishPromise=we((q,W)=>{A._finishPromise_resolve=q,A._finishPromise_reject=W});const U=A._cancelAlgorithm(C);return eo(A),nt(U,()=>(N._state==="errored"?sn(A,N._storedError):(yi(N._writableStreamController,C),yc(O),ba(A)),null),q=>(yi(N._writableStreamController,q),yc(O),sn(A,q),null)),A._finishPromise})(d,D)}d._writable=(function(D,O,C,A,N=1,U=()=>1){const q=Object.create(jr.prototype);return iy(q),fy(q,Object.create(vi.prototype),D,O,C,A,N,U),q})(_,E,R,I,y,m),d._readable=gi(_,x,P,b,w),d._backpressure=void 0,d._backpressureChangePromise=void 0,d._backpressureChangePromise_resolve=void 0,yo(d,!0),d._transformStreamController=void 0})(this,we(d=>{f=d}),a,c,u,l),(function(d,h){const y=Object.create(Mr.prototype);let m,b,w;m=h.transform!==void 0?_=>h.transform(_,y):_=>{try{return wy(y,_),oe(void 0)}catch(E){return $(E)}},b=h.flush!==void 0?()=>h.flush(y):()=>oe(void 0),w=h.cancel!==void 0?_=>h.cancel(_):()=>oe(void 0),(function(_,E,I,R,x){E._controlledTransformStream=_,_._transformStreamController=E,E._transformAlgorithm=I,E._flushAlgorithm=R,E._cancelAlgorithm=x,E._finishPromise=void 0,E._finishPromise_resolve=void 0,E._finishPromise_reject=void 0})(d,y,m,b,w)})(this,s),s.start!==void 0?f(s.start(this._transformStreamController)):f(void 0)}get readable(){if(!Wl(this))throw Hl("readable");return this._readable}get writable(){if(!Wl(this))throw Hl("writable");return this._writable}};function Wl(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_transformStreamController")&&t instanceof vo}function by(t,e){Nt(t._readable._readableStreamController,e),rl(t,e)}function rl(t,e){eo(t._transformStreamController),yi(t._writable._writableStreamController,e),yc(t)}function yc(t){t._backpressure&&yo(t,!1)}function yo(t,e){t._backpressureChangePromise!==void 0&&t._backpressureChangePromise_resolve(),t._backpressureChangePromise=we(r=>{t._backpressureChangePromise_resolve=r}),t._backpressure=e}Object.defineProperties(vo.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vo.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});class Mr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Fi(this))throw Bi("desiredSize");return el(this._controlledTransformStream._readable._readableStreamController)}enqueue(e=void 0){if(!Fi(this))throw Bi("enqueue");wy(this,e)}error(e=void 0){if(!Fi(this))throw Bi("error");var r;r=e,by(this._controlledTransformStream,r)}terminate(){if(!Fi(this))throw Bi("terminate");(function(e){const r=e._controlledTransformStream;rn(r._readable._readableStreamController);const n=new TypeError("TransformStream terminated");rl(r,n)})(this)}}function Fi(t){return!!Te(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledTransformStream")&&t instanceof Mr}function eo(t){t._transformAlgorithm=void 0,t._flushAlgorithm=void 0,t._cancelAlgorithm=void 0}function wy(t,e){const r=t._controlledTransformStream,n=r._readable._readableStreamController;if(!Pn(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{Nn(n,e)}catch(i){throw rl(r,i),r._readable._storedError}(function(i){return!my(i)})(n)!==r._backpressure&&yo(r,!0)}function Gl(t,e){return or(t._transformAlgorithm(e),void 0,r=>{throw by(t._controlledTransformStream,r),r})}function Bi(t){return new TypeError(`TransformStreamDefaultController.prototype.${t} can only be used on a TransformStreamDefaultController`)}function ba(t){t._finishPromise_resolve!==void 0&&(t._finishPromise_resolve(),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function sn(t,e){t._finishPromise_reject!==void 0&&(Fn(t._finishPromise),t._finishPromise_reject(e),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function Hl(t){return new TypeError(`TransformStream.prototype.${t} can only be used on a TransformStream`)}Object.defineProperties(Mr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),ie(Mr.prototype.enqueue,"enqueue"),ie(Mr.prototype.error,"error"),ie(Mr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Mr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});var dg=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),Dn=function(){return Dn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Dn.apply(this,arguments)},hg=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},pg=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},vg=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};function yg(){if(typeof wx>"u"||typeof Page>"u"||!wx.getSystemInfoSync||!wx.getStorageSync||!wx.setStorageSync||!wx.connectSocket||!wx.request)return!1;try{if(!wx.getSystemInfoSync()||wx.getSystemInfoSync().AppPlatform==="qq")return!1}catch{return!1}return!0}function mg(){return typeof App>"u"&&typeof getApp>"u"&&!wx.onAppHide&&!wx.offAppHide&&!wx.onAppShow&&!wx.offAppShow}var wa="Error when aborting requestTask",gg=(function(t){dg(e,t);function e(r){r===void 0&&(r={});var n=t.call(this)||this,o=r.timeout,i=r.timeoutMsg,s=r.restrictedMethods;return n._timeout=o||0,n._timeoutMsg=i||"请求超时",n._restrictedMethods=s||["get","post","upload","download"],n}return e.prototype.post=function(r){var n=this;return new Promise(function(o,i){var s=r.url,u=r.data,l=r.headers,a=wx.request({url:Xn("https:",s),data:u,timeout:n._timeout,method:"POST",header:l,success:function(c){c.statusCode>=200&&c.statusCode<300?o({statusCode:c.statusCode,status:c.statusCode,data:c.data}):i(c)},fail:function(c){i(c)},complete:function(c){if(!(!c||!c.errMsg)&&!(!n._timeout||n._restrictedMethods.indexOf("post")===-1)){var f=c.errMsg;if(f==="request:fail timeout"){console.warn(n._timeoutMsg);try{a.abort()}catch{}}}}})})},e.prototype.get=function(r){var n=this;return new Promise(function(o,i){var s=r.url,u=r.body,l=r.headers,a=Xn("https:",s),c=wx.request({url:a,data:u,timeout:n._timeout,method:"GET",header:l,success:function(f){f.statusCode>=200&&f.statusCode<300?o({statusCode:f.statusCode,status:f.statusCode,data:f.data}):i(f)},fail:function(f){i(f)},complete:function(f){if(!(!f||!f.errMsg)&&!(!n._timeout||n._restrictedMethods.indexOf("get")===-1)){var d=f.errMsg;if(d.includes("timeout")){console.warn(n._timeoutMsg);try{c.abort()}catch(h){console.warn(wa,h)}}}}})})},e.prototype.upload=function(r){var n=this,o=this;return new Promise(function(i){return hg(n,void 0,void 0,function(){var s,u,l,a,c,f;return pg(this,function(d){return s=r.url,u=r.file,l=r.data,a=r.headers,c=r.onUploadProgress,f=wx.uploadFile({url:s,filePath:u,name:"file",formData:Dn({},l),header:a,timeout:this._timeout,success:function(h){var y={statusCode:h.statusCode,data:h.data||{}};h.statusCode===200&&l.success_action_status&&(y.statusCode=parseInt(l.success_action_status,10)),i(y)},fail:function(h){i(h)},complete:function(h){if(!(!h||!h.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("upload")===-1)){var y=h.errMsg;if(y==="request:fail timeout"){console.warn(o._timeoutMsg);try{f.abort()}catch{}}}}}),c&&f.onProgressUpdate(function(h){c(h)}),[2]})})})},e.prototype.download=function(r){var n=this,o=this;return new Promise(function(i,s){var u=r.url,l=r.headers,a=wx.downloadFile({url:Xn("https:",u),header:l,timeout:n._timeout,success:function(c){c.statusCode===200&&c.tempFilePath?i({statusCode:200,tempFilePath:c.tempFilePath}):i(c)},fail:function(c){s(c)},complete:function(c){if(!(!c||!c.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("download")===-1)){var f=c.errMsg;if(f==="request:fail timeout"){console.warn(o._timeoutMsg);try{a.abort()}catch{}}}}})})},e.prototype.fetch=function(r){var n=r.url,o=r.body,i=r.enableAbort,s=r.headers,u=r.method,l=r.stream,a=l===void 0?!1:l,c=r.signal,f=r.timeout,d=this,h=f??this._timeout,y=null,m=new De({start:function(b){y=b},cancel:function(){y=null}});return new Promise(function(b,w){a&&b({data:m});var _=wx.request({url:Xn("https:",n),data:o,timeout:h,method:u.toUpperCase(),header:s,success:function(I){var R;(R=y)===null||R===void 0||R.close(),!a&&b(I)},fail:function(I){var R;if((R=y)===null||R===void 0||R.close(),w(I),a)throw I},complete:function(I){if(!(!I||!I.errMsg)&&!(!h||d._restrictedMethods.indexOf("post")===-1||!i)){var R=I.errMsg;if(R==="request:fail timeout"){console.warn(d._timeoutMsg);try{_.abort()}catch(x){console.warn(wa,x)}}}},enableChunked:a});if(_.onChunkReceived(function(I){var R;(R=y)===null||R===void 0||R.enqueue(new Uint8Array(I.data))}),c){var E=function(){try{_.abort()}catch(I){console.warn(wa,I)}};c.aborted?E():c.addEventListener("abort",function(){return E()})}})},e})(Uc),_g={setItem:function(t,e){wx.setStorageSync(t,e)},getItem:function(t){return wx.getStorageSync(t)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}},bg=(function(){function t(e,r){r===void 0&&(r={});var n=wx.connectSocket(Dn({url:e},r)),o={set onopen(i){n.onOpen(i)},set onmessage(i){n.onMessage(i)},set onclose(i){n.onClose(i)},set onerror(i){n.onError(i)},send:function(i){return n.send({data:i})},close:function(i,s){return n.close({code:i,reason:s})},get readyState(){return n.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return o}return t})();function wg(t){var e={},r=t.replace(/^[?#]/,"");if(!r)return e;var n=r.split("&");return n.forEach(function(o){var i=o.split("="),s=i[0],u=i[1];s=decodeURIComponent(s),u=decodeURIComponent(u),s&&(e[s]?Array.isArray(e[s])?e[s].push(u):e[s]=[e[s],u]:e[s]=u)}),e}function Eg(t){var e={root:{globalThis:{}},reqClass:gg,wsClass:bg,captchaOptions:{openURIWithCallback:function(r){var n=t.EventBus,o={},i=r;console.log("openURIWithCallback",r);var s=r.match(/^(data:.*?)(\?[^#\s]*)?$/);if(s){i=s[1],console.log("openURIWithCallback url",i);var u=s[2];u&&(o=wg(u))}console.log("openURIWithCallback queryObj",o);var l=o.token,a=vg(o,["token"]);return/^data:/.test(i)&&!l?Promise.reject({error:"invalid_argument",error_description:"invalie captcha data: "+r}):l?new Promise(function(c){console.log("wait for captcha..."),n.$emit("CAPTCHA_DATA_CHANGE",Dn(Dn({},a),{token:l,url:i})),n.$once("RESOLVE_CAPTCHA_DATA",function(f){c(f)})}):Promise.reject({error:"unimplemented",error_description:"need to impl captcha data"})}},localStorage:_g,primaryStorage:so.local,getAppSign:function(){var r=wx.getAccountInfoSync();return mg()?r&&r.plugin?r.plugin.appId:"":r&&r.miniProgram?r.miniProgram.appId:""}};return e}var er={genAdapter:Eg,isMatch:yg,runtime:"wx_mp"},mo=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},go=rt,Vl={};function Sg(t,e){var r=e.name,n=e.namespace,o=e.entity,i=e.injectEvents,s=e.IIFE,u=s===void 0?!1:s;if(Vl[r]||n&&t[n])throw new Error(JSON.stringify({code:go.INVALID_OPERATION,msg:"Duplicate component ".concat(r)}));if(u){if(!o||typeof o!="function")throw new Error(JSON.stringify({code:go.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));o.call(t)}if(Vl[r]=e,n?t.prototype[n]=o:Ey(t.prototype,o),i){var l=i.bus,a=i.events;if(!l||!a||a.length===0)return;var c=t.prototype.fire||function(){};t.prototype.events||(t.prototype.events={});var f=t.prototype.events||{};f[r]?t.prototype.events[r].events=mo(mo([],t.prototype.events[r].events,!0),a,!0):t.prototype.events[r]={bus:l,events:a},t.prototype.fire=function(d,h){c(d,h);for(var y=Object.keys(this.events),m=0,b=y;m<b.length;m++){var w=b[m],_=this.events[w],E=_.bus,I=_.events;if(I.includes(d)){E.fire(d,h);break}}}}}function Ey(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:{var r=e;return new Date(r.getTime())}case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(var n=Object.keys(e),o=0,i=n;o<i.length;o++){var s=i[o];Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=Ey(t[s],e[s]))}return t}function Ig(t,e){var r=e.entity,n=e.target;if(Object.prototype.hasOwnProperty.call(t,n))throw new Error(JSON.stringify({code:go.INVALID_OPERATION,msg:"target:".concat(n," is not exist")}));var o=t.prototype[n];if(typeof o!="function")throw new Error(JSON.stringify({code:go.INVALID_OPERATION,msg:"target:".concat(n," is not a function which is the only type supports hook")}));t.prototype[n]=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return r.call.apply(r,mo([this],i,!1)),o.call.apply(o,mo([this],i,!1))}}var Zt={},gn=function(){return gn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},gn.apply(this,arguments)},Og="user_info",Kl=Lm,mc={},gc={};function Jl(t){var e=t.env,r=t.platformInfo,n="".concat(Og,"_").concat(e),o={userInfoKey:n};mc[e]=mc[e]||new Kl(gn(gn({},t),{keys:o,platformInfo:r})),gc[e]=gc[e]||new Kl(gn(gn({},t),{keys:o,platformInfo:r,persistence:"local"}))}function Ag(t){return mc[t]}function Sy(t){return gc[t]}var Ea,Jr;(function(t){t.ZH="zh-CN",t.EN="en-US"})(Jr||(Jr={}));var Tg="Accept-Language",Rg=(Ea={},Ea[Jr.EN]={"请检查调用方式，或前往云开发 AI+ 首页查看文档":"Please check the calling method or visit the AI+ homepage to view the documentation","AI+ 请求出错，错误码":"AI+ request error, error code",错误信息:"error message",未实现:"not implemented","小程序不支持 wasm 加载":"wasm loading is not supported in mini programs","小程序不支持动态 js 加载":"dynamic js loading is not supported in mini programs",请求超时:"request timeout","缺少 privatelink sdk 地址":"missing privatelink sdk address"},Ea),zl=function(t,e){var r;return((r=Rg[e])===null||r===void 0?void 0:r[t])||t},Cg=function(t){return"lang_".concat(t.clientId||t.env)},xg=function(t,e){var r,n,o=Cg(e),i=(t.adapter||{}).localStorage,s=e.lang||((r=i?.getItem)===null||r===void 0?void 0:r.call(i,o))||Jr.ZH;return(n=i?.setItem)===null||n===void 0||n.call(i,o,s),new Proxy({t:function(u){return zl(u,s)},LANG_HEADER_KEY:Tg,lang:s},{get:function(u,l){var a;return l==="lang"&&((a=i?.getItem)===null||a===void 0?void 0:a.call(i,o))||u[l]},set:function(u,l,a){var c;return l==="lang"&&a!==u[l]&&(u[l]=a,u.t=function(f){return zl(f,a)},(c=i?.setItem)===null||c===void 0||c.call(i,o,a),Bo.fire(jo,{i18n:u})),u[l]=a,!0}})},_o=function(){return _o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},_o.apply(this,arguments)},Ng=gm,Pg=_m,Iy="",Oy="@cloudbase/js-sdk";function Dg(t){Iy=t}function nl(){return Iy}function Lg(t){Oy=t,Ng(t)}function Ug(){return Oy}var qg="2020-01-10",Ay=[],Fg=["env","endPointKey","region"],_c="https:";function Ty(t){return Ay.find(function(e){return Fg.filter(function(r){return t[r]!=null}).every(function(r){return e[r]===t[r]})})}function bo(t){var e,r,n=Ty(t);n?(t.baseUrl!=null&&(n.baseUrl=t.baseUrl),t.protocol!=null&&(n.protocol=t.protocol)):Ay.push(_o(_o({},t),{protocol:(e=t.protocol)!==null&&e!==void 0?e:_c})),t.endPointKey==="CLOUD_API"&&Pg((r=t.protocol)!==null&&r!==void 0?r:_c)}function wo(t,e,r){return Ty({env:t,endPointKey:e,region:r})}function Yl(t,e,r){var n,o=(n={},n[Jr.ZH]="//".concat(t,".api.tcloudbasegateway.com/v1"),n[Jr.EN]="//".concat(t,".api.intl.tcloudbasegateway.com/v1"),n);bo({endPointKey:"GATEWAY",env:t,baseUrl:o[r]||o[Jr.ZH],protocol:e})}function Bg(t,e,r){var n="//".concat(t,".").concat(e||"ap-shanghai",".tcb-api.tencentcloudapi.com/web");bo({env:t,region:e,baseUrl:n,protocol:r,endPointKey:"CLOUD_API"})}function Ql(t,e){e===void 0&&(e="CLOUD_API");var r=wo(t,e||"CLOUD_API"),n=r.protocol,o=r.baseUrl,i="".concat(n).concat(o);return i.match(/(http(s)?:)?\/\/([^/?#]*)/)[0]}var Xl;(function(t){t.NULL="NULL",t.ANONYMOUS="ANONYMOUS",t.WECHAT="WECHAT",t.WECHAT_PUBLIC="WECHAT-PUBLIC",t.WECHAT_OPEN="WECHAT-OPEN",t.CUSTOM="CUSTOM",t.EMAIL="EMAIL",t.USERNAME="USERNAME",t.PHONE="PHONE"})(Xl||(Xl={}));var te=function(){return te=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},te.apply(this,arguments)},Ut=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},qt=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},jg=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r},Sa=rt,Mg=Im,kg=vv,Zl=mv,$g=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function Ia(t,e,r){var n=t[e];t[e]=function(o){var i={},s={};r.forEach(function(l){var a=l.call(t,o),c=a.data,f=a.headers;Object.assign(i,c),Object.assign(s,f)});var u=o.data;return u&&(function(){if(kg(u)){Object.keys(i).forEach(function(l){u.append(l,i[l])});return}o.data=te(te({},u),i)})(),o.headers=te(te({},o.headers||{}),s),n.call(t,o)}}function Oa(){var t=Mg();return{data:{seqId:t},headers:{"X-SDK-Version":"@cloudbase/js-sdk/".concat(nl()),"x-seqid":t}}}var Wg=(function(){function t(e){var r=this;this.throwWhenRequestFail=!1,this.config=e;var n={timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] 请求在".concat(this.config.timeout/1e3,"s内未完成，已中断"),restrictedMethods:["post","put"]};this.reqClass=new Zt.adapter.reqClass(n),this.throwWhenRequestFail=e.throw||!1,this.localCache=Sy(this.config.env),Ia(this.reqClass,"post",[Oa]),Ia(this.reqClass,"upload",[Oa]),Ia(this.reqClass,"download",[Oa]),Bo.on(jo,function(o){var i;r.config.i18n=((i=o.data)===null||i===void 0?void 0:i.i18n)||r.config.i18n})}return t.prototype.getDefaultHeaders=function(){var e,r,n;return e={},e[(r=this.config.i18n)===null||r===void 0?void 0:r.LANG_HEADER_KEY]=(n=this.config.i18n)===null||n===void 0?void 0:n.lang,e},t.prototype.post=function(e,r){return Ut(this,void 0,void 0,function(){var n;return qt(this,function(o){switch(o.label){case 0:return[4,this.reqClass.post(te(te({},e),{headers:te(te({},e.headers),this.getDefaultHeaders()),customReqOpts:r}))];case 1:return n=o.sent(),[2,n]}})})},t.prototype.upload=function(e){return Ut(this,void 0,void 0,function(){var r;return qt(this,function(n){switch(n.label){case 0:return[4,this.reqClass.upload(te(te({},e),{headers:te(te({},e.headers),this.getDefaultHeaders())}))];case 1:return r=n.sent(),[2,r]}})})},t.prototype.download=function(e){return Ut(this,void 0,void 0,function(){var r;return qt(this,function(n){switch(n.label){case 0:return[4,this.reqClass.download(te(te({},e),{headers:te(te({},e.headers),this.getDefaultHeaders())}))];case 1:return r=n.sent(),[2,r]}})})},t.prototype.getBaseEndPoint=function(e){return e===void 0&&(e="CLOUD_API"),Ql(this.config.env,e)},t.prototype.getOauthAccessTokenV2=function(e){return Ut(this,void 0,void 0,function(){var r,n;return qt(this,function(o){switch(o.label){case 0:return[4,e.getAccessToken()];case 1:return r=o.sent(),[4,e.getCredentials()];case 2:return n=o.sent(),[2,{accessToken:r,accessTokenExpire:new Date(n.expires_at).getTime()}]}})})},t.prototype.request=function(e,r,n,o){var i,s;return Ut(this,void 0,void 0,function(){var u,l,a,c,f,d,h,y,m,b,w,_,E,I,R,x,P,D,O,C,A;return qt(this,function(N){switch(N.label){case 0:if(u="x-tcb-trace_".concat(this.config.env),l="application/x-www-form-urlencoded",a=te({action:e,dataVersion:qg,env:this.config.env},r),$g.indexOf(e)!==-1)return[3,2];if(c=this.config._fromApp,!c.oauthInstance)throw new Error("you can't request without auth");return f=c.oauthInstance,d=f.oauth2client,h=a,[4,this.getOauthAccessTokenV2(d)];case 1:h.access_token=N.sent().accessToken,N.label=2;case 2:return e==="storage.uploadFile"?(y=new FormData,Object.keys(y).forEach(function(U){Object.prototype.hasOwnProperty.call(y,U)&&y[U]!==void 0&&y.append(U,a[U])}),l="multipart/form-data"):(l="application/json;charset=UTF-8",y={},Object.keys(a).forEach(function(U){a[U]!==void 0&&(y[U]=a[U])})),m={headers:te({"content-type":l},this.getDefaultHeaders())},n?.onUploadProgress&&(m.onUploadProgress=n.onUploadProgress),this.config.region&&(m.headers["X-TCB-Region"]=this.config.region),b=this.localCache.getStore(u),b&&(m.headers["X-TCB-Trace"]=b),w=n?.parse!==void 0?n.parse:r.parse,_=n?.inQuery!==void 0?n.inQuery:r.inQuery,E=n?.search!==void 0?n.search:r.search,I=te(te({},n?.defaultQuery||{}),{env:this.config.env}),w&&(I.parse=!0),_&&(I=te(te({},_),I)),R=this.config.endPointMode||"CLOUD_API",x=wo(this.config.env,R),P=x.baseUrl,D=x.protocol,(e==="functions.invokeFunction"||/^(storage|database)\./.test(e))&&R==="GATEWAY"&&(P="".concat(P.match(/\/\/([^/?#]*)/)[0],"/web")),n.pathname?O=Zl(D,"".concat((i=Ql(this.config.env,R))===null||i===void 0?void 0:i.replace(/^https?:/,""),"/").concat(n.pathname),I):O=Zl(D,P,I),E&&(O+=E),[4,this.post(te({url:O,data:y},m),o)];case 3:if(C=N.sent(),A=(s=C.header)===null||s===void 0?void 0:s["x-tcb-trace"],A&&this.localCache.setStore(u,A),Number(C.status)!==200&&Number(C.statusCode)!==200||!C.data)throw new Error("network request error");return[2,C]}})})},t.prototype.fetch=function(e){var r,n,o,i,s,u,l,a;return Ut(this,void 0,void 0,function(){var c,f,d,h,y,m,b,w,_=this;return qt(this,function(E){switch(E.label){case 0:c=e.token,f=e.headers,d=f===void 0?{}:f,h=jg(e,["token","headers"]),y=function(){return Ut(_,void 0,void 0,function(){var I,R,x;return qt(this,function(P){switch(P.label){case 0:if(c!=null)return[2,c];if(I=this.config._fromApp,!I.oauthInstance)throw new Error("you can't request without auth");return R=I.oauthInstance,x=R.oauth2client,[4,this.getOauthAccessTokenV2(x)];case 1:return[2,P.sent().accessToken]}})})},m=function(){return Ut(_,void 0,void 0,function(){var I,R,x,P,D;return qt(this,function(O){switch(O.label){case 0:return R=(I=this.reqClass).fetch,P={},D={"X-SDK-Version":"@cloudbase/js-sdk/".concat(nl())},x="Bearer ".concat,[4,y()];case 1:return[2,R.apply(I,[te.apply(void 0,[(P.headers=te.apply(void 0,[te.apply(void 0,[(D.Authorization=x.apply("Bearer ",[O.sent()]),D),this.getDefaultHeaders()]),d]),P),h])])]}})})},E.label=1;case 1:return E.trys.push([1,3,,6]),[4,m()];case 2:return b=E.sent(),[2,b];case 3:if(w=E.sent(),w?.code!=="ACCESS_TOKEN_EXPIRED")return[3,5];if(typeof((i=(o=(n=(r=this.config)===null||r===void 0?void 0:r._fromApp)===null||n===void 0?void 0:n.oauthInstance)===null||o===void 0?void 0:o.authApi)===null||i===void 0?void 0:i.refreshTokenForce)!="function")throw w;return[4,(a=(l=(u=(s=this.config)===null||s===void 0?void 0:s._fromApp)===null||u===void 0?void 0:u.oauthInstance)===null||l===void 0?void 0:l.authApi)===null||a===void 0?void 0:a.refreshTokenForce()];case 4:return E.sent(),[2,m()];case 5:throw w;case 6:return[2]}})})},t.prototype.send=function(e,r,n,o){return r===void 0&&(r={}),n===void 0&&(n={}),Ut(this,void 0,void 0,function(){var i;return qt(this,function(s){switch(s.label){case 0:return[4,this.request(e,r,te(te({},n),{onUploadProgress:r.onUploadProgress}),o)];case 1:if(i=s.sent(),i.data.code&&this.throwWhenRequestFail)throw new Error(JSON.stringify({code:Sa.OPERATION_FAIL,msg:"[".concat(i.data.code,"] ").concat(i.data.message)}));return[2,i.data]}})})},t.prototype.gateWay=function(e,r){return Ut(this,void 0,void 0,function(){var n,o,i,s,u,l,a,c,f,d,h,y,m,b,w,_;return qt(this,function(E){switch(E.label){case 0:if(n=e.name,o=e.data,i=e.path,s=i===void 0?"":i,u=e.method,l=e.header,a=l===void 0?{}:l,!n||!s)throw new Error(JSON.stringify({code:Sa.INVALID_PARAMS,msg:"[gateWay] invalid function name or path"}));try{c=o?JSON.stringify(o):""}catch{throw new Error(JSON.stringify({code:Sa.INVALID_PARAMS,msg:"[gateWay] invalid data"}))}return f=yv(),d=wo(this.config.env,"GATEWAY"),h=d.baseUrl,y=d.protocol,m="".concat(y).concat(h,"/").concat(s,"/").concat(n),[4,this.fetch({method:u||"POST",headers:te({"Content-Type":"application/json; charset=utf-8","X-Request-Id":f},a),body:c,url:m,customReqOpts:r})];case 1:return b=E.sent(),w=[te({requestId:f},b)],_={},[4,b.data];case 2:return[2,te.apply(void 0,w.concat([(_.data=E.sent(),_)]))]}})})},t})(),Ry={};function Gg(t){Ry[t.env]=new Wg(te(te({},t),{throw:!0}))}function Hg(t){return Ry[t]}var Nr={},$e={},ef;function Cy(){if(ef)return $e;ef=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.COMMUNITY_SITE_URL=$e.IS_DEBUG_MODE=$e.getProtocol=$e.setProtocol=$e.getSdkName=$e.setSdkName=void 0;var t="@cloudbase/js-sdk";function e(s){t=s}$e.setSdkName=e;function r(){return t}$e.getSdkName=r;var n="https:";function o(s){n=s}$e.setProtocol=o;function i(){return n}return $e.getProtocol=i,$e.IS_DEBUG_MODE=!1,$e.COMMUNITY_SITE_URL="https://support.qq.com/products/148793",$e}var Gn={},tf;function Vg(){return tf||(tf=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.ERRORS=void 0,Gn.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"}),Gn}var rf;function Ho(){return rf||(rf=1,(function(t){var e=Nr&&Nr.__createBinding||(Object.create?(function(n,o,i,s){s===void 0&&(s=i);var u=Object.getOwnPropertyDescriptor(o,i);(!u||("get"in u?!o.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return o[i]}}),Object.defineProperty(n,s,u)}):(function(n,o,i,s){s===void 0&&(s=i),n[s]=o[i]})),r=Nr&&Nr.__exportStar||function(n,o){for(var i in n)i!=="default"&&!Object.prototype.hasOwnProperty.call(o,i)&&e(o,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.OATUH_LOGINTYPE=void 0,r(Cy(),t),r(Vg(),t),t.OATUH_LOGINTYPE="constants"})(Nr)),Nr}var re=Ho(),_i=function(){return _i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},_i.apply(this,arguments)},xy=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Ny=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Kg(t,e){var r,n,o;return xy(this,void 0,void 0,function(){var i,s,u,l,a,c,f,d,h,y,m,b,w,_,E,I;return Ny(this,function(R){switch(R.label){case 0:if(i=t||{},s=i.name,u=i.body,l=i.path,a=l===void 0?"":l,c=i.method,f=c===void 0?"POST":c,d=i.headers,h=d===void 0?{}:d,y=i.token,!s)throw new Error(JSON.stringify({code:re.ERRORS.INVALID_PARAMS,msg:"[apis] invalid api name"}));return m=this.getEndPointWithKey("GATEWAY"),b=m.BASE_URL,w=m.PROTOCOL,_="".concat(w).concat(b,"/apis/").concat(s),E=a.startsWith("/")?a:"/".concat(a),[4,this.request.fetch(_i({url:"".concat(_).concat(E),method:f||"POST",headers:_i({"Content-Type":"application/json; charset=utf-8"},h),body:u,token:((r=y?.trim)===null||r===void 0?void 0:r.call(y))||((o=(n=h.Authorization)===null||n===void 0?void 0:n.replace)===null||o===void 0?void 0:o.call(n,/^Bearer /,""))||null},e))];case 1:return I=R.sent(),[4,I.data];case 2:return[2,R.sent()]}})})}var Jg=["GET","POST","PUT","DELETE","HEAD","OPTIONS","PATCH","REQUEST"];function zg(t){var e=this;return new Proxy({},{get:function(r,n){if(typeof n!="string")throw new Error("[apis] method must be string");var o=n.toLocaleUpperCase();if(!Jg.includes(o))throw new Error("[apis] invalid method: ".concat(n));return function(i,s){return xy(e,void 0,void 0,function(){return Ny(this,function(u){switch(u.label){case 0:return[4,Kg.call(this,_i({name:t,method:(o==="REQUEST"?i.method:o)||"POST"},i),s)];case 1:return[2,u.sent()]}})})}}})}function Yg(){var t=this;return new Proxy({},{get:function(e,r){if(typeof r=="string")return zg.call(t,r)}})}var si=function(){return si=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},si.apply(this,arguments)},nf=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},un=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Qg=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Xg=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Zg=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r},e_=xm,t_=Nm,ji=rt,of=Fo,af=Sn,sf=Mo,r_={timeout:15e3,persistence:"local"},uf=1e3*60*10,cf=100,lf={},n_=(function(){function t(e){this.cloudbaseConfig=e||this.cloudbaseConfig,this.authInstance=null,this.oauthInstance=null,this.version=nl()}return Object.defineProperty(t.prototype,"config",{get:function(){return this.cloudbaseConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"platform",{get:function(){return Zt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cache",{get:function(){return Ag(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCache",{get:function(){return Sy(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return Hg(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apis",{get:function(){return Yg.call(this)},enumerable:!1,configurable:!0}),t.prototype.init=function(e){var r;if(!e.env)throw new Error(JSON.stringify({code:ji.INVALID_PARAMS,msg:"env must not be specified"}));Zt.adapter||this.useDefaultAdapter();var n={timeout:e.timeout||5e3,timeoutMsg:"[".concat(Ug(),"][REQUEST TIMEOUT] request had been abort since didn't finished within").concat(e.timeout/1e3,"s")};this.requestClient=new Zt.adapter.reqClass(n),this.cloudbaseConfig=si(si(si({},r_),e),{i18n:xg(Zt,e)}),delete this.cloudbaseConfig.lang,this.cloudbaseConfig.timeout=this.formatTimeout(this.cloudbaseConfig.timeout);var o=this.cloudbaseConfig,i=o.env,s=o.persistence,u=o.debug,l=o.timeout,a=o.oauthClient,c=o.i18n;Jl({env:i,persistence:s,debug:u,platformInfo:this.platform}),Bg(i,e.region||""),Yl(i,_c,this.cloudbaseConfig.i18n.lang);var f=new t(this.cloudbaseConfig);return Gg({env:i,region:e.region||"",timeout:l,oauthClient:a,_fromApp:f,i18n:c,endPointMode:e.endPointMode}),f.requestClient=this.requestClient,(r=this===null||this===void 0?void 0:this.fire)===null||r===void 0||r.call(this,"cloudbase_init",f),this.try2InitAuth(e,f),f},t.prototype.updateConfig=function(e){var r=e.persistence,n=e.debug;this.cloudbaseConfig.persistence=r,this.cloudbaseConfig.debug=n,Jl({env:this.cloudbaseConfig.env,persistence:r,debug:n,platformInfo:this.platform})},t.prototype.updateLang=function(e){var r;!e||e===((r=this.cloudbaseConfig.i18n)===null||r===void 0?void 0:r.lang)||(this.cloudbaseConfig.i18n.lang=e,Yl(this.cloudbaseConfig.env,"https",e))},t.prototype.registerExtension=function(e){lf[e.name]=e},t.prototype.invokeExtension=function(e,r){return Qg(this,void 0,void 0,function(){var n;return Xg(this,function(o){switch(o.label){case 0:if(n=lf[e],!n)throw new Error(JSON.stringify({code:ji.INVALID_PARAMS,msg:"extension:".concat(e," must be registered before invoke")}));return[4,n.invoke(r,this)];case 1:return[2,o.sent()]}})})},t.prototype.useAdapters=function(e,r){var n=e_(e,r)||{},o=n.adapter,i=n.runtime;o&&(Zt.adapter=o),i&&(Zt.runtime=i)},t.prototype.registerHook=function(e){Ig(t,e)},t.prototype.registerComponent=function(e){Sg(t,e)},t.prototype.registerVersion=function(e){Dg(e),this.version=e},t.prototype.registerSdkName=function(e){Lg(e)},t.prototype.registerEndPoint=function(e,r){bo({baseUrl:e,protocol:r,env:this.config.env,endPointKey:"CLOUD_API"})},t.prototype.registerEndPointWithKey=function(e){bo({env:this.config.env,endPointKey:e.key,baseUrl:e.url,protocol:e.protocol})},t.prototype.getEndPointWithKey=function(e){var r=wo(this.config.env,e);return{BASE_URL:r.baseUrl,PROTOCOL:r.protocol}},t.prototype.parseCaptcha=function(e){var r={},n=e.match(/^(data:.*?)(\?[^#\s]*)?$/);if(n){e=n[1];var o=n[2];o&&(r=Am(o))}var i=r.token,s=Zg(r,["token"]);return/^data:/.test(e)&&!i?{error:"invalid_argument",error_description:"invalid captcha data: ".concat(e)}:i?{state:s.state,token:i,captchaData:e}:{error:"unimplemented",error_description:"need to impl captcha data"}},t.prototype.useDefaultAdapter=function(){var e=t_(),r=e.adapter,n=e.runtime;Zt.adapter=r,Zt.runtime=n},t.prototype.formatTimeout=function(e){switch(!0){case e>uf:return af(ji.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),uf;case e<cf:return af(ji.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),cf;default:return e}},t.prototype.try2InitAuth=function(e,r){try{e.accessKey&&r.auth()}catch(n){console.log("try2InitAuth error:",n)}},nf([sf({mode:"sync",title:"Cloudbase 初始化失败",messages:["请确认以下各项：","  1 - 调用 cloudbase.init() 的语法或参数是否正确","  2 - 如果是非浏览器环境，是否配置了安全应用来源（https://docs.cloudbase.net/api-reference/webv3/adapter#%E7%AC%AC-2-%E6%AD%A5%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E5%BA%94%E7%94%A8%E6%9D%A5%E6%BA%90）","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(of)]}),un("design:type",Function),un("design:paramtypes",[Object]),un("design:returntype",t)],t.prototype,"init",null),nf([sf({title:"调用扩展能力失败",messages:["请确认以下各项：","  1 - 调用 invokeExtension() 的语法或参数是否正确","  2 - 被调用的扩展能力是否已经安装并通过 registerExtension() 注册","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(of)]}),un("design:type",Function),un("design:paramtypes",[String,Object]),un("design:returntype",Promise)],t.prototype,"invokeExtension",null),t})(),st=new n_;st.useAdapters(er);const Vo="/auth";var Y;(function(t){t.AUTH_SIGN_UP_URL="/v1/signup",t.AUTH_TOKEN_URL="/v1/token",t.AUTH_REVOKE_URL="/v1/revoke",t.WEDA_USER_URL="/v1/plugin/weda/userinfo",t.AUTH_RESET_PASSWORD="/v1/reset",t.AUTH_GET_DEVICE_CODE="/v1/device/code",t.CHECK_USERNAME="/v1/checkUsername",t.CHECK_IF_USER_EXIST="/v1/checkIfUserExist",t.GET_PROVIDER_TYPE="/v1/mgr/provider/providerSubType",t.AUTH_SIGN_IN_URL="/v1/signin",t.AUTH_SIGN_IN_ANONYMOUSLY_URL="/v1/signin/anonymously",t.AUTH_SIGN_IN_WITH_PROVIDER_URL="/v1/signin/with/provider",t.AUTH_SIGN_IN_WITH_WECHAT_URL="/v1/signin/wechat/noauth",t.AUTH_SIGN_IN_CUSTOM="/v1/signin/custom",t.PROVIDER_TOKEN_URL="/v1/provider/token",t.PROVIDER_URI_URL="/v1/provider/uri",t.USER_ME_URL="/v1/user/me",t.AUTH_SIGNOUT_URL="/v1/user/signout",t.USER_QUERY_URL="/v1/user/query",t.USER_PRIFILE_URL="/v1/user/profile",t.USER_BASIC_EDIT_URL="/v1/user/basic/edit",t.USER_TRANS_BY_PROVIDER_URL="/v1/user/trans/by/provider",t.PROVIDER_LIST="/v1/user/provider",t.PROVIDER_BIND_URL="/v1/user/provider/bind",t.PROVIDER_UNBIND_URL="/v1/user/provider",t.CHECK_PWD_URL="/v1/user/sudo",t.SUDO_URL="/v1/user/sudo",t.BIND_CONTACT_URL="/v1/user/contact",t.AUTH_SET_PASSWORD="/v1/user/password",t.AUTHORIZE_DEVICE_URL="/v1/user/device/authorize",t.AUTHORIZE_URL="/v1/user/authorize",t.AUTHORIZE_INFO_URL="/v1/user/authorize/info",t.AUTHORIZED_DEVICES_DELETE_URL="/v1/user/authorized/devices/",t.AUTH_REVOKE_ALL_URL="/v1/user/revoke/all",t.GET_USER_BEHAVIOR_LOG="/v1/user/security/history",t.VERIFICATION_URL="/v1/verification",t.VERIFY_URL="/v1/verification/verify",t.CAPTCHA_DATA_URL="/v1/captcha/data",t.VERIFY_CAPTCHA_DATA_URL="/v1/captcha/data/verify",t.GET_CAPTCHA_URL="/v1/captcha/init",t.GET_MINIPROGRAM_QRCODE="/v1/qrcode/generate",t.GET_MINIPROGRAM_QRCODE_STATUS="/v1/qrcode/get/status"})(Y||(Y={}));var Tn;(function(t){t.AUTH_SIGN_IN_URL="/v2/signin/username",t.AUTH_TOKEN_URL="/v2/token",t.USER_ME_URL="/v2/user/me",t.VERIFY_URL="/v2/signin/verificationcode",t.AUTH_SIGN_IN_WITH_PROVIDER_URL="/v2/signin/with/provider",t.AUTH_PUBLIC_KEY="/v2/signin/publichkey",t.AUTH_RESET_PASSWORD="/v2/signin/password/update"})(Tn||(Tn={}));var ff;(function(t){t.REGISTER="REGISTER",t.SIGN_IN="SIGN_IN",t.PASSWORD_RESET="PASSWORD_RESET",t.EMAIL_ADDRESS_CHANGE="EMAIL_ADDRESS_CHANGE",t.PHONE_NUMBER_CHANGE="PHONE_NUMBER_CHANGE"})(ff||(ff={}));var He;(function(t){t.UNREACHABLE="unreachable",t.LOCAL="local",t.CANCELLED="cancelled",t.UNKNOWN="unknown",t.UNAUTHENTICATED="unauthenticated",t.RESOURCE_EXHAUSTED="resource_exhausted",t.FAILED_PRECONDITION="failed_precondition",t.INVALID_ARGUMENT="invalid_argument",t.DEADLINE_EXCEEDED="deadline_exceeded",t.NOT_FOUND="not_found",t.ALREADY_EXISTS="already_exists",t.PERMISSION_DENIED="permission_denied",t.ABORTED="aborted",t.OUT_OF_RANGE="out_of_range",t.UNIMPLEMENTED="unimplemented",t.INTERNAL="internal",t.UNAVAILABLE="unavailable",t.DATA_LOSS="data_loss",t.INVALID_PASSWORD="invalid_password",t.PASSWORD_NOT_SET="password_not_set",t.INVALID_STATUS="invalid_status",t.USER_PENDING="user_pending",t.USER_BLOCKED="user_blocked",t.INVALID_VERIFICATION_CODE="invalid_verification_code",t.TWO_FACTOR_REQUIRED="two_factor_required",t.INVALID_TWO_FACTOR="invalid_two_factor",t.INVALID_TWO_FACTOR_RECOVERY="invalid_two_factor_recovery",t.UNDER_REVIEW="under_review",t.INVALID_REQUEST="invalid_request",t.UNAUTHORIZED_CLIENT="unauthorized_client",t.ACCESS_DENIED="access_denied",t.UNSUPPORTED_RESPONSE_TYPE="unsupported_response_type",t.INVALID_SCOPE="invalid_scope",t.INVALID_GRANT="invalid_grant",t.SERVER_ERROR="server_error",t.TEMPORARILY_UNAVAILABLE="temporarily_unavailable",t.INTERACTION_REQUIRED="interaction_required",t.LOGIN_REQUIRED="login_required",t.ACCOUNT_SELECTION_REQUIRED="account_selection_required",t.CONSENT_REQUIRED="consent_required",t.INVALID_REQUEST_URI="invalid_request_uri",t.INVALID_REQUEST_OBJECT="invalid_request_object",t.REQUEST_NOT_SUPPORTED="request_not_supported",t.REQUEST_URI_NOT_SUPPORTED="request_uri_not_supported",t.REGISTRATION_NOT_SUPPORTED="registration_not_supported",t.CAPTCHA_REQUIRED="captcha_required",t.CAPTCHA_INVALID="captcha_invalid"})(He||(He={}));var df;(function(t){t.CLIENT_ID="client_id",t.CLIENT_SECRET="client_secret",t.RESPONSE_TYPE="response_type",t.SCOPE="scope",t.STATE="state",t.REDIRECT_URI="redirect_uri",t.ERROR="error",t.ERROR_DESCRIPTION="error_description",t.ERROR_URI="error_uri",t.GRANT_TYPE="grant_type",t.CODE="code",t.ACCESS_TOKEN="access_token",t.TOKEN_TYPE="token_type",t.EXPIRES_IN="expires_in",t.USERNAME="username",t.PASSWORD="password",t.REFRESH_TOKEN="refresh_token"})(df||(df={}));function Py(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}const bc=t=>{const e=n=>{for(const o in t)t.hasOwnProperty(o)&&(n[o]=bc(t[o]));return n},r=t==null?"NullOrUndefined":Object.prototype.toString.call(t).slice(8,-1);if(["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"].includes(r))return t.slice();switch(r){case"Object":return e(Object.create(Object.getPrototypeOf(t)));case"Array":return e([]);case"Date":return new Date(t.valueOf());case"RegExp":return new RegExp(t.source,(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"")+(t.unicode?"u":""));default:return t}},hf=t=>{const e=/^(?:http(s)?:\/\/[^\/]+)?(\/[^\?#]*)/,r=t.match(e);return r&&r[2]||""};let Hn=new Map;class Dy{constructor(e){this.clientId=e?.clientId||"",Hn=Hn||new Map}async run(e,r){e=`${this.clientId}_${e}`;let n=Hn.get(e);return n||(n=new Promise((o,i)=>{(async()=>{try{await this.runIdlePromise();const s=r();o(await s)}catch(s){i(s)}finally{Hn.delete(e)}})()}),Hn.set(e,n)),n}runIdlePromise(){return Promise.resolve()}}const Mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i_(t){t=String(t);let e,r,n,o,i="",s=0;const u=t.length%3;for(;s<t.length;){if((r=t.charCodeAt(s++))>255||(n=t.charCodeAt(s++))>255||(o=t.charCodeAt(s++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");e=r<<16|n<<8|o,i+=Mi.charAt(e>>18&63)+Mi.charAt(e>>12&63)+Mi.charAt(e>>6&63)+Mi.charAt(e&63)}return u?i.slice(0,u-3)+"===".substring(u):i}function il(){if(typeof globalThis>"u")return!1;const{wx:t}=globalThis;if(typeof t>"u"||globalThis.Page===void 0||!t.getSystemInfoSync||!t.getStorageSync||!t.setStorageSync||!t.connectSocket||!t.request)return!1;try{if(!t.getSystemInfoSync()||t.getSystemInfoSync().AppPlatform==="qq")return!1}catch{return!1}return!0}let bi=!1;function pf(){bi=bi||typeof window!==void 0&&window.__wxjs_environment==="miniprogram"}try{il()||(bi=bi||!!navigator.userAgent.match(/miniprogram/i)||window.__wxjs_environment==="miniprogram",window&&window.WeixinJSBridge&&window.WeixinJSBridge.invoke?pf():typeof document<"u"&&document.addEventListener("WeixinJSBridgeReady",pf,!1))}catch{}function vf(){return bi}const yf="x-request-id",mf="x-device-id",gf="device_id",o_=async function(t,e){let r=null,n=null;try{const o=Object.assign({},e);o.method||(o.method="GET"),o.body&&typeof o.body!="string"&&(o.body=JSON.stringify(o.body));const s=await(await fetch(t,o)).json();s?.error?(n=s,n.error_uri=new URL(t).pathname):r=s}catch(o){n={error:He.UNREACHABLE,error_description:o.message,error_uri:new URL(t).pathname}}if(n)throw n;return r};function a_(){return Py()}class s_{constructor(e){this._env=e?.env||""}async getItem(e){return window.localStorage.getItem(`${e}${this._env}`)}async removeItem(e){window.localStorage.removeItem(`${e}${this._env}`)}async setItem(e,r){window.localStorage.setItem(`${e}${this._env}`,r)}getItemSync(e){return window.localStorage.getItem(`${e}${this._env}`)}removeItemSync(e){window.localStorage.removeItem(`${e}${this._env}`)}setItemSync(e,r){window.localStorage.setItem(`${e}${this._env}`,r)}}const ol=new s_;function Ly(t){let e=!0;return t?.expires_at&&t?.access_token&&(e=t.expires_at<new Date),e}class u_{constructor(e){this.credentials=null,this.accessKeyCredentials=null,this.singlePromise=null,this.tokenSectionName=e.tokenSectionName,this.storage=e.storage,this.clientId=e.clientId,this.singlePromise=new Dy({clientId:this.clientId}),this.credentials=e.credentials||null}getStorageCredentialsSync(){let e=null;const r=this.storage.getItemSync(this.tokenSectionName);if(r!=null)try{e=JSON.parse(r),e?.expires_at&&(e.expires_at=new Date(e.expires_at))}catch{this.storage.removeItem(this.tokenSectionName),e=null}return e}async setCredentials(e){if(e?.expires_in){if(e?.expires_at||(e.expires_at=new Date(Date.now()+(e.expires_in-30)*1e3)),this.storage){const r=JSON.stringify(e);await this.storage.setItem(this.tokenSectionName,r)}this.credentials=e}else this.storage&&await this.storage.removeItem(this.tokenSectionName),this.credentials=null}setAccessKeyCredentials(e){this.accessKeyCredentials=e}async getCredentials(){return this.singlePromise.run("getCredentials",async()=>{if(Ly(this.credentials)){const{credentials:e,isAccessKeyCredentials:r}=await this.getStorageCredentials();if(r)return e;this.credentials=e}return this.credentials})}async getStorageCredentials(){return this.singlePromise.run("_getStorageCredentials",async()=>{let e=null,r=!1;const n=await this.storage.getItem(this.tokenSectionName);if(n)try{e=JSON.parse(n),e?.expires_at&&(e.expires_at=new Date(e.expires_at))}catch{await this.storage.removeItem(this.tokenSectionName),e=null}else e=this.accessKeyCredentials||null,r=!0;return{credentials:e,isAccessKeyCredentials:r}})}}class Ct{constructor(e){this.singlePromise=null,e.clientSecret||(e.clientSecret=""),!e.clientId&&e.env&&(e.clientId=e.env),this.apiOrigin=e.apiOrigin,this.apiPath=e.apiPath||Vo,this.clientId=e.clientId,this.i18n=e.i18n,this.singlePromise=new Dy({clientId:this.clientId}),this.retry=this.formatRetry(e.retry,Ct.defaultRetry),e.baseRequest?this.baseRequest=e.baseRequest:this.baseRequest=o_,this.tokenInURL=e.tokenInURL,this.headers=e.headers,this.storage=e.storage||ol,this.localCredentials=new u_({tokenSectionName:`credentials_${e.clientId}`,storage:this.storage,clientId:e.clientId}),this.clientSecret=e.clientSecret,e.clientId&&(this.basicAuth=`Basic ${i_(`${e.clientId}:${this.clientSecret}`)}`),this.wxCloud=e.wxCloud;try{il()&&(this.useWxCloud=e.useWxCloud,this.wxCloud===void 0&&e.env&&(wx.cloud.init({env:e.env}),this.wxCloud=wx.cloud))}catch{}this.refreshTokenFunc=e.refreshTokenFunc||this.defaultRefreshTokenFunc,this.anonymousSignInFunc=e.anonymousSignInFunc,this.onCredentialsError=e.onCredentialsError,Bo.on(jo,r=>{this.i18n=r.data?.i18n||this.i18n})}setCredentials(e){return this.localCredentials.setCredentials(e)}setAccessKeyCredentials(e){return this.localCredentials.setAccessKeyCredentials(e)}async getAccessToken(){const e=await this.getCredentials();if(e?.access_token)return Promise.resolve(e.access_token);const r={error:He.UNAUTHENTICATED};return Promise.reject(r)}async request(e,r){r||(r={});const n=this.formatRetry(r.retry,this.retry);if(r.headers={...r.headers,[this.i18n?.LANG_HEADER_KEY]:this.i18n?.lang},this.headers&&(r.headers={...this.headers,...r.headers}),r.headers[yf]||(r.headers[yf]=a_()),!r.headers[mf]){const s=await this.getDeviceId();r.headers[mf]=s}if(r?.withBasicAuth&&this.basicAuth&&(r.headers.Authorization=this.basicAuth),r?.withCredentials){const s=await this.getCredentials();s&&(this.tokenInURL?(e.indexOf("?")<0&&(e+="?"),e+=`access_token=${s.access_token}`):r.headers.Authorization=`${s.token_type} ${s.access_token}`)}else this.clientId&&e.indexOf("client_id")<0&&(e+=e.indexOf("?")<0?"?":"&",e+=`client_id=${this.clientId}`);e.startsWith("/")&&(e=`${this.apiOrigin}${this.apiPath}${e}`);let o=null;const i=n+1;for(let s=0;s<i;s++){try{r.useWxCloud||this.useWxCloud?o=await this.wxCloudCallFunction(e,r):o=await this.baseRequest(e,r);break}catch(u){if(r.withCredentials&&u&&u.error===He.UNAUTHENTICATED)return await this.setCredentials(null),Promise.reject(u);if(s===n||!u||u.error!=="unreachable")return Promise.reject(u)}await this.sleep(Ct.retryInterval)}return o}async wxCloudCallFunction(e,r){let n=null,o=null;try{let i="";try{i=await wx.getRendererUserAgent()}catch{}const{result:s}=await this.wxCloud.callFunction({name:"httpOverCallFunction",data:{url:e,method:r.method,headers:{origin:"https://servicewechat.com","User-Agent":i,...r.headers},body:r.body}});s?.body?.error_code?(o=s?.body,o.error_uri=hf(e)):n=s?.body}catch(i){o={error:He.UNREACHABLE,error_description:i.message,error_uri:hf(e)}}if(o)throw o;return n}async getCredentials(){let e=await this.localCredentials.getCredentials();if(!e){const r="credentials not found";return this.onCredentialsError?.({msg:r}),this.unAuthenticatedError(r)}if(Ly(e))if(e.refresh_token)try{e=await this.refreshToken(e)}catch(r){if(e.scope==="anonymous")e=await this.anonymousLogin(e);else return this.onCredentialsError?.({msg:r.error_description}),Promise.reject(r)}else if(e.scope==="anonymous")e=await this.anonymousLogin(e);else{const r="no refresh token found in credentials";return this.onCredentialsError?.({msg:r}),this.unAuthenticatedError(r)}return e}getCredentialsSync(){return this.localCredentials.getStorageCredentialsSync()}getCredentialsAsync(){return this.getCredentials()}async getScope(){const e=await this.localCredentials.getCredentials();if(!e){const r="credentials not found";return this.onCredentialsError?.({msg:r}),this.unAuthenticatedError(r)}return e.scope}async getGroups(){const e=await this.localCredentials.getCredentials();if(!e){const r="credentials not found";return this.onCredentialsError?.({msg:r}),this.unAuthenticatedError(r)}return e.groups}async refreshToken(e){return this.singlePromise.run("_refreshToken",async()=>{if(!e||!e.refresh_token){const r="no refresh token found in credentials";return this.onCredentialsError?.({msg:r}),this.unAuthenticatedError(r)}try{const r=await this.refreshTokenFunc(e.refresh_token,e);return await this.localCredentials.setCredentials(r),r}catch(r){if(r.error===He.INVALID_GRANT){await this.localCredentials.setCredentials(null);const n=r.error_description;return this.onCredentialsError?.({msg:n}),this.unAuthenticatedError(n)}return this.onCredentialsError?.({msg:r.error_description}),Promise.reject(r)}})}async anonymousLogin(e){return this.singlePromise.run("_anonymousLogin",async()=>(this.anonymousSignInFunc?e=await this.anonymousSignInFunc(e)||await this.localCredentials.getCredentials():e=await this.anonymousSignIn(e),e))}checkRetry(e){let r=null;if((typeof e!="number"||e<Ct.minRetry||e>Ct.maxRetry)&&(r={error:He.UNREACHABLE,error_description:"wrong options param: retry"}),r)throw r;return e}formatRetry(e,r){return typeof e>"u"?r:this.checkRetry(e)}async sleep(e){return new Promise(r=>{setTimeout(()=>{r()},e)})}async anonymousSignIn(e){return this.singlePromise.run("_anonymous",async()=>{if(!e||e.scope!=="anonymous")return this.unAuthenticatedError("no anonymous in credentials");try{const r=await this.request(Y.AUTH_SIGN_IN_ANONYMOUSLY_URL,{method:"POST",withBasicAuth:!0,body:{}});return await this.localCredentials.setCredentials(r),r}catch(r){return r.error===He.INVALID_GRANT?(await this.localCredentials.setCredentials(null),this.unAuthenticatedError(r.error_description)):Promise.reject(r)}})}async defaultRefreshTokenFunc(e,r){if(e===void 0||e===""){const i="refresh token not found";return this.onCredentialsError?.({msg:i}),this.unAuthenticatedError(i)}let n=Y.AUTH_TOKEN_URL;return r?.version==="v2"&&(n=Tn.AUTH_TOKEN_URL),{...await this.request(n,{method:"POST",body:{client_id:this.clientId,client_secret:this.clientSecret,grant_type:"refresh_token",refresh_token:e}}),version:r?.version||"v1"}}async getDeviceId(){if(this.deviceID)return this.deviceID;let e=await this.storage.getItem(gf);return typeof e=="string"&&e.length>=16&&e.length<=48||(e=Py(),await this.storage.setItem(gf,e)),this.deviceID=e,e}unAuthenticatedError(e){const r={error:He.UNAUTHENTICATED,error_description:e};return Promise.reject(r)}}Ct.defaultRetry=2;Ct.minRetry=0;Ct.maxRetry=5;Ct.retryInterval=1e3;class ni{constructor(e){if(this.params={},typeof e=="string")this.parse(e);else if(e&&typeof e=="object")for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&this.append(r,e[r])}parse(e){e.split("&").forEach(n=>{const[o,i]=n.split("=").map(decodeURIComponent);this.append(o,i)})}append(e,r){this.params[e]?this.params[e]=this.params[e].concat([r]):this.params[e]=[r]}get(e){return this.params[e]?this.params[e][0]:null}getAll(e){return this.params[e]||[]}delete(e){delete this.params[e]}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}set(e,r){this.params[e]=[r]}toString(){const e=[];for(const r in this.params)Object.prototype.hasOwnProperty.call(this.params,r)&&this.params[r].forEach(n=>{e.push(`${encodeURIComponent(r)}=${encodeURIComponent(n)}`)});return e.join("&")}}class c_{constructor(e){e.openURIWithCallback||(e.openURIWithCallback=this.getDefaultOpenURIWithCallback()),e.storage||(e.storage=ol),this.config=e,this.tokenSectionName=`captcha_${e.clientId}`}isMatch(){return this.config?.adapter?.isMatch?.()||il()}async request(e,r){r||(r={}),r.method||(r.method="GET");const n=`${r.method}:${e}`;let o=e;r.withCaptcha&&(o=await this.appendCaptchaTokenToURL(e,n,!1));let i;try{i=await this.config.request(o,r)}catch(s){return s.error===He.CAPTCHA_REQUIRED||s.error===He.CAPTCHA_INVALID?(e=await this.appendCaptchaTokenToURL(e,n,s.error===He.CAPTCHA_INVALID),this.config.request(e,r)):Promise.reject(s)}return i}getDefaultOpenURIWithCallback(){if(!this.isMatch()&&!vf()&&(window.location.search.indexOf("__captcha")>0&&(document.body.style.display="none"),document.getElementById("captcha_panel_wrap")===null)){const e=document.createElement("div");e.style.cssText="background-color: rgba(0, 0, 0, 0.7);position: fixed;left: 0px;right: 0px;top: 0px;bottom: 0px;padding: 9vw 0 0 0;display: none;z-index:100;",e.setAttribute("id","captcha_panel_wrap"),setTimeout(()=>{document.body.appendChild(e)},0)}return this.defaultOpenURIWithCallback}async defaultOpenURIWithCallback(e,r){const{width:n="355px",height:o="355px"}=r||{};if(e.match(/^(data:.*)$/))return Promise.reject({error:He.UNIMPLEMENTED,error_description:"need to impl captcha data"});const s=document.getElementById("captcha_panel_wrap"),u=document.createElement("iframe");return s.innerHTML="",u.setAttribute("src",e),u.setAttribute("id","review-panel-iframe"),u.style.cssText=`min-width:${n};display:block;height:${o};margin:0 auto;background-color: rgb(255, 255, 255);border: none;`,s.appendChild(u),s.style.display="block",new Promise((l,a)=>{u.onload=function(){try{const c=window.location,f=u.contentWindow.location;if(f.host+f.pathname===c.host+c.pathname){s.style.display="none";const d=new ni(f.search),h=d.get("captcha_token");return h?l({captcha_token:h,expires_in:Number(d.get("expires_in"))}):a({error:d.get("error"),error_description:d.get("error_description")})}s.style.display="block"}catch{s.style.display="block"}}})}async getCaptchaToken(e,r){if(!e){const i=await this.findCaptchaToken();if(i)return i}let n;if(!this.isMatch()&&!vf()){const i=`${window.location.origin+window.location.pathname}?__captcha=on`;if(n=await this.config.request(Y.GET_CAPTCHA_URL,{method:"POST",body:{client_id:this.config.clientId,redirect_uri:i,state:r},withCredentials:!1}),n.captcha_token){const s={captcha_token:n.captcha_token,expires_in:n.expires_in};return this.saveCaptchaToken(s),n.captcha_token}}else{const i=await this.config.request(Y.CAPTCHA_DATA_URL,{method:"POST",body:{state:r,redirect_uri:""},withCredentials:!1});n={url:`${i.data}?state=${encodeURIComponent(r)}&token=${encodeURIComponent(i.token)}`}}const o=await this.config.openURIWithCallback(n.url);return this.saveCaptchaToken(o),o.captcha_token}async appendCaptchaTokenToURL(e,r,n){const o=await this.getCaptchaToken(n,r);return e.indexOf("?")>0?e+=`&captcha_token=${o}`:e+=`?captcha_token=${o}`,e}async saveCaptchaToken(e){e.expires_at=new Date(Date.now()+(e.expires_in-10)*1e3);const r=JSON.stringify(e);await this.config.storage.setItem(this.tokenSectionName,r)}async findCaptchaToken(){const e=await this.config.storage.getItem(this.tokenSectionName);if(e!=null)try{const r=JSON.parse(e);return r?.expires_at&&(r.expires_at=new Date(r.expires_at)),r.expires_at<new Date?null:r.captcha_token}catch{return await this.config.storage.removeItem(this.tokenSectionName),null}return null}}var l_={};function Aa(t,e){const r=()=>{try{return require("../utils/encrypt")}catch{return}};try{if((e?.root?.globalThis||globalThis).IS_MP_BUILD)return;if(!l_.IS_MP_BUILD&&t)return r()}catch{if(t)return r()}}let f_=class to{static parseParamsToSearch(e){return Object.keys(e).forEach(n=>{e[n]||delete e[n]}),new ni(e).toString()}constructor(e){let{request:r}=e,n=e.credentialsClient;if(!n){const o={apiOrigin:e.apiOrigin,apiPath:e.apiPath,clientId:e.clientId,storage:e.storage,env:e.env,baseRequest:e.baseRequest,anonymousSignInFunc:e.anonymousSignInFunc,wxCloud:e.wxCloud,onCredentialsError:e.onCredentialsError,headers:e.headers||{},i18n:e.i18n};n=new Ct(o)}if(!r){const o=n.request.bind(n),i=new c_({clientId:e.clientId,request:o,storage:e.storage,adapter:e.adapter,...e.captchaOptions});r=i.request.bind(i)}this.config={env:e.env,apiOrigin:e.apiOrigin,apiPath:e.apiPath,clientId:e.clientId,request:r,credentialsClient:n,storage:e.storage||ol,adapter:e.adapter}}getParamsByVersion(e,r){const n=bc(e),o={v2:Tn}[n?.version]?.[r]||Y[r];return n&&delete n.version,{params:n,url:o}}async signIn(e){const r=e.version||"v1",n=this.getParamsByVersion(e,"AUTH_SIGN_IN_URL");n.params.query&&delete n.params.query;const o=await this.getEncryptParams(n.params),i=await this.config.request(n.url,{method:"POST",body:o});return await this.config.credentialsClient.setCredentials({...i,version:r}),Promise.resolve(i)}async signInAnonymously(e={},r=!1){const n=await this.config.request(Y.AUTH_SIGN_IN_ANONYMOUSLY_URL,{method:"POST",body:e,useWxCloud:r});return await this.config.credentialsClient.setCredentials(n),Promise.resolve(n)}async signUp(e){const r=await this.config.request(Y.AUTH_SIGN_UP_URL,{method:"POST",body:e});return await this.config.credentialsClient.setCredentials(r),Promise.resolve(r)}async signOut(e){let r={};if(e){try{r=await this.config.request(Y.AUTH_SIGNOUT_URL,{method:"POST",withCredentials:!0,body:e})}catch(i){i.error!==He.UNAUTHENTICATED&&console.log("sign_out_error",i)}return await this.config.credentialsClient.setCredentials(),r}const n=await this.config.credentialsClient.getAccessToken(),o=await this.config.request(Y.AUTH_REVOKE_URL,{method:"POST",body:{token:n}});return await this.config.credentialsClient.setCredentials(),Promise.resolve(o)}async revokeAllDevices(){await this.config.request(Y.AUTH_REVOKE_ALL_URL,{method:"DELETE",withCredentials:!0})}async revokeDevice(e){await this.config.request(Y.AUTHORIZED_DEVICES_DELETE_URL+e.device_id,{method:"DELETE",withCredentials:!0})}async getVerification(e,r){let n=!1;return(e.target==="CUR_USER"||await this.hasLoginState())&&(n=!0),this.config.request(Y.VERIFICATION_URL,{method:"POST",body:e,withCaptcha:r?.withCaptcha||!1,withCredentials:n})}async verify(e){const r=this.getParamsByVersion(e,"VERIFY_URL"),n=await this.config.request(r.url,{method:"POST",body:r.params});return e?.version==="v2"&&await this.config.credentialsClient.setCredentials({...n,version:"v2"}),n}async genProviderRedirectUri(e){const{provider_redirect_uri:r,other_params:n={},...o}=e;r&&!o.redirect_uri&&(o.redirect_uri=r);let i=`${Y.PROVIDER_URI_URL}?${to.parseParamsToSearch(o)}`;return Object.keys(n).forEach(s=>{const u=n[s];s==="sign_out_uri"&&!(u?.length>0)||(i+=`&other_params[${s}]=${encodeURIComponent(u)}`)}),this.config.request(i,{method:"GET"})}async grantProviderToken(e,r=!1){return this.config.request(Y.PROVIDER_TOKEN_URL,{method:"POST",body:e,useWxCloud:r})}async patchProviderToken(e){return this.config.request(Y.PROVIDER_TOKEN_URL,{method:"PATCH",body:e})}async signInWithProvider(e,r=!1){const n=this.getParamsByVersion(e,"AUTH_SIGN_IN_WITH_PROVIDER_URL"),o=await this.config.request(n.url,{method:"POST",body:n.params,useWxCloud:r});return await this.config.credentialsClient.setCredentials({...o,version:e?.version||"v1"}),Promise.resolve(o)}async signInCustom(e){const r=await this.config.request(Y.AUTH_SIGN_IN_CUSTOM,{method:"POST",body:e});return await this.config.credentialsClient.setCredentials(r),Promise.resolve(r)}async signInWithWechat(e={}){const r=await this.config.request(Y.AUTH_SIGN_IN_WITH_WECHAT_URL,{method:"POST",body:e});return await this.config.credentialsClient.setCredentials(r),Promise.resolve(r)}async bindWithProvider(e){return this.config.request(Y.PROVIDER_BIND_URL,{method:"POST",body:e,withCredentials:!0})}async getUserProfile(e){return this.getUserInfo(e)}async getUserInfo(e={}){const r=this.getParamsByVersion(e,"USER_ME_URL");if(r.params?.query){const o=new ni(r.params.query);r.url+=`?${o.toString()}`}const n=await this.config.request(r.url,{method:"GET",withCredentials:!0});return n.sub&&(n.uid=n.sub),n}async getWedaUserInfo(){return await this.config.request(Y.WEDA_USER_URL,{method:"GET",withCredentials:!0})}async deleteMe(e){const r=this.getParamsByVersion(e,"USER_ME_URL"),n=`${r.url}?${to.parseParamsToSearch(r.params)}`;return this.config.request(n,{method:"DELETE",withCredentials:!0})}async hasLoginState(){try{return await this.config.credentialsClient.getAccessToken(),!0}catch{return!1}}hasLoginStateSync(){return this.config.credentialsClient.getCredentialsSync()}async getLoginState(){return this.config.credentialsClient.getCredentialsAsync()}async transByProvider(e){return this.config.request(Y.USER_TRANS_BY_PROVIDER_URL,{method:"PATCH",body:e,withCredentials:!0})}async grantToken(e){const r=this.getParamsByVersion(e,"AUTH_TOKEN_URL");return this.config.request(r.url,{method:"POST",body:r.params})}async getProviders(){return this.config.request(Y.PROVIDER_LIST,{method:"GET",withCredentials:!0})}async unbindProvider(e){return this.config.request(`${Y.PROVIDER_UNBIND_URL}/${e.provider_id}`,{method:"DELETE",withCredentials:!0})}async checkPassword(e){return this.config.request(`${Y.CHECK_PWD_URL}`,{method:"POST",withCredentials:!0,body:e})}async editContact(e){return this.config.request(`${Y.BIND_CONTACT_URL}`,{method:"PATCH",withCredentials:!0,body:e})}async setPassword(e){return this.config.request(`${Y.AUTH_SET_PASSWORD}`,{method:"PATCH",withCredentials:!0,body:e})}async updatePasswordByOld(e){const r=await this.sudo({password:e.old_password});return this.setPassword({sudo_token:r.sudo_token,new_password:e.new_password})}async sudo(e){return this.config.request(`${Y.SUDO_URL}`,{method:"POST",withCredentials:!0,body:e})}async sendVerificationCodeToCurrentUser(e){return e.target="CUR_USER",this.config.request(Y.VERIFICATION_URL,{method:"POST",body:e,withCredentials:!0,withCaptcha:!0})}async changeBoundProvider(e){return this.config.request(`${Y.PROVIDER_LIST}/${e.provider_id}/trans`,{method:"POST",body:{provider_trans_token:e.trans_token},withCredentials:!0})}async setUserProfile(e){return this.config.request(Y.USER_PRIFILE_URL,{method:"PATCH",body:e,withCredentials:!0})}async updateUserBasicInfo(e){return this.config.request(Y.USER_BASIC_EDIT_URL,{method:"POST",withCredentials:!0,body:e})}async queryUserProfile(e){const r=new ni(e);return this.config.request(`${Y.USER_QUERY_URL}?${r.toString()}`,{method:"GET",withCredentials:!0})}setCustomSignFunc(e){this.getCustomSignTicketFn=e}async signInWithCustomTicket(){const e=this.getCustomSignTicketFn;if(!e)return Promise.reject({error:"failed_precondition",error_description:"please use setCustomSignFunc to set custom sign function"});const r=await e();return this.signInCustom({provider_id:"custom",ticket:r})}async resetPassword(e){return this.config.request(Y.AUTH_RESET_PASSWORD,{method:"POST",body:e})}async authorize(e){return this.config.request(Y.AUTHORIZE_URL,{method:"POST",withCredentials:!0,body:e})}async authorizeDevice(e){return this.config.request(Y.AUTHORIZE_DEVICE_URL,{method:"POST",withCredentials:!0,body:e})}async deviceAuthorize(e){return this.config.request(Y.AUTH_GET_DEVICE_CODE,{method:"POST",body:e,withCredentials:!0})}async authorizeInfo(e){const r=`${Y.AUTHORIZE_INFO_URL}?${to.parseParamsToSearch(e)}`;let n=!0,o=!1;return await this.hasLoginState()&&(o=!0,n=!1),this.config.request(r,{method:"GET",withBasicAuth:n,withCredentials:o})}async checkUsername(e){return this.config.request(Y.CHECK_USERNAME,{method:"GET",body:e,withCredentials:!0})}async checkIfUserExist(e){const r=new ni(e);return this.config.request(`${Y.CHECK_IF_USER_EXIST}?${r.toString()}`,{method:"GET"})}async loginScope(){return this.config.credentialsClient.getScope()}async loginGroups(){return this.config.credentialsClient.getGroups()}async refreshTokenForce(e){const r=await this.config.credentialsClient.getCredentials();return await this.config.credentialsClient.refreshToken({...r,version:e?.version||"v1"})}async getCredentials(){return this.config.credentialsClient.getCredentials()}async getPublicKey(){return this.config.request(Tn.AUTH_PUBLIC_KEY,{method:"POST",body:{}})}async getEncryptParams(e){const{isEncrypt:r}=e;delete e.isEncrypt;const n=bc(e),o=Aa(r,this.config.adapter);if(!o)return e;let i="",s="";try{const u=await this.getPublicKey();if(i=u.public_key,s=u.public_key_thumbprint,!i||!s)throw u}catch(u){throw u}return{params:o.getEncryptInfo({publicKey:i,payload:n}),public_key_thumbprint:s}}async getProviderSubType(){return this.config.request(Y.GET_PROVIDER_TYPE,{method:"POST",body:{provider_id:"weda"}})}async verifyCaptchaData({token:e,key:r}){return this.config.request(Y.VERIFY_CAPTCHA_DATA_URL,{method:"POST",body:{token:e,key:r},withCredentials:!1})}async createCaptchaData({state:e,redirect_uri:r=void 0}){return this.config.request(Y.CAPTCHA_DATA_URL,{method:"POST",body:{state:e,redirect_uri:r},withCredentials:!1})}async getMiniProgramCode(e){return this.config.request(Y.GET_MINIPROGRAM_QRCODE,{method:"POST",body:e})}async getMiniProgramQrCodeStatus(e){return this.config.request(Y.GET_MINIPROGRAM_QRCODE_STATUS,{method:"POST",body:e})}async getUserBehaviorLog(e){const r={LOGIN:"query[action]=USER_LOGIN",MODIFY:"ne_query[action]=USER_LOGIN"},n=`${Y.GET_USER_BEHAVIOR_LOG}?${r[e.type]}&limit=${e.limit}${e.page_token?`&page_token=${e.page_token}`:""}`;return this.config.request(n,{method:"GET",withCredentials:!0})}async modifyPassword(e){let r="",n="";const o=Aa(!0,this.config.adapter);if(!o)throw new Error("do not support encrypt, a encrypt util required.");try{const u=await this.getPublicKey();if(r=u.public_key,n=u.public_key_thumbprint,!r||!n)throw u}catch(u){throw u}const i=e.password?o.getEncryptInfo({publicKey:r,payload:e.password}):"",s=o.getEncryptInfo({publicKey:r,payload:e.new_password});return this.config.request(Y.USER_BASIC_EDIT_URL,{method:"POST",withCredentials:!0,body:{user_id:e.user_id,encrypt_password:i,encrypt_new_password:s,public_key_thumbprint:n}})}async modifyPasswordWithoutLogin(e){let r="",n="";const o=Aa(!0,this.config.adapter);if(!o)throw new Error("do not support encrypt, a encrypt util required.");try{const u=await this.getPublicKey();if(r=u.public_key,n=u.public_key_thumbprint,!r||!n)throw u}catch(u){throw u}const i=e.password?o.getEncryptInfo({publicKey:r,payload:e.password}):"",s=o.getEncryptInfo({publicKey:r,payload:e.new_password});return this.config.request(Tn.AUTH_RESET_PASSWORD,{method:"POST",body:{username:e.username,password:i,new_password:s,public_key_thumbprint:n}})}};class d_{constructor(e){const{apiOrigin:r,apiPath:n=Vo,clientId:o,env:i,storage:s,request:u,baseRequest:l,anonymousSignInFunc:a,wxCloud:c,adapter:f,onCredentialsError:d,headers:h,i18n:y,useWxCloud:m}=e;this.oauth2client=new Ct({apiOrigin:r,apiPath:n,clientId:o,env:i,storage:s,baseRequest:l||u,anonymousSignInFunc:a,wxCloud:c,onCredentialsError:d,headers:h||{},i18n:y,useWxCloud:m}),this.authApi=new f_({credentialsClient:this.oauth2client,...e,request:u?this.oauth2client.request.bind(this.oauth2client):void 0,adapter:f})}}var V={},_f;function Bn(){if(_f)return V;_f=1,Object.defineProperty(V,"__esModule",{value:!0}),V.parseQueryString=V.transformPhone=V.sleep=V.printGroupLog=V.throwError=V.printInfo=V.printError=V.printWarn=V.execCallback=V.createPromiseCallback=V.removeParam=V.getHash=V.getQuery=V.toQueryString=V.formatUrl=V.generateRequestId=V.genSeqId=V.isFormData=V.isInstanceOf=V.isNull=V.isPalinObject=V.isUndefined=V.isString=V.isArray=void 0;var t=Ho();function e(O){return Object.prototype.toString.call(O)==="[object Array]"}V.isArray=e;function r(O){return typeof O=="string"}V.isString=r;function n(O){return typeof O>"u"}V.isUndefined=n;function o(O){return Object.prototype.toString.call(O)==="[object Object]"}V.isPalinObject=o;function i(O){return Object.prototype.toString.call(O)==="[object Null]"}V.isNull=i;function s(O,C){return O instanceof C}V.isInstanceOf=s;function u(O){return Object.prototype.toString.call(O)==="[object FormData]"}V.isFormData=u;function l(){return Math.random().toString(16).slice(2)}V.genSeqId=l;function a(){var O=new Date().getTime(),C=Date?.now&&Date.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(A){var N=Math.random()*16;return O>0?(N=(O+N)%16|0,O=Math.floor(O/16)):(N=(C+N)%16|0,C=Math.floor(C/16)),(A==="x"?N:N&7|8).toString(16)})}V.generateRequestId=a;function c(O,C,A){A===void 0&&(A={});var N=/\?/.test(C),U="";return Object.keys(A).forEach(function(q){U===""?!N&&(C+="?"):U+="&",U+="".concat(q,"=").concat(encodeURIComponent(A[q]))}),C+=U,/^http(s)?:\/\//.test(C)?C:"".concat(O).concat(C)}V.formatUrl=c;function f(O){O===void 0&&(O={});var C=[];return Object.keys(O).forEach(function(A){C.push("".concat(A,"=").concat(encodeURIComponent(O[A])))}),C.join("&")}V.toQueryString=f;function d(O,C){if(typeof window>"u")return!1;var A=C||window.location.search,N=new RegExp("(^|&)".concat(O,"=([^&]*)(&|$)")),U=A.substr(A.indexOf("?")+1).match(N);return U!=null?U[2]:""}V.getQuery=d;var h=function(O){if(typeof window>"u")return"";var C=window.location.hash.match(new RegExp("[#?&/]".concat(O,"=([^&#]*)")));return C?C[1]:""};V.getHash=h;function y(O,C){var A=C.split("?")[0],N,U=[],q=C.indexOf("?")!==-1?C.split("?")[1]:"";if(q!==""){U=q.split("&");for(var W=U.length-1;W>=0;W-=1)N=U[W].split("=")[0],N===O&&U.splice(W,1);A="".concat(A,"?").concat(U.join("&"))}return A}V.removeParam=y;function m(){var O;if(!Promise){O=function(){},O.promise={};var C=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(O.promise,"then",{get:C}),Object.defineProperty(O.promise,"catch",{get:C}),O}var A=new Promise(function(N,U){O=function(q,W){return q?U(q):N(W)}});return O.promise=A,O}V.createPromiseCallback=m;function b(O,C,A){if(A===void 0&&(A=null),O&&typeof O=="function")return O(C,A);if(C)throw C;return A}V.execCallback=b;function w(O,C){console.warn("[".concat((0,t.getSdkName)(),"][").concat(O,"]:").concat(C))}V.printWarn=w;function _(O,C){console.error({code:O,msg:"[".concat((0,t.getSdkName)(),"][").concat(O,"]:").concat(C)})}V.printError=_;function E(O,C){console.log("[".concat((0,t.getSdkName)(),"][").concat(O,"]:").concat(C))}V.printInfo=E;function I(O,C){throw new Error(JSON.stringify({code:O,msg:"[".concat((0,t.getSdkName)(),"][").concat(O,"]:").concat(C)}))}V.throwError=I;function R(O){var C,A=O.title,N=O.subtitle,U=N===void 0?"":N,q=O.content,W=q===void 0?[]:q,ae=O.printTrace,z=ae===void 0?!1:ae,Q=O.collapsed,H=Q===void 0?!1:Q;H?(console.groupCollapsed||console.error)(A,U):(console.group||console.error)(A,U);for(var K=0,ve=W;K<ve.length;K++){var Dt=ve[K],Jt=Dt.type,Lt=Dt.body;switch(Jt){case"info":console.log(Lt);break;case"warn":console.warn(Lt);break;case"error":console.error(Lt);break}}z&&(console.trace||console.log)("stack trace:"),(C=console.groupEnd)===null||C===void 0||C.call(console)}V.printGroupLog=R;var x=function(O){return O===void 0&&(O=0),new Promise(function(C){return setTimeout(C,O)})};V.sleep=x;function P(O){return"+86".concat(O)}V.transformPhone=P;var D=function(O){O=O.replace(/^\?/,"");var C={},A=O.split("&");return A.forEach(function(N){var U=N.split("="),q=U[0],W=U[1];q=decodeURIComponent(q),W=decodeURIComponent(W),q&&(C[q]?Array.isArray(C[q])?C[q].push(W):C[q]=[C[q],W]:C[q]=W)}),C};return V.parseQueryString=D,V}var Rn=Bn(),Pr={},Qt={},bf;function h_(){if(bf)return Qt;bf=1;var t=Qt&&Qt.__awaiter||function(c,f,d,h){function y(m){return m instanceof d?m:new d(function(b){b(m)})}return new(d||(d=Promise))(function(m,b){function w(I){try{E(h.next(I))}catch(R){b(R)}}function _(I){try{E(h.throw(I))}catch(R){b(R)}}function E(I){I.done?m(I.value):y(I.value).then(w,_)}E((h=h.apply(c,f||[])).next())})},e=Qt&&Qt.__generator||function(c,f){var d={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},h,y,m,b;return b={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function w(E){return function(I){return _([E,I])}}function _(E){if(h)throw new TypeError("Generator is already executing.");for(;b&&(b=0,E[0]&&(d=0)),d;)try{if(h=1,y&&(m=E[0]&2?y.return:E[0]?y.throw||((m=y.return)&&m.call(y),0):y.next)&&!(m=m.call(y,E[1])).done)return m;switch(y=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return d.label++,{value:E[1],done:!1};case 5:d.label++,y=E[1],E=[0];continue;case 7:E=d.ops.pop(),d.trys.pop();continue;default:if(m=d.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){d=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){d.label=E[1];break}if(E[0]===6&&d.label<m[1]){d.label=m[1],m=E;break}if(m&&d.label<m[2]){d.label=m[2],d.ops.push(E);break}m[2]&&d.ops.pop(),d.trys.pop();continue}E=f.call(c,d)}catch(I){E=[6,I],y=0}finally{h=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.catchErrorsDecorator=void 0;var r=Bn(),n=Ho(),o=!1;typeof navigator<"u"&&navigator.userAgent&&(o=navigator.userAgent.indexOf("Firefox")!==-1);var i=o?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,s=/https?:\/\/.+:\d*\/.*\.js:\d+:\d+/;function u(c){var f=c.mode,d=f===void 0?"async":f,h=c.customInfo,y=h===void 0?{}:h,m=c.title,b=c.messages,w=b===void 0?[]:b;return function(_,E,I){if(n.IS_DEBUG_MODE){var R=y.className||_.constructor.name,x=y.methodName||E,P=I.value,D=l(new Error);d==="sync"?I.value=function(){for(var O=[],C=0;C<arguments.length;C++)O[C]=arguments[C];var A=a({err:new Error,className:R,methodName:x,sourceLink:D});try{return P.apply(this,O)}catch(Q){var N=Q,U=Q.message,q=Q.error,W=Q.error_description,ae={title:m||"".concat(R,".").concat(x," failed"),content:[{type:"error",body:Q}]};if(U&&/^\{.*\}$/.test(U)){var z=JSON.parse(U);ae.subtitle=U,z.code&&(A?(A.code=z.code,A.msg=z.msg):(Q.code=z.code,Q.message=z.msg),N=A||Q,ae.content=w.map(function(H){return{type:"info",body:H}}))}throw q&&W&&(ae.subtitle=W,A?(A.code=q,A.msg=W):(Q.code=q,Q.message=W),N=A||Q,ae.content=w.map(function(H){return{type:"info",body:H}})),(0,r.printGroupLog)(ae),N}}:I.value=function(){for(var O=[],C=0;C<arguments.length;C++)O[C]=arguments[C];return t(this,void 0,void 0,function(){var A,N,U,q,W,ae,z,Q;return e(this,function(H){switch(H.label){case 0:A=a({err:new Error,className:R,methodName:x,sourceLink:D}),H.label=1;case 1:return H.trys.push([1,3,,4]),[4,P.apply(this,O)];case 2:return[2,H.sent()];case 3:throw N=H.sent(),U=N,q=N.message,W=N.error,ae=N.error_description,z={title:m||"".concat(R,".").concat(x," failed"),content:[{type:"error",body:N}]},q&&/^\{.*\}$/.test(q)&&(Q=JSON.parse(q),z.subtitle=Q,Q.code&&(A?(A.code=Q.code,A.message=Q.msg):(N.code=Q.code,N.message=Q.msg),U=A||N,z.content=w.map(function(K){return{type:"info",body:K}}))),W&&ae&&(z.subtitle=ae,A?(A.code=W,A.msg=ae):(N.code=W,N.message=ae),U=A||N,z.content=w.map(function(K){return{type:"info",body:K}})),(0,r.printGroupLog)(z),U;case 4:return[2]}})})}}}}Qt.catchErrorsDecorator=u;function l(c){var f="",d=c.stack.split(`
`),h=d.findIndex(function(m){return i.test(m)});if(h!==-1){var y=s.exec(d[h+1]||"");f=y?y[0]:""}return f}function a(c){var f=c.err,d=c.className,h=c.methodName,y=c.sourceLink;if(!y)return null;var m=f.stack.split(`
`),b=o?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp("".concat(d,"\\.descriptor.value\\s*\\[as\\s").concat(h,"\\]\\s*\\(.*\\)$")),w=o?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp("".concat(d,"\\.descriptor.value\\s*\\[as\\s").concat(h,"\\]")),_=m.findIndex(function(R){return b.test(R)}),E;if(_!==-1){var I=m.filter(function(R,x){return x>_});I.unshift(m[_].replace(w,"".concat(d,".").concat(h)).replace(s,y)),E=new Error,E.stack="".concat(o?"@debugger":"Error",`
`).concat(I.join(`
`))}return E}return Qt}var wf;function p_(){return wf||(wf=1,(function(t){var e=Pr&&Pr.__createBinding||(Object.create?(function(n,o,i,s){s===void 0&&(s=i);var u=Object.getOwnPropertyDescriptor(o,i);(!u||("get"in u?!o.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return o[i]}}),Object.defineProperty(n,s,u)}):(function(n,o,i,s){s===void 0&&(s=i),n[s]=o[i]})),r=Pr&&Pr.__exportStar||function(n,o){for(var i in n)i!=="default"&&!Object.prototype.hasOwnProperty.call(o,i)&&e(o,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(h_(),t)})(Pr)),Pr}var le=p_(),Oe={},Ef;function v_(){if(Ef)return Oe;Ef=1;var t=Oe&&Oe.__extends||(function(){var d=function(h,y){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,b){m.__proto__=b}||function(m,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(m[w]=b[w])},d(h,y)};return function(h,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");d(h,y);function m(){this.constructor=h}h.prototype=y===null?Object.create(y):(m.prototype=y.prototype,new m)}})(),e=Oe&&Oe.__spreadArray||function(d,h,y){if(y||arguments.length===2)for(var m=0,b=h.length,w;m<b;m++)(w||!(m in h))&&(w||(w=Array.prototype.slice.call(h,0,m)),w[m]=h[m]);return d.concat(w||Array.prototype.slice.call(h))};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.removeEventListener=Oe.activateEvent=Oe.addEventListener=Oe.CloudbaseEventEmitter=Oe.IErrorEvent=Oe.CloudbaseEvent=void 0;var r=Bn();function n(d,h,y){y[d]=y[d]||[],y[d].push(h)}function o(d,h,y){if(y?.[d]){var m=y[d].indexOf(h);m!==-1&&y[d].splice(m,1)}}var i=(function(){function d(h,y){this.data=y||null,this.name=h}return d})();Oe.CloudbaseEvent=i;var s=(function(d){t(h,d);function h(y,m){var b=d.call(this,"error",{error:y,data:m})||this;return b.error=y,b}return h})(i);Oe.IErrorEvent=s;var u=(function(){function d(){this.listeners={}}return d.prototype.on=function(h,y){return n(h,y,this.listeners),this},d.prototype.off=function(h,y){return o(h,y,this.listeners),this},d.prototype.fire=function(h,y){if((0,r.isInstanceOf)(h,s))return console.error(h.error),this;var m=(0,r.isString)(h)?new i(h,y||{}):h,b=m.name;if(this.listens(b)){m.target=this;for(var w=this.listeners[b]?e([],this.listeners[b],!0):[],_=0,E=w;_<E.length;_++){var I=E[_];I.call(this,m)}}return this},d.prototype.listens=function(h){return this.listeners[h]&&this.listeners[h].length>0},d})();Oe.CloudbaseEventEmitter=u;var l=new u;function a(d,h){l.on(d,h)}Oe.addEventListener=a;function c(d,h){h===void 0&&(h={}),l.fire(d,h)}Oe.activateEvent=c;function f(d,h){l.off(d,h)}return Oe.removeEventListener=f,Oe}var y_=v_(),Et={};const Uy=mm(wm);var Sf;function m_(){if(Sf)return Et;Sf=1;var t={},e=Et&&Et.__extends||(function(){var c=function(f,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,y){h.__proto__=y}||function(h,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(h[m]=y[m])},c(f,d)};return function(f,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");c(f,d);function h(){this.constructor=f}f.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}})(),r=Et&&Et.__awaiter||function(c,f,d,h){function y(m){return m instanceof d?m:new d(function(b){b(m)})}return new(d||(d=Promise))(function(m,b){function w(I){try{E(h.next(I))}catch(R){b(R)}}function _(I){try{E(h.throw(I))}catch(R){b(R)}}function E(I){I.done?m(I.value):y(I.value).then(w,_)}E((h=h.apply(c,f||[])).next())})},n=Et&&Et.__generator||function(c,f){var d={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},h,y,m,b;return b={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function w(E){return function(I){return _([E,I])}}function _(E){if(h)throw new TypeError("Generator is already executing.");for(;b&&(b=0,E[0]&&(d=0)),d;)try{if(h=1,y&&(m=E[0]&2?y.return:E[0]?y.throw||((m=y.return)&&m.call(y),0):y.next)&&!(m=m.call(y,E[1])).done)return m;switch(y=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return d.label++,{value:E[1],done:!1};case 5:d.label++,y=E[1],E=[0];continue;case 7:E=d.ops.pop(),d.trys.pop();continue;default:if(m=d.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){d=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){d.label=E[1];break}if(E[0]===6&&d.label<m[1]){d.label=m[1],m=E;break}if(m&&d.label<m[2]){d.label=m[2],d.ops.push(E);break}m[2]&&d.ops.pop(),d.trys.pop();continue}E=f.call(c,d)}catch(I){E=[6,I],y=0}finally{h=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(Et,"__esModule",{value:!0}),Et.CloudbaseCache=void 0;var o=Uy,i=Bn(),s=Ho(),u=(function(c){e(f,c);function f(d){var h=c.call(this)||this;return h.root=d,d.tcbCacheObject||(d.tcbCacheObject={}),h}return f.prototype.setItem=function(d,h){this.root.tcbCacheObject[d]=h},f.prototype.getItem=function(d){return this.root.tcbCacheObject[d]},f.prototype.removeItem=function(d){delete this.root.tcbCacheObject[d]},f.prototype.clear=function(){delete this.root.tcbCacheObject},f})(o.AbstractStorage);function l(c,f){switch(c){case"local":return f.localStorage?f.localStorage:((0,i.printWarn)(s.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new u(f.root));case"none":return new u(f.root);default:return f.localStorage?f.localStorage:((0,i.printWarn)(s.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new u(f.root))}}var a=(function(){function c(f){this.keys={};var d=f.persistence,h=f.platformInfo,y=h===void 0?{}:h,m=f.keys,b=m===void 0?{}:m;this.platformInfo=y,this.storage||(this.persistenceTag=this.platformInfo.adapter.primaryStorage||d,this.storage=l(this.persistenceTag,this.platformInfo.adapter),this.keys=b)}return Object.defineProperty(c.prototype,"mode",{get:function(){return this.storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"persistence",{get:function(){return this.persistenceTag},enumerable:!1,configurable:!0}),c.prototype.setStore=function(f,d,h){if(this.mode==="async"){(0,i.printWarn)(s.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed");return}if(this.storage)try{var y={version:h||"localCachev1",content:d};this.storage.setItem(f,JSON.stringify(y))}catch(m){throw new Error(JSON.stringify({code:s.ERRORS.OPERATION_FAIL,msg:"[".concat((0,s.getSdkName)(),"][").concat(s.ERRORS.OPERATION_FAIL,"]setStore failed"),info:m}))}},c.prototype.setStoreAsync=function(f,d,h){return r(this,void 0,void 0,function(){var y;return n(this,function(m){switch(m.label){case 0:if(!this.storage)return[2];m.label=1;case 1:return m.trys.push([1,3,,4]),y={version:h||"localCachev1",content:d},[4,this.storage.setItem(f,JSON.stringify(y))];case 2:return m.sent(),[3,4];case 3:return m.sent(),[2];case 4:return[2]}})})},c.prototype.getStore=function(f,d){var h;if(this.mode==="async"){(0,i.printWarn)(s.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed");return}try{if(typeof process<"u"&&(!((h=t)===null||h===void 0)&&h.tcb_token))return t.tcb_token;if(!this.storage)return""}catch{return""}d=d||"localCachev1";var y=this.storage.getItem(f);if(!y)return"";if(y.indexOf(d)>=0){var m=JSON.parse(y);return m.content}return""},c.prototype.getStoreAsync=function(f,d){var h;return r(this,void 0,void 0,function(){var y,m;return n(this,function(b){switch(b.label){case 0:try{if(typeof process<"u"&&(!((h=t)===null||h===void 0)&&h.tcb_token))return[2,t.tcb_token];if(!this.storage)return[2,""]}catch{return[2,""]}return d=d||"localCachev1",[4,this.storage.getItem(f)];case 1:return y=b.sent(),y?y.indexOf(d)>=0?(m=JSON.parse(y),[2,m.content]):[2,""]:[2,""]}})})},c.prototype.removeStore=function(f){if(this.mode==="async"){(0,i.printWarn)(s.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed");return}this.storage.removeItem(f)},c.prototype.removeStoreAsync=function(f){return r(this,void 0,void 0,function(){return n(this,function(d){switch(d.label){case 0:return[4,this.storage.removeItem(f)];case 1:return d.sent(),[2]}})})},c})();return Et.CloudbaseCache=a,Et}var g_=m_(),St={},We={},If;function __(){if(If)return We;If=1;var t=We&&We.__extends||(function(){var a=function(c,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(d[y]=h[y])},a(c,f)};return function(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");a(c,f);function d(){this.constructor=c}c.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)}})(),e=We&&We.__assign||function(){return e=Object.assign||function(a){for(var c,f=1,d=arguments.length;f<d;f++){c=arguments[f];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(a[h]=c[h])}return a},e.apply(this,arguments)},r=We&&We.__awaiter||function(a,c,f,d){function h(y){return y instanceof f?y:new f(function(m){m(y)})}return new(f||(f=Promise))(function(y,m){function b(E){try{_(d.next(E))}catch(I){m(I)}}function w(E){try{_(d.throw(E))}catch(I){m(I)}}function _(E){E.done?y(E.value):h(E.value).then(b,w)}_((d=d.apply(a,c||[])).next())})},n=We&&We.__generator||function(a,c){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},d,h,y,m;return m={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function b(_){return function(E){return w([_,E])}}function w(_){if(d)throw new TypeError("Generator is already executing.");for(;m&&(m=0,_[0]&&(f=0)),f;)try{if(d=1,h&&(y=_[0]&2?h.return:_[0]?h.throw||((y=h.return)&&y.call(h),0):h.next)&&!(y=y.call(h,_[1])).done)return y;switch(h=0,y&&(_=[_[0]&2,y.value]),_[0]){case 0:case 1:y=_;break;case 4:return f.label++,{value:_[1],done:!1};case 5:f.label++,h=_[1],_=[0];continue;case 7:_=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(_[0]===6||_[0]===2)){f=0;continue}if(_[0]===3&&(!y||_[1]>y[0]&&_[1]<y[3])){f.label=_[1];break}if(_[0]===6&&f.label<y[1]){f.label=y[1],y=_;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(_);break}y[2]&&f.ops.pop(),f.trys.pop();continue}_=c.call(a,f)}catch(E){_=[6,E],h=0}finally{d=y=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}};Object.defineProperty(We,"__esModule",{value:!0}),We.WebRequest=We.genAdapter=void 0;var o=Uy,i=Bn(),s=Cy(),u=(function(a){t(c,a);function c(f){var d=a.call(this)||this,h=f.timeout,y=f.timeoutMsg,m=f.restrictedMethods;return d.timeout=h||0,d.timeoutMsg=y||"请求超时",d.restrictedMethods=m||["get","post","upload","download"],d}return c.prototype.get=function(f){return this.request(e(e({},f),{method:"get"}),this.restrictedMethods.includes("get"))},c.prototype.post=function(f){return this.request(e(e({},f),{method:"post"}),this.restrictedMethods.includes("post"))},c.prototype.put=function(f){return this.request(e(e({},f),{method:"put"}))},c.prototype.upload=function(f){var d=f.data,h=f.file,y=f.name,m=f.method,b=f.headers,w=b===void 0?{}:b,_={post:"post",put:"put"}[m?.toLowerCase()]||"put",E=new FormData;return _==="post"?(Object.keys(d).forEach(function(I){E.append(I,d[I])}),E.append("key",y),E.append("file",h),this.request(e(e({},f),{data:E,method:_}),this.restrictedMethods.includes("upload"))):this.request(e(e({},f),{method:"put",headers:w,body:h}),this.restrictedMethods.includes("upload"))},c.prototype.download=function(f){return r(this,void 0,void 0,function(){var d,h,y,m;return n(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.get(e(e({},f),{headers:{},responseType:"blob"}))];case 1:return d=b.sent().data,h=window.URL.createObjectURL(new Blob([d])),y=decodeURIComponent(new URL(f.url).pathname.split("/").pop()||""),m=document.createElement("a"),m.href=h,m.setAttribute("download",y),m.style.display="none",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(h),document.body.removeChild(m),[3,3];case 2:return b.sent(),[3,3];case 3:return[2,new Promise(function(w){w({statusCode:200,tempFilePath:f.url})})]}})})},c.prototype.fetch=function(f){var d;return r(this,void 0,void 0,function(){var h,y,m,b,w,_,E,I,R,x,P,D=this;return n(this,function(O){switch(O.label){case 0:return h=new AbortController,y=f.url,m=f.enableAbort,b=m===void 0?!1:m,w=f.stream,_=w===void 0?!1:w,E=f.signal,I=f.timeout,R=I??this.timeout,E&&(E.aborted&&h.abort(),E.addEventListener("abort",function(){return h.abort()})),x=null,b&&R&&(x=setTimeout(function(){console.warn(D.timeoutMsg),h.abort(new Error(D.timeoutMsg))},R)),[4,fetch(y,e(e({},f),{signal:h.signal})).then(function(C){return r(D,void 0,void 0,function(){var A,N,U;return n(this,function(q){switch(q.label){case 0:return clearTimeout(x),C.ok?(A=C,[3,3]):[3,1];case 1:return U=(N=Promise).reject,[4,C.json()];case 2:A=U.apply(N,[q.sent()]),q.label=3;case 3:return[2,A]}})})}).catch(function(C){return clearTimeout(x),Promise.reject(C)})];case 1:return P=O.sent(),[2,{data:_?P.body:!((d=P.headers.get("content-type"))===null||d===void 0)&&d.includes("application/json")?P.json():P.text(),statusCode:P.status,header:P.headers}]}})})},c.prototype.request=function(f,d){var h=this;d===void 0&&(d=!1);var y=String(f.method).toLowerCase()||"get";return new Promise(function(m){var b=f.url,w=f.headers,_=w===void 0?{}:w,E=f.data,I=f.responseType,R=f.withCredentials,x=f.body,P=f.onUploadProgress,D=(0,i.formatUrl)((0,s.getProtocol)(),b,y==="get"?E:{}),O=new XMLHttpRequest;O.open(y,D),I&&(O.responseType=I),Object.keys(_).forEach(function(N){O.setRequestHeader(N,_[N])});var C;P&&O.upload.addEventListener("progress",P),O.onreadystatechange=function(){var N={};if(O.readyState===4){var U=O.getAllResponseHeaders(),q=U.trim().split(/[\r\n]+/),W={};q.forEach(function(ae){var z=ae.split(": "),Q=z.shift().toLowerCase(),H=z.join(": ");W[Q]=H}),N.header=W,N.statusCode=O.status;try{N.data=I==="blob"?O.response:JSON.parse(O.responseText)}catch{N.data=I==="blob"?O.response:O.responseText}clearTimeout(C),m(N)}},d&&h.timeout&&(C=setTimeout(function(){console.warn(h.timeoutMsg),O.abort()},h.timeout));var A;(0,i.isFormData)(E)?A=E:_["content-type"]==="application/x-www-form-urlencoded"?A=(0,i.toQueryString)(E):x?A=x:A=E?JSON.stringify(E):void 0,R&&(O.withCredentials=!0),O.send(A)})},c})(o.AbstractSDKRequest);We.WebRequest=u;function l(){var a={type:"default",root:window,reqClass:u,wsClass:WebSocket,localStorage};return a}return We.genAdapter=l,We}var Of;function b_(){return Of||(Of=1,(function(t){var e=St&&St.__assign||function(){return e=Object.assign||function(c){for(var f,d=1,h=arguments.length;d<h;d++){f=arguments[d];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(c[y]=f[y])}return c},e.apply(this,arguments)},r=St&&St.__createBinding||(Object.create?(function(c,f,d,h){h===void 0&&(h=d);var y=Object.getOwnPropertyDescriptor(f,d);(!y||("get"in y?!f.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return f[d]}}),Object.defineProperty(c,h,y)}):(function(c,f,d,h){h===void 0&&(h=d),c[h]=f[d]})),n=St&&St.__setModuleDefault||(Object.create?(function(c,f){Object.defineProperty(c,"default",{enumerable:!0,value:f})}):function(c,f){c.default=f}),o=St&&St.__importStar||function(c){if(c&&c.__esModule)return c;var f={};if(c!=null)for(var d in c)d!=="default"&&Object.prototype.hasOwnProperty.call(c,d)&&r(f,c,d);return n(f,c),f};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var i=o(__()),s=Bn(),u;(function(c){c.WEB="web",c.WX_MP="wx_mp"})(u=t.RUNTIME||(t.RUNTIME={}));function l(c,f){for(var d=(0,s.isArray)(c)?c:[c],h=0,y=d;h<y.length;h++){var m=y[h],b=m.isMatch,w=m.genAdapter,_=m.runtime;if(b())return{adapter:e({isMatch:b},w(f)),runtime:_}}}t.useAdapters=l;function a(){return{adapter:i.genAdapter(),runtime:u.WEB}}t.useDefaultAdapter=a})(St)),St}var w_=b_(),xt=function(){return xt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},xt.apply(this,arguments)},ui=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},ci=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},qy=(function(){function t(e){var r,n;try{this.localStorage=e?.localStorage||(((n=(r=e?.adapter)===null||r===void 0?void 0:r.root)===null||n===void 0?void 0:n.globalThis)||globalThis).localStorage}catch{this.localStorage=e?.localStorage||{}}}return t.prototype.getItem=function(e){return ui(this,void 0,void 0,function(){return ci(this,function(r){return[2,this.localStorage.getItem(e)]})})},t.prototype.removeItem=function(e){return ui(this,void 0,void 0,function(){return ci(this,function(r){return this.localStorage.removeItem(e),[2]})})},t.prototype.setItem=function(e,r){return ui(this,void 0,void 0,function(){return ci(this,function(n){return this.localStorage.setItem(e,r),[2]})})},t.prototype.getItemSync=function(e){return this.localStorage.getItem(e)},t.prototype.setItemSync=function(e,r){this.localStorage.setItem(e,r)},t.prototype.removeItemSync=function(e){this.localStorage.removeItem(e)},t})(),E_=/^[^:]+:\/\/[^/]+(\/[^?#]+)/,Fy=function(t,e){var r,n,o,i=(r=e?.headers)===null||r===void 0?void 0:r["x-request-id"];return t||(t={}),(t?.code||!((n=t?.data)===null||n===void 0)&&n.error_code)&&(t={error:t.code||t.data.error,error_description:t.data.error_description||t.message||t.code||t.data.error_code,request_id:t.requestId,error_code:(o=t.data)===null||o===void 0?void 0:o.error_code}),t?.request_id||(t.request_id=t.request_id||i),t?.error?(t.error_uri=I_(e?.url),t):t?.data||{}};function S_(t){return function(e,r){return ui(this,void 0,void 0,function(){return ci(this,function(n){return[2,new Promise(function(o,i){var s=Object.assign({},r);s.body&&typeof s.body!="string"&&(s.body=JSON.stringify(s.body));var u=wx.request({url:e,data:s.body,timeout:t._timeout,method:s.method||"GET",header:s.headers,success:function(l){l=Fy(l,xt(xt({},r),{url:e})),l.error&&i(l),o(l)},fail:function(l){i({error:"unreachable",error_description:l.message})},complete:function(l){if(!(!l||!l.errMsg)&&!(!t._timeout||t._restrictedMethods.indexOf("request")===-1)){var a=l.errMsg;if(a==="request:fail timeout"){console.warn(t._timeoutMsg);try{u.abort()}catch{}}}}})})]})})}}function I_(t){return E_.test(t)?RegExp.$1:t}var O_=function(t,e){var r=xt({},t);try{if(!t?.storage&&e?.localStorage&&(r.storage=new qy({localStorage:e.localStorage,adapter:e})),!t.captchaOptions&&e?.captchaOptions&&(r.captchaOptions=e.captchaOptions),!t.baseRequest&&!t.request&&e?.reqClass){var n={timeout:1e4,restrictedMethods:["get","post","upload","download","request"]},o=new e.reqClass(n);r.baseRequest=function(i,s){var u,l,a,c,f;return ui(this,void 0,void 0,function(){var d,h,y,m;return ci(this,function(b){switch(b.label){case 0:if(d={},h=((u=s.method)===null||u===void 0?void 0:u.toLocaleLowerCase())||"post",y=(a=(l=o?.[h])===null||l===void 0?void 0:l.bind)===null||a===void 0?void 0:a.call(l,o),typeof y!="function")throw new Error("invalid 【".concat(h,"】 request method"));b.label=1;case 1:return b.trys.push([1,3,,4]),(!(!((c=s.headers)===null||c===void 0)&&c["content-type"])||!((f=s.headers)===null||f===void 0)&&f["content-type"].includes("application/json"))&&!["string","undefined"].includes(typeof s.body)&&(s.data=s.data||s.body,s.body=JSON.stringify(s.body)),[4,y(xt({url:i},s))];case 2:return d=b.sent(),d=Fy(d,xt(xt({},s),{url:i})),[3,4];case 3:throw m=b.sent(),d=m,m;case 4:if(d?.error)throw d;return[2,d]}})})}}}catch(i){console.error("user adapter generate fail:",i)}return r},A_=function(t,e){if(!er.isMatch()||t.storage&&t.baseRequest)return t;var r=xt({},t),n={};try{var o=er.genAdapter({}),i=o.localStorage,s=o.reqClass;if(i&&(n.storage=new qy({localStorage:i,adapter:e})),s){var u=new s({timeout:1e4,restrictedMethods:["get","post","upload","download","request"]});n.request=S_(u)}return r.captchaOptions&&(n.baseRequest=n.request,n.request=void 0),xt(xt({},r),n)}catch(l){console.error("adapter generate fail:",l)}return r},T_=function(t){return t.adapter&&t.adapter.type!=="default"?O_(t,t.adapter):A_(t,t.adapter)},Me=function(){return Me=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Me.apply(this,arguments)},fe=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},j=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},M=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},k=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R_="auth",ro={SIGN_OUT:"sign_out",SIGN_IN:"sign_in",CREDENTIALS_ERROR:"credentials_error"},no={LOGIN_STATE_CHANGED:"loginStateChanged"},io=new y_.CloudbaseEventEmitter,C_=function(t){io.fire(no.LOGIN_STATE_CHANGED,Me(Me({},t),{eventType:ro.CREDENTIALS_ERROR}))},x_=(function(){function t(e){var r=e.cache,n=e.oauthInstance;this.cache=r,this.oauthInstance=n,this.setUserInfo()}return t.prototype.checkLocalInfo=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return this.uid=this.getLocalUserInfo("uid"),this.gender=this.getLocalUserInfo("gender"),this.picture=this.getLocalUserInfo("picture"),this.email=this.getLocalUserInfo("email"),this.emailVerified=this.getLocalUserInfo("email_verified"),this.phoneNumber=this.getLocalUserInfo("phone_number"),this.username=this.getLocalUserInfo("username"),this.name=this.getLocalUserInfo("name"),this.birthdate=this.getLocalUserInfo("birthdate"),this.zoneinfo=this.getLocalUserInfo("zoneinfo"),this.locale=this.getLocalUserInfo("locale"),this.sub=this.getLocalUserInfo("sub"),this.createdFrom=this.getLocalUserInfo("created_from"),this.providers=this.getLocalUserInfo("providers"),[2]})})},t.prototype.checkLocalInfoAsync=function(){return M(this,void 0,void 0,function(){var e,r,n,o;return k(this,function(i){switch(i.label){case 0:return e=this,[4,this.getLocalUserInfoAsync("uid")];case 1:return e.uid=i.sent(),r=this,[4,this.getLocalUserInfoAsync("gender")];case 2:return r.gender=i.sent(),this.picture=this.getLocalUserInfo("picture"),n=this,[4,this.getLocalUserInfoAsync("email")];case 3:return n.email=i.sent(),this.emailVerified=this.getLocalUserInfo("email_verified"),this.phoneNumber=this.getLocalUserInfo("phone_number"),o=this,[4,this.getLocalUserInfoAsync("username")];case 4:return o.username=i.sent(),this.name=this.getLocalUserInfo("name"),this.birthdate=this.getLocalUserInfo("birthdate"),this.zoneinfo=this.getLocalUserInfo("zoneinfo"),this.locale=this.getLocalUserInfo("locale"),this.sub=this.getLocalUserInfo("sub"),this.createdFrom=this.getLocalUserInfo("created_from"),this.providers=this.getLocalUserInfo("providers"),[2]}})})},t.prototype.update=function(e){return M(this,void 0,void 0,function(){var r;return k(this,function(n){switch(n.label){case 0:return[4,this.oauthInstance.authApi.setUserProfile(Me({},e))];case 1:return r=n.sent(),this.setLocalUserInfo(r),[2]}})})},t.prototype.updateUserBasicInfo=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.updateUserBasicInfo(Me({},e))];case 1:return r.sent(),this.setLocalUserInfo({username:e.username}),[2]}})})},t.prototype.updatePassword=function(e,r){return this.oauthInstance.authApi.updatePasswordByOld({old_password:r,new_password:e})},t.prototype.updateUsername=function(e){return typeof e!="string"&&Rn.throwError(re.ERRORS.INVALID_PARAMS,"username must be a string"),this.update({username:e})},t.prototype.refresh=function(e){return M(this,void 0,void 0,function(){var r;return k(this,function(n){switch(n.label){case 0:return[4,this.oauthInstance.authApi.getUserInfo(e)];case 1:if(r=n.sent(),r.code==="INVALID_ACCESS_TOKEN")throw this.setLocalUserInfo({}),r;return this.setLocalUserInfo(r),[2,r]}})})},t.prototype.getLocalUserInfo=function(e){var r=this.cache.keys.userInfoKey,n=this.cache.getStore(r);return n[e]},t.prototype.getLocalUserInfoAsync=function(e){return M(this,void 0,void 0,function(){var r,n;return k(this,function(o){switch(o.label){case 0:return r=this.cache.keys.userInfoKey,[4,this.cache.getStoreAsync(r)];case 1:return n=o.sent(),[2,n[e]]}})})},t.prototype.setUserInfo=function(){var e=this,r=this.cache.keys.userInfoKey,n=this.cache.getStore(r);["uid","email","name","gender","picture","email_verified","phone_number","birthdate","zoneinfo","locale","sub","created_from","providers","username"].forEach(function(o){e[o]=n[o]})},t.prototype.setLocalUserInfo=function(e){var r=this.cache.keys.userInfoKey;this.cache.setStore(r,e),this.setUserInfo()},fe([le.catchErrorsDecorator({title:"更新用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.update() 的语法或参数是否正确","  2 - 用户信息中是否包含非法值","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"update",null),fe([le.catchErrorsDecorator({title:"更新密码失败",messages:["请确认以下各项：","  1 - 调用 User.updatePassword() 的语法或参数是否正确","  3 - 新密码中是否包含非法字符","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[String,String]),j("design:returntype",void 0)],t.prototype,"updatePassword",null),fe([le.catchErrorsDecorator({title:"更新用户名失败",messages:["请确认以下各项：","  1 - 调用 User.updateUsername() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",void 0)],t.prototype,"updateUsername",null),fe([le.catchErrorsDecorator({title:"刷新本地用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.refresh() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"refresh",null),t})(),Ta=(function(){function t(e){var r=e.envId,n=e.cache,o=e.oauthInstance;r||Rn.throwError(re.ERRORS.INVALID_PARAMS,"envId is not defined"),this.cache=n,this.oauthInstance=o,this.user=new x_({cache:this.cache,oauthInstance:o})}return t.prototype.checkLocalState=function(){var e;this.oauthLoginState=(e=this.oauthInstance)===null||e===void 0?void 0:e.authApi.hasLoginStateSync(),this.user.checkLocalInfo()},t.prototype.checkLocalStateAsync=function(){var e;return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,(e=this.oauthInstance)===null||e===void 0?void 0:e.authApi.getLoginState()];case 1:return r.sent(),[4,this.user.checkLocalInfoAsync()];case 2:return r.sent(),[2]}})})},t})(),N_=(function(){function t(e){this.config=e,this.cache=e.cache,this.oauthInstance=e.oauthInstance,this.setAccessKey()}return t.prototype.bindPhoneNumber=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.editContact(e)]})})},t.prototype.unbindProvider=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.unbindProvider(e)]})})},t.prototype.bindEmail=function(e){return this.oauthInstance.authApi.editContact(e)},t.prototype.verify=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.verify(e)]})})},t.prototype.getVerification=function(e,r){return M(this,void 0,void 0,function(){return k(this,function(n){return[2,this.oauthInstance.authApi.getVerification(e,r)]})})},Object.defineProperty(t.prototype,"currentUser",{get:function(){if(this.cache.mode==="async"){Rn.printWarn(re.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrentUser instead");return}var e=this.hasLoginState();return e&&e.user||null},enumerable:!1,configurable:!0}),t.prototype.getCurrentUser=function(){return M(this,void 0,void 0,function(){var e;return k(this,function(r){switch(r.label){case 0:return[4,this.getLoginState()];case 1:return e=r.sent(),e?[4,e.user.checkLocalInfoAsync()]:[3,3];case 2:return r.sent(),[2,e.user||null];case 3:return[2,null]}})})},t.prototype.signInAnonymously=function(e){return e===void 0&&(e={}),M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.signInAnonymously(e)];case 1:return r.sent(),[2,this.createLoginState()]}})})},t.prototype.signInAnonymouslyInWx=function(e){var r=e===void 0?{}:e,n=r.useWxCloud;return M(this,void 0,void 0,function(){var o,i,s=this;return k(this,function(u){switch(u.label){case 0:if(!er.isMatch())throw Error("wx api undefined");return o=wx.getAccountInfoSync().miniProgram,i=function(l){return M(s,void 0,void 0,function(){var a,c,f;return k(this,function(d){switch(d.label){case 0:a=void 0,c=void 0,d.label=1;case 1:return d.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:o?.appId,provider_code:l,provider_params:{provider_code_type:"open_id",appid:o?.appId}},n)];case 2:if(a=d.sent(),a?.error_code||!a.provider_token)throw a;return[4,this.oauthInstance.authApi.signInAnonymously({provider_token:a.provider_token},n)];case 3:if(c=d.sent(),c?.error_code)throw c;return[3,5];case 4:throw f=d.sent(),f;case 5:return[2]}})})},[4,new Promise(function(l,a){wx.login({success:function(c){return M(s,void 0,void 0,function(){var f;return k(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,i(c.code)];case 1:return d.sent(),l(!0),[3,3];case 2:return f=d.sent(),a(f),[3,3];case 3:return[2]}})})},fail:function(c){var f=new Error(c?.errMsg);f.code=c?.errno,a(f)}})})];case 1:return u.sent(),[2,this.createLoginState(void 0,{asyncRefreshUser:!0})]}})})},t.prototype.bindOpenId=function(){return M(this,void 0,void 0,function(){var e,r,n=this;return k(this,function(o){switch(o.label){case 0:if(!er.isMatch())throw Error("wx api undefined");return e=wx.getAccountInfoSync().miniProgram,r=function(i){return M(n,void 0,void 0,function(){var s,u;return k(this,function(l){switch(l.label){case 0:s=void 0,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:e?.appId,provider_code:i,provider_params:{provider_code_type:"open_id",appid:e?.appId}})];case 2:if(s=l.sent(),s?.error_code||!s.provider_token)throw s;return[4,this.oauthInstance.authApi.bindWithProvider({provider_token:s.provider_token})];case 3:return l.sent(),[3,5];case 4:throw u=l.sent(),u;case 5:return[2]}})})},[4,new Promise(function(i,s){wx.login({success:function(u){return M(n,void 0,void 0,function(){var l;return k(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,r(u.code)];case 1:return a.sent(),i(!0),[3,3];case 2:return l=a.sent(),s(l),[3,3];case 3:return[2]}})})},fail:function(u){var l=new Error(u?.errMsg);l.code=u?.errno,s(l)}})})];case 1:return o.sent(),[2]}})})},t.prototype.signInWithOpenId=function(e){var r=e===void 0?{}:e,n=r.useWxCloud,o=n===void 0?!0:n;return M(this,void 0,void 0,function(){var i,s,u=this;return k(this,function(l){switch(l.label){case 0:if(!er.isMatch())throw Error("wx api undefined");return i=wx.getAccountInfoSync().miniProgram,s=function(a){return M(u,void 0,void 0,function(){var c,f,d;return k(this,function(h){switch(h.label){case 0:c=void 0,f=void 0,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:i?.appId,provider_code:a,provider_params:{provider_code_type:"open_id",appid:i?.appId}},o)];case 2:if(c=h.sent(),c?.error_code||!c.provider_token)throw c;return[4,this.oauthInstance.authApi.signInWithProvider({provider_token:c.provider_token},o)];case 3:if(f=h.sent(),f?.error_code)throw f;return[3,5];case 4:throw d=h.sent(),d;case 5:return[4,this.oauthInstance.oauth2client.setCredentials(f)];case 6:return h.sent(),[2]}})})},[4,new Promise(function(a,c){wx.login({success:function(f){return M(u,void 0,void 0,function(){var d;return k(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,s(f.code)];case 1:return h.sent(),a(!0),[3,3];case 2:return d=h.sent(),c(d),[3,3];case 3:return[2]}})})},fail:function(f){var d=new Error(f?.errMsg);d.code=f?.errno,c(d)}})})];case 1:return l.sent(),[2,this.createLoginState()]}})})},t.prototype.signInWithUnionId=function(){return M(this,void 0,void 0,function(){var e,r=this;return k(this,function(n){switch(n.label){case 0:if(!er.isMatch())throw Error("wx api undefined");n.label=1;case 1:return n.trys.push([1,3,,4]),[4,new Promise(function(o,i){var s=wx.getAccountInfoSync().miniProgram;wx.login({success:function(u){return M(r,void 0,void 0,function(){var l,a,c,f,d;return k(this,function(h){switch(h.label){case 0:l=s?.appId,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_code:u.code,provider_id:l,provider_params:{provider_code_type:"union_id",appid:s?.appId}})];case 2:return a=h.sent(),c=a.provider_token,c?[4,this.oauthInstance.authApi.signInWithProvider({provider_id:l,provider_token:c})]:(i(a),[2]);case 3:return f=h.sent(),f?.error_code?(i(f),[2]):(o(!0),[3,5]);case 4:return d=h.sent(),i(d),[3,5];case 5:return[2]}})})},fail:function(u){var l=new Error(u?.errMsg);l.code=u?.errno,i(l)}})})];case 2:return n.sent(),[3,4];case 3:throw e=n.sent(),e;case 4:return[2,this.createLoginState()]}})})},t.prototype.signInWithPhoneAuth=function(e){var r=e.phoneCode,n=r===void 0?"":r;return M(this,void 0,void 0,function(){var o,i,s,u,l,a;return k(this,function(c){switch(c.label){case 0:if(!er.isMatch())throw Error("wx api undefined");return o=wx.getAccountInfoSync().miniProgram,i={provider_params:{provider_code_type:"phone"},provider_id:o.appId},[4,wx.login()];case 1:s=c.sent().code,i.provider_code=s,c.label=2;case 2:return c.trys.push([2,6,,7]),[4,this.oauthInstance.authApi.grantProviderToken(i)];case 3:if(u=c.sent(),u.error_code)throw u;return[4,this.oauthInstance.authApi.patchProviderToken({provider_token:u.provider_token,provider_id:o.appId,provider_params:{code:n,provider_code_type:"phone"}})];case 4:if(u=c.sent(),u.error_code)throw u;return[4,this.oauthInstance.authApi.signInWithProvider({provider_token:u.provider_token})];case 5:if(l=c.sent(),l?.error_code)throw l;return[3,7];case 6:throw a=c.sent(),a;case 7:return[2,this.createLoginState()]}})})},t.prototype.signInWithSms=function(e){var r=e.verificationInfo,n=r===void 0?{verification_id:"",is_user:!1}:r,o=e.verificationCode,i=o===void 0?"":o,s=e.phoneNum,u=s===void 0?"":s,l=e.bindInfo,a=l===void 0?void 0:l;return M(this,void 0,void 0,function(){return k(this,function(c){try{return[2,this.signInWithUsername({verificationInfo:n,verificationCode:i,bindInfo:a,username:u,loginType:"sms"})]}catch(f){throw f}return[2]})})},t.prototype.signInWithEmail=function(e){var r=e.verificationInfo,n=r===void 0?{verification_id:"",is_user:!1}:r,o=e.verificationCode,i=o===void 0?"":o,s=e.bindInfo,u=s===void 0?void 0:s,l=e.email,a=l===void 0?"":l;return M(this,void 0,void 0,function(){return k(this,function(c){try{return[2,this.signInWithUsername({verificationInfo:n,verificationCode:i,bindInfo:u,username:a,loginType:"email"})]}catch(f){throw f}return[2]})})},t.prototype.setCustomSignFunc=function(e){this.oauthInstance.authApi.setCustomSignFunc(e)},t.prototype.signInWithCustomTicket=function(){return M(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this.oauthInstance.authApi.signInWithCustomTicket()];case 1:return e.sent(),[2,this.createLoginState()]}})})},t.prototype.signIn=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.signIn(e)];case 1:return r.sent(),[2,this.createLoginState(e)]}})})},t.prototype.signUp=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.signUp(e)];case 1:return r.sent(),[2,this.createLoginState()]}})})},t.prototype.setPassword=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.setPassword(e)]})})},t.prototype.isUsernameRegistered=function(e){return M(this,void 0,void 0,function(){var r;return k(this,function(n){switch(n.label){case 0:return typeof e!="string"&&Rn.throwError(re.ERRORS.INVALID_PARAMS,"username must be a string"),[4,this.oauthInstance.authApi.checkIfUserExist({username:e})];case 1:return r=n.sent().exist,[2,r]}})})},t.prototype.signOut=function(e){return M(this,void 0,void 0,function(){var r,n;return k(this,function(o){switch(o.label){case 0:return r=this.cache.keys.userInfoKey,[4,this.oauthInstance.authApi.signOut(e)];case 1:return n=o.sent(),[4,this.cache.removeStoreAsync(r)];case 2:return o.sent(),io.fire(no.LOGIN_STATE_CHANGED,{eventType:ro.SIGN_OUT}),[2,n]}})})},t.prototype.hasLoginState=function(){var e;if(this.cache.mode==="async"){Rn.printWarn(re.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed");return}var r=(e=this.oauthInstance)===null||e===void 0?void 0:e.authApi.hasLoginStateSync();if(r){var n=new Ta({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance});return n}return null},t.prototype.getLoginState=function(){return M(this,void 0,void 0,function(){var e,r;return k(this,function(n){switch(n.label){case 0:e=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.oauthInstance.authApi.getLoginState()];case 2:return e=n.sent(),[3,4];case 3:return n.sent(),[2,null];case 4:return e?(r=new Ta({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance}),[2,r]):[2,null]}})})},t.prototype.getUserInfo=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.getUserInfo(e)]})})},t.prototype.getWedaUserInfo=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.getWedaUserInfo()]})})},t.prototype.updateUserBasicInfo=function(e){return M(this,void 0,void 0,function(){var r;return k(this,function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return r=n.sent(),r?[4,r.user.updateUserBasicInfo(e)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.getAuthHeader=function(){return console.error("Auth.getAuthHeader API 已废弃"),{}},t.prototype.bindWithProvider=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.bindWithProvider(e)]})})},t.prototype.queryUser=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.queryUserProfile(e)]})})},t.prototype.getAccessToken=function(){return M(this,void 0,void 0,function(){var e;return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.oauth2client.getAccessToken()];case 1:return e=r.sent(),[2,{accessToken:e,env:this.config.env}]}})})},t.prototype.grantProviderToken=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.grantProviderToken(e)]})})},t.prototype.patchProviderToken=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.patchProviderToken(e)]})})},t.prototype.signInWithProvider=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.signInWithProvider(e)];case 1:return r.sent(),[2,this.createLoginState(e)]}})})},t.prototype.signInWithWechat=function(e){return e===void 0&&(e={}),M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.signInWithWechat(e)];case 1:return r.sent(),[2,this.createLoginState(e)]}})})},t.prototype.grantToken=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.authApi.grantToken(e)];case 1:return r.sent(),[2,this.createLoginState()]}})})},t.prototype.genProviderRedirectUri=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.genProviderRedirectUri(e)]})})},t.prototype.resetPassword=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.resetPassword(e)]})})},t.prototype.deviceAuthorize=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.deviceAuthorize(e)]})})},t.prototype.sudo=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.sudo(e)]})})},t.prototype.deleteMe=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.deleteMe(e)]})})},t.prototype.getProviders=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.getProviders()]})})},t.prototype.loginScope=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.loginScope()]})})},t.prototype.loginGroups=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.loginGroups()]})})},t.prototype.onLoginStateChanged=function(e){return M(this,void 0,void 0,function(){var r,n=this;return k(this,function(o){switch(o.label){case 0:return io.on(no.LOGIN_STATE_CHANGED,function(i){return M(n,void 0,void 0,function(){var s,u,l;return k(this,function(a){switch(a.label){case 0:return((l=i?.data)===null||l===void 0?void 0:l.eventType)===ro.CREDENTIALS_ERROR?[3,2]:[4,this.getLoginState()];case 1:return u=a.sent(),[3,3];case 2:u={},a.label=3;case 3:return s=u,e.call(this,Me(Me({},i),s)),[2]}})})}),[4,this.getLoginState()];case 1:return r=o.sent(),e.call(this,r),[2]}})})},t.prototype.refreshTokenForce=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.refreshTokenForce(e)]})})},t.prototype.getCredentials=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.getCredentials()]})})},t.prototype.setCredentials=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){switch(r.label){case 0:return[4,this.oauthInstance.oauth2client.setCredentials(e)];case 1:return r.sent(),[2]}})})},t.prototype.getProviderSubType=function(){return M(this,void 0,void 0,function(){return k(this,function(e){return[2,this.oauthInstance.authApi.getProviderSubType()]})})},t.prototype.createCaptchaData=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.createCaptchaData(e)]})})},t.prototype.verifyCaptchaData=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.verifyCaptchaData(e)]})})},t.prototype.getMiniProgramQrCode=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.getMiniProgramCode(e)]})})},t.prototype.getMiniProgramQrCodeStatus=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.getMiniProgramQrCodeStatus(e)]})})},t.prototype.modifyPassword=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.modifyPassword(e)]})})},t.prototype.modifyPasswordWithoutLogin=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.modifyPasswordWithoutLogin(e)]})})},t.prototype.getUserBehaviorLog=function(e){return M(this,void 0,void 0,function(){return k(this,function(r){return[2,this.oauthInstance.authApi.getUserBehaviorLog(e)]})})},t.prototype.toDefaultLoginPage=function(e){return e===void 0&&(e={}),M(this,void 0,void 0,function(){var r,n,o,i,s;return k(this,function(u){return r=e.config_version||"env",n=Object.keys(e.query||{}).map(function(l){return"".concat(l,"=").concat(e.query[l])}).join("&"),er.isMatch()?wx.navigateTo({url:"/packages/$wd_system/pages/login/index".concat(n?"?".concat(n):"")}):(o=e.redirect_uri||window.location.href,i=new URL(o),s="".concat(i.origin,"/__auth/?app_id=").concat(e.app_id||"","&env_id=").concat(this.config.env,"&client_id=").concat(this.config.clientId||this.config.env,"&config_version=").concat(r,"&redirect_uri=").concat(encodeURIComponent(o)).concat(n?"&".concat(n):""),window.location.href=s),[2]})})},t.prototype.createLoginState=function(e,r){return M(this,void 0,void 0,function(){var n;return k(this,function(o){switch(o.label){case 0:return n=new Ta({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance}),[4,n.checkLocalStateAsync()];case 1:return o.sent(),r?.asyncRefreshUser?(n.user.refresh(e),[3,4]):[3,2];case 2:return[4,n.user.refresh(e)];case 3:o.sent(),o.label=4;case 4:return io.fire(no.LOGIN_STATE_CHANGED,{eventType:ro.SIGN_IN}),[2,n]}})})},t.prototype.signInWithUsername=function(e){var r=e.verificationInfo,n=r===void 0?{verification_id:"",is_user:!1}:r,o=e.verificationCode,i=o===void 0?"":o,s=e.username,u=s===void 0?"":s,l=e.bindInfo,a=l===void 0?void 0:l,c=e.loginType,f=c===void 0?"":c;return M(this,void 0,void 0,function(){var d,h,y,m,b,w,_,E;return k(this,function(I){switch(I.label){case 0:return I.trys.push([0,8,,9]),[4,this.oauthInstance.authApi.verify({verification_id:n.verification_id,verification_code:i})];case 1:if(d=I.sent(),d?.error_code)throw d;return h=d.verification_token,y="+86 ".concat(u),m={phone_number:y},f==="email"&&(y=u,m={email:y}),n.is_user?[4,this.oauthInstance.authApi.signIn({username:y,verification_token:h})]:[3,5];case 2:if(b=I.sent(),b?.error_code)throw b;return a?[4,this.oauthInstance.authApi.bindWithProvider({provider_token:a?.providerToken})]:[3,4];case 3:if(w=I.sent(),w?.error_code)throw w;I.label=4;case 4:return[3,7];case 5:return[4,this.oauthInstance.authApi.signUp(Me(Me({},m),{verification_token:h,provider_token:a?.providerId}))];case 6:if(_=I.sent(),_?.error_code)throw _;I.label=7;case 7:return[2,this.createLoginState()];case 8:throw E=I.sent(),E;case 9:return[2]}})})},t.prototype.setAccessKey=function(){return M(this,void 0,void 0,function(){return k(this,function(e){if(this.config.accessKey)try{this.oauthInstance.oauth2client.setAccessKeyCredentials({access_token:this.config.accessKey,token_type:"Bearer",scope:"accessKey",expires_at:new Date(+new Date+ +new Date),expires_in:+new Date+ +new Date})}catch(r){console.warn("accessKey error: ",r)}return[2]})})},fe([le.catchErrorsDecorator({title:"绑定手机号失败",messages:["请确认以下各项：","  1 - 调用 auth().bindPhoneNumber() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"bindPhoneNumber",null),fe([le.catchErrorsDecorator({title:"解除三方绑定失败",messages:["请确认以下各项：","  1 - 调用 auth().unbindProvider() 的语法或参数是否正确","  2 - 当前账户是否已经与此登录方式解绑","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"unbindProvider",null),fe([le.catchErrorsDecorator({title:"绑定邮箱地址失败",messages:["请确认以下各项：","  1 - 调用 auth().bindEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",void 0)],t.prototype,"bindEmail",null),fe([le.catchErrorsDecorator({title:"验证码验证失败",messages:["请确认以下各项：","  1 - 调用 auth().verify() 的语法或参数是否正确","  2 - 当前环境是否开通了手机验证码/邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"verify",null),fe([le.catchErrorsDecorator({title:"获取验证码失败",messages:["请确认以下各项：","  1 - 调用 auth().getVerification() 的语法或参数是否正确","  2 - 当前环境是否开通了手机验证码/邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object,Object]),j("design:returntype",Promise)],t.prototype,"getVerification",null),fe([le.catchErrorsDecorator({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 调用 auth().getCurrentUser() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getCurrentUser",null),fe([le.catchErrorsDecorator({title:"匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().signInAnonymously() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInAnonymously",null),fe([le.catchErrorsDecorator({title:"小程序匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().signInAnonymouslyInWx() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInAnonymouslyInWx",null),fe([le.catchErrorsDecorator({title:"小程序绑定OpenID失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了小程序openId静默登录","  2 - 调用 auth().bindOpenId() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"bindOpenId",null),fe([le.catchErrorsDecorator({title:"小程序openId静默登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了小程序openId静默登录","  2 - 调用 auth().signInWithOpenId() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInWithOpenId",null),fe([le.catchErrorsDecorator({title:"小程序unionId静默登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了小程序unionId静默登录","  2 - 调用 auth().signInWithUnionId() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"signInWithUnionId",null),fe([le.catchErrorsDecorator({title:"小程序手机号授权登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了小程序手机号授权登录","  2 - 调用 auth().signInWithPhoneAuth() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInWithPhoneAuth",null),fe([le.catchErrorsDecorator({title:"短信验证码登陆",messages:["请确认以下各项：","  1 - 当前环境是否开启了小程序短信验证码登陆","  2 - 调用 auth().signInWithSms() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInWithSms",null),fe([le.catchErrorsDecorator({title:"邮箱验证码登陆",messages:["请确认以下各项：","  1 - 当前环境是否开启了邮箱登陆","  2 - 调用 auth().signInWithEmail() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signInWithEmail",null),fe([le.catchErrorsDecorator({title:"自定义登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了自定义登录","  2 - 调用 auth().signInWithCustomTicket() 的语法或参数是否正确","  3 - ticket 是否归属于当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"signInWithCustomTicket",null),fe([le.catchErrorsDecorator({title:"注册失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了指定登录方式","  2 - 调用 auth().signUp() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signUp",null),fe([le.catchErrorsDecorator({title:"获取用户是否被占用失败",messages:["请确认以下各项：","  1 - 调用 auth().isUsernameRegistered() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",Promise)],t.prototype,"isUsernameRegistered",null),fe([le.catchErrorsDecorator({title:"用户登出失败",messages:["请确认以下各项：","  1 - 调用 auth().signOut() 的语法或参数是否正确","  2 - 当前用户是否为匿名登录（匿名登录不支持signOut）","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"signOut",null),fe([le.catchErrorsDecorator({title:"获取本地登录态失败",messages:["请确认以下各项：","  1 - 调用 auth().getLoginState() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getLoginState",null),fe([le.catchErrorsDecorator({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"getUserInfo",null),fe([le.catchErrorsDecorator({title:"获取微搭插件用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getWedaUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getWedaUserInfo",null),fe([le.catchErrorsDecorator({title:"绑定第三方登录方式失败",messages:["请确认以下各项：","  1 - 调用 auth().bindWithProvider() 的语法或参数是否正确","  2 - 此账户是否已经绑定此第三方","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"bindWithProvider",null),fe([le.catchErrorsDecorator({title:"获取身份源类型",messages:["请确认以下各项：","  1 - 调用 auth().getProviderSubType() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(re.COMMUNITY_SITE_URL)]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getProviderSubType",null),t})();function P_(t,e){var r=t.region,n=r===void 0?"ap-shanghai":r,o=t.i18n,i=t.accessKey,s=t.useWxCloud,u=e?.platform||w_.useDefaultAdapter(),l=u.runtime,a=u.adapter,c=e||{},f=c.env,d=c.clientId,h=c.debug,y=c.cache,m=c.app,b=(e||{}).apiOrigin;b||(b="https://".concat(f,".").concat(n,".tcb-api.tencentcloudapi.com"));var w={env:f,clientId:d,i18n:o,accessKey:i,useWxCloud:s},_=new d_(T_(Me(Me({},w),{apiOrigin:b,apiPath:t?.apiPath||Vo,storage:t?.storage,baseRequest:t?.baseRequest,request:t?.request,anonymousSignInFunc:t?.anonymousSignInFunc,captchaOptions:t?.captchaOptions,wxCloud:t?.wxCloud,adapter:a,onCredentialsError:C_,headers:t.headers||{}}))),E=new N_(Me(Me({},w),{region:n,persistence:t.persistence,debug:h,cache:y||new g_.CloudbaseCache({persistence:t.persistence,keys:{userInfoKey:"user_info_".concat(f)},platformInfo:u}),runtime:l||"web",_fromApp:m,oauthInstance:_}));return{authInstance:E,oauthInstance:_}}var By={name:R_,namespace:"auth",entity:function(t){if(t===void 0&&(t={region:"",persistence:"local",apiPath:Vo}),this.authInstance)return Rn.printWarn(re.ERRORS.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var e=this.platform.adapter,r=t.persistence||e.primaryStorage;r&&r!==this.config.persistence&&this.updateConfig({persistence:r});var n=P_(Me(Me({wxCloud:this.config.wxCloud,storage:this.config.storage},t),{persistence:this.config.persistence,i18n:this.config.i18n,accessKey:this.config.accessKey,useWxCloud:this.config.useWxCloud}),{env:this.config.env,clientId:this.config.clientId,apiOrigin:this.request.getBaseEndPoint(this.config.endPointMode||"CLOUD_API"),platform:this.platform,cache:this.cache,app:this,debug:this.config.debug}),o=n.authInstance,i=n.oauthInstance;return this.oauthInstance=i,this.authInstance=o,this.authInstance}};try{cloudbase.registerComponent(By)}catch{}function D_(t){try{t.registerComponent(By)}catch(e){console.warn(e)}}var Eo=function(){return Eo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Eo.apply(this,arguments)},jy=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},My=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Af=rt,wc="cloudrun",L_=(function(){function t(){}return t.prototype.callContainer=function(e,r){return jy(this,void 0,void 0,function(){var n,o,i;return My(this,function(s){switch(s.label){case 0:if(n=e.name,o=e.data,!n)throw new Error(JSON.stringify({code:Af.INVALID_PARAMS,msg:"[".concat(wc,".callContainer] invalid name")}));try{i=o?JSON.stringify(o):""}catch{throw new Error(JSON.stringify({code:Af.INVALID_PARAMS,msg:"[".concat(wc,".callContainer] invalid data")}))}return[4,ky.call(this,Eo(Eo({},e),{data:i}),r)];case 1:return[2,s.sent()]}})})},t})();function ky(t,e){return jy(this,void 0,void 0,function(){var r,n,o,i,s,u,l,a,c,f,d,h,y;return My(this,function(m){switch(m.label){case 0:return r=t.name,n=t.data,o=t.path,i=o===void 0?"":o,s=t.method,u=t.header,l=u===void 0?{}:u,a=this.getEndPointWithKey("GATEWAY"),c=a.BASE_URL,f=a.PROTOCOL,d="".concat(f).concat(c,"/cloudrun/").concat(r),h=i.startsWith("/")?i:"/".concat(i),[4,this.request.fetch({method:s||"POST",headers:Object.assign({},{"Content-Type":"application/json; charset=utf-8"},l),body:n,url:"".concat(d).concat(h),customReqOpts:e})];case 1:return y=m.sent(),e.from==="node-sdk"?[2,y]:[4,y.data];case 2:return[2,m.sent()]}})})}var U_=new L_,$y={name:wc,entity:{callContainer:U_.callContainer}};try{cloudbase.registerComponent($y)}catch{}function q_(t){try{t.registerComponent($y)}catch(e){console.warn(e)}}var kr=function(){return kr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},kr.apply(this,arguments)},F_=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Ra=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},B_=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},j_=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},M_=qo,Ca=rt,k_=Fo,Vn=gv,$_=Mo,oo="functions",W_=(function(){function t(){}return t.prototype.callFunction=function(e,r,n){var o,i,s;return B_(this,void 0,void 0,function(){var u,l,a,c,f,d,h,y,m,b,w,_,E,A,I,R,x,P,D,O,C,A,N;return j_(this,function(U){switch(U.label){case 0:if(u=e.name,l=e.data,a=e.query,c=e.parse,f=e.search,d=e.type,h=e.path,y=h===void 0?"":h,m=e.method,b=e.header,w=b===void 0?{}:b,!u)throw new Error(JSON.stringify({code:Ca.INVALID_PARAMS,msg:"[".concat(oo,".callFunction] invalid function name")}));try{_=l?JSON.stringify(l):""}catch{throw new Error(JSON.stringify({code:Ca.INVALID_PARAMS,msg:"[".concat(oo,".callFunction] invalid data")}))}return d!=="cloudrun"?[3,2]:(E=yv(),[4,ky.call(this,{name:u,data:_,path:y,method:m,header:kr(kr({},w),{"X-Request-Id":E})})]);case 1:return A=U.sent(),[2,{result:A,requestId:E}];case 2:I=this,R=I.request,x=I.config,P="functions.invokeFunction",D={inQuery:a,parse:c,search:f,function_name:u,request_data:_},O={},U.label=3;case 3:return U.trys.push([3,8,,9]),x.endPointMode!=="GATEWAY"?[3,5]:[4,R.gateWay(kr(kr({},e),{path:"functions"}),n)];case 4:return C=U.sent(),O=kr({requestId:C.requestId},!((o=C.data)===null||o===void 0)&&o.code?C.data:{data:{response_data:C.data}}),[3,7];case 5:return[4,R.send(P,D,{defaultQuery:!((i=l?.params)===null||i===void 0)&&i.action?{action:(s=l?.params)===null||s===void 0?void 0:s.action}:{}},n)];case 6:O=U.sent(),U.label=7;case 7:if(O.code)return[2,Vn(r,null,O)];if(A=O.data.response_data,c||x.endPointMode==="GATEWAY")return[2,Vn(r,null,{result:A,requestId:O.requestId})];try{return A=JSON.parse(O.data.response_data),[2,Vn(r,null,{result:A,requestId:O.requestId})]}catch{Vn(r,new Error("[".concat(M_(),"][").concat(Ca.INVALID_PARAMS,"][").concat(oo,".callFunction] response data must be json")))}return[3,9];case 8:return N=U.sent(),Vn(r,N),[3,9];case 9:return[2]}})})},F_([$_({customInfo:{},title:"函数调用失败",messages:["请确认以下各项：","  1 - 调用 callFunction() 的语法或参数是否正确","  2 - 当前环境下是否存在此函数","  3 - 函数安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(k_)]}),Ra("design:type",Function),Ra("design:paramtypes",[Object,Function,Object]),Ra("design:returntype",Promise)],t.prototype,"callFunction",null),t})(),G_=new W_,Wy={name:oo,entity:{callFunction:G_.callFunction}};try{cloudbase.registerComponent(Wy)}catch{}function H_(t){try{t.registerComponent(Wy)}catch(e){console.warn(e)}}var dr=function(){return dr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},dr.apply(this,arguments)},cn=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Re=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},ur=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},cr=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},jt;(function(t){t.put="put",t.post="post"})(jt||(jt={}));var V_=qo,it=rt,ln=Fo,xa=hv,Kn=pv,K_=Em,ft=gv,fn=Mo,Ke="storage";function Tf(t){var e=t.lastIndexOf("/");return e===-1?t:t.slice(e+1)}var J_=(function(){function t(){}return t.prototype.uploadFile=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u,l,a,c,f,d,h,y,m,b,w,_,E,I,R,x,P,D,O,C,A,N,U;return cr(this,function(q){switch(q.label){case 0:if(n=e.cloudPath,o=e.filePath,i=e.onUploadProgress,s=e.method,u=s===void 0?"put":s,l=e.headers,a=l===void 0?{}:l,c=e.fileContent,!Kn(n)||!o&&!c)throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".uploadFile] invalid params")}));return f={put:jt.put,post:jt.post}[u.toLocaleLowerCase()]||jt.put,d="storage.getUploadMetadata",h=this.request,y={path:n,method:f},f===jt.put&&(y.headers=a),[4,h.send(d,y,e.customReqOpts)];case 1:return m=q.sent(),b=m.data,w=b.url,_=b.authorization,E=b.token,I=b.fileId,R=b.cosFileId,x=b.download_url,P=m.requestId,D={url:w,file:o,name:n,onUploadProgress:i,fileContent:c,fileId:I,requestId:P},O=dr(dr({},D),{method:jt.put,headers:dr(dr({},a),{authorization:_,"x-cos-meta-fileid":R,"x-cos-security-token":E})}),C=dr(dr({},D),{method:jt.post,data:{key:n,signature:_,"x-cos-meta-fileid":R,success_action_status:"201","x-cos-security-token":E}}),A=(U={},U[jt.put]={params:O,isSuccess:function(W){return W>=200&&W<300}},U[jt.post]={params:C,isSuccess:function(W){return W===201}},U),[4,h.upload(A[f].params)];case 2:return N=q.sent(),A[f].isSuccess(N.statusCode)?[2,ft(r,null,{fileID:I,download_url:x,requestId:P})]:[2,ft(r,new Error("[".concat(V_(),"][").concat(it.OPERATION_FAIL,"][").concat(Ke,"]:").concat(N.data)))]}})})},t.prototype.getUploadMetadata=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u;return cr(this,function(l){switch(l.label){case 0:if(n=e.cloudPath,!Kn(n))throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".getUploadMetadata] invalid cloudPath")}));o=this.request,i="storage.getUploadMetadata",l.label=1;case 1:return l.trys.push([1,3,,4]),[4,o.send(i,{path:n},e.customReqOpts)];case 2:return s=l.sent(),[2,ft(r,null,s)];case 3:return u=l.sent(),[2,ft(r,u)];case 4:return[2]}})})},t.prototype.deleteFile=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u,l,a,c;return cr(this,function(f){switch(f.label){case 0:if(n=e.fileList,!n||!xa(n)||n.length===0)throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".deleteFile] fileList must not be empty")}));for(o=0,i=n;o<i.length;o++)if(s=i[o],!s||!Kn(s))throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".deleteFile] fileID must be string")}));return u="storage.batchDeleteFile",l=this.request,[4,l.send(u,{fileid_list:n},e.customReqOpts)];case 1:return a=f.sent(),a.code?[2,ft(r,null,a)]:(c={fileList:a.data.delete_list,requestId:a.requestId},[2,ft(r,null,c)])}})})},t.prototype.getTempFileURL=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u,l,a,c;return cr(this,function(f){switch(f.label){case 0:if(n=e.fileList,!n||!xa(n)||n.length===0)throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".getTempFileURL] fileList must not be empty")}));for(o=[],i=0,s=n;i<s.length;i++)if(u=s[i],K_(u)){if(!Object.prototype.hasOwnProperty.call(u,"fileID")||!Object.prototype.hasOwnProperty.call(u,"maxAge"))throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".getTempFileURL] file info must include fileID and maxAge")}));o.push({fileid:u.fileID,max_age:u.maxAge})}else if(Kn(u))o.push({fileid:u});else throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".getTempFileURL] invalid fileList")}));return l="storage.batchGetDownloadUrl",a=this.request,[4,a.send(l,{file_list:o},e.customReqOpts)];case 1:return c=f.sent(),c.code?[2,ft(r,null,c)]:[2,ft(r,null,{fileList:c.data.download_list,requestId:c.requestId})]}})})},t.prototype.downloadFile=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u,l;return cr(this,function(a){switch(a.label){case 0:if(n=e.fileID,!Kn(n))throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".getTempFileURL] fileID must be string")}));return[4,this.getTempFileURL.call(this,{fileList:[{fileID:n,maxAge:600}],customReqOpts:e.customReqOpts})];case 1:return o=a.sent(),i=o.fileList[0],i.code!=="SUCCESS"?[2,ft(r,i)]:(s=this.request,u=encodeURI(i.download_url),[4,s.download({url:u,tempFilePath:e.tempFilePath})]);case 2:return l=a.sent(),[2,ft(r,null,l)]}})})},t.prototype.copyFile=function(e,r){return ur(this,void 0,void 0,function(){var n,o,i,s,u,l,a,c,f,d;return cr(this,function(h){switch(h.label){case 0:if(n=e.fileList,!n||!xa(n)||n.length===0)throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".copyFile] fileList must not be empty")}));for(o=[],i=0,s=n;i<s.length;i++){if(u=s[i],l=u.srcPath,a=u.dstPath,!l||!a||typeof l!="string"||typeof a!="string")throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".copyFile] srcPath and dstPath may not be empty")}));if(l===a)throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".copyFile] srcPath and dstPath can not be the same")}));if(Tf(l)!==Tf(a))throw new Error(JSON.stringify({code:it.INVALID_PARAMS,msg:"[".concat(Ke,".copyFile] srcPath and dstPath file name must be the same")}));o.push({src_path:l,dst_path:a,overwrite:u.overwrite,remove_original:u.removeOriginal})}return c="storage.batchCopyFile",f=this.request,[4,f.send(c,{file_list:o},e.customReqOpts)];case 1:return d=h.sent(),d.code?[2,ft(r,null,d)]:[2,ft(r,null,{fileList:d.data.copy_list,requestId:d.requestId})]}})})},t.prototype.getFileInfo=function(e){var r;return ur(this,void 0,void 0,function(){var n,o,i=this;return cr(this,function(s){switch(s.label){case 0:return[4,this.getTempFileURL(e)];case 1:return n=s.sent(),n?.fileList&&((r=n?.fileList)===null||r===void 0?void 0:r.length)>0?[4,Promise.all(n.fileList.map(function(u){return ur(i,void 0,void 0,function(){var l,a,c,f,d;return cr(this,function(h){switch(h.label){case 0:if(u.code!=="SUCCESS")return[2,{code:u.code,fileID:u.fileID,tempFileURL:u.tempFileURL}];h.label=1;case 1:return h.trys.push([1,3,,4]),l=this.request,[4,l.fetch({url:u.tempFileURL,method:"HEAD"})];case 2:return a=h.sent(),c=parseInt(a.headers["content-length"])||0,f=a.headers["content-type"]||"",d={code:u.code,fileID:u.fileID,tempFileURL:u.tempFileURL,cloudId:u.fileID,fileName:u.fileID.split("/").pop(),contentType:f,mime:f.split(";")[0].trim(),size:c},[2,d];case 3:return h.sent(),[2,{code:"FETCH_FILE_INFO_ERROR",fileID:u.fileID,tempFileURL:u.tempFileURL}];case 4:return[2]}})})}))]:[3,3];case 2:return o=s.sent(),[2,{fileList:o,requestId:n.requestId}];case 3:return[2,{fileList:[],requestId:n.requestId}]}})})},cn([fn({customInfo:{},title:"上传文件失败",messages:["请确认以下各项：","  1 - 调用 uploadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"uploadFile",null),cn([fn({customInfo:{},title:"获取上传元信息失败",messages:["请确认以下各项：","  1 - 调用 getUploadMetadata() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"getUploadMetadata",null),cn([fn({customInfo:{},title:"删除文件失败",messages:["请确认以下各项：","  1 - 调用 deleteFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"deleteFile",null),cn([fn({customInfo:{},title:"获取文件下载链接",messages:["请确认以下各项：","  1 - 调用 getTempFileURL() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"getTempFileURL",null),cn([fn({customInfo:{},title:"下载文件失败",messages:["请确认以下各项：","  1 - 调用 downloadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"downloadFile",null),cn([fn({customInfo:{},title:"批量复制文件",messages:["请确认以下各项：","  1 - 调用 copyFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(ln)]}),Re("design:type",Function),Re("design:paramtypes",[Object,Function]),Re("design:returntype",Promise)],t.prototype,"copyFile",null),t})(),Dr=new J_,Gy={name:Ke,entity:{uploadFile:Dr.uploadFile,deleteFile:Dr.deleteFile,getTempFileURL:Dr.getTempFileURL,downloadFile:Dr.downloadFile,getUploadMetadata:Dr.getUploadMetadata,copyFile:Dr.copyFile,getFileInfo:Dr.getFileInfo}};try{cloudbase.registerComponent(Gy)}catch{}function z_(t){try{t.registerComponent(Gy)}catch(e){console.warn(e)}}var Na,Rf;function Hy(){if(Rf)return Na;Rf=1;var t=typeof vn=="object"&&vn&&vn.Object===Object&&vn;return Na=t,Na}var Pa,Cf;function Kt(){if(Cf)return Pa;Cf=1;var t=Hy(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Pa=r,Pa}var Da,xf;function Ko(){if(xf)return Da;xf=1;var t=Kt(),e=t.Symbol;return Da=e,Da}var La,Nf;function Y_(){if(Nf)return La;Nf=1;var t=Ko(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,o=t?t.toStringTag:void 0;function i(s){var u=r.call(s,o),l=s[o];try{s[o]=void 0;var a=!0}catch{}var c=n.call(s);return a&&(u?s[o]=l:delete s[o]),c}return La=i,La}var Ua,Pf;function Q_(){if(Pf)return Ua;Pf=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Ua=r,Ua}var qa,Df;function Ri(){if(Df)return qa;Df=1;var t=Ko(),e=Y_(),r=Q_(),n="[object Null]",o="[object Undefined]",i=t?t.toStringTag:void 0;function s(u){return u==null?u===void 0?o:n:i&&i in Object(u)?e(u):r(u)}return qa=s,qa}var Fa,Lf;function jn(){if(Lf)return Fa;Lf=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Fa=t,Fa}var Ba,Uf;function Vy(){if(Uf)return Ba;Uf=1;var t=Ri(),e=jn(),r="[object AsyncFunction]",n="[object Function]",o="[object GeneratorFunction]",i="[object Proxy]";function s(u){if(!e(u))return!1;var l=t(u);return l==n||l==o||l==r||l==i}return Ba=s,Ba}var ja,qf;function X_(){if(qf)return ja;qf=1;var t=Kt(),e=t["__core-js_shared__"];return ja=e,ja}var Ma,Ff;function Z_(){if(Ff)return Ma;Ff=1;var t=X_(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return Ma=r,Ma}var ka,Bf;function Ky(){if(Bf)return ka;Bf=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return ka=r,ka}var $a,jf;function eb(){if(jf)return $a;jf=1;var t=Vy(),e=Z_(),r=jn(),n=Ky(),o=/[\\^$.*+?()[\]{}|]/g,i=/^\[object .+?Constructor\]$/,s=Function.prototype,u=Object.prototype,l=s.toString,a=u.hasOwnProperty,c=RegExp("^"+l.call(a).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(d){if(!r(d)||e(d))return!1;var h=t(d)?c:i;return h.test(n(d))}return $a=f,$a}var Wa,Mf;function tb(){if(Mf)return Wa;Mf=1;function t(e,r){return e?.[r]}return Wa=t,Wa}var Ga,kf;function an(){if(kf)return Ga;kf=1;var t=eb(),e=tb();function r(n,o){var i=e(n,o);return t(i)?i:void 0}return Ga=r,Ga}var Ha,$f;function rb(){if($f)return Ha;$f=1;var t=an(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return Ha=e,Ha}var Va,Wf;function Jy(){if(Wf)return Va;Wf=1;var t=rb();function e(r,n,o){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:o,writable:!0}):r[n]=o}return Va=e,Va}var Ka,Gf;function zy(){if(Gf)return Ka;Gf=1;function t(e,r){return e===r||e!==e&&r!==r}return Ka=t,Ka}var Ja,Hf;function al(){if(Hf)return Ja;Hf=1;var t=Jy(),e=zy(),r=Object.prototype,n=r.hasOwnProperty;function o(i,s,u){var l=i[s];(!(n.call(i,s)&&e(l,u))||u===void 0&&!(s in i))&&t(i,s,u)}return Ja=o,Ja}var za,Vf;function Mn(){if(Vf)return za;Vf=1;var t=Array.isArray;return za=t,za}var Ya,Kf;function kn(){if(Kf)return Ya;Kf=1;function t(e){return e!=null&&typeof e=="object"}return Ya=t,Ya}var Qa,Jf;function sl(){if(Jf)return Qa;Jf=1;var t=Ri(),e=kn(),r="[object Symbol]";function n(o){return typeof o=="symbol"||e(o)&&t(o)==r}return Qa=n,Qa}var Xa,zf;function nb(){if(zf)return Xa;zf=1;var t=Mn(),e=sl(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function o(i,s){if(t(i))return!1;var u=typeof i;return u=="number"||u=="symbol"||u=="boolean"||i==null||e(i)?!0:n.test(i)||!r.test(i)||s!=null&&i in Object(s)}return Xa=o,Xa}var Za,Yf;function Jo(){if(Yf)return Za;Yf=1;var t=an(),e=t(Object,"create");return Za=e,Za}var es,Qf;function ib(){if(Qf)return es;Qf=1;var t=Jo();function e(){this.__data__=t?t(null):{},this.size=0}return es=e,es}var ts,Xf;function ob(){if(Xf)return ts;Xf=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return ts=t,ts}var rs,Zf;function ab(){if(Zf)return rs;Zf=1;var t=Jo(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function o(i){var s=this.__data__;if(t){var u=s[i];return u===e?void 0:u}return n.call(s,i)?s[i]:void 0}return rs=o,rs}var ns,ed;function sb(){if(ed)return ns;ed=1;var t=Jo(),e=Object.prototype,r=e.hasOwnProperty;function n(o){var i=this.__data__;return t?i[o]!==void 0:r.call(i,o)}return ns=n,ns}var is,td;function ub(){if(td)return is;td=1;var t=Jo(),e="__lodash_hash_undefined__";function r(n,o){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=t&&o===void 0?e:o,this}return is=r,is}var os,rd;function cb(){if(rd)return os;rd=1;var t=ib(),e=ob(),r=ab(),n=sb(),o=ub();function i(s){var u=-1,l=s==null?0:s.length;for(this.clear();++u<l;){var a=s[u];this.set(a[0],a[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=r,i.prototype.has=n,i.prototype.set=o,os=i,os}var as,nd;function lb(){if(nd)return as;nd=1;function t(){this.__data__=[],this.size=0}return as=t,as}var ss,id;function zo(){if(id)return ss;id=1;var t=zy();function e(r,n){for(var o=r.length;o--;)if(t(r[o][0],n))return o;return-1}return ss=e,ss}var us,od;function fb(){if(od)return us;od=1;var t=zo(),e=Array.prototype,r=e.splice;function n(o){var i=this.__data__,s=t(i,o);if(s<0)return!1;var u=i.length-1;return s==u?i.pop():r.call(i,s,1),--this.size,!0}return us=n,us}var cs,ad;function db(){if(ad)return cs;ad=1;var t=zo();function e(r){var n=this.__data__,o=t(n,r);return o<0?void 0:n[o][1]}return cs=e,cs}var ls,sd;function hb(){if(sd)return ls;sd=1;var t=zo();function e(r){return t(this.__data__,r)>-1}return ls=e,ls}var fs,ud;function pb(){if(ud)return fs;ud=1;var t=zo();function e(r,n){var o=this.__data__,i=t(o,r);return i<0?(++this.size,o.push([r,n])):o[i][1]=n,this}return fs=e,fs}var ds,cd;function Yo(){if(cd)return ds;cd=1;var t=lb(),e=fb(),r=db(),n=hb(),o=pb();function i(s){var u=-1,l=s==null?0:s.length;for(this.clear();++u<l;){var a=s[u];this.set(a[0],a[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=r,i.prototype.has=n,i.prototype.set=o,ds=i,ds}var hs,ld;function ul(){if(ld)return hs;ld=1;var t=an(),e=Kt(),r=t(e,"Map");return hs=r,hs}var ps,fd;function vb(){if(fd)return ps;fd=1;var t=cb(),e=Yo(),r=ul();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return ps=n,ps}var vs,dd;function yb(){if(dd)return vs;dd=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return vs=t,vs}var ys,hd;function Qo(){if(hd)return ys;hd=1;var t=yb();function e(r,n){var o=r.__data__;return t(n)?o[typeof n=="string"?"string":"hash"]:o.map}return ys=e,ys}var ms,pd;function mb(){if(pd)return ms;pd=1;var t=Qo();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return ms=e,ms}var gs,vd;function gb(){if(vd)return gs;vd=1;var t=Qo();function e(r){return t(this,r).get(r)}return gs=e,gs}var _s,yd;function _b(){if(yd)return _s;yd=1;var t=Qo();function e(r){return t(this,r).has(r)}return _s=e,_s}var bs,md;function bb(){if(md)return bs;md=1;var t=Qo();function e(r,n){var o=t(this,r),i=o.size;return o.set(r,n),this.size+=o.size==i?0:1,this}return bs=e,bs}var ws,gd;function Yy(){if(gd)return ws;gd=1;var t=vb(),e=mb(),r=gb(),n=_b(),o=bb();function i(s){var u=-1,l=s==null?0:s.length;for(this.clear();++u<l;){var a=s[u];this.set(a[0],a[1])}}return i.prototype.clear=t,i.prototype.delete=e,i.prototype.get=r,i.prototype.has=n,i.prototype.set=o,ws=i,ws}var Es,_d;function wb(){if(_d)return Es;_d=1;var t=Yy(),e="Expected a function";function r(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new TypeError(e);var i=function(){var s=arguments,u=o?o.apply(this,s):s[0],l=i.cache;if(l.has(u))return l.get(u);var a=n.apply(this,s);return i.cache=l.set(u,a)||l,a};return i.cache=new(r.Cache||t),i}return r.Cache=t,Es=r,Es}var Ss,bd;function Eb(){if(bd)return Ss;bd=1;var t=wb(),e=500;function r(n){var o=t(n,function(s){return i.size===e&&i.clear(),s}),i=o.cache;return o}return Ss=r,Ss}var Is,wd;function Sb(){if(wd)return Is;wd=1;var t=Eb(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(o){var i=[];return o.charCodeAt(0)===46&&i.push(""),o.replace(e,function(s,u,l,a){i.push(l?a.replace(r,"$1"):u||s)}),i});return Is=n,Is}var Os,Ed;function Ib(){if(Ed)return Os;Ed=1;function t(e,r){for(var n=-1,o=e==null?0:e.length,i=Array(o);++n<o;)i[n]=r(e[n],n,e);return i}return Os=t,Os}var As,Sd;function Ob(){if(Sd)return As;Sd=1;var t=Ko(),e=Ib(),r=Mn(),n=sl(),o=t?t.prototype:void 0,i=o?o.toString:void 0;function s(u){if(typeof u=="string")return u;if(r(u))return e(u,s)+"";if(n(u))return i?i.call(u):"";var l=u+"";return l=="0"&&1/u==-1/0?"-0":l}return As=s,As}var Ts,Id;function Ab(){if(Id)return Ts;Id=1;var t=Ob();function e(r){return r==null?"":t(r)}return Ts=e,Ts}var Rs,Od;function cl(){if(Od)return Rs;Od=1;var t=Mn(),e=nb(),r=Sb(),n=Ab();function o(i,s){return t(i)?i:e(i,s)?[i]:r(n(i))}return Rs=o,Rs}var Cs,Ad;function Qy(){if(Ad)return Cs;Ad=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,o){var i=typeof n;return o=o??t,!!o&&(i=="number"||i!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<o}return Cs=r,Cs}var xs,Td;function ll(){if(Td)return xs;Td=1;var t=sl();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return xs=e,xs}var Ns,Rd;function Tb(){if(Rd)return Ns;Rd=1;var t=al(),e=cl(),r=Qy(),n=jn(),o=ll();function i(s,u,l,a){if(!n(s))return s;u=e(u,s);for(var c=-1,f=u.length,d=f-1,h=s;h!=null&&++c<f;){var y=o(u[c]),m=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=d){var b=h[y];m=a?a(b,y,h):void 0,m===void 0&&(m=n(b)?b:r(u[c+1])?[]:{})}t(h,y,m),h=h[y]}return s}return Ns=i,Ns}var Ps,Cd;function Rb(){if(Cd)return Ps;Cd=1;var t=Tb();function e(r,n,o){return r==null?r:t(r,n,o)}return Ps=e,Ps}var Cb=Rb();const xb=Lc(Cb);var Ds,xd;function Nb(){if(xd)return Ds;xd=1;function t(e){var r=e==null?0:e.length;return r?e[r-1]:void 0}return Ds=t,Ds}var Ls,Nd;function Pb(){if(Nd)return Ls;Nd=1;var t=cl(),e=ll();function r(n,o){o=t(o,n);for(var i=0,s=o.length;n!=null&&i<s;)n=n[e(o[i++])];return i&&i==s?n:void 0}return Ls=r,Ls}var Us,Pd;function Db(){if(Pd)return Us;Pd=1;function t(e,r,n){var o=-1,i=e.length;r<0&&(r=-r>i?0:i+r),n=n>i?i:n,n<0&&(n+=i),i=r>n?0:n-r>>>0,r>>>=0;for(var s=Array(i);++o<i;)s[o]=e[o+r];return s}return Us=t,Us}var qs,Dd;function Lb(){if(Dd)return qs;Dd=1;var t=Pb(),e=Db();function r(n,o){return o.length<2?n:t(n,e(o,0,-1))}return qs=r,qs}var Fs,Ld;function Ub(){if(Ld)return Fs;Ld=1;var t=cl(),e=Nb(),r=Lb(),n=ll();function o(i,s){return s=t(s,i),i=r(i,s),i==null||delete i[n(e(s))]}return Fs=o,Fs}var Bs,Ud;function qb(){if(Ud)return Bs;Ud=1;var t=Ub();function e(r,n){return r==null?!0:t(r,n)}return Bs=e,Bs}var Fb=qb();const Bb=Lc(Fb);var js,qd;function jb(){if(qd)return js;qd=1;var t=Yo();function e(){this.__data__=new t,this.size=0}return js=e,js}var Ms,Fd;function Mb(){if(Fd)return Ms;Fd=1;function t(e){var r=this.__data__,n=r.delete(e);return this.size=r.size,n}return Ms=t,Ms}var ks,Bd;function kb(){if(Bd)return ks;Bd=1;function t(e){return this.__data__.get(e)}return ks=t,ks}var $s,jd;function $b(){if(jd)return $s;jd=1;function t(e){return this.__data__.has(e)}return $s=t,$s}var Ws,Md;function Wb(){if(Md)return Ws;Md=1;var t=Yo(),e=ul(),r=Yy(),n=200;function o(i,s){var u=this.__data__;if(u instanceof t){var l=u.__data__;if(!e||l.length<n-1)return l.push([i,s]),this.size=++u.size,this;u=this.__data__=new r(l)}return u.set(i,s),this.size=u.size,this}return Ws=o,Ws}var Gs,kd;function Gb(){if(kd)return Gs;kd=1;var t=Yo(),e=jb(),r=Mb(),n=kb(),o=$b(),i=Wb();function s(u){var l=this.__data__=new t(u);this.size=l.size}return s.prototype.clear=e,s.prototype.delete=r,s.prototype.get=n,s.prototype.has=o,s.prototype.set=i,Gs=s,Gs}var Hs,$d;function Hb(){if($d)return Hs;$d=1;function t(e,r){for(var n=-1,o=e==null?0:e.length;++n<o&&r(e[n],n,e)!==!1;);return e}return Hs=t,Hs}var Vs,Wd;function Xo(){if(Wd)return Vs;Wd=1;var t=al(),e=Jy();function r(n,o,i,s){var u=!i;i||(i={});for(var l=-1,a=o.length;++l<a;){var c=o[l],f=s?s(i[c],n[c],c,i,n):void 0;f===void 0&&(f=n[c]),u?e(i,c,f):t(i,c,f)}return i}return Vs=r,Vs}var Ks,Gd;function Vb(){if(Gd)return Ks;Gd=1;function t(e,r){for(var n=-1,o=Array(e);++n<e;)o[n]=r(n);return o}return Ks=t,Ks}var Js,Hd;function Kb(){if(Hd)return Js;Hd=1;var t=Ri(),e=kn(),r="[object Arguments]";function n(o){return e(o)&&t(o)==r}return Js=n,Js}var zs,Vd;function Jb(){if(Vd)return zs;Vd=1;var t=Kb(),e=kn(),r=Object.prototype,n=r.hasOwnProperty,o=r.propertyIsEnumerable,i=t((function(){return arguments})())?t:function(s){return e(s)&&n.call(s,"callee")&&!o.call(s,"callee")};return zs=i,zs}var ii={exports:{}},Ys,Kd;function zb(){if(Kd)return Ys;Kd=1;function t(){return!1}return Ys=t,Ys}ii.exports;var Jd;function Xy(){return Jd||(Jd=1,(function(t,e){var r=Kt(),n=zb(),o=e&&!e.nodeType&&e,i=o&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===o,u=s?r.Buffer:void 0,l=u?u.isBuffer:void 0,a=l||n;t.exports=a})(ii,ii.exports)),ii.exports}var Qs,zd;function Zy(){if(zd)return Qs;zd=1;var t=9007199254740991;function e(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=t}return Qs=e,Qs}var Xs,Yd;function Yb(){if(Yd)return Xs;Yd=1;var t=Ri(),e=Zy(),r=kn(),n="[object Arguments]",o="[object Array]",i="[object Boolean]",s="[object Date]",u="[object Error]",l="[object Function]",a="[object Map]",c="[object Number]",f="[object Object]",d="[object RegExp]",h="[object Set]",y="[object String]",m="[object WeakMap]",b="[object ArrayBuffer]",w="[object DataView]",_="[object Float32Array]",E="[object Float64Array]",I="[object Int8Array]",R="[object Int16Array]",x="[object Int32Array]",P="[object Uint8Array]",D="[object Uint8ClampedArray]",O="[object Uint16Array]",C="[object Uint32Array]",A={};A[_]=A[E]=A[I]=A[R]=A[x]=A[P]=A[D]=A[O]=A[C]=!0,A[n]=A[o]=A[b]=A[i]=A[w]=A[s]=A[u]=A[l]=A[a]=A[c]=A[f]=A[d]=A[h]=A[y]=A[m]=!1;function N(U){return r(U)&&e(U.length)&&!!A[t(U)]}return Xs=N,Xs}var Zs,Qd;function fl(){if(Qd)return Zs;Qd=1;function t(e){return function(r){return e(r)}}return Zs=t,Zs}var oi={exports:{}};oi.exports;var Xd;function dl(){return Xd||(Xd=1,(function(t,e){var r=Hy(),n=e&&!e.nodeType&&e,o=n&&!0&&t&&!t.nodeType&&t,i=o&&o.exports===n,s=i&&r.process,u=(function(){try{var l=o&&o.require&&o.require("util").types;return l||s&&s.binding&&s.binding("util")}catch{}})();t.exports=u})(oi,oi.exports)),oi.exports}var eu,Zd;function Qb(){if(Zd)return eu;Zd=1;var t=Yb(),e=fl(),r=dl(),n=r&&r.isTypedArray,o=n?e(n):t;return eu=o,eu}var tu,eh;function e0(){if(eh)return tu;eh=1;var t=Vb(),e=Jb(),r=Mn(),n=Xy(),o=Qy(),i=Qb(),s=Object.prototype,u=s.hasOwnProperty;function l(a,c){var f=r(a),d=!f&&e(a),h=!f&&!d&&n(a),y=!f&&!d&&!h&&i(a),m=f||d||h||y,b=m?t(a.length,String):[],w=b.length;for(var _ in a)(c||u.call(a,_))&&!(m&&(_=="length"||h&&(_=="offset"||_=="parent")||y&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||o(_,w)))&&b.push(_);return b}return tu=l,tu}var ru,th;function hl(){if(th)return ru;th=1;var t=Object.prototype;function e(r){var n=r&&r.constructor,o=typeof n=="function"&&n.prototype||t;return r===o}return ru=e,ru}var nu,rh;function t0(){if(rh)return nu;rh=1;function t(e,r){return function(n){return e(r(n))}}return nu=t,nu}var iu,nh;function Xb(){if(nh)return iu;nh=1;var t=t0(),e=t(Object.keys,Object);return iu=e,iu}var ou,ih;function Zb(){if(ih)return ou;ih=1;var t=hl(),e=Xb(),r=Object.prototype,n=r.hasOwnProperty;function o(i){if(!t(i))return e(i);var s=[];for(var u in Object(i))n.call(i,u)&&u!="constructor"&&s.push(u);return s}return ou=o,ou}var au,oh;function r0(){if(oh)return au;oh=1;var t=Vy(),e=Zy();function r(n){return n!=null&&e(n.length)&&!t(n)}return au=r,au}var su,ah;function pl(){if(ah)return su;ah=1;var t=e0(),e=Zb(),r=r0();function n(o){return r(o)?t(o):e(o)}return su=n,su}var uu,sh;function ew(){if(sh)return uu;sh=1;var t=Xo(),e=pl();function r(n,o){return n&&t(o,e(o),n)}return uu=r,uu}var cu,uh;function tw(){if(uh)return cu;uh=1;function t(e){var r=[];if(e!=null)for(var n in Object(e))r.push(n);return r}return cu=t,cu}var lu,ch;function rw(){if(ch)return lu;ch=1;var t=jn(),e=hl(),r=tw(),n=Object.prototype,o=n.hasOwnProperty;function i(s){if(!t(s))return r(s);var u=e(s),l=[];for(var a in s)a=="constructor"&&(u||!o.call(s,a))||l.push(a);return l}return lu=i,lu}var fu,lh;function vl(){if(lh)return fu;lh=1;var t=e0(),e=rw(),r=r0();function n(o){return r(o)?t(o,!0):e(o)}return fu=n,fu}var du,fh;function nw(){if(fh)return du;fh=1;var t=Xo(),e=vl();function r(n,o){return n&&t(o,e(o),n)}return du=r,du}var ai={exports:{}};ai.exports;var dh;function iw(){return dh||(dh=1,(function(t,e){var r=Kt(),n=e&&!e.nodeType&&e,o=n&&!0&&t&&!t.nodeType&&t,i=o&&o.exports===n,s=i?r.Buffer:void 0,u=s?s.allocUnsafe:void 0;function l(a,c){if(c)return a.slice();var f=a.length,d=u?u(f):new a.constructor(f);return a.copy(d),d}t.exports=l})(ai,ai.exports)),ai.exports}var hu,hh;function ow(){if(hh)return hu;hh=1;function t(e,r){var n=-1,o=e.length;for(r||(r=Array(o));++n<o;)r[n]=e[n];return r}return hu=t,hu}var pu,ph;function aw(){if(ph)return pu;ph=1;function t(e,r){for(var n=-1,o=e==null?0:e.length,i=0,s=[];++n<o;){var u=e[n];r(u,n,e)&&(s[i++]=u)}return s}return pu=t,pu}var vu,vh;function n0(){if(vh)return vu;vh=1;function t(){return[]}return vu=t,vu}var yu,yh;function yl(){if(yh)return yu;yh=1;var t=aw(),e=n0(),r=Object.prototype,n=r.propertyIsEnumerable,o=Object.getOwnPropertySymbols,i=o?function(s){return s==null?[]:(s=Object(s),t(o(s),function(u){return n.call(s,u)}))}:e;return yu=i,yu}var mu,mh;function sw(){if(mh)return mu;mh=1;var t=Xo(),e=yl();function r(n,o){return t(n,e(n),o)}return mu=r,mu}var gu,gh;function i0(){if(gh)return gu;gh=1;function t(e,r){for(var n=-1,o=r.length,i=e.length;++n<o;)e[i+n]=r[n];return e}return gu=t,gu}var _u,_h;function o0(){if(_h)return _u;_h=1;var t=t0(),e=t(Object.getPrototypeOf,Object);return _u=e,_u}var bu,bh;function a0(){if(bh)return bu;bh=1;var t=i0(),e=o0(),r=yl(),n=n0(),o=Object.getOwnPropertySymbols,i=o?function(s){for(var u=[];s;)t(u,r(s)),s=e(s);return u}:n;return bu=i,bu}var wu,wh;function uw(){if(wh)return wu;wh=1;var t=Xo(),e=a0();function r(n,o){return t(n,e(n),o)}return wu=r,wu}var Eu,Eh;function s0(){if(Eh)return Eu;Eh=1;var t=i0(),e=Mn();function r(n,o,i){var s=o(n);return e(n)?s:t(s,i(n))}return Eu=r,Eu}var Su,Sh;function cw(){if(Sh)return Su;Sh=1;var t=s0(),e=yl(),r=pl();function n(o){return t(o,r,e)}return Su=n,Su}var Iu,Ih;function lw(){if(Ih)return Iu;Ih=1;var t=s0(),e=a0(),r=vl();function n(o){return t(o,r,e)}return Iu=n,Iu}var Ou,Oh;function fw(){if(Oh)return Ou;Oh=1;var t=an(),e=Kt(),r=t(e,"DataView");return Ou=r,Ou}var Au,Ah;function dw(){if(Ah)return Au;Ah=1;var t=an(),e=Kt(),r=t(e,"Promise");return Au=r,Au}var Tu,Th;function hw(){if(Th)return Tu;Th=1;var t=an(),e=Kt(),r=t(e,"Set");return Tu=r,Tu}var Ru,Rh;function pw(){if(Rh)return Ru;Rh=1;var t=an(),e=Kt(),r=t(e,"WeakMap");return Ru=r,Ru}var Cu,Ch;function ml(){if(Ch)return Cu;Ch=1;var t=fw(),e=ul(),r=dw(),n=hw(),o=pw(),i=Ri(),s=Ky(),u="[object Map]",l="[object Object]",a="[object Promise]",c="[object Set]",f="[object WeakMap]",d="[object DataView]",h=s(t),y=s(e),m=s(r),b=s(n),w=s(o),_=i;return(t&&_(new t(new ArrayBuffer(1)))!=d||e&&_(new e)!=u||r&&_(r.resolve())!=a||n&&_(new n)!=c||o&&_(new o)!=f)&&(_=function(E){var I=i(E),R=I==l?E.constructor:void 0,x=R?s(R):"";if(x)switch(x){case h:return d;case y:return u;case m:return a;case b:return c;case w:return f}return I}),Cu=_,Cu}var xu,xh;function vw(){if(xh)return xu;xh=1;var t=Object.prototype,e=t.hasOwnProperty;function r(n){var o=n.length,i=new n.constructor(o);return o&&typeof n[0]=="string"&&e.call(n,"index")&&(i.index=n.index,i.input=n.input),i}return xu=r,xu}var Nu,Nh;function yw(){if(Nh)return Nu;Nh=1;var t=Kt(),e=t.Uint8Array;return Nu=e,Nu}var Pu,Ph;function gl(){if(Ph)return Pu;Ph=1;var t=yw();function e(r){var n=new r.constructor(r.byteLength);return new t(n).set(new t(r)),n}return Pu=e,Pu}var Du,Dh;function mw(){if(Dh)return Du;Dh=1;var t=gl();function e(r,n){var o=n?t(r.buffer):r.buffer;return new r.constructor(o,r.byteOffset,r.byteLength)}return Du=e,Du}var Lu,Lh;function gw(){if(Lh)return Lu;Lh=1;var t=/\w*$/;function e(r){var n=new r.constructor(r.source,t.exec(r));return n.lastIndex=r.lastIndex,n}return Lu=e,Lu}var Uu,Uh;function _w(){if(Uh)return Uu;Uh=1;var t=Ko(),e=t?t.prototype:void 0,r=e?e.valueOf:void 0;function n(o){return r?Object(r.call(o)):{}}return Uu=n,Uu}var qu,qh;function bw(){if(qh)return qu;qh=1;var t=gl();function e(r,n){var o=n?t(r.buffer):r.buffer;return new r.constructor(o,r.byteOffset,r.length)}return qu=e,qu}var Fu,Fh;function ww(){if(Fh)return Fu;Fh=1;var t=gl(),e=mw(),r=gw(),n=_w(),o=bw(),i="[object Boolean]",s="[object Date]",u="[object Map]",l="[object Number]",a="[object RegExp]",c="[object Set]",f="[object String]",d="[object Symbol]",h="[object ArrayBuffer]",y="[object DataView]",m="[object Float32Array]",b="[object Float64Array]",w="[object Int8Array]",_="[object Int16Array]",E="[object Int32Array]",I="[object Uint8Array]",R="[object Uint8ClampedArray]",x="[object Uint16Array]",P="[object Uint32Array]";function D(O,C,A){var N=O.constructor;switch(C){case h:return t(O);case i:case s:return new N(+O);case y:return e(O,A);case m:case b:case w:case _:case E:case I:case R:case x:case P:return o(O,A);case u:return new N;case l:case f:return new N(O);case a:return r(O);case c:return new N;case d:return n(O)}}return Fu=D,Fu}var Bu,Bh;function Ew(){if(Bh)return Bu;Bh=1;var t=jn(),e=Object.create,r=(function(){function n(){}return function(o){if(!t(o))return{};if(e)return e(o);n.prototype=o;var i=new n;return n.prototype=void 0,i}})();return Bu=r,Bu}var ju,jh;function Sw(){if(jh)return ju;jh=1;var t=Ew(),e=o0(),r=hl();function n(o){return typeof o.constructor=="function"&&!r(o)?t(e(o)):{}}return ju=n,ju}var Mu,Mh;function Iw(){if(Mh)return Mu;Mh=1;var t=ml(),e=kn(),r="[object Map]";function n(o){return e(o)&&t(o)==r}return Mu=n,Mu}var ku,kh;function Ow(){if(kh)return ku;kh=1;var t=Iw(),e=fl(),r=dl(),n=r&&r.isMap,o=n?e(n):t;return ku=o,ku}var $u,$h;function Aw(){if($h)return $u;$h=1;var t=ml(),e=kn(),r="[object Set]";function n(o){return e(o)&&t(o)==r}return $u=n,$u}var Wu,Wh;function Tw(){if(Wh)return Wu;Wh=1;var t=Aw(),e=fl(),r=dl(),n=r&&r.isSet,o=n?e(n):t;return Wu=o,Wu}var Gu,Gh;function Rw(){if(Gh)return Gu;Gh=1;var t=Gb(),e=Hb(),r=al(),n=ew(),o=nw(),i=iw(),s=ow(),u=sw(),l=uw(),a=cw(),c=lw(),f=ml(),d=vw(),h=ww(),y=Sw(),m=Mn(),b=Xy(),w=Ow(),_=jn(),E=Tw(),I=pl(),R=vl(),x=1,P=2,D=4,O="[object Arguments]",C="[object Array]",A="[object Boolean]",N="[object Date]",U="[object Error]",q="[object Function]",W="[object GeneratorFunction]",ae="[object Map]",z="[object Number]",Q="[object Object]",H="[object RegExp]",K="[object Set]",ve="[object String]",Dt="[object Symbol]",Jt="[object WeakMap]",Lt="[object ArrayBuffer]",Le="[object DataView]",ee="[object Float32Array]",ke="[object Float64Array]",me="[object Int8Array]",Se="[object Int16Array]",be="[object Int32Array]",Ie="[object Uint8Array]",Ue="[object Uint8ClampedArray]",zt="[object Uint16Array]",Or="[object Uint32Array]",g={};g[O]=g[C]=g[Lt]=g[Le]=g[A]=g[N]=g[ee]=g[ke]=g[me]=g[Se]=g[be]=g[ae]=g[z]=g[Q]=g[H]=g[K]=g[ve]=g[Dt]=g[Ie]=g[Ue]=g[zt]=g[Or]=!0,g[U]=g[q]=g[Jt]=!1;function p(v,S,T,L,F,X){var Z,ue=S&x,ge=S&P,he=S&D;if(T&&(Z=F?T(v,L,F,X):T(v)),Z!==void 0)return Z;if(!_(v))return v;var Ar=m(v);if(Ar){if(Z=d(v),!ue)return s(v,Z)}else{var Yt=f(v),$n=Yt==q||Yt==W;if(b(v))return i(v,ue);if(Yt==Q||Yt==O||$n&&!F){if(Z=ge||$n?{}:y(v),!ue)return ge?l(v,o(Z,v)):u(v,n(Z,v))}else{if(!g[Yt])return F?v:{};Z=h(v,Yt,ue)}}X||(X=new t);var Tl=X.get(v);if(Tl)return Tl;X.set(v,Z),E(v)?v.forEach(function(sr){Z.add(p(sr,S,T,sr,v,X))}):w(v)&&v.forEach(function(sr,Tr){Z.set(Tr,p(sr,S,T,Tr,v,X))});var ym=he?ge?c:a:ge?R:I,Rl=Ar?void 0:ym(v);return e(Rl||v,function(sr,Tr){Rl&&(Tr=sr,sr=v[Tr]),r(Z,Tr,p(sr,S,T,Tr,v,X))}),Z}return Gu=p,Gu}var Hu,Hh;function Cw(){if(Hh)return Hu;Hh=1;var t=Rw(),e=1,r=4;function n(o){return t(o,e|r)}return Hu=n,Hu}var xw=Cw();const Nw=Lc(xw);function _n(t){return t===void 0&&(t=""),"".concat(t?"".concat(t,"_"):"").concat(+new Date,"_").concat(Math.random())}var Pw=(function(){function t(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}return t})(),Vh=(function(){function t(e){var r=e.id,n=e.docChanges,o=e.docs,i=e.msgType,s=e.type,u,l;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return u||(u=JSON.parse(JSON.stringify(n))),u},enumerable:!0},docs:{get:function(){return l||(l=JSON.parse(JSON.stringify(o))),l},enumerable:!0},msgType:{get:function(){return i},enumerable:!0},type:{get:function(){return s},enumerable:!0}})}return t})(),Zo=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),Dw=(function(t){Zo(e,t);function e(r){var n=t.call(this,"Watch Error ".concat(JSON.stringify(r.msgData)," (requestid: ").concat(r.requestId,")"))||this;return n.isRealtimeErrorMessageError=!0,n.payload=r,n}return e})(Error),Kh=function(t){return t?.isRealtimeErrorMessageError},Lw=(function(t){Zo(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="timeout",r.payload=null,r.generic=!0,r}return e})(Error),Uw=function(t){return t.type==="timeout"},qw=(function(t){Zo(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="cancelled",r.payload=null,r.generic=!0,r}return e})(Error),Fw=function(t){return t.type==="cancelled"},pt=(function(t){Zo(e,t);function e(r){var n=t.call(this,r.errMsg)||this;return n.errCode="UNKNOWN_ERROR",Object.defineProperties(n,{message:{get:function(){return"errCode: ".concat(this.errCode," ").concat(et[this.errCode]||""," | errMsg: ").concat(this.errMsg)},set:function(o){this.errMsg=o}}}),n.errCode=r.errCode||"UNKNOWN_ERROR",n.errMsg=r.errMsg,n}return Object.defineProperty(e.prototype,"message",{get:function(){return"errCode: ".concat(this.errCode," | errMsg: ").concat(this.errMsg)},set:function(r){this.errMsg=r},enumerable:!1,configurable:!0}),e})(Error),et={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"},Ec=function(t){return t===void 0&&(t=0),new Promise(function(e){return setTimeout(e,t)})},ot=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Ve=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Jh=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},ce;(function(t){t.LOGGINGIN="LOGGINGIN",t.INITING="INITING",t.REBUILDING="REBUILDING",t.ACTIVE="ACTIVE",t.ERRORED="ERRORED",t.CLOSING="CLOSING",t.CLOSED="CLOSED",t.PAUSED="PAUSED",t.RESUMING="RESUMING"})(ce||(ce={}));var Bw=100,ki=2,jw=2,Mw=10*1e3,kw=10*1e3,$w=10*1e3,Ww=(function(){function t(e){var r=this;this.watchStatus=ce.INITING,this.wsLogin=function(n,o){return ot(r,void 0,void 0,function(){var i;return Ve(this,function(s){switch(s.label){case 0:return this.watchStatus=ce.LOGGINGIN,[4,this.login(n,o)];case 1:return i=s.sent(),this.envId||(this.envId=i.envId),[2,i]}})})},this.initWatch=function(n){return ot(r,void 0,void 0,function(){var o,i=this;return Ve(this,function(s){switch(s.label){case 0:if(this.initWatchPromise!==null&&this.initWatchPromise!==void 0)return[2,this.initWatchPromise];this.initWatchPromise=new Promise(function(u,l){(function(){return ot(i,void 0,void 0,function(){var a,c,f,d,h,y,m,b,w,_,E;return Ve(this,function(I){switch(I.label){case 0:return I.trys.push([0,3,,4]),this.watchStatus===ce.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,u()]):[4,this.wsLogin(this.envId,n)];case 1:return a=I.sent().envId,this.watchStatus===ce.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,u()]):(this.watchStatus=ce.INITING,c={watchId:this.watchId,requestId:_n(),msgType:"INIT_WATCH",msgData:{envId:a,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:c,waitResponse:!0,skipOnMessage:!0,timeout:kw})]);case 2:if(f=I.sent(),d=f.msgData,h=d.events,y=d.currEvent,this.sessionInfo={queryID:f.msgData.queryID,currentEventId:y-1,currentDocs:[]},h.length>0){for(m=0,b=h;m<b.length;m++)w=b[m],w.ID=y;this.handleServerEvents(f)}else this.sessionInfo.currentEventId=y,_=new Vh({id:y,docChanges:[],docs:[],type:"init"}),this.listener.onChange(_),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=ce.ACTIVE,this.availableRetries.INIT_WATCH=ki,u(),[3,4];case 3:return E=I.sent(),this.handleWatchEstablishmentError(E,{operationName:"INIT_WATCH",resolve:u,reject:l}),[3,4];case 4:return[2]}})})})()}),o=!1,s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.initWatchPromise];case 2:return s.sent(),o=!0,[3,4];case 3:return this.initWatchPromise=void 0,[7];case 4:return console.log("[realtime] initWatch ".concat(o?"success":"fail")),[2]}})})},this.rebuildWatch=function(n){return ot(r,void 0,void 0,function(){var o,i=this;return Ve(this,function(s){switch(s.label){case 0:if(this.rebuildWatchPromise!==null&&this.rebuildWatchPromise!==void 0)return[2,this.rebuildWatchPromise];this.rebuildWatchPromise=new Promise(function(u,l){(function(){return ot(i,void 0,void 0,function(){var a,c,f,d;return Ve(this,function(h){switch(h.label){case 0:return h.trys.push([0,3,,4]),this.watchStatus===ce.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,u()]):[4,this.wsLogin(this.envId,n)];case 1:if(a=h.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===ce.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,u()]):(this.watchStatus=ce.REBUILDING,c={watchId:this.watchId,requestId:_n(),msgType:"REBUILD_WATCH",msgData:{envId:a,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:c,waitResponse:!0,skipOnMessage:!1,timeout:$w})]);case 2:return f=h.sent(),this.handleServerEvents(f),this.watchStatus=ce.ACTIVE,this.availableRetries.REBUILD_WATCH=ki,u(),[3,4];case 3:return d=h.sent(),this.handleWatchEstablishmentError(d,{operationName:"REBUILD_WATCH",resolve:u,reject:l}),[3,4];case 4:return[2]}})})})()}),o=!1,s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.rebuildWatchPromise];case 2:return s.sent(),o=!0,[3,4];case 3:return this.rebuildWatchPromise=void 0,[7];case 4:return console.log("[realtime] rebuildWatch ".concat(o?"success":"fail")),[2]}})})},this.handleWatchEstablishmentError=function(n,o){return ot(r,void 0,void 0,function(){var i,s,u,l=this;return Ve(this,function(a){return i=o.operationName==="INIT_WATCH",s=function(){l.closeWithError(new pt({errCode:i?et.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:et.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:n})),o.reject(n)},u=function(c){l.useRetryTicket(o.operationName)?i?(l.initWatchPromise=void 0,o.resolve(l.initWatch(c))):(l.rebuildWatchPromise=void 0,o.resolve(l.rebuildWatch(c))):s()},this.handleCommonError(n,{onSignError:function(){return u(!0)},onTimeoutError:function(){return u(!1)},onNotRetryableError:s,onCancelledError:o.reject,onUnknownError:function(){(function(){return ot(l,void 0,void 0,function(){var c,f=this;return Ve(this,function(d){switch(d.label){case 0:return d.trys.push([0,8,,9]),c=function(){return ot(f,void 0,void 0,function(){return Ve(this,function(h){switch(h.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return h.sent(),u(!0),[2]}})})},this.isWSConnected()?[3,2]:[4,c()];case 1:return d.sent(),[3,7];case 2:return[4,Ec(Bw)];case 3:return d.sent(),this.watchStatus!==ce.PAUSED?[3,4]:(o.reject(new qw("".concat(o.operationName," cancelled due to pause after unknownError"))),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,c()];case 5:return d.sent(),[3,7];case 6:u(!1),d.label=7;case 7:return[3,9];case 8:return d.sent(),u(!0),[3,9];case 9:return[2]}})})})()}}),[2]})})},this.closeWatch=function(){return ot(r,void 0,void 0,function(){var n,o,i;return Ve(this,function(s){switch(s.label){case 0:if(n=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==ce.ACTIVE)return this.watchStatus=ce.CLOSED,this.onWatchClose(this,n),[2];s.label=1;case 1:return s.trys.push([1,3,4,5]),this.watchStatus=ce.CLOSING,o={watchId:this.watchId,requestId:_n(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:o})];case 2:return s.sent(),this.sessionInfo=void 0,this.watchStatus=ce.CLOSED,[3,5];case 3:return i=s.sent(),this.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:i})),[3,5];case 4:return this.onWatchClose(this,n),[7];case 5:return[2]}})})},this.scheduleSendACK=function(){r.clearACKSchedule(),r.ackTimeoutId=setTimeout(function(){r.waitExpectedTimeoutId?r.scheduleSendACK():r.sendACK()},Mw)},this.clearACKSchedule=function(){r.ackTimeoutId&&clearTimeout(r.ackTimeoutId)},this.sendACK=function(){return ot(r,void 0,void 0,function(){var n,o,i;return Ve(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),this.watchStatus!==ce.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(n={watchId:this.watchId,requestId:_n(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:n})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return s.sent(),this.scheduleSendACK(),[3,3];case 2:if(o=s.sent(),Kh(o))switch(i=o.payload,i.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:i.msgData.code})),[2]}return this.availableRetries.CHECK_LAST&&this.availableRetries.CHECK_LAST>0?(this.availableRetries.CHECK_LAST-=1,this.scheduleSendACK()):this.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:o})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(n,o){if(Kh(n)){var i=n.payload;switch(i.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":{o.onSignError(n);return}case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":{o.onNotRetryableError(n);return}default:{o.onNotRetryableError(n);return}}}else if(Uw(n)){o.onTimeoutError(n);return}else if(Fw(n)){o.onCancelledError(n);return}o.onUnknownError(n)},this.watchId="watchid_".concat(+new Date,"_").concat(Math.random()),this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.onceWSConnected=e.onceWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.debug=e.debug,this.availableRetries={INIT_WATCH:ki,REBUILD_WATCH:ki,CHECK_LAST:jw},this.listener=new Pw({close:function(){r.closeWatch()},onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return t.prototype.onMessage=function(e){var r=this;switch(this.watchStatus){case ce.PAUSED:{if(e.msgType!=="ERROR")return;break}case ce.LOGGINGIN:case ce.INITING:case ce.REBUILDING:{console.warn("[realtime listener] internal non-fatal error: unexpected message received while ".concat(this.watchStatus));return}case ce.CLOSED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");return}case ce.ERRORED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error");return}}if(!this.sessionInfo){console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.");return}switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":{console.warn("nextevent ".concat(e.msgData.currEvent," ignored"),e),this.handleServerEvents(e);break}case"CHECK_EVENT":{this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this.waitExpectedTimeoutId=setTimeout(function(){r.rebuildWatch()},this.getWaitExpectedTimeoutLength()),console.log("[realtime] waitExpectedTimeoutLength ".concat(this.getWaitExpectedTimeoutLength())));break}case"ERROR":{this.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:"".concat(e.msgData.code," - ").concat(e.msgData.message)}));break}default:{console.warn("[realtime listener] virtual client receive unexpected msg ".concat(e.msgType,": "),e);break}}},t.prototype.closeWithError=function(e){var r;this.watchStatus=ce.ERRORED,this.clearACKSchedule(),this.listener.onError(e),this.onWatchClose(this,((r=this.sessionInfo)===null||r===void 0?void 0:r.queryID)||""),console.log("[realtime] client closed (".concat(this.collectionName," ").concat(this.query,") (watchId ").concat(this.watchId,")"))},t.prototype.pause=function(){this.watchStatus=ce.PAUSED,console.log("[realtime] client paused (".concat(this.collectionName," ").concat(this.query,") (watchId ").concat(this.watchId,")"))},t.prototype.resume=function(){return ot(this,void 0,void 0,function(){var e;return Ve(this,function(r){switch(r.label){case 0:this.watchStatus=ce.RESUMING,console.log("[realtime] client resuming with ".concat(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH"," (").concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")")),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return r.sent(),console.log("[realtime] client successfully resumed (".concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")")),[3,4];case 3:return e=r.sent(),console.error("[realtime] client resume failed (".concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")"),e),[3,4];case 4:return[2]}})})},t.prototype.useRetryTicket=function(e){return this.availableRetries[e]&&this.availableRetries[e]>0?(this.availableRetries[e]-=1,console.log("[realtime] ".concat(e," use a retry ticket, now only ").concat(this.availableRetries[e]," retry left")),!0):!1},t.prototype.handleServerEvents=function(e){return ot(this,void 0,void 0,function(){var r;return Ve(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this.handleServerEventsInternel(e)];case 1:return n.sent(),this.postHandleServerEventsValidityCheck(e),[3,3];case 2:throw r=n.sent(),console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",r),r;case 3:return[2]}})})},t.prototype.handleServerEventsInternel=function(e){return ot(this,void 0,void 0,function(){var r,n,o,i,s,u,l,a,c,f,d,h;return Ve(this,function(y){switch(y.label){case 0:if(r=e.requestId,n=e.msgData.events,o=e.msgType,!n.length||!this.sessionInfo)return[2];i=this.sessionInfo;try{s=n.map(Gw)}catch(m){return this.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:m})),[2]}u=Jh([],i.currentDocs,!0),l=!1,a=function(m,b){var w,_,E,I,R,x,D,D,P,P,D,O,O,C,A,N;return Ve(this,function(U){switch(U.label){case 0:return w=s[m],i.currentEventId>=w.id?(!s[m-1]||w.id>s[m-1].id?console.warn("[realtime] duplicate event received, cur ".concat(i.currentEventId," but got ").concat(w.id)):console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ".concat(r,")")),[2,"continue"]):[3,1];case 1:if(i.currentEventId!==w.id-1)return[3,2];switch(w.dataType){case"update":{if(!w.doc)switch(w.queueType){case"update":case"dequeue":{if(_=u.find(function(q){return q._id===w.docId}),_){if(E=Nw(_),w.updatedFields&&Object.keys(w.updatedFields).forEach(function(q){xb(E,q,w.updatedFields[q])}),w.removedFields)for(I=0,R=w.removedFields;I<R.length;I++)x=R[I],Bb(E,x);w.doc=E}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break}case"enqueue":throw D=new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '.concat(e.requestId,")")}),c.closeWithError(D),D}break}case"replace":{if(!w.doc)throw D=new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '.concat(e.requestId,")")}),c.closeWithError(D),D;break}case"remove":{P=u.find(function(q){return q._id===w.docId}),P?w.doc=P:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break}case"limit":{if(!w.doc)switch(w.queueType){case"dequeue":{P=u.find(function(q){return q._id===w.docId}),P?w.doc=P:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");break}case"enqueue":throw D=new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '.concat(e.requestId,")")}),c.closeWithError(D),D}break}}switch(w.queueType){case"init":{l?u.push(w.doc):(l=!0,u=[w.doc]);break}case"enqueue":{u.push(w.doc);break}case"dequeue":{O=u.findIndex(function(q){return q._id===w.docId}),O>-1?u.splice(O,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break}case"update":{O=u.findIndex(function(q){return q._id===w.docId}),O>-1?u[O]=w.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}}return(m===b-1||s[m+1]&&s[m+1].id!==w.id)&&(C=Jh([],u,!0),A=s.slice(0,m+1).filter(function(q){return q.id===w.id}),c.sessionInfo.currentEventId=w.id,c.sessionInfo.currentDocs=u,N=new Vh({id:w.id,docChanges:A,docs:C,msgType:o}),c.listener.onChange(N)),[3,4];case 2:return console.warn("[realtime listener] event received is out of order, cur ".concat(c.sessionInfo.currentEventId," but got ").concat(w.id)),[4,c.rebuildWatch()];case 3:return U.sent(),[2,{value:void 0}];case 4:return[2]}})},c=this,f=0,d=s.length,y.label=1;case 1:return f<d?[5,a(f,d)]:[3,4];case 2:if(h=y.sent(),typeof h=="object")return[2,h.value];y.label=3;case 3:return f++,[3,1];case 4:return[2]}})})},t.prototype.postHandleServerEventsValidityCheck=function(e){if(!this.sessionInfo){console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur");return}if(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent){console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling");return}},t.prototype.clearWaitExpectedEvent=function(){this.waitExpectedTimeoutId&&(clearTimeout(this.waitExpectedTimeoutId),this.waitExpectedTimeoutId=void 0)},t})();function Gw(t){var e={id:t.ID,dataType:t.DataType,queueType:t.QueueType,docId:t.DocID,doc:t.Doc&&t.Doc!=="{}"?JSON.parse(t.Doc):void 0};return t.DataType==="update"&&(t.UpdatedFields&&(e.updatedFields=JSON.parse(t.UpdatedFields)),(t.removedFields||t.RemovedFields)&&(e.removedFields=JSON.parse(t.removedFields))),e}var u0={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}},ht;(function(t){t[t.NormalClosure=1e3]="NormalClosure",t[t.GoingAway=1001]="GoingAway",t[t.ProtocolError=1002]="ProtocolError",t[t.UnsupportedData=1003]="UnsupportedData",t[t.NoStatusReceived=1005]="NoStatusReceived",t[t.AbnormalClosure=1006]="AbnormalClosure",t[t.InvalidFramePayloadData=1007]="InvalidFramePayloadData",t[t.PolicyViolation=1008]="PolicyViolation",t[t.MessageTooBig=1009]="MessageTooBig",t[t.MissingExtension=1010]="MissingExtension",t[t.InternalError=1011]="InternalError",t[t.ServiceRestart=1012]="ServiceRestart",t[t.TryAgainLater=1013]="TryAgainLater",t[t.BadGateway=1014]="BadGateway",t[t.TLSHandshake=1015]="TLSHandshake",t[t.ReconnectWebSocket=3e3]="ReconnectWebSocket",t[t.NoRealtimeListeners=3001]="NoRealtimeListeners",t[t.HeartbeatPingError=3002]="HeartbeatPingError",t[t.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",t[t.NoAuthentication=3050]="NoAuthentication"})(ht||(ht={}));var Vu=function(t,e){var r=u0[t],n=r?"".concat(r.name,", code ").concat(t,", reason ").concat(e||r.description):"code ".concat(t);return new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:n})},c0=null,l0="web";function Hw(){return c0}function Vw(t){c0=t}function zh(){return l0}function Kw(t){l0=t}var So=function(){return So=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},So.apply(this,arguments)},It=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Ot=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Ku={OPEN:1},Yh=3,Jw=5e3,zw=1e4,Yw=5,Qw=1e4,Xw=2,Zw=2,eE=5e3,tE=(function(){function t(e){var r=this;this.virtualWSClient=new Set,this.queryIdClientMap=new Map,this.watchIdClientMap=new Map,this.pingFailed=0,this.pongMissed=0,this.logins=new Map,this.wsReadySubsribers=[],this.wsResponseWait=new Map,this.rttObserved=[],this.send=function(n){return It(r,void 0,void 0,function(){var o=this;return Ot(this,function(i){return[2,new Promise(function(s,u){(function(){return It(o,void 0,void 0,function(){var l,a,c,f,d,h,y,m,b=this;return Ot(this,function(w){switch(w.label){case 0:a=!1,c=!1,f=function(_){a=!0,l&&clearTimeout(l),s(_)},d=function(_){c=!0,l&&clearTimeout(l),u(_)},n.timeout&&(l=setTimeout(function(){(function(){return It(b,void 0,void 0,function(){return Ot(this,function(_){switch(_.label){case 0:return!a||!c?[4,Ec(0)]:[3,2];case 1:_.sent(),(!a||!c)&&d(new Lw("wsclient.send timedout")),_.label=2;case 2:return[2]}})})})()},n.timeout)),w.label=1;case 1:return w.trys.push([1,8,,9]),this.wsInitPromise!==void 0||this.wsInitPromise!==null?[4,this.wsInitPromise]:[3,3];case 2:w.sent(),w.label=3;case 3:if(!this.ws)return d(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this.ws.readyState!==Ku.OPEN)return d(new Error("ws readyState invalid: ".concat(this.ws.readyState,", can not send message"))),[2];n.waitResponse&&(h={resolve:f,reject:d,skipOnMessage:n.skipOnMessage},this.wsResponseWait.set(n.msg.requestId,h)),w.label=4;case 4:return w.trys.push([4,6,,7]),[4,this.ws.send(JSON.stringify(n.msg))];case 5:return w.sent(),n.waitResponse||f(void 0),[3,7];case 6:return y=w.sent(),y&&(d(y),n.waitResponse&&this.wsResponseWait.delete(n.msg.requestId)),[3,7];case 7:return[3,9];case 8:return m=w.sent(),d(m),[3,9];case 9:return[2]}})})})()})]})})},this.closeAllClients=function(n){r.virtualWSClient.forEach(function(o){o.closeWithError(n)})},this.pauseClients=function(n){(n||r.virtualWSClient).forEach(function(o){o.pause()})},this.resumeClients=function(n){(n||r.virtualWSClient).forEach(function(o){o.resume()})},this.initWebSocketConnection=function(n,o){return o===void 0&&(o=r.maxReconnect),It(r,void 0,void 0,function(){var i=this;return Ot(this,function(s){switch(s.label){case 0:if(n&&this.reconnectState)return[2];if(n&&(this.reconnectState=!0),this.wsInitPromise!==void 0&&this.wsInitPromise!==null)return[2,this.wsInitPromise];n&&this.pauseClients(),this.close(ht.ReconnectWebSocket),this.wsInitPromise=new Promise(function(u,l){(function(){return It(i,void 0,void 0,function(){var a,c,f,d=this;return Ot(this,function(h){switch(h.label){case 0:return h.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return a=h.sent(),[4,new Promise(function(y){var m=a.wsUrl||"wss://tcb-ws.tencentcloudapi.com",b=Hw();d.ws=b?new b(m):new WebSocket(m),y(void 0)})];case 2:return h.sent(),this.ws.connect?[4,this.ws.connect()]:[3,4];case 3:h.sent(),h.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return h.sent(),u(),n&&(this.resumeClients(),this.reconnectState=!1),[3,11];case 6:return c=h.sent(),console.error("[realtime] initWebSocketConnection connect fail",c),o>0?(f=!0,this.wsInitPromise=void 0,f?[4,Ec(this.reconnectInterval)]:[3,8]):[3,9];case 7:h.sent(),n&&(this.reconnectState=!1),h.label=8;case 8:return u(this.initWebSocketConnection(n,o-1)),[3,10];case 9:l(c),n&&this.closeAllClients(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:c})),h.label=10;case 10:return[3,11];case 11:return[2]}})})})()}),s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,this.wsInitPromise];case 2:return s.sent(),this.wsReadySubsribers.forEach(function(u){var l=u.resolve;return l()}),[3,5];case 3:return s.sent(),this.wsReadySubsribers.forEach(function(u){var l=u.reject;return l()}),[3,5];case 4:return this.wsInitPromise=void 0,this.wsReadySubsribers=[],[7];case 5:return[2]}})})},this.initWebSocketEvent=function(){return new Promise(function(n,o){if(!r.ws)throw new Error("can not initWebSocketEvent, ws not exists");var i=!1;r.ws.onopen=function(s){console.warn("[realtime] ws event: open",s),i=!0,n()},r.ws.onerror=function(s){r.logins=new Map,i?(console.error("[realtime] ws event: error",s),r.clearHeartbeat(),r.virtualWSClient.forEach(function(u){return u.closeWithError(new pt({errCode:et.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:s}))})):(console.error("[realtime] ws open failed with ws event: error",s),o(s))},r.ws.onclose=function(s){switch(console.warn("[realtime] ws event: close",s),r.logins=new Map,r.clearHeartbeat(),s.code){case ht.ReconnectWebSocket:break;case ht.NoRealtimeListeners:break;case ht.HeartbeatPingError:case ht.HeartbeatPongTimeoutError:case ht.NormalClosure:case ht.AbnormalClosure:{r.maxReconnect>0?r.initWebSocketConnection(!0,r.maxReconnect):r.closeAllClients(Vu(s.code));break}case ht.NoAuthentication:{r.closeAllClients(Vu(s.code,s.reason));break}default:r.maxReconnect>0?r.initWebSocketConnection(!0,r.maxReconnect):r.closeAllClients(Vu(s.code))}},r.ws.onmessage=function(s){var u,l=((u=s.data)===null||u===void 0?void 0:u.data)||s.data;r.heartbeat();var a;try{a=typeof l=="string"?JSON.parse(l):l}catch(_){throw new Error("[realtime] onMessage parse res.data error: ".concat(_))}if(a.msgType==="ERROR"){var c=null;r.virtualWSClient.forEach(function(_){_.watchId===a.watchId&&(c=_)}),c&&c.listener.onError(a)}var f=r.wsResponseWait.get(a.requestId);if(f){try{a.msgType==="ERROR"?f.reject(new Dw(a)):f.resolve(a)}catch(_){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",_)}finally{r.wsResponseWait.delete(a.requestId)}if(f.skipOnMessage)return}if(a.msgType==="PONG"){if(r.lastPingSendTS){var d=Date.now()-r.lastPingSendTS;if(d>zw){console.warn("[realtime] untrusted rtt observed: ".concat(d));return}r.rttObserved.length>=Yh&&r.rttObserved.splice(0,r.rttObserved.length-Yh+1),r.rttObserved.push(d)}return}var h=a.watchId&&r.watchIdClientMap.get(a.watchId);if(h)h.onMessage(a);else switch(console.error("[realtime] no realtime listener found responsible for watchId ".concat(a.watchId,": "),a),a.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":{h=r.queryIdClientMap.get(a.msgData.queryID),h&&h.onMessage(a);break}default:for(var y=0,m=Array.from(r.watchIdClientMap.entries());y<m.length;y++){var b=m[y],w=b[1];w.onMessage(a);break}}},r.heartbeat()})},this.isWSConnected=function(){return!!(r.ws&&r.ws.readyState===Ku.OPEN)},this.onceWSConnected=function(){return It(r,void 0,void 0,function(){var n=this;return Ot(this,function(o){return this.isWSConnected()?[2]:this.wsInitPromise!==null&&this.wsInitPromise!==void 0?[2,this.wsInitPromise]:[2,new Promise(function(i,s){n.wsReadySubsribers.push({resolve:i,reject:s})})]})})},this.webLogin=function(n,o){return It(r,void 0,void 0,function(){var i,s,u,l,a,c,f,d,h=this;return Ot(this,function(y){switch(y.label){case 0:if(!o){if(n){if(i=this.logins.get(n),i){if(i.loggedIn&&i.loginResult)return[2,i.loginResult];if(i.loggingInPromise!==null&&i.loggingInPromise!==void 0)return[2,i.loggingInPromise]}}else if(s=this.logins.get(""),s?.loggingInPromise!==null&&s?.loggingInPromise!==void 0)return[2,s.loggingInPromise]}u=new Promise(function(m,b){(function(){return It(h,void 0,void 0,function(){var w,_,E,I,R;return Ot(this,function(x){switch(x.label){case 0:return x.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return w=x.sent(),_={envId:w.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},E={watchId:void 0,requestId:_n(),msgType:"LOGIN",msgData:_,exMsgData:{runtime:zh(),signStr:w.signStr,secretVersion:w.secretVersion}},[4,this.send({msg:E,waitResponse:!0,skipOnMessage:!0,timeout:eE})];case 2:return I=x.sent(),I.msgData.code?b(new Error("".concat(I.msgData.code," ").concat(I.msgData.message))):m({envId:w.envId}),[3,4];case 3:return R=x.sent(),b(R),[3,4];case 4:return[2]}})})})()}),l=n&&this.logins.get(n),a=Date.now(),l?(l.loggedIn=!1,l.loggingInPromise=u,l.loginStartTS=a):(l={loggedIn:!1,loggingInPromise:u,loginStartTS:a},this.logins.set(n||"",l)),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,u];case 2:if(c=y.sent(),f=n&&this.logins.get(n),f&&f===l&&f.loginStartTS===a)return l.loggedIn=!0,l.loggingInPromise=void 0,l.loginStartTS=void 0,l.loginResult=c,[2,c];if(f){if(f.loggedIn&&f.loginResult)return[2,f.loginResult];if(f.loggingInPromise!==null&&f.loggingInPromise!==void 0)return[2,f.loggingInPromise];throw new Error("ws unexpected login info")}else throw new Error("ws login info reset");case 3:throw d=y.sent(),l.loggedIn=!1,l.loggingInPromise=void 0,l.loginStartTS=void 0,l.loginResult=void 0,d;case 4:return[2]}})})},this.getWsSign=function(){return It(r,void 0,void 0,function(){var n,o,i,s,u,l,a;return Ot(this,function(c){switch(c.label){case 0:return this.wsSign&&this.wsSign.expiredTs>Date.now()?[2,this.wsSign]:(n=Date.now()+6e4,[4,this.context.appConfig.request.send("auth.wsWebSign",{runtime:zh()})]);case 1:if(o=c.sent(),o.code)throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败: ".concat(o.code));if(o.data)return i=o.data,s=i.signStr,u=i.wsUrl,l=i.secretVersion,a=i.envId,[2,{signStr:s,wsUrl:u,secretVersion:l,envId:a,expiredTs:n}];throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败")}})})},this.getWaitExpectedTimeoutLength=function(){return r.rttObserved.length?r.rttObserved.reduce(function(n,o){return n+o})/r.rttObserved.length*1.5:Jw},this.ping=function(){return It(r,void 0,void 0,function(){var n;return Ot(this,function(o){switch(o.label){case 0:return n={watchId:void 0,requestId:_n(),msgType:"PING",msgData:null},[4,this.send({msg:n})];case 1:return o.sent(),[2]}})})},this.onWatchStart=function(n,o){r.queryIdClientMap.set(o,n)},this.onWatchClose=function(n,o){o&&r.queryIdClientMap.delete(o),r.watchIdClientMap.delete(n.watchId),r.virtualWSClient.delete(n),r.virtualWSClient.size||r.close(ht.NoRealtimeListeners)},this.maxReconnect=e.maxReconnect||Yw,this.reconnectInterval=e.reconnectInterval||Qw,this.context=e.context}return t.prototype.clearHeartbeat=function(){this.pingTimeoutId&&clearTimeout(this.pingTimeoutId),this.pongTimeoutId&&clearTimeout(this.pongTimeoutId)},t.prototype.close=function(e){this.clearHeartbeat(),this.ws&&(this.ws.close(e,u0[e].name),this.ws=void 0)},t.prototype.watch=function(e){!this.ws&&(this.wsInitPromise===void 0||this.wsInitPromise===null)&&this.initWebSocketConnection(!1);var r=new Ww(So(So({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this.virtualWSClient.add(r),this.watchIdClientMap.set(r.watchId,r),r.listener},t.prototype.heartbeat=function(e){var r=this;this.clearHeartbeat(),this.pingTimeoutId=setTimeout(function(){(function(){return It(r,void 0,void 0,function(){var n=this;return Ot(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),!this.ws||this.ws.readyState!==Ku.OPEN?[2]:(this.lastPingSendTS=Date.now(),[4,this.ping()]);case 1:return o.sent(),this.pingFailed=0,this.pongTimeoutId=setTimeout(function(){console.error("pong timed out"),n.pongMissed<Zw?(n.pongMissed+=1,n.heartbeat(!0)):n.initWebSocketConnection(!0)},this.context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return o.sent(),this.pingFailed<Xw?(this.pingFailed+=1,this.heartbeat()):this.close(ht.HeartbeatPingError),[3,3];case 3:return[2]}})})})()},e?0:this.context.appConfig.realtimePingInterval)},t})(),f0={target:"database",entity:function(){var t=this.platform,e=t.adapter,r=t.runtime;Vw(e.wsClass),Kw(r)}},d0={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=tE}};try{cloudbase.registerComponent(d0),cloudbase.registerHook(f0)}catch{}function rE(t){try{t.registerComponent(d0),t.registerHook(f0)}catch(e){console.warn(e)}}var nE=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Ju=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},iE=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},oE=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},aE=rt,sE=Fo,uE=Mo,h0="analytics",cE=["mall"];function lE(t){if(Object.prototype.toString.call(t).slice(8,-1)!=="Object")return!1;var e=t.report_data,r=t.report_type;return!(cE.includes(r)===!1||Object.prototype.toString.call(e).slice(8,-1)!=="Object"||e.action_time!==void 0&&!Number.isInteger(e.action_time)||typeof e.action_type!="string")}var fE=(function(){function t(){}return t.prototype.analytics=function(e){return iE(this,void 0,void 0,function(){var r,n,o,i,s;return oE(this,function(u){if(!lE(e))throw new Error(JSON.stringify({code:aE.INVALID_PARAMS,msg:"[".concat(h0,".analytics] invalid report data")}));return r="analytics.report",n=e.report_data.action_time===void 0?Math.floor(Date.now()/1e3):e.report_data.action_time,o={analytics_scene:e.report_type,analytics_data:Object.assign({},e.report_data,{action_time:n})},i={requestData:o},s=this.request,s.send(r,i),[2]})})},nE([uE({customInfo:{},title:"上报调用失败",messages:["请确认以下各项：","  1 - 调用 analytics() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助：".concat(sE)]}),Ju("design:type",Function),Ju("design:paramtypes",[Object]),Ju("design:returntype",Promise)],t.prototype,"analytics",null),t})(),dE=new fE,p0={name:h0,entity:{analytics:dE.analytics}};try{cloudbase.registerComponent(p0)}catch{}function hE(t){try{t.registerComponent(p0)}catch(e){console.warn(e)}}var Sc=function(t,e){return Sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},Sc(t,e)};function pE(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Pe=function(){return Pe=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Pe.apply(this,arguments)};function Ln(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,[])).next())})}function Un(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var Hr=(function(t){pE(e,t);function e(r,n){var o=t.call(this,r)||this;return o.name="WxCloudSDKError",o.code=n?.code,o.requestId=n?.requestId,o.originError=n?.originError,o}return e})(Error);function Ic(){return typeof window<"u"&&window||typeof globalThis<"u"&&globalThis}function vE(){try{var t=Ic();return t?typeof wx>"u"?Ic().location.href:t.__wxRoute:void 0}catch{}}function yE(){var t=Ic();if(t?.navigator)return t.navigator.userAgent;if(typeof wx<"u"&&wx.getSystemInfo){var e;return wx.getSystemInfo({success:function(r){r&&(e=["brand","model","version","system","platform","SDKVersion","language"].map(function(n){return"".concat(n,": ").concat(r[n])}).join(", "))}}),e}}var mE="1.6.1",gE=function(t){var e=t.dataSourceName,r=t.methodName,n=t.params,o=t.realMethodName,i=t.callFunction,s=t.envType,u=s===void 0?"prod":s,l=t.mode;return Ln(void 0,void 0,void 0,function(){var a,c,f,d,h,y;return Un(this,function(m){switch(m.label){case 0:a={data:{},requestId:""},m.label=1;case 1:return m.trys.push([1,3,,4]),[4,i({name:"lowcode-datasource",data:{dataSourceName:e,methodName:r,params:n,userAgent:yE(),referrer:vE(),"x-sdk-version":mE,envType:u,mode:l}})];case 2:if(c=m.sent(),f=((h=c?.result)===null||h===void 0?void 0:h.requestId)||c?.requestId||c?.requestID,c?.result.code)throw new Hr("【错误】".concat(c?.result.message,`
【操作】调用 models.`).concat(e?"".concat(e,"."):"").concat(o,`
【错误码】`).concat(c?.result.code,`
【请求ID】`).concat(f||"N/A"),{code:c?.result.code,requestId:f});return a.data=((y=c?.result)===null||y===void 0?void 0:y.data)||{},a.requestId=f,[3,4];case 3:throw d=m.sent(),d.name==="WxCloudSDKError"?d:(console.log(d),new Hr("【错误】".concat(d.message,`
      【操作】调用 models.`).concat(e?"".concat(e,"."):"").concat(o,`
      【请求ID】N/A`),{code:"UnknownError",originError:d}));case 4:return[2,a]}})})},Qh=function(t){var e=t.sql,r=t.params,n=t.config,o=t.callFunction,i=t.unsafe,s=i===void 0?!1:i;return Ln(void 0,void 0,void 0,function(){return Un(this,function(u){return[2,gE({realMethodName:"$runSQL",methodName:"callWedaApi",params:{action:"RunMysqlCommand",data:{sqlTemplate:e,config:n,parameter:s?"":Object.entries(r||{}).reduce(function(l,a){var c=a[0],f=a[1];if(f!==void 0){var d="OBJECT",h=typeof f;switch(h){case"boolean":{d="BOOLEAN";break}case"number":{d="NUMBER";break}case"string":{d="STRING";break}default:Array.isArray(f)?d="ARRAY":d="OBJECT"}l.push({key:c,type:d,value:d==="STRING"?f:JSON.stringify(f)})}return l},[])||[]}},callFunction:o,mode:"sdk"})]})})},_E=function(t){return{$runSQL:function(e,r,n){return Ln(this,void 0,void 0,function(){var o;return Un(this,function(i){switch(i.label){case 0:return[4,Qh({sql:e,params:r,config:Pe(Pe({},n),{preparedStatements:!0}),callFunction:t})];case 1:return o=i.sent(),[2,o]}})})},$runSQLRaw:function(e,r){return Ln(this,void 0,void 0,function(){var n;return Un(this,function(o){switch(o.label){case 0:return[4,Qh({sql:e,params:[],config:Pe(Pe({},r),{preparedStatements:!1}),callFunction:t})];case 1:return n=o.sent(),[2,n]}})})}}},Xh={filter:{where:{}},select:{$master:!0}};function Xt(t){return{getUrl:function(e){return"".concat(e,"/").concat(t)},method:"post"}}var bE={get:Pe(Pe({},Xt("get")),{defaultParams:Pe({},Xh)}),list:Pe(Pe({},Xt("list")),{defaultParams:Pe({},Xh)}),create:Xt("create"),createMany:Xt("createMany"),update:Pe(Pe({},Xt("update")),{method:"put"}),updateMany:Pe(Pe({},Xt("updateMany")),{method:"put"}),upsert:Xt("upsert"),delete:Xt("delete"),deleteMany:Xt("deleteMany")},$i="Unknown error occurred",Zh="NotSupported",wE=function(t,e,r,n){var o=_E(t);return new Proxy({},{get:function(i,s){if(typeof s=="string")return Object.prototype.hasOwnProperty.call(o,s)?o[s]:EE(r,s,e,n)}})},ep=function(t,e,r,n,o){return new Hr("【错误】".concat(t,`
【操作】调用 models.`).concat(e,".").concat(r,`
【错误码】`).concat(n,`
【请求ID】`).concat(o),{code:n,requestId:o})},EE=function(t,e,r,n){var o=new Proxy({},{get:function(i,s){if(s!=="runSQLTemplate"){var u=bE[s];if(!u){var l=new Error("不支持的操作: ".concat(s));throw new Hr(l.message||$i,{originError:l,code:Zh,requestId:"N/A"})}return function(a){return a===void 0&&(a={}),Ln(void 0,void 0,void 0,function(){var c,f,d,h,y,m,b,w,_,E;return Un(this,function(I){switch(I.label){case 0:c=u.getUrl,f=u.method,d=u.defaultParams,h=d===void 0?{}:d,y=Object.assign({},h,a),m=y.envType==="pre"?"pre":"prod",b=[t,m,c(e)].join("/"),I.label=1;case 1:return I.trys.push([1,3,,4]),[4,r({url:b,body:JSON.stringify(y),method:f})];case 2:if(w=I.sent(),w.code)throw ep(w?.message,e,s,w?.code,w?.requestId);return s==="get"&&Object.assign(w,{data:(E=w.data.record)!==null&&E!==void 0?E:w.data}),[2,w];case 3:throw _=I.sent(),new Hr(_?.message||$i,{originError:_});case 4:return[2]}})})}}else{if(!n?.sqlBaseUrl){var l=new Error("不支持的操作: ".concat(s));throw new Hr(l.message||$i,{originError:l,code:Zh,requestId:"N/A"})}return function(a){return Ln(void 0,void 0,void 0,function(){var c,f,d,h,y,m,b,w,_,E,I,R,x,P,D,O;return Un(this,function(C){switch(C.label){case 0:c=a.params,f=a.templateName,d=a.envType,h=d==="pre"?"pre":"prod",y=[n.sqlBaseUrl,h,f,"run"].join("/"),m=Object.entries(c||{}).reduce(function(A,N){var U=N[0],q=N[1];if(q!==void 0){var W="OBJECT",ae=typeof q;switch(ae){case"boolean":{W="BOOLEAN";break}case"number":{W="NUMBER";break}case"string":{W="STRING";break}default:Array.isArray(q)?W="ARRAY":W="OBJECT"}A.push({key:U,type:W,value:W==="STRING"?q:JSON.stringify(q)})}return A},[]),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,r({url:y,body:JSON.stringify({parameter:m}),method:"POST"})];case 2:if(b=C.sent(),!((_=b?.Response)===null||_===void 0)&&_.Error)throw ep((I=(E=b?.Response)===null||E===void 0?void 0:E.Error)===null||I===void 0?void 0:I.Message,e,s,(x=(R=b?.Response)===null||R===void 0?void 0:R.Error)===null||x===void 0?void 0:x.Code,(P=b?.Response)===null||P===void 0?void 0:P.RequestId);return[2,Pe(Pe({},(D=b?.Response)!==null&&D!==void 0?D:{}),{data:(O=b?.Response)===null||O===void 0?void 0:O.Data})];case 3:throw w=C.sent(),new Hr(w?.message||$i,{originError:w});case 4:return[2]}})})}}}});return o},li=function(){return li=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},li.apply(this,arguments)},SE=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},IE=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},OE=bv,tp="models";function AE(t){var e=this,r=t.callFunction.bind(t),n=t.request.fetch.bind(t.request),o=function(f){return SE(e,void 0,void 0,function(){var d;return IE(this,function(h){switch(h.label){case 0:return[4,n(li(li({},f),{headers:li({"Content-Type":"application/json"},f.headers)}))];case 1:return d=h.sent(),[4,d.data];case 2:return[2,h.sent()]}})})},i=t.getEndPointWithKey("GATEWAY"),s=i.BASE_URL,u=i.PROTOCOL,l="".concat(u).concat(s,"/model"),a="".concat(u).concat(s,"/sql"),c=wE(r,o,l,{sqlBaseUrl:a});return c}var rp=new WeakMap;function TE(t){return new Proxy({},{get:function(e,r){var n=rp.get(t);return n||(n=AE(t),rp.set(t,n)),n[r]}})}var v0="cloudbase_init",y0=new OE;y0.on(v0,function(t){var e=t.data;Object.assign(e,{models:TE(e)})});var m0={name:tp,namespace:tp,entity:new Proxy({},{get:function(t,e){console.warn("【deprecated】Accessing Cloudbase.prototype.models.".concat(e,"."))}}),injectEvents:{bus:y0,events:[v0]}};try{cloudbase.registerComponent(m0)}catch{}function RE(t){try{t.registerComponent(m0)}catch(e){console.warn(e)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Oc=function(t,e){return Oc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},Oc(t,e)};function g0(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Oc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function qn(t){if(!t)throw new TypeError("Assertion failed")}function CE(){}function xE(t){return typeof t=="object"&&t!==null||typeof t=="function"}function NE(t){if(typeof t!="function")return!1;var e=!1;try{new t({start:function(){e=!0}})}catch{}return e}function _0(t){return!(!xE(t)||typeof t.getReader!="function")}function PE(t){return!(!NE(t)||!_0(new t))}function b0(t){try{var e=t.getReader({mode:"byob"});return e.releaseLock(),!0}catch{return!1}}function DE(t){try{return new t({type:"bytes"}),!0}catch{return!1}}function LE(t){qn(PE(t));var e=DE(t);return function(r,n){var o=n===void 0?{}:n,i=o.type;if(i=w0(i),i==="bytes"&&!e&&(i=void 0),r.constructor===t&&(i!=="bytes"||b0(r)))return r;if(i==="bytes"){var s=np(r,{type:i});return new t(s)}else{var s=np(r);return new t(s)}}}function np(t,e){var r=e===void 0?{}:e,n=r.type;qn(_0(t)),qn(t.locked===!1),n=w0(n);var o;return n==="bytes"?o=new FE(t):o=new UE(t),o}function w0(t){var e=String(t);if(e==="bytes")return e;if(t===void 0)return t;throw new RangeError("Invalid type is specified")}var E0=(function(){function t(e){this._underlyingReader=void 0,this._readerMode=void 0,this._readableStreamController=void 0,this._pendingRead=void 0,this._underlyingStream=e,this._attachDefaultReader()}return t.prototype.start=function(e){this._readableStreamController=e},t.prototype.cancel=function(e){return qn(this._underlyingReader!==void 0),this._underlyingReader.cancel(e)},t.prototype._attachDefaultReader=function(){if(this._readerMode!=="default"){this._detachReader();var e=this._underlyingStream.getReader();this._readerMode="default",this._attachReader(e)}},t.prototype._attachReader=function(e){var r=this;qn(this._underlyingReader===void 0),this._underlyingReader=e;var n=this._underlyingReader.closed;n&&n.then(function(){return r._finishPendingRead()}).then(function(){e===r._underlyingReader&&r._readableStreamController.close()},function(o){e===r._underlyingReader&&r._readableStreamController.error(o)}).catch(CE)},t.prototype._detachReader=function(){this._underlyingReader!==void 0&&(this._underlyingReader.releaseLock(),this._underlyingReader=void 0,this._readerMode=void 0)},t.prototype._pullWithDefaultReader=function(){var e=this;this._attachDefaultReader();var r=this._underlyingReader.read().then(function(n){var o=e._readableStreamController;n.done?e._tryClose():o.enqueue(n.value)});return this._setPendingRead(r),r},t.prototype._tryClose=function(){try{this._readableStreamController.close()}catch{}},t.prototype._setPendingRead=function(e){var r=this,n,o=function(){r._pendingRead===n&&(r._pendingRead=void 0)};this._pendingRead=n=e.then(o,o)},t.prototype._finishPendingRead=function(){var e=this;if(this._pendingRead){var r=function(){return e._finishPendingRead()};return this._pendingRead.then(r,r)}},t})(),UE=(function(t){g0(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.pull=function(){return this._pullWithDefaultReader()},e})(E0);function ip(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function qE(t,e){var r=ip(t),n=ip(e);n.set(r,0)}var FE=(function(t){g0(e,t);function e(r){var n=this,o=b0(r);return n=t.call(this,r)||this,n._supportsByob=o,n}return Object.defineProperty(e.prototype,"type",{get:function(){return"bytes"},enumerable:!1,configurable:!0}),e.prototype._attachByobReader=function(){if(this._readerMode!=="byob"){qn(this._supportsByob),this._detachReader();var r=this._underlyingStream.getReader({mode:"byob"});this._readerMode="byob",this._attachReader(r)}},e.prototype.pull=function(){if(this._supportsByob){var r=this._readableStreamController.byobRequest;if(r)return this._pullWithByobRequest(r)}return this._pullWithDefaultReader()},e.prototype._pullWithByobRequest=function(r){var n=this;this._attachByobReader();var o=new Uint8Array(r.view.byteLength),i=this._underlyingReader.read(o).then(function(s){n._readableStreamController,s.done?(n._tryClose(),r.respond(0)):(qE(s.value,r.view),r.respond(s.value.byteLength))});return this._setPendingRead(i),i},e})(E0);function BE(t){var e,r,n,o,i,s,u;return l(),{feed:a,reset:l};function l(){e=!0,r="",n=0,o=-1,i=void 0,s=void 0,u=""}function a(f){r=r?r+f:f,e&&jE(r)&&(r=r.slice(S0.length)),e=!1;for(var d=r.length,h=0,y=!1;h<d;){y&&(r[h]===`
`&&(h+=1),y=!1);for(var m=-1,b=o,w=void 0,_=n;m<0&&_<d;_++)w=r[_],w===":"&&b<0?b=_-h:w==="\r"?(y=!0,m=_-h):w===`
`&&(m=_-h);if(m<0){n=d-h,o=b;break}else n=0,o=-1;c(r,h,b,m),h+=m+1}h===d?r="":h>0&&(r=r.slice(h))}function c(f,d,h,y){if(y===0){u.length>0&&(t({type:"event",id:i,event:s||void 0,data:u.slice(0,-1)}),u="",i=void 0),s=void 0;return}var m=h<0,b=f.slice(d,d+(m?y:h)),w=0;m?w=y:f[d+h+1]===" "?w=h+2:w=h+1;var _=d+w,E=y-w,I=f.slice(_,_+E).toString();if(b==="data")u+=I?"".concat(I,`
`):`
`;else if(b==="event")s=I;else if(b==="id"&&!I.includes("\0"))i=I;else if(b==="retry"){var R=parseInt(I,10);Number.isNaN(R)||t({type:"reconnect-interval",value:R})}}}var S0=[239,187,191];function jE(t){return S0.every(function(e,r){return t.charCodeAt(r)===e})}var ao={exports:{}},ME=ao.exports,op;function kE(){return op||(op=1,(function(t,e){(function(r,n){t.exports=n()})(ME,function(){var r=typeof vn<"u"?vn:self;if(typeof r.TextEncoder<"u"&&typeof r.TextDecoder<"u")return{TextEncoder:r.TextEncoder,TextDecoder:r.TextDecoder};var n=["utf8","utf-8","unicode-1-1-utf-8"],o=function(s){if(n.indexOf(s)<0&&typeof s<"u"&&s!==null)throw new RangeError("Invalid encoding type. Only utf-8 is supported");this.encoding="utf-8",this.encode=function(u){if(typeof u!="string")throw new TypeError("passed argument must be of type string");var l=unescape(encodeURIComponent(u)),a=new Uint8Array(l.length);return l.split("").forEach(function(c,f){a[f]=c.charCodeAt(0)}),a}},i=function(s,u){if(n.indexOf(s)<0&&typeof s<"u"&&s!==null)throw new RangeError("Invalid encoding type. Only utf-8 is supported");if(this.encoding="utf-8",this.ignoreBOM=!1,this.fatal=typeof u<"u"&&"fatal"in u?u.fatal:!1,typeof this.fatal!="boolean")throw new TypeError("fatal flag must be boolean");this.decode=function(l,a){if(typeof l>"u")return"";var c=typeof a<"u"&&"stream"in a?a.stream:!1;if(typeof c!="boolean")throw new TypeError("stream option must be boolean");if(ArrayBuffer.isView(l)){var f=new Uint8Array(l.buffer,l.byteOffset,l.byteLength),d=new Array(f.length);return f.forEach(function(h,y){d[y]=String.fromCharCode(h)}),decodeURIComponent(escape(d.join("")))}else throw new TypeError("passed argument must be an array buffer view")}};return{TextEncoder:o,TextDecoder:i}})})(ao)),ao.exports}var $E=kE(),I0=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},O0=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},WE=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(u,l){s=t[i](s),o(u,l,s.done,s.value)})}}function o(i,s,u,l){Promise.resolve(l).then(function(a){i({value:a,done:u})},s)}},GE=De,Ee=vo,A0=function(){var t;return new Ee({start:function(e){t=BE(function(r){r.type==="event"&&e.enqueue(r)})},transform:function(e){t.feed(e)}})},ct=LE(GE),_l=(function(){function t(e,r){e===void 0&&(e="utf-8"),r===void 0&&(r={});var n=this;this.transform=new Ee({transform:function(o,i){var s=n.handle.decode(new Uint8Array(o),{stream:!0});s&&i.enqueue(s)},flush:function(o){var i=n.handle.decode();i&&o.enqueue(i),o.terminate()}}),this.handle=new $E.TextDecoder(e,r)}return Object.defineProperty(t.prototype,"encoding",{get:function(){return this.handle.encoding},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fatal",{get:function(){return this.handle.fatal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignoreBOM",{get:function(){return this.handle.ignoreBOM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readable",{get:function(){return this.transform.readable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"writable",{get:function(){return this.transform.writable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"TextDecoderStream"},enumerable:!1,configurable:!0}),t})();function pe(t){var e=t;return e[Symbol.asyncIterator]=function(){var r=t.getReader();return{next:function(){return I0(this,void 0,void 0,function(){var n,o,i;return O0(this,function(s){switch(s.label){case 0:return[4,r.read()];case 1:return n=s.sent(),o=n.done,i=n.value,[2,o?{done:!0,value:void 0}:{done:!1,value:i}]}})})}}},e}function Pt(t){return pe(t.pipeThrough(new _l).pipeThrough(A0()).pipeThrough(new Ee({transform:function(e,r){try{var n=JSON.parse(e.data);r.enqueue(n)}catch(o){e.data!=="[DONE]"?console.warn("Error when transforming event source data to json",o,e):r.terminate()}}})))}function HE(t){return pe(ct(t).pipeThrough(new _l))}function VE(t){var e,r,n,o;return I0(this,void 0,void 0,function(){var i,s,u,l,a,c,f;return O0(this,function(d){switch(d.label){case 0:i=HE(t),s="",d.label=1;case 1:d.trys.push([1,6,7,12]),u=!0,l=WE(i),d.label=2;case 2:return[4,l.next()];case 3:if(a=d.sent(),e=a.done,!!e)return[3,5];o=a.value,u=!1;try{c=o,s+=c}finally{u=!0}d.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return f=d.sent(),r={error:f},[3,12];case 7:return d.trys.push([7,,10,11]),!u&&!e&&(n=l.return)?[4,n.call(l)]:[3,9];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:return[2,JSON.parse(s)]}})})}function ap(){var t,e,r=new Promise(function(n,o){t=n,e=o});return{promise:r,res:t,rej:e}}function wt(t){var e;return t.role==="assistant"&&"tool_calls"in t&&((e=t.tool_calls)===null||e===void 0?void 0:e[0])!=null}function KE(t){return{type:"function",function:{description:t.description,name:t.name,parameters:t.parameters}}}var hr=function(){return hr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},hr.apply(this,arguments)},At=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Tt=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Wi=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r},JE=(function(){function t(e,r){this.baseUrl=r;var n=arguments[2];typeof n=="string"?this.req=function(o){var i=o.headers,s=i===void 0?{}:i,u=Wi(o,["headers"]);return e(hr(hr({},u),{headers:hr(hr({},s),{Authorization:"Bearer ".concat(n)})}))}:this.req=e}return t.prototype.list=function(e,r){return this.req({method:"get",url:this.join("bots"),data:e,timeout:r?.timeout})},t.prototype.create=function(e,r){var n=e.botInfo;return this.req({method:"post",url:this.join("bots"),data:n,timeout:r?.timeout})},t.prototype.get=function(e,r){var n=e.botId;return this.req({method:"get",url:this.join("bots/".concat(n)),timeout:r?.timeout})},t.prototype.update=function(e,r){var n=e.botId,o=e.botInfo;return this.req({method:"PATCH",url:this.join("bots/".concat(n)),data:o,timeout:r?.timeout})},t.prototype.delete=function(e,r){var n=e.botId;return this.req({method:"delete",url:this.join("bots/".concat(n)),timeout:r?.timeout})},t.prototype.getChatRecords=function(e,r){return this.req({method:"get",url:this.join("bots/".concat(e.botId,"/records")),data:e,timeout:r?.timeout})},t.prototype.sendFeedback=function(e,r){var n=e.userFeedback;return this.req({method:"post",url:this.join("bots/".concat(n.botId,"/feedback")),data:n,timeout:r?.timeout})},t.prototype.getFeedback=function(e,r){return this.req({method:"get",url:this.join("bots/".concat(e.botId,"/feedback")),data:e,timeout:r?.timeout})},t.prototype.uploadFiles=function(e,r){return At(this,void 0,void 0,function(){return Tt(this,function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/files")),data:e,timeout:r?.timeout})]})})},t.prototype.createConversation=function(e,r){var n=e.botId,o=Wi(e,["botId"]);return At(this,void 0,void 0,function(){return Tt(this,function(i){return[2,this.req({method:"post",url:this.join("bots/".concat(n,"/conversation")),data:o,timeout:r?.timeout})]})})},t.prototype.getConversation=function(e,r){var n=e.pageSize,o=n===void 0?10:n,i=e.pageNumber,s=i===void 0?1:i,u=e.botId,l=Wi(e,["pageSize","pageNumber","botId"]);return At(this,void 0,void 0,function(){var a,c;return Tt(this,function(f){if(s<1)throw new Error("pageNumber must be greater than 0");return a=o*(s-1),c=o,[2,this.req({method:"get",url:this.join("bots/".concat(u,"/conversation")),data:hr(hr({},l),{offset:a,limit:c}),timeout:r?.timeout})]})})},t.prototype.deleteConversation=function(e,r){var n=e.botId,o=e.conversationId,i=Wi(e,["botId","conversationId"]);return At(this,void 0,void 0,function(){return Tt(this,function(s){return[2,this.req({method:"delete",url:this.join("bots/".concat(n,"/conversation/").concat(o)),data:i,timeout:r?.timeout})]})})},t.prototype.speechToText=function(e,r){return At(this,void 0,void 0,function(){return Tt(this,function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/speech-to-text")),data:e,timeout:r?.timeout})]})})},t.prototype.textToSpeech=function(e,r){return At(this,void 0,void 0,function(){return Tt(this,function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/text-to-speech")),data:e,timeout:r?.timeout})]})})},t.prototype.getTextToSpeechResult=function(e,r){return At(this,void 0,void 0,function(){return Tt(this,function(n){return[2,this.req({method:"get",url:this.join("bots/".concat(e.botId,"/text-to-speech")),data:e,timeout:r?.timeout})]})})},t.prototype.getRecommendQuestions=function(e,r){return At(this,void 0,void 0,function(){var n;return Tt(this,function(o){switch(o.label){case 0:return[4,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/recommend-questions")),data:e,stream:!0,timeout:r?.timeout})];case 1:return n=o.sent(),[2,new Gi(n)]}})})},t.prototype.generateBot=function(e,r){return At(this,void 0,void 0,function(){var n;return Tt(this,function(o){switch(o.label){case 0:return[4,this.req({method:"post",url:this.join("generate-bot"),data:e,stream:!0,timeout:r?.timeout})];case 1:return n=o.sent(),[2,new Gi(n)]}})})},t.prototype.getPreview=function(e,r){return At(this,void 0,void 0,function(){var n;return Tt(this,function(o){switch(o.label){case 0:return[4,this.req({method:"post",url:this.join("preview"),data:e,stream:!0,timeout:r?.timeout})];case 1:return n=o.sent(),[2,new Gi(n)]}})})},t.prototype.generateImage=function(e,r){return this.req({method:"post",url:this.join("generate-image"),data:e,timeout:r?.timeout})},t.prototype.sendMessage=function(e,r){return At(this,void 0,void 0,function(){var n;return Tt(this,function(o){switch(o.label){case 0:return[4,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/send-message")),data:e,stream:!0,timeout:r?.timeout})];case 1:return n=o.sent(),[2,new Gi(n)]}})})},t.prototype.join=function(e){return"".concat(this.baseUrl,"/").concat(e)},t})(),Gi=(function(){function t(e){var r=ct(e);this._eventSourceStream=r.pipeThrough(new _l).pipeThrough(A0())}return Object.defineProperty(t.prototype,"teeedStream",{get:function(){var e=this._eventSourceStream.tee(),r=e[0],n=e[1];return this._eventSourceStream=n,r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventSourceStream",{get:function(){return pe(this.teeedStream)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataStream",{get:function(){return pe(this.eventSourceStream.pipeThrough(new Ee({transform:function(e,r){try{var n=JSON.parse(e.data);r.enqueue(n)}catch(o){e.data!=="[DONE]"?console.warn("Error when transforming event source data to json",o,e):r.terminate()}}})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textStream",{get:function(){return pe(this.dataStream.pipeThrough(new Ee({transform:function(e,r){var n;r.enqueue((n=e?.content)!==null&&n!==void 0?n:"")}})))},enumerable:!1,configurable:!0}),t})(),Fe=function(){return Fe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Fe.apply(this,arguments)},sp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},up=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function cp(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tool_choice,i=t.tools,s=t.top_p,u=function(){return o&&o!=="auto"&&console.warn("`tool_choice` is not 'auto'"),o};return Fe(Fe({},t),{messages:e,model:r,temperature:n,tool_choice:u(),tools:i,top_p:s})}var T0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="zhipu/api/paas/v4/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return sp(this,void 0,void 0,function(){var n,o;return up(this,function(i){switch(i.label){case 0:return n=cp(e),[4,this.req({url:this.url,data:Fe(Fe({},n),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return o=i.sent(),[2,Fe(Fe({},o),{rawResponse:o})]}})})},t.prototype.doStream=function(e,r){return sp(this,void 0,void 0,function(){var n,o,i,s,u,l;return up(this,function(a){switch(a.label){case 0:return n=cp(e),o=null,[4,this.req({url:this.url,data:Fe(Fe({},n),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return i=a.sent(),s=ct(i),u=Pt(s),l=u.pipeThrough(new Ee({transform:function(c,f){var d=c.choices.map(function(y){var m=y.delta;return o==null&&(o=wt(m)),o?Fe(Fe({},y),{finish_reason:"tool_calls",delta:m}):y}),h=Fe(Fe({},c),{choices:d});f.enqueue(Fe(Fe({},h),{rawResponse:c}))}})),[2,pe(l)]}})})},t})(),Io=function(){return Io=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Io.apply(this,arguments)};function nn(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tool_choice,i=t.tools,s=t.top_p,u=function(){if(i)return i.forEach(function(a){a.type!=="function"&&console.warn("`type` in tool is not 'function'",a)}),i},l=function(){return e.forEach(function(a){"tool_calls"in a&&a.tool_calls.filter(function(c){return c.type!=="function"}).forEach(function(c){return console.warn("`type` in tool_call is not 'function'",c,a)})}),e};return Io(Io({},t),{messages:l(),model:r,tools:u(),top_p:s,tool_choice:o,temperature:n})}function Oo(t){if(typeof t!="object"||t==null)return t;if(Array.isArray(t))return t.map(function(r){return Oo(r)});return Object.entries(t).reduce(function(r,n){var o=n[0],i=n[1],s=e(o);return r[s]=typeof i=="object"?Oo(i):i,r},{});function e(r){var n=r.replace(/[A-Z]/g,function(o){return"_".concat(o.toLowerCase())});return n.charAt(0)==="_"?n.slice(1):n}}var Je=function(){return Je=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Je.apply(this,arguments)},lp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},fp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="hunyuan-beta/openapi/v1/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return lp(this,void 0,void 0,function(){var n;return fp(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:Je(Je({},nn(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,Je(Je({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return lp(this,void 0,void 0,function(){var n,o,i,s,u;return fp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:Je(Je({},nn(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=h.delta;return n==null&&(n=wt(y)),n?Je(Je({},h),{finish_reason:"tool_calls",delta:y}):h}),d=Je(Je({},a),{choices:f});c.enqueue(Je(Je({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),ze=function(){return ze=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ze.apply(this,arguments)},dp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},hp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},C0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="hunyuan",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return dp(this,void 0,void 0,function(){var n,o;return hp(this,function(i){switch(i.label){case 0:return[4,this.req({url:this.url,headers:{"X-Tc-Action":"ChatCompletions"},data:ze(ze({},nn(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=i.sent(),o=Oo(n.Response),[2,ze(ze({},o),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return dp(this,void 0,void 0,function(){var n,o,i,s,u;return hp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,headers:{"X-Tc-Action":"ChatCompletions"},data:ze(ze({},e),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=Oo(a),d=f.choices.map(function(y){var m=y.delta;return n==null&&(n=wt(m)),n?ze(ze({},y),{finish_reason:"tool_calls",delta:m}):y}),h=ze(ze({},f),{choices:d});c.enqueue(ze(ze({},h),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),Be=function(){return Be=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Be.apply(this,arguments)},pp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},vp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function yp(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tools,i=t.top_p;return Be(Be({},t),{messages:e,model:r,tools:o,top_p:i,temperature:n})}var x0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="ark/api/v3/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return pp(this,void 0,void 0,function(){var n;return vp(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:Be(Be({},yp(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,Be(Be({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return pp(this,void 0,void 0,function(){var n,o,i,s,u;return vp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:Be(Be({},yp(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=h.delta;return n==null&&(n=wt(y)),n?Be(Be({},h),{finish_reason:"tool_calls",delta:y}):h}),d=Be(Be({},a),{choices:f});c.enqueue(Be(Be({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),xe=function(){return xe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},xe.apply(this,arguments)},mp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},gp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function _p(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tools,i=t.top_p;return xe(xe({},t),{messages:e,model:r,tools:o,top_p:i,temperature:n})}var N0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="dashscope/compatible-mode/v1/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return mp(this,void 0,void 0,function(){var n;return gp(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:xe(xe({},_p(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,xe(xe({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return mp(this,void 0,void 0,function(){var n,o,i,s,u;return gp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:xe(xe({},_p(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=Object.assign(h.delta,{role:"assistant"});return n==null&&(n=wt(y)),n?xe(xe({},h),{finish_reason:"tool_calls",delta:y}):xe(xe({},h),{delta:y})}),d=xe(xe({},a),{choices:f});c.enqueue(xe(xe({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),Ne=function(){return Ne=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ne.apply(this,arguments)},bp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},wp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Ep(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tools,i=t.top_p;return Ne(Ne({},t),{messages:e,model:r,tools:o,top_p:i,temperature:n})}var P0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="01-ai/v1/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return bp(this,void 0,void 0,function(){var n;return wp(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:Ne(Ne({},Ep(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,Ne(Ne({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return bp(this,void 0,void 0,function(){var n,o,i,s,u;return wp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:Ne(Ne({},Ep(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f,d,h,y,m,b;if(!((h=(d=(f=a?.choices)===null||f===void 0?void 0:f[0])===null||d===void 0?void 0:d.delta)===null||h===void 0)&&h.content||!((b=(m=(y=a?.choices)===null||y===void 0?void 0:y[0])===null||m===void 0?void 0:m.delta)===null||b===void 0)&&b.tool_calls){var w=a.choices.map(function(E){var I=Object.assign(E.delta,{role:"assistant"});return n==null&&(n=wt(I)),n?Ne(Ne({},E),{finish_reason:"tool_calls",delta:I}):Ne(Ne({},E),{delta:I})}),_=Ne(Ne({},a),{choices:w});c.enqueue(Ne(Ne({},_),{rawResponse:a}))}}})),[2,pe(u)]}})})},t})(),je=function(){return je=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},je.apply(this,arguments)},Sp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Ip=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Op(t){var e=t.messages,r=t.model,n=t.temperature,o=t.tools,i=t.top_p;return je(je({},t),{messages:e,model:r,tools:o,top_p:i,temperature:n})}var D0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="moonshot/v1/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return Sp(this,void 0,void 0,function(){var n;return Ip(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:je(je({},Op(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,je(je({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return Sp(this,void 0,void 0,function(){var n,o,i,s,u;return Ip(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:je(je({},Op(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=h.delta;return n==null&&(n=wt(y)),n?je(je({},h),{finish_reason:"tool_calls",delta:y}):h}),d=je(je({},a),{choices:f});c.enqueue(je(je({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),Ye=function(){return Ye=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ye.apply(this,arguments)},Ap=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Tp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},L0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="hunyuan-exp/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e){return Ap(this,void 0,void 0,function(){var r;return Tp(this,function(n){switch(n.label){case 0:return[4,this.req({url:this.url,data:Ye(Ye({},nn(e)),{stream:!1}),stream:!1})];case 1:return r=n.sent(),[2,Ye(Ye({},r),{rawResponse:r})]}})})},t.prototype.doStream=function(e){return Ap(this,void 0,void 0,function(){var r,n,o,i,s;return Tp(this,function(u){switch(u.label){case 0:return r=null,[4,this.req({url:this.url,data:Ye(Ye({},nn(e)),{stream:!0}),stream:!0})];case 1:return n=u.sent(),o=ct(n),i=Pt(o),s=i.pipeThrough(new Ee({transform:function(l,a){var c=l.choices.map(function(d){var h=d.delta;return r==null&&(r=wt(h)),r?Ye(Ye({},d),{finish_reason:"tool_calls",delta:h}):d}),f=Ye(Ye({},l),{choices:c});a.enqueue(Ye(Ye({},f),{rawResponse:l}))}})),[2,pe(s)]}})})},t})(),Qe=function(){return Qe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Qe.apply(this,arguments)},Rp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Cp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},U0=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="hunyuan-open/v1/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return Rp(this,void 0,void 0,function(){var n;return Cp(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:Qe(Qe({},nn(e)),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,Qe(Qe({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return Rp(this,void 0,void 0,function(){var n,o,i,s,u;return Cp(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:Qe(Qe({},nn(e)),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=h.delta;return n==null&&(n=wt(y)),n?Qe(Qe({},h),{finish_reason:"tool_calls",delta:y}):h}),d=Qe(Qe({},a),{choices:f});c.enqueue(Qe(Qe({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),Xe=function(){return Xe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Xe.apply(this,arguments)},xp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Np=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},zE=(function(){function t(e,r,n){this.req=e,this.baseUrl=r,this.subUrl="deepseek/chat/completions",n!=null&&(this.subUrl=n)}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e,r){return xp(this,void 0,void 0,function(){var n;return Np(this,function(o){switch(o.label){case 0:return[4,this.req({url:this.url,data:Xe(Xe({},e),{stream:!1}),stream:!1,timeout:r?.timeout})];case 1:return n=o.sent(),[2,Xe(Xe({},n),{rawResponse:n})]}})})},t.prototype.doStream=function(e,r){return xp(this,void 0,void 0,function(){var n,o,i,s,u;return Np(this,function(l){switch(l.label){case 0:return n=null,[4,this.req({url:this.url,data:Xe(Xe({},e),{stream:!0}),stream:!0,timeout:r?.timeout})];case 1:return o=l.sent(),i=ct(o),s=Pt(i),u=s.pipeThrough(new Ee({transform:function(a,c){var f=a.choices.map(function(h){var y=h.delta;return n==null&&(n=wt(y)),n?Xe(Xe({},h),{finish_reason:"tool_calls",delta:y}):h}),d=Xe(Xe({},a),{choices:f});c.enqueue(Xe(Xe({},d),{rawResponse:a}))}})),[2,pe(u)]}})})},t})(),Ze=function(){return Ze=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ze.apply(this,arguments)},Pp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Dp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},q0=(function(){function t(e,r,n){n===void 0&&(n=""),this.req=e,this.baseUrl=r,this.subUrl=n}return Object.defineProperty(t.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),t.prototype.doGenerate=function(e){return Pp(this,void 0,void 0,function(){var r;return Dp(this,function(n){switch(n.label){case 0:return[4,this.req({url:this.url,data:Ze(Ze({},e),{stream:!1}),stream:!1})];case 1:return r=n.sent(),[2,Ze(Ze({},r),{rawResponse:r})]}})})},t.prototype.doStream=function(e){return Pp(this,void 0,void 0,function(){var r,n,o,i,s;return Dp(this,function(u){switch(u.label){case 0:return r=null,[4,this.req({url:this.url,data:Ze(Ze({},e),{stream:!0}),stream:!0})];case 1:return n=u.sent(),o=ct(n),i=Pt(o),s=i.pipeThrough(new Ee({transform:function(l,a){var c=l.choices.map(function(d){var h=d.delta;return r==null&&(r=wt(h)),r?Ze(Ze({},d),{finish_reason:"tool_calls",delta:h}):d}),f=Ze(Ze({},l),{choices:c});a.enqueue(Ze(Ze({},f),{rawResponse:l}))}})),[2,pe(s)]}})})},t})(),Ao=function(){return Ao=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ao.apply(this,arguments)},Ac=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Tc=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},YE=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r},QE=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(u,l){s=t[i](s),o(u,l,s.done,s.value)})}}function o(i,s,u,l){Promise.resolve(l).then(function(a){i({value:a,done:u})},s)}},Ft=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))};function Lp(t){var e,r=t.onStepFinish,n=t.abortSignal,o=t.maxSteps,i=t.topP,s=t.toolChoice,u=YE(t,["onStepFinish","abortSignal","maxSteps","topP","toolChoice"]);if(o!=null&&o<1)throw new Error("`maxSteps` muse be greater than 0.");return[{onStepFinish:r,abortSignal:n,maxSteps:o},Ao(Ao({},u),{tools:(e=u.tools)===null||e===void 0?void 0:e.map(function(l){return"fn"in l?KE(l):l}),top_p:i??u.top_p,tool_choice:s??u.tool_choice})]}var F0=(function(){function t(e){this.model=e}return t.prototype.generateText=function(e,r){var n,o;return Ac(this,void 0,void 0,function(){var i,s,u,l,a,c,f,d,h,y,m,b,w,_,E,I,R,x,P,D,O,C=this;return Tc(this,function(A){switch(A.label){case 0:return i=[],s={completion_tokens:0,prompt_tokens:0,total_tokens:0},u=Lp(e),l=u[0],a=l.onStepFinish,c=l.maxSteps,f=c===void 0?10:c,d=u[1],h=function(){return C.model.doGenerate(d,r)},[4,h()];case 1:y=A.sent(),m=1,y.rawResponse&&i.push(y.rawResponse),b=null,A.label=2;case 2:if(!(m<f&&(b=Up(y))!=null))return[3,9];w=Bp(y.usage),Jn(s,w),A.label=3;case 3:return A.trys.push([3,7,,8]),[4,Fp(b)];case 4:return _=A.sent(),E=y.choices[0],[4,a?.({finishReason:E.finish_reason,messages:d.messages.slice(),text:E.message.content,toolCall:b,toolResult:_,stepUsage:w,totalUsage:Object.assign({},s)})];case 5:return A.sent(),qp(d.messages,E.message,_),[4,h()];case 6:return y=A.sent(),y.rawResponse&&i.push(y.rawResponse),m+=1,[3,8];case 7:return I=A.sent(),[2,{text:"",messages:d.messages,usage:s,error:I,rawResponses:i}];case 8:return[3,2];case 9:return R=(n=y?.choices)===null||n===void 0?void 0:n[0],x=R?.message,P=(o=x?.content)!==null&&o!==void 0?o:"",D=x?Ft(Ft([],d.messages,!0),[x],!1):d.messages,O=Bp(y.usage),Jn(s,O),[4,a?.({finishReason:R.finish_reason,messages:D.slice(),text:P,toolCall:Up(y),toolResult:null,stepUsage:O,totalUsage:Object.assign({},s)})];case 10:return A.sent(),[2,{text:P,messages:D,usage:s,rawResponses:i}]}})})},t.prototype.streamText=function(e,r){var n;return Ac(this,void 0,void 0,function(){var o,i,s,u,l,a,c,f,d,h,y,m,b,w,_,E,I,R,x,P,D,O,C,A,N,U,q,W,ae,z,Q,H,K,ve,Dt,Jt,Lt=this;return Tc(this,function(Le){switch(Le.label){case 0:return o={completion_tokens:0,prompt_tokens:0,total_tokens:0},i=Lp(e),s=i[0],u=s.onStepFinish,l=s.maxSteps,a=l===void 0?10:l,c=i[1],f=function(){return Lt.model.doStream(c,r)},[4,f()];case 1:d=Le.sent(),h=1,y=null,m=function(){var ee=d.tee(),ke=ee[0],me=ee[1];return d=pe(ke),XE(me)},Le.label=2;case 2:return b=h<a,b?[4,m()]:[3,4];case 3:b=(y=Le.sent())!=null,Le.label=4;case 4:if(!b)return[3,11];w=y.message,_=y.usage,Jn(o,_),E=(n=w.tool_calls)===null||n===void 0?void 0:n[0],Le.label=5;case 5:return Le.trys.push([5,9,,10]),[4,Fp(E)];case 6:return I=Le.sent(),[4,u?.({finishReason:"tool_calls",messages:c.messages.slice(),text:w.content,toolCall:E,toolResult:I,stepUsage:_,totalUsage:Object.assign({},o)})];case 7:return Le.sent(),qp(c.messages,w,I),[4,f()];case 8:return d=Le.sent(),[3,10];case 9:return R=Le.sent(),x=d.tee(),P=x[0],D=x[1],[2,{messages:Promise.resolve(c.messages),dataStream:pe(P),textStream:pe(D.pipeThrough(new Ee({transform:function(ee,ke){var me,Se,be,Ie=(be=(Se=(me=ee?.choices)===null||me===void 0?void 0:me[0])===null||Se===void 0?void 0:Se.delta)===null||be===void 0?void 0:be.content;typeof Ie=="string"&&ke.enqueue(Ie)}}))),usage:Promise.resolve(o),error:R}];case 10:return[3,2];case 11:return[4,m()];case 12:return y=Le.sent(),y?(O=y.message,C=y.usage,Jn(o,C),A=Ft(Ft([],c.messages,!0),[O],!1),u({messages:A.slice(),finishReason:"tool_call",stepUsage:C,text:O.content,toolCall:O.tool_calls[0],totalUsage:Object.assign({},o)}),N=d.tee(),U=N[0],q=N[1],[2,{messages:Promise.resolve(Ft(Ft([],c.messages,!0),[O],!1)),dataStream:pe(U),textStream:pe(q.pipeThrough(new Ee({transform:function(ee,ke){var me,Se,be,Ie=(be=(Se=(me=ee?.choices)===null||me===void 0?void 0:me[0])===null||Se===void 0?void 0:Se.delta)===null||be===void 0?void 0:be.content;typeof Ie=="string"&&ke.enqueue(Ie)}}))),usage:Promise.resolve(o)}]):(W=ap(),ae=ap(),z={role:"assistant",content:""},Q="",H={completion_tokens:0,prompt_tokens:0,total_tokens:0},K=d.pipeThrough(new Ee({transform:function(ee,ke){var me,Se,be,Ie,Ue,zt,Or,g,p=(be=(Se=(me=ee?.choices)===null||me===void 0?void 0:me[0])===null||Se===void 0?void 0:Se.delta)===null||be===void 0?void 0:be.content;typeof p=="string"&&(z.content+=p);var v=(Ue=(Ie=ee?.choices)===null||Ie===void 0?void 0:Ie[0])===null||Ue===void 0?void 0:Ue.finish_reason;v&&(Q=v),!((zt=ee?.usage)===null||zt===void 0)&&zt.completion_tokens&&(H.completion_tokens=ee.usage.completion_tokens),!((Or=ee?.usage)===null||Or===void 0)&&Or.prompt_tokens&&(H.prompt_tokens=ee.usage.prompt_tokens),!((g=ee?.usage)===null||g===void 0)&&g.total_tokens&&(H.total_tokens=ee.usage.total_tokens),ke.enqueue(ee)},flush:function(){W.res(Ft(Ft([],c.messages,!0),[z],!1)),Jn(o,H),ae.res(Object.assign({},o)),u?.({messages:Ft(Ft([],c.messages,!0),[z],!1),finishReason:Q,text:z.content,stepUsage:H,totalUsage:Object.assign({},o)})}})),ve=K.tee(),Dt=ve[0],Jt=ve[1],[2,{messages:W.promise,dataStream:pe(Dt),textStream:pe(Jt.pipeThrough(new Ee({transform:function(ee,ke){var me,Se,be,Ie=(be=(Se=(me=ee?.choices)===null||me===void 0?void 0:me[0])===null||Se===void 0?void 0:Se.delta)===null||be===void 0?void 0:be.content;typeof Ie=="string"&&ke.enqueue(Ie)}}))),usage:ae.promise}])}})})},t})();function Up(t){var e,r=(e=t?.choices)===null||e===void 0?void 0:e[0];if(!r)return null;var n=r.finish_reason,o=r.message;return n!=="tool_calls"||!o||!wt(o)?null:o.tool_calls[0]}function qp(t,e,r){t.push(e,{role:"tool",tool_call_id:e.tool_calls[0].id,content:JSON.stringify(r)})}function XE(t){var e,r,n,o,i,s,u,l,a,c;return Ac(this,void 0,void 0,function(){var f,d,h,y,m,b,w,_,E,I,R,x,P;return Tc(this,function(D){switch(D.label){case 0:f={completion_tokens:0,prompt_tokens:0,total_tokens:0},d=pe(t),h={id:"",function:{name:"",arguments:""},type:""},y={role:"assistant",content:"",tool_calls:[h]},D.label=1;case 1:D.trys.push([1,6,7,12]),m=!0,b=QE(d),D.label=2;case 2:return[4,b.next()];case 3:if(w=D.sent(),e=w.done,!!e)return[3,5];o=w.value,m=!1;try{if(_=o,E=_?.choices[0],!E)return[2,null];if(I=E.finish_reason,R=E.delta,I!=="tool_calls")return[2,null];if(!R)return[3,4];if(R.content&&(y.content+=R.content),!("tool_calls"in R))return[3,4];x=(i=R?.tool_calls)===null||i===void 0?void 0:i[0],x?.id&&(h.id=x.id),x?.type&&(h.type=x.type),!((s=x?.function)===null||s===void 0)&&s.name&&(h.function.name=x.function.name),!((u=x?.function)===null||u===void 0)&&u.arguments&&(h.function.arguments+=x.function.arguments),!((l=_?.usage)===null||l===void 0)&&l.completion_tokens&&(f.completion_tokens=_.usage.completion_tokens),!((a=_?.usage)===null||a===void 0)&&a.prompt_tokens&&(f.prompt_tokens=_.usage.prompt_tokens),!((c=_?.usage)===null||c===void 0)&&c.total_tokens&&(f.total_tokens=_.usage.total_tokens)}finally{m=!0}D.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return P=D.sent(),r={error:P},[3,12];case 7:return D.trys.push([7,,10,11]),!m&&!e&&(n=b.return)?[4,n.call(b)]:[3,9];case 8:D.sent(),D.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:return[2,{message:y,usage:f}]}})})}var To=new Map;function Fp(t){return To.get(t.function.name)(JSON.parse(t.function.arguments))}function Bp(t){var e,r,n;return{completion_tokens:(e=t?.completion_tokens)!==null&&e!==void 0?e:0,prompt_tokens:(r=t?.prompt_tokens)!==null&&r!==void 0?r:0,total_tokens:(n=t?.total_tokens)!==null&&n!==void 0?n:0}}function Jn(t,e){t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens}var B0={hunyuan:C0,"hunyuan-beta":R0,ark:x0,dashscope:N0,"01-ai":P0,moonshot:D0,zhipu:T0,"hunyuan-exp":L0,"hunyuan-open":U0,deepseek:zE};const ZE=Object.freeze(Object.defineProperty({__proto__:null,ArkSimpleModel:x0,DSSimpleModel:N0,DefaultSimpleModel:q0,HunYuanBetaSimpleModel:R0,HunYuanExpSimpleModel:L0,HunYuanOpenSimpleModel:U0,HunYuanSimpleModel:C0,MODELS:B0,MoonshotSimpleModel:D0,ReactModel:F0,YiSimpleModel:P0,ZhiPuSimpleModel:T0,toolMap:To},Symbol.toStringTag,{value:"Module"}));var bn=function(){return bn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},bn.apply(this,arguments)},zu=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Yu=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Qu=B0,e1=(function(){function t(e,r,n){var o=this;this.req=e,this.baseUrl=r,this.modelRequest=function(i){var s=i.url,u=i.data,l=i.headers,a=i.stream,c=i.timeout;return zu(o,void 0,void 0,function(){var f,d,h,y,m,b,w;return Yu(this,function(_){switch(_.label){case 0:return f={"Content-Type":"application/json"},a&&Object.assign(f,{Accept:"text/event-stream"}),[4,this.req.fetch({method:"post",headers:bn(bn((m={},m[(b=this.i18n)===null||b===void 0?void 0:b.LANG_HEADER_KEY]=(w=this.i18n)===null||w===void 0?void 0:w.lang,m),f),l),body:JSON.stringify(u),url:s,stream:a,timeout:c})];case 1:return d=_.sent(),h=d.data,y=d.header,[2,this.handleResponseData(h,y)]}})})},this.botRequest=function(i){var s=i.method,u=i.url,l=i.data,a=l===void 0?{}:l,c=i.headers,f=i.stream,d=i.timeout;return zu(o,void 0,void 0,function(){function h(x){return Object.entries(x).map(function(P){var D=P[0],O=P[1];return"".concat(D,"=").concat(O)}).join("&")}var y,m,b,w,_,E,I,R;return Yu(this,function(x){switch(x.label){case 0:return s!=="get"?[3,2]:(y=this.handleResponseData,[4,this.req.fetch({url:"".concat(u,"?").concat(h(a)),method:s,headers:c,stream:f,timeout:d})]);case 1:return[2,y.apply(this,[x.sent().data])];case 2:return m={"Content-Type":"application/json"},f&&Object.assign(m,{Accept:"text/event-stream"}),[4,this.req.fetch({url:u,body:JSON.stringify(a),headers:bn(bn((E={},E[(I=this.i18n)===null||I===void 0?void 0:I.LANG_HEADER_KEY]=(R=this.i18n)===null||R===void 0?void 0:R.lang,E),m),c),stream:f,method:s,timeout:d})];case 3:return b=x.sent(),w=b.data,_=b.header,[2,this.handleResponseData(w,_)]}})})},this.aiBaseUrl="".concat(r,"/ai"),this.aiBotBaseUrl="".concat(r,"/aibot"),this.bot=new JE(this.botRequest,this.aiBotBaseUrl),this.i18n=n,Bo.on(jo,function(i){var s;o.i18n=((s=i.data)===null||s===void 0?void 0:s.i18n)||o.i18n})}return t.prototype.handleResponseData=function(e,r){var n,o;return zu(this,void 0,void 0,function(){var i,s,s;return Yu(this,function(u){switch(u.label){case 0:return i="".concat(this.i18n.t("请检查调用方式，或前往云开发 AI+ 首页查看文档"),"：https://tcb.cloud.tencent.com/dev#/ai"),typeof e=="object"&&e&&"then"in e?[4,e]:[3,2];case 1:if(s=u.sent(),typeof s=="object"&&s&&"code"in s&&s.code!=="NORMAL")throw new Error("".concat(this.i18n.t("AI+ 请求出错，错误码"),"：").concat(s.code,"，").concat(this.i18n.t("错误信息"),"：").concat(s.message,`
`).concat(i,`
`).concat(JSON.stringify(s,null,2)));return[2,e];case 2:return!((o=(n=r?.get)===null||n===void 0?void 0:n.call(r,"content-type"))===null||o===void 0)&&o.includes("application/json")?[4,VE(e)]:[3,4];case 3:if(s=u.sent(),typeof s=="object"&&s&&"code"in s&&s.code!=="NORMAL")throw new Error("".concat(this.i18n.t("AI+ 请求出错，错误码"),"：").concat(s.code,"，").concat(this.i18n.t("错误信息"),"：").concat(s.message,`
`).concat(i,`
`).concat(JSON.stringify(s,null,2)));u.label=4;case 4:return[2,e]}})})},t.prototype.createModel=function(e,r){var n,o=Qu[e];if(o)n=new o(this.modelRequest,this.aiBaseUrl);else{var i=typeof r?.defaultModelSubUrl=="string"?r.defaultModelSubUrl:"/chat/completions";n=new q0(this.modelRequest,this.aiBaseUrl,"".concat(e).concat(i))}var s=new F0(n);return s},t.prototype.registerModel=function(e,r){if(Qu[e]!=null){console.warn("AI model ".concat(e," already exists!"));return}Qu[e]=r},t.prototype.registerFunctionTool=function(e){To.has(e.name)&&console.warn("AI function tool ".concat(e.name," already exists and will be overwritten!")),To.set(e.name,e.fn)},t})(),Ro=function(){return Ro=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ro.apply(this,arguments)},t1=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},r1=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},j0=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r},n1="ai";j0(ZE,["MODELS"]);var i1=function(t){var e=t.getAccessToken,r=t.req,n=function(o){return t1(void 0,void 0,void 0,function(){var i,s,u,l,a;return r1(this,function(c){switch(c.label){case 0:if(typeof r.fetch!="function")throw new Error("req.fetch is not a function");return i=o.token,s=o.headers,u=s===void 0?{}:s,l=j0(o,["token","headers"]),i==null?[3,1]:(a=i,[3,3]);case 1:return[4,e()];case 2:a=c.sent().accessToken,c.label=3;case 3:return[2,r.fetch(Ro({headers:Ro({Authorization:"Bearer ".concat(a)},u)},l))]}})})};return{download:r.download,post:r.post,upload:r.upload,fetch:n}};function o1(t){var e=t.env,r=t.baseUrl,n=t.req,o=t.getAccessToken,i=t.handleReqInstance,s=t.i18n,u=function(){if(r!=null)return r;if(e==null)throw new Error("`env` is required when `baseUrl` is not provided!");return"https://".concat(e,".api.tcloudbasegateway.com/v1")},l=function(){if(i==null){if(o==null)throw new Error("`getAccessToken` is required when `handleReqInstance` is not provided!");return i1({req:n,getAccessToken:o})}return i({req:n})};return new e1(l(),u(),s)}function a1(t){var e=this,r,n=this.request;if(n.fetch==null)throw new Error("cloudbase.request.fetch() unimplemented!");var o=function(){var s=e.getEndPointWithKey("GATEWAY"),u=s.BASE_URL,l=s.PROTOCOL;return"".concat(l).concat(u)},i=(r=t?.baseUrl)!==null&&r!==void 0?r:o();return o1({req:n,baseUrl:i,handleReqInstance:function(s){var u=s.req;return u},i18n:this.config.i18n})}var s1={name:n1,entity:{ai:a1}};function u1(t){try{t.registerComponent(s1)}catch(e){console.warn(e)}}var Lr,tr;(function(t){t.DocIDError="文档ID不合法",t.CollNameError="集合名称不合法",t.OpStrError="操作符不合法",t.DirectionError="排序字符不合法",t.IntergerError="must be integer",t.QueryParamTypeError="查询参数必须为对象",t.QueryParamValueError="查询参数对象值不能均为undefined"})(tr||(tr={}));var de={Number:"Number",Object:"Object",Array:"Array",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",ServerDate:"ServerDate",BsonDate:"BsonDate"},c1=["desc","asc"],l1=["<","<=","==",">=",">"],$r;(function(t){t.lt="<",t.gt=">",t.lte="<=",t.gte=">=",t.eq="=="})($r||($r={}));Lr={},Lr[$r.eq]="$eq",Lr[$r.lt]="$lt",Lr[$r.lte]="$lte",Lr[$r.gt]="$gt",Lr[$r.gte]="$gte";var Ht;(function(t){t.WHERE="WHERE",t.DOC="DOC"})(Ht||(Ht={}));var f1=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),Hi=[],jp={},d1=(function(){function t(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}return t})(),lt=(function(t){f1(e,t);function e(r,n){var o=this;if(n!==jp)throw new TypeError("InternalSymbol cannot be constructed with new operator");return o=t.call(this,r)||this,o}return e.for=function(r){for(var n=0,o=Hi.length;n<o;n++)if(Hi[n].target===r)return Hi[n].instance;var i=new e(r,jp);return Hi.push({target:r,instance:i}),i},e})(d1),wi=lt.for("UNSET_FIELD_NAME"),M0=lt.for("UPDATE_COMMAND"),k0=lt.for("QUERY_COMMAND"),$0=lt.for("LOGIC_COMMAND"),W0=lt.for("GEO_POINT"),h1=lt.for("SYMBOL_GEO_LINE_STRING"),p1=lt.for("SYMBOL_GEO_POLYGON"),v1=lt.for("SYMBOL_GEO_MULTI_POINT"),y1=lt.for("SYMBOL_GEO_MULTI_LINE_STRING"),m1=lt.for("SYMBOL_GEO_MULTI_POLYGON"),G0=lt.for("SERVER_DATE"),H0=lt.for("REGEXP"),V0=(function(){function t(e){var r=(e===void 0?{}:e).offset,n=r===void 0?0:r;this.offset=n}return Object.defineProperty(t.prototype,"_internalType",{get:function(){return G0},enumerable:!0,configurable:!0}),t.prototype.parse=function(){return{$date:{offset:this.offset}}},t})();function g1(t){return new V0(t)}var Xu=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},ea=(function(){function t(){}return t.formatResDocumentData=function(e){return e.map(function(r){return t.formatField(r)})},t.formatField=function(e){var r=Object.keys(e),n={};return Array.isArray(e)&&(n=[]),r.forEach(function(o){var i=e[o],s=t.whichType(i),u;switch(s){case de.GeoPoint:u=new tt(i.coordinates[0],i.coordinates[1]);break;case de.GeoLineString:u=new kt(i.coordinates.map(function(l){return new tt(l[0],l[1])}));break;case de.GeoPolygon:u=new zr(i.coordinates.map(function(l){return new kt(l.map(function(a){var c=Xu(a,2),f=c[0],d=c[1];return new tt(f,d)}))}));break;case de.GeoMultiPoint:u=new Co(i.coordinates.map(function(l){return new tt(l[0],l[1])}));break;case de.GeoMultiLineString:u=new xo(i.coordinates.map(function(l){return new kt(l.map(function(a){var c=Xu(a,2),f=c[0],d=c[1];return new tt(f,d)}))}));break;case de.GeoMultiPolygon:u=new Ei(i.coordinates.map(function(l){return new zr(l.map(function(a){return new kt(a.map(function(c){var f=Xu(c,2),d=f[0],h=f[1];return new tt(d,h)}))}))}));break;case de.Timestamp:u=new Date(i.$timestamp*1e3);break;case de.Object:case de.Array:u=t.formatField(i);break;case de.ServerDate:u=new Date(i.$date);break;default:u=i}Array.isArray(n)?n.push(u):n[o]=u}),n},t.whichType=function(e){var r=Object.prototype.toString.call(e).slice(8,-1);if(r===de.Timestamp)return de.BsonDate;if(r===de.Object){if(e instanceof tt)return de.GeoPoint;if(e instanceof Date)return de.Timestamp;if(e instanceof V0)return de.ServerDate;e.$timestamp?r=de.Timestamp:e.$date?r=de.ServerDate:tt.validate(e)?r=de.GeoPoint:kt.validate(e)?r=de.GeoLineString:zr.validate(e)?r=de.GeoPolygon:Co.validate(e)?r=de.GeoMultiPoint:xo.validate(e)?r=de.GeoMultiLineString:Ei.validate(e)&&(r=de.GeoMultiPolygon)}return r},t.generateDocId=function(){for(var e="ABCDEFabcdef0123456789",r="",n=0;n<24;n++)r+=e.charAt(Math.floor(Math.random()*e.length));return r},t})(),_r=(function(){function t(){}return t.isGeopoint=function(e,r){if(ea.whichType(r)!==de.Number)throw new Error("Geo Point must be number type");var n=Math.abs(r);if(e==="latitude"&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if(e==="longitude"&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},t.isInteger=function(e,r){if(!Number.isInteger(r))throw new Error(e+tr.IntergerError);return!0},t.isFieldOrder=function(e){if(c1.indexOf(e)===-1)throw new Error(tr.DirectionError);return!0},t.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},t.isOperator=function(e){if(l1.indexOf(e)===-1)throw new Error(tr.OpStrError);return!0},t.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(tr.CollNameError);return!0},t.isDocID=function(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(tr.DocIDError);return!0},t})(),Vt=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},wr=function(t){return Vt(t)==="object"},_1=function(t){return Vt(t)==="string"},mt=function(t){return Vt(t)==="number"},_e=function(t){return Array.isArray(t)},K0=function(t){return Vt(t)==="date"},bl=function(t){return Vt(t)==="regexp"},J0=function(t){return t&&t._internalType instanceof lt},tt=(function(){function t(e,r){_r.isGeopoint("longitude",e),_r.isGeopoint("latitude",r),this.longitude=e,this.latitude=r}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Point",coordinates:[this.longitude,this.latitude]},r},t.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},t.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},t.validate=function(e){return e.type==="Point"&&_e(e.coordinates)&&_r.isGeopoint("longitude",e.coordinates[0])&&_r.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return W0},enumerable:!0,configurable:!0}),t})(),b1=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},kt=(function(){function t(e){if(!_e(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach(function(r){if(!(r instanceof tt))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"LineString",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,n;if(e.type!=="LineString"||!_e(e.coordinates))return!1;try{for(var o=b1(e.coordinates),i=o.next();!i.done;i=o.next()){var s=i.value;if(!mt(s[0])||!mt(s[1]))return!1}}catch(u){r={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},t.isClosed=function(e){var r=e.points[0],n=e.points[e.points.length-1];if(r.latitude===n.latitude&&r.longitude===n.longitude)return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return h1},enumerable:!0,configurable:!0}),t})(),Mp=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zr=(function(){function t(e){if(!_e(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof kt))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]");if(!kt.isClosed(r))throw new Error("LineString "+r.points.map(function(n){return n.toReadableString()})+" is not a closed cycle")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Polygon",coordinates:this.lines.map(function(n){return n.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,n,o,i;if(e.type!=="Polygon"||!_e(e.coordinates))return!1;try{for(var s=Mp(e.coordinates),u=s.next();!u.done;u=s.next()){var l=u.value;if(!this.isCloseLineString(l))return!1;try{for(var a=(o=void 0,Mp(l)),c=a.next();!c.done;c=a.next()){var f=c.value;if(!mt(f[0])||!mt(f[1]))return!1}}catch(d){o={error:d}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}}catch(d){r={error:d}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return!0},t.isCloseLineString=function(e){var r=e[0],n=e[e.length-1];return!(r[0]!==n[0]||r[1]!==n[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return m1},enumerable:!0,configurable:!0}),t})(),w1=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Co=(function(){function t(e){if(!_e(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length===0)throw new Error('"points" must contain 1 point at least');e.forEach(function(r){if(!(r instanceof tt))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPoint",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,n;if(e.type!=="MultiPoint"||!_e(e.coordinates))return!1;try{for(var o=w1(e.coordinates),i=o.next();!i.done;i=o.next()){var s=i.value;if(!mt(s[0])||!mt(s[1]))return!1}}catch(u){r={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return v1},enumerable:!0,configurable:!0}),t})(),kp=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},xo=(function(){function t(e){if(!_e(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof kt))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiLineString",coordinates:this.lines.map(function(n){return n.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,n,o,i;if(e.type!=="MultiLineString"||!_e(e.coordinates))return!1;try{for(var s=kp(e.coordinates),u=s.next();!u.done;u=s.next()){var l=u.value;try{for(var a=(o=void 0,kp(l)),c=a.next();!c.done;c=a.next()){var f=c.value;if(!mt(f[0])||!mt(f[1]))return!1}}catch(d){o={error:d}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}}catch(d){r={error:d}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return y1},enumerable:!0,configurable:!0}),t})(),Vi=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ei=(function(){function t(e){var r,n;if(!_e(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof e);if(e.length===0)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var o=Vi(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(!(s instanceof zr))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof s+"[]")}}catch(u){r={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}this.polygons=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPolygon",coordinates:this.polygons.map(function(n){return n.lines.map(function(o){return o.points.map(function(i){return[i.longitude,i.latitude]})})})},r},t.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map(function(e){return e.lines.map(function(r){return r.points.map(function(n){return[n.longitude,n.latitude]})})})}},t.validate=function(e){var r,n,o,i,s,u;if(e.type!=="MultiPolygon"||!_e(e.coordinates))return!1;try{for(var l=Vi(e.coordinates),a=l.next();!a.done;a=l.next()){var c=a.value;try{for(var f=(o=void 0,Vi(c)),d=f.next();!d.done;d=f.next()){var h=d.value;try{for(var y=(s=void 0,Vi(h)),m=y.next();!m.done;m=y.next()){var b=m.value;if(!mt(b[0])||!mt(b[1]))return!1}}catch(w){s={error:w}}finally{try{m&&!m.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}}}catch(w){o={error:w}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}}}catch(w){r={error:w}}finally{try{a&&!a.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return p1},enumerable:!0,configurable:!0}),t})();const E1=Object.freeze(Object.defineProperty({__proto__:null,LineString:kt,MultiLineString:xo,MultiPoint:Co,MultiPolygon:Ei,Point:tt,Polygon:zr},Symbol.toStringTag,{value:"Module"}));var rr=function(){var t;if(!Promise){t=function(){},t.promise={};var e=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(t.promise,"then",{get:e}),Object.defineProperty(t.promise,"catch",{get:e}),t}var r=new Promise(function(n,o){t=function(i,s){return i?o(i):n(s)}});return t.promise=r,t},ne;(function(t){t.SET="set",t.REMOVE="remove",t.INC="inc",t.MUL="mul",t.PUSH="push",t.PULL="pull",t.PULL_ALL="pullAll",t.POP="pop",t.SHIFT="shift",t.UNSHIFT="unshift",t.ADD_TO_SET="addToSet",t.BIT="bit",t.RENAME="rename",t.MAX="max",t.MIN="min"})(ne||(ne={}));var Ae=(function(){function t(e,r,n){this._internalType=M0,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=n||wi}return t.prototype._setFieldName=function(e){var r=new t(this.operator,this.operands,e);return r},t})();function $p(t){return t&&t instanceof Ae&&t._internalType===M0}var ut;(function(t){t.AND="and",t.OR="or",t.NOT="not",t.NOR="nor"})(ut||(ut={}));var Vr=(function(){function t(e,r,n){if(this._internalType=$0,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=n||wi,this.fieldName!==wi)if(Array.isArray(r)){r=r.slice(),this.operands=r;for(var o=0,i=r.length;o<i;o++){var s=r[o];(No(s)||Po(s))&&(r[o]=s._setFieldName(this.fieldName))}}else{var s=r;(No(s)||Po(s))&&(r=s._setFieldName(this.fieldName))}}return t.prototype._setFieldName=function(e){var r=this.operands.map(function(o){return o instanceof t?o._setFieldName(e):o}),n=new t(this.operator,r,e);return n},t.prototype.and=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(ut.AND,e,this.fieldName)},t.prototype.or=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(ut.OR,e,this.fieldName)},t})();function No(t){return t&&t instanceof Vr&&t._internalType===$0}var S1=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),J;(function(t){t.EQ="eq",t.NEQ="neq",t.GT="gt",t.GTE="gte",t.LT="lt",t.LTE="lte",t.IN="in",t.NIN="nin",t.ALL="all",t.ELEM_MATCH="elemMatch",t.EXISTS="exists",t.SIZE="size",t.MOD="mod",t.GEO_NEAR="geoNear",t.GEO_WITHIN="geoWithin",t.GEO_INTERSECTS="geoIntersects"})(J||(J={}));var Ce=(function(t){S1(e,t);function e(r,n,o){var i=t.call(this,r,n,o)||this;return i.operator=r,i._internalType=k0,i}return e.prototype.toJSON=function(){var r,n;switch(this.operator){case J.IN:case J.NIN:return r={},r["$"+this.operator]=this.operands,r;default:return n={},n["$"+this.operator]=this.operands[0],n}},e.prototype._setFieldName=function(r){var n=new e(this.operator,this.operands,r);return n},e.prototype.eq=function(r){var n=new e(J.EQ,[r],this.fieldName);return this.and(n)},e.prototype.neq=function(r){var n=new e(J.NEQ,[r],this.fieldName);return this.and(n)},e.prototype.gt=function(r){var n=new e(J.GT,[r],this.fieldName);return this.and(n)},e.prototype.gte=function(r){var n=new e(J.GTE,[r],this.fieldName);return this.and(n)},e.prototype.lt=function(r){var n=new e(J.LT,[r],this.fieldName);return this.and(n)},e.prototype.lte=function(r){var n=new e(J.LTE,[r],this.fieldName);return this.and(n)},e.prototype.in=function(r){var n=new e(J.IN,r,this.fieldName);return this.and(n)},e.prototype.nin=function(r){var n=new e(J.NIN,r,this.fieldName);return this.and(n)},e.prototype.geoNear=function(r){if(!(r.geometry instanceof tt))throw new TypeError('"geometry" must be of type Point. Received type '+typeof r.geometry);if(r.maxDistance!==void 0&&!mt(r.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof r.maxDistance);if(r.minDistance!==void 0&&!mt(r.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof r.minDistance);var n=new e(J.GEO_NEAR,[r],this.fieldName);return this.and(n)},e.prototype.geoWithin=function(r){if(!(r.geometry instanceof Ei)&&!(r.geometry instanceof zr))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof r.geometry);var n=new e(J.GEO_WITHIN,[r],this.fieldName);return this.and(n)},e.prototype.geoIntersects=function(r){if(!(r.geometry instanceof tt)&&!(r.geometry instanceof kt)&&!(r.geometry instanceof zr)&&!(r.geometry instanceof Co)&&!(r.geometry instanceof xo)&&!(r.geometry instanceof Ei))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof r.geometry);var n=new e(J.GEO_INTERSECTS,[r],this.fieldName);return this.and(n)},e})(Vr);function Po(t){return t&&t instanceof Ce&&t._internalType===k0}function Wp(t){return Po(t)}var Ir={};for(var Er in J)Ir[Er]="$"+Er;for(var Er in ut)Ir[Er]="$"+Er;for(var Er in ne)Ir[Er]="$"+Er;Ir[J.NEQ]="$ne";Ir[ne.REMOVE]="$unset";Ir[ne.SHIFT]="$pop";Ir[ne.UNSHIFT]="$push";function wn(t){return Ir[t]||"$"+t}var Rc=function(){return Rc=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Rc.apply(this,arguments)},I1=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},Gp=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(I1(arguments[e]));return t};function Si(t){return Cc(t,[t])}function Cc(t,e){if(J0(t))switch(t._internalType){case W0:return t.toJSON();case G0:return t.parse();case H0:return t.parse();default:return t.toJSON?t.toJSON():t}else{if(K0(t))return{$date:+t};if(bl(t))return{$regex:t.source,$options:t.flags};if(_e(t))return t.map(function(o){if(e.indexOf(o)>-1)throw new Error("Cannot convert circular structure to JSON");return Cc(o,Gp(e,[o]))});if(wr(t)){var r=Rc({},t);for(var n in r){if(e.indexOf(r[n])>-1)throw new Error("Cannot convert circular structure to JSON");r[n]=Cc(r[n],Gp(e,[r[n]]))}return r}else return t}}var xc=function(){return xc=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},xc.apply(this,arguments)},O1=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},Hp=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O1(arguments[e]));return t};function z0(t,e,r,n){var o=xc({},t);for(var i in t)if(!/^\$/.test(i)){var s=t[i];if(s&&wr(s)&&!e(s)){if(n.indexOf(s)>-1)throw new Error("Cannot convert circular structure to JSON");var u=Hp(r,[i]),l=Hp(n,[s]),a=z0(s,e,u,l);o[i]=a;var c=!1;for(var f in a)/^\$/.test(f)?c=!0:(o[i+"."+f]=a[f],delete o[i][f]);c||delete o[i]}}return o}function Y0(t){return z0(t,Nc,[],[t])}function Vp(t,e,r){e[r]||delete t[r];for(var n in e)t[n]?_e(t[n])?t[n].push(e[n]):wr(t[n])?wr(e[n])?Object.assign(t[n],e[n]):(console.warn("unmergable condition, query is object but condition is "+Vt(e)+", can only overwrite",e,r),t[n]=e[n]):(console.warn("to-merge query is of type "+Vt(t)+", can only overwrite",t,e,r),t[n]=e[n]):t[n]=e[n]}function Nc(t){return J0(t)||K0(t)||bl(t)}function br(t){return Si(t)}var wl=(function(){function t(){}return t.encode=function(e){var r=new t;return r.encodeUpdate(e)},t.prototype.encodeUpdate=function(e){return $p(e)?this.encodeUpdateCommand(e):Vt(e)==="object"?this.encodeUpdateObject(e):e},t.prototype.encodeUpdateCommand=function(e){if(e.fieldName===wi)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case ne.PUSH:case ne.PULL:case ne.PULL_ALL:case ne.POP:case ne.SHIFT:case ne.UNSHIFT:case ne.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},t.prototype.encodeFieldUpdateCommand=function(e){var r,n,o,i,s=wn(e.operator);switch(e.operator){case ne.REMOVE:return r={},r[s]=(n={},n[e.fieldName]="",n),r;default:return o={},o[s]=(i={},i[e.fieldName]=e.operands[0],i),o}},t.prototype.encodeArrayUpdateCommand=function(e){var r,n,o,i,s,u,l,a,c,f,d=wn(e.operator);switch(e.operator){case ne.PUSH:{var h=void 0;return _e(e.operands)?h={$each:e.operands.map(br)}:h=e.operands,r={},r[d]=(n={},n[e.fieldName]=h,n),r}case ne.UNSHIFT:{var h={$each:e.operands.map(br),$position:0};return o={},o[d]=(i={},i[e.fieldName]=h,i),o}case ne.POP:return s={},s[d]=(u={},u[e.fieldName]=1,u),s;case ne.SHIFT:return l={},l[d]=(a={},a[e.fieldName]=-1,a),l;default:return c={},c[d]=(f={},f[e.fieldName]=br(e.operands),f),c}},t.prototype.encodeUpdateObject=function(e){var r=Y0(e);for(var n in r)if(!/^\$/.test(n)){var o=r[n];if($p(o)){r[n]=o._setFieldName(n);var i=this.encodeUpdateCommand(r[n]);Vp(r,i,n)}else{r[n]=o=br(o);var s=new Ae(ne.SET,[o],n),i=this.encodeUpdateCommand(s);Vp(r,i,n)}}return r},t})(),Zu={};function Q0(t){if(!Ge.wsClientClass)throw new Error("to use realtime you must import realtime module first");var e=t.config.env;return Zu[e]||(Zu[e]=new Ge.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new Ge.reqClass(t.config)}}})),Zu[e]}var Do=function(){return Do=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Do.apply(this,arguments)},Kp=(function(){function t(e,r,n,o){var i=this;o===void 0&&(o={}),this.watch=function(s){var u=Q0(i._db);return u.watch(Do(Do({},s),{envId:i._db.config.env,collectionName:i._coll,query:JSON.stringify({_id:i.id})}))},this._db=e,this._coll=r,this.id=n,this.request=new Ge.reqClass(this._db.config),this.projection=o}return t.prototype.create=function(e,r){r=r||rr();var n={collectionName:this._coll,data:Si(e)};return this.id&&(n._id=this.id),this.request.send("database.addDocument",n).then(function(o){o.code?r(0,o):r(0,{id:o.data._id,requestId:o.requestId})}).catch(function(o){r(o)}),r.promise},t.prototype.set=function(e,r){if(r=r||rr(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n=!1,o=function(u){if(typeof u=="object")for(var l in u)u[l]instanceof Ae?n=!0:typeof u[l]=="object"&&o(u[l])};if(o(e),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var i=!1,s={collectionName:this._coll,queryType:Ht.DOC,data:Si(e),multi:!1,merge:i,upsert:!0};return this.id&&(s.query={_id:this.id}),this.request.send("database.updateDocument",s).then(function(u){u.code?r(0,u):r(0,{updated:u.data.updated,upsertedId:u.data.upserted_id,requestId:u.requestId})}).catch(function(u){r(u)}),r.promise},t.prototype.update=function(e,r){if(r=r||rr(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={_id:this.id},o=!0,i={collectionName:this._coll,data:wl.encode(e),query:n,queryType:Ht.DOC,multi:!1,merge:o,upsert:!1};return this.request.send("database.updateDocument",i).then(function(s){s.code?r(0,s):r(0,{updated:s.data.updated,upsertedId:s.data.upserted_id,requestId:s.requestId})}).catch(function(s){r(s)}),r.promise},t.prototype.remove=function(e){e=e||rr();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:Ht.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then(function(o){o.code?e(0,o):e(0,{deleted:o.data.deleted,requestId:o.requestId})}).catch(function(o){e(o)}),e.promise},t.prototype.get=function(e){e=e||rr();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:Ht.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then(function(o){if(o.code)e(0,o);else{var i=ea.formatResDocumentData(o.data.list);e(0,{data:i,requestId:o.requestId})}}).catch(function(o){e(o)}),e.promise},t.prototype.field=function(e){for(var r in e)e[r]?e[r]=1:e[r]=0;return new t(this._db,this._coll,this.id,e)},t})(),Lo=(function(){function t(){}return t.encode=function(e){var r=new A1;return r.encodeQuery(e)},t})(),A1=(function(){function t(){}return t.prototype.encodeQuery=function(e,r){var n;return Nc(e)?No(e)?this.encodeLogicCommand(e):Po(e)?this.encodeQueryCommand(e):(n={},n[r]=this.encodeQueryObject(e),n):wr(e)?this.encodeQueryObject(e):e},t.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},t.prototype.encodeLogicCommand=function(e){var r,n,o,i,s,u,l,a=this;switch(e.operator){case ut.NOR:case ut.AND:case ut.OR:{var c=wn(e.operator),f=e.operands.map(function(y){return a.encodeQuery(y,e.fieldName)});return r={},r[c]=f,r}case ut.NOT:{var c=wn(e.operator),d=e.operands[0];if(bl(d))return n={},n[e.fieldName]=(o={},o[c]=this.encodeRegExp(d),o),n;var f=this.encodeQuery(d)[e.fieldName];return i={},i[e.fieldName]=(s={},s[c]=f,s),i}default:{var c=wn(e.operator);if(e.operands.length===1){var h=this.encodeQuery(e.operands[0]);return u={},u[c]=h,u}else{var f=e.operands.map(this.encodeQuery.bind(this));return l={},l[c]=f,l}}}},t.prototype.encodeQueryCommand=function(e){return Wp(e)?this.encodeComparisonCommand(e):this.encodeComparisonCommand(e)},t.prototype.encodeComparisonCommand=function(e){var r,n,o,i,s,u,l,a,c;if(e.fieldName===wi)throw new Error("Cannot encode a comparison command with unset field name");var f=wn(e.operator);switch(e.operator){case J.EQ:case J.NEQ:case J.LT:case J.LTE:case J.GT:case J.GTE:case J.ELEM_MATCH:case J.EXISTS:case J.SIZE:case J.MOD:return r={},r[e.fieldName]=(n={},n[f]=br(e.operands[0]),n),r;case J.IN:case J.NIN:case J.ALL:return o={},o[e.fieldName]=(i={},i[f]=br(e.operands),i),o;case J.GEO_NEAR:{var d=e.operands[0];return s={},s[e.fieldName]={$nearSphere:{$geometry:d.geometry.toJSON(),$maxDistance:d.maxDistance,$minDistance:d.minDistance}},s}case J.GEO_WITHIN:{var d=e.operands[0];return u={},u[e.fieldName]={$geoWithin:{$geometry:d.geometry.toJSON()}},u}case J.GEO_INTERSECTS:{var d=e.operands[0];return l={},l[e.fieldName]={$geoIntersects:{$geometry:d.geometry.toJSON()}},l}default:return a={},a[e.fieldName]=(c={},c[f]=br(e.operands[0]),c),a}},t.prototype.encodeQueryObject=function(e){var r=Y0(e);for(var n in r){var o=r[n];if(No(o)){r[n]=o._setFieldName(n);var i=this.encodeLogicCommand(r[n]);this.mergeConditionAfterEncode(r,i,n)}else if(Wp(o)){r[n]=o._setFieldName(n);var i=this.encodeComparisonCommand(r[n]);this.mergeConditionAfterEncode(r,i,n)}else Nc(o)&&(r[n]=br(o))}return r},t.prototype.mergeConditionAfterEncode=function(e,r,n){r[n]||delete e[n];for(var o in r)e[o]?_e(e[o])?e[o]=e[o].concat(r[o]):wr(e[o])?wr(r[o])?Object.assign(e,r):(console.warn("unmergable condition, query is object but condition is "+Vt(r)+", can only overwrite",r,n),e[o]=r[o]):(console.warn("to-merge query is of type "+Vt(e)+", can only overwrite",e,r,n),e[o]=r[o]):e[o]=r[o]},t})(),Wr=function(){return Wr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Wr.apply(this,arguments)},T1=(function(){function t(e,r,n,o,i){var s=this;this.watch=function(u){var l=Q0(s._db);return l.watch(Wr(Wr({},u),{envId:s._db.config.env,collectionName:s._coll,query:JSON.stringify(s._fieldFilters||{}),limit:s._queryOptions.limit,orderBy:s._fieldOrders?s._fieldOrders.reduce(function(a,c){return a[c.field]=c.direction,a},{}):void 0}))},this._db=e,this._coll=r,this._fieldFilters=n,this._fieldOrders=o||[],this._queryOptions=i||{},this._request=new Ge.reqClass(this._db.config)}return t.prototype.get=function(e){e=e||rr();var r=[];this._fieldOrders&&this._fieldOrders.forEach(function(o){r.push(o)});var n={collectionName:this._coll,queryType:Ht.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),r.length>0&&(n.order=r),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then(function(o){if(o.code)e(0,o);else{var i=ea.formatResDocumentData(o.data.list),s={data:i,requestId:o.requestId};o.total&&(s.total=o.total),o.limit&&(s.limit=o.limit),o.offset&&(s.offset=o.offset),e(0,s)}}).catch(function(o){e(o)}),e.promise},t.prototype.count=function(e){e=e||rr();var r={collectionName:this._coll,queryType:Ht.WHERE};return this._fieldFilters&&(r.query=this._fieldFilters),this._request.send("database.countDocument",r).then(function(n){n.code?e(0,n):e(0,{requestId:n.requestId,total:n.data.total})}).catch(function(n){e(n)}),e.promise},t.prototype.where=function(e){if(Object.prototype.toString.call(e).slice(8,-1)!=="Object")throw Error(tr.QueryParamTypeError);var r=Object.keys(e),n=r.some(function(o){return e[o]!==void 0});if(r.length&&!n)throw Error(tr.QueryParamValueError);return new t(this._db,this._coll,Lo.encode(e),this._fieldOrders,this._queryOptions)},t.prototype.orderBy=function(e,r){_r.isFieldPath(e),_r.isFieldOrder(r);var n={field:e,direction:r},o=this._fieldOrders.concat(n);return new t(this._db,this._coll,this._fieldFilters,o,this._queryOptions)},t.prototype.limit=function(e){_r.isInteger("limit",e);var r=Wr({},this._queryOptions);return r.limit=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.skip=function(e){_r.isInteger("offset",e);var r=Wr({},this._queryOptions);return r.offset=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.update=function(e,r){if(r=r||rr(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={collectionName:this._coll,query:this._fieldFilters,queryType:Ht.WHERE,multi:!0,merge:!0,upsert:!1,data:wl.encode(e)};return this._request.send("database.updateDocument",n).then(function(o){o.code?r(0,o):r(0,{requestId:o.requestId,updated:o.data.updated,upsertId:o.data.upsert_id})}).catch(function(o){r(o)}),r.promise},t.prototype.field=function(e){for(var r in e)e[r]?typeof e[r]!="object"&&(e[r]=1):e[r]=0;var n=Wr({},this._queryOptions);return n.projection=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},t.prototype.remove=function(e){e=e||rr(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");var r={collectionName:this._coll,query:Lo.encode(this._fieldFilters),queryType:Ht.WHERE,multi:!0};return this._request.send("database.deleteDocument",r).then(function(n){n.code?e(0,n):e(0,{requestId:n.requestId,deleted:n.data.deleted})}).catch(function(n){e(n)}),e.promise},t})();function R1(t,e){return e={exports:{}},t(e,e.exports),e.exports}var C1=L1,x1=q1,N1=j1,$t=[],vt=[],P1=typeof Uint8Array<"u"?Uint8Array:Array,ec="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var dn=0,D1=ec.length;dn<D1;++dn)$t[dn]=ec[dn],vt[ec.charCodeAt(dn)]=dn;vt[45]=62;vt[95]=63;function X0(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function L1(t){var e=X0(t),r=e[0],n=e[1];return(r+n)*3/4-n}function U1(t,e,r){return(e+r)*3/4-r}function q1(t){var e,r=X0(t),n=r[0],o=r[1],i=new P1(U1(t,n,o)),s=0,u=o>0?n-4:n,l;for(l=0;l<u;l+=4)e=vt[t.charCodeAt(l)]<<18|vt[t.charCodeAt(l+1)]<<12|vt[t.charCodeAt(l+2)]<<6|vt[t.charCodeAt(l+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=e&255;return o===2&&(e=vt[t.charCodeAt(l)]<<2|vt[t.charCodeAt(l+1)]>>4,i[s++]=e&255),o===1&&(e=vt[t.charCodeAt(l)]<<10|vt[t.charCodeAt(l+1)]<<4|vt[t.charCodeAt(l+2)]>>2,i[s++]=e>>8&255,i[s++]=e&255),i}function F1(t){return $t[t>>18&63]+$t[t>>12&63]+$t[t>>6&63]+$t[t&63]}function B1(t,e,r){for(var n,o=[],i=e;i<r;i+=3)n=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),o.push(F1(n));return o.join("")}function j1(t){for(var e,r=t.length,n=r%3,o=[],i=16383,s=0,u=r-n;s<u;s+=i)o.push(B1(t,s,s+i>u?u:s+i));return n===1?(e=t[r-1],o.push($t[e>>2]+$t[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],o.push($t[e>>10]+$t[e>>4&63]+$t[e<<2&63]+"=")),o.join("")}var tc={byteLength:C1,toByteArray:x1,fromByteArray:N1};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var M1=function(e,r,n,o,i){var s,u,l=i*8-o-1,a=(1<<l)-1,c=a>>1,f=-7,d=n?i-1:0,h=n?-1:1,y=e[r+d];for(d+=h,s=y&(1<<-f)-1,y>>=-f,f+=l;f>0;s=s*256+e[r+d],d+=h,f-=8);for(u=s&(1<<-f)-1,s>>=-f,f+=o;f>0;u=u*256+e[r+d],d+=h,f-=8);if(s===0)s=1-c;else{if(s===a)return u?NaN:(y?-1:1)*(1/0);u=u+Math.pow(2,o),s=s-c}return(y?-1:1)*u*Math.pow(2,s-o)},k1=function(e,r,n,o,i,s){var u,l,a,c=s*8-i-1,f=(1<<c)-1,d=f>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=o?0:s-1,m=o?1:-1,b=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,u=f):(u=Math.floor(Math.log(r)/Math.LN2),r*(a=Math.pow(2,-u))<1&&(u--,a*=2),u+d>=1?r+=h/a:r+=h*Math.pow(2,1-d),r*a>=2&&(u++,a/=2),u+d>=f?(l=0,u=f):u+d>=1?(l=(r*a-1)*Math.pow(2,i),u=u+d):(l=r*Math.pow(2,d-1)*Math.pow(2,i),u=0));i>=8;e[n+y]=l&255,y+=m,l/=256,i-=8);for(u=u<<i|l,c+=i;c>0;e[n+y]=u&255,y+=m,u/=256,c-=8);e[n+y-m]|=b*128},hn={read:M1,write:k1},ta=R1(function(t,e){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=w,e.INSPECT_MAX_BYTES=50;var n=2147483647;e.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=o(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{var g=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(g,p),g.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function i(g){if(g>n)throw new RangeError('The value "'+g+'" is invalid for option "size"');var p=new Uint8Array(g);return Object.setPrototypeOf(p,s.prototype),p}function s(g,p,v){if(typeof g=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return c(g)}return u(g,p,v)}s.poolSize=8192;function u(g,p,v){if(typeof g=="string")return f(g,p);if(ArrayBuffer.isView(g))return h(g);if(g==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(g));if(Ue(g,ArrayBuffer)||g&&Ue(g.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ue(g,SharedArrayBuffer)||g&&Ue(g.buffer,SharedArrayBuffer)))return y(g,p,v);if(typeof g=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var S=g.valueOf&&g.valueOf();if(S!=null&&S!==g)return s.from(S,p,v);var T=m(g);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof g[Symbol.toPrimitive]=="function")return s.from(g[Symbol.toPrimitive]("string"),p,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(g))}s.from=function(g,p,v){return u(g,p,v)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function l(g){if(typeof g!="number")throw new TypeError('"size" argument must be of type number');if(g<0)throw new RangeError('The value "'+g+'" is invalid for option "size"')}function a(g,p,v){return l(g),g<=0?i(g):p!==void 0?typeof v=="string"?i(g).fill(p,v):i(g).fill(p):i(g)}s.alloc=function(g,p,v){return a(g,p,v)};function c(g){return l(g),i(g<0?0:b(g)|0)}s.allocUnsafe=function(g){return c(g)},s.allocUnsafeSlow=function(g){return c(g)};function f(g,p){if((typeof p!="string"||p==="")&&(p="utf8"),!s.isEncoding(p))throw new TypeError("Unknown encoding: "+p);var v=_(g,p)|0,S=i(v),T=S.write(g,p);return T!==v&&(S=S.slice(0,T)),S}function d(g){for(var p=g.length<0?0:b(g.length)|0,v=i(p),S=0;S<p;S+=1)v[S]=g[S]&255;return v}function h(g){if(Ue(g,Uint8Array)){var p=new Uint8Array(g);return y(p.buffer,p.byteOffset,p.byteLength)}return d(g)}function y(g,p,v){if(p<0||g.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(g.byteLength<p+(v||0))throw new RangeError('"length" is outside of buffer bounds');var S;return p===void 0&&v===void 0?S=new Uint8Array(g):v===void 0?S=new Uint8Array(g,p):S=new Uint8Array(g,p,v),Object.setPrototypeOf(S,s.prototype),S}function m(g){if(s.isBuffer(g)){var p=b(g.length)|0,v=i(p);return v.length===0||g.copy(v,0,0,p),v}if(g.length!==void 0)return typeof g.length!="number"||zt(g.length)?i(0):d(g);if(g.type==="Buffer"&&Array.isArray(g.data))return d(g.data)}function b(g){if(g>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return g|0}function w(g){return+g!=g&&(g=0),s.alloc(+g)}s.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==s.prototype},s.compare=function(p,v){if(Ue(p,Uint8Array)&&(p=s.from(p,p.offset,p.byteLength)),Ue(v,Uint8Array)&&(v=s.from(v,v.offset,v.byteLength)),!s.isBuffer(p)||!s.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===v)return 0;for(var S=p.length,T=v.length,L=0,F=Math.min(S,T);L<F;++L)if(p[L]!==v[L]){S=p[L],T=v[L];break}return S<T?-1:T<S?1:0},s.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(p,v){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return s.alloc(0);var S;if(v===void 0)for(v=0,S=0;S<p.length;++S)v+=p[S].length;var T=s.allocUnsafe(v),L=0;for(S=0;S<p.length;++S){var F=p[S];if(Ue(F,Uint8Array))L+F.length>T.length?s.from(F).copy(T,L):Uint8Array.prototype.set.call(T,F,L);else if(s.isBuffer(F))F.copy(T,L);else throw new TypeError('"list" argument must be an Array of Buffers');L+=F.length}return T};function _(g,p){if(s.isBuffer(g))return g.length;if(ArrayBuffer.isView(g)||Ue(g,ArrayBuffer))return g.byteLength;if(typeof g!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(g));var v=g.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&v===0)return 0;for(var T=!1;;)switch(p){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return ke(g).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return be(g).length;default:if(T)return S?-1:ke(g).length;p=(""+p).toLowerCase(),T=!0}}s.byteLength=_;function E(g,p,v){var S=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,p>>>=0,v<=p))return"";for(g||(g="utf8");;)switch(g){case"hex":return Q(this,p,v);case"utf8":case"utf-8":return U(this,p,v);case"ascii":return ae(this,p,v);case"latin1":case"binary":return z(this,p,v);case"base64":return N(this,p,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,p,v);default:if(S)throw new TypeError("Unknown encoding: "+g);g=(g+"").toLowerCase(),S=!0}}s.prototype._isBuffer=!0;function I(g,p,v){var S=g[p];g[p]=g[v],g[v]=S}s.prototype.swap16=function(){var p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var v=0;v<p;v+=2)I(this,v,v+1);return this},s.prototype.swap32=function(){var p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var v=0;v<p;v+=4)I(this,v,v+3),I(this,v+1,v+2);return this},s.prototype.swap64=function(){var p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var v=0;v<p;v+=8)I(this,v,v+7),I(this,v+1,v+6),I(this,v+2,v+5),I(this,v+3,v+4);return this},s.prototype.toString=function(){var p=this.length;return p===0?"":arguments.length===0?U(this,0,p):E.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(p){if(!s.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:s.compare(this,p)===0},s.prototype.inspect=function(){var p="",v=e.INSPECT_MAX_BYTES;return p=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(p+=" ... "),"<Buffer "+p+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(p,v,S,T,L){if(Ue(p,Uint8Array)&&(p=s.from(p,p.offset,p.byteLength)),!s.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(p));if(v===void 0&&(v=0),S===void 0&&(S=p?p.length:0),T===void 0&&(T=0),L===void 0&&(L=this.length),v<0||S>p.length||T<0||L>this.length)throw new RangeError("out of range index");if(T>=L&&v>=S)return 0;if(T>=L)return-1;if(v>=S)return 1;if(v>>>=0,S>>>=0,T>>>=0,L>>>=0,this===p)return 0;for(var F=L-T,X=S-v,Z=Math.min(F,X),ue=this.slice(T,L),ge=p.slice(v,S),he=0;he<Z;++he)if(ue[he]!==ge[he]){F=ue[he],X=ge[he];break}return F<X?-1:X<F?1:0};function R(g,p,v,S,T){if(g.length===0)return-1;if(typeof v=="string"?(S=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,zt(v)&&(v=T?0:g.length-1),v<0&&(v=g.length+v),v>=g.length){if(T)return-1;v=g.length-1}else if(v<0)if(T)v=0;else return-1;if(typeof p=="string"&&(p=s.from(p,S)),s.isBuffer(p))return p.length===0?-1:x(g,p,v,S,T);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call(g,p,v):Uint8Array.prototype.lastIndexOf.call(g,p,v):x(g,[p],v,S,T);throw new TypeError("val must be string, number or Buffer")}function x(g,p,v,S,T){var L=1,F=g.length,X=p.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(g.length<2||p.length<2)return-1;L=2,F/=2,X/=2,v/=2}function Z(Yt,$n){return L===1?Yt[$n]:Yt.readUInt16BE($n*L)}var ue;if(T){var ge=-1;for(ue=v;ue<F;ue++)if(Z(g,ue)===Z(p,ge===-1?0:ue-ge)){if(ge===-1&&(ge=ue),ue-ge+1===X)return ge*L}else ge!==-1&&(ue-=ue-ge),ge=-1}else for(v+X>F&&(v=F-X),ue=v;ue>=0;ue--){for(var he=!0,Ar=0;Ar<X;Ar++)if(Z(g,ue+Ar)!==Z(p,Ar)){he=!1;break}if(he)return ue}return-1}s.prototype.includes=function(p,v,S){return this.indexOf(p,v,S)!==-1},s.prototype.indexOf=function(p,v,S){return R(this,p,v,S,!0)},s.prototype.lastIndexOf=function(p,v,S){return R(this,p,v,S,!1)};function P(g,p,v,S){v=Number(v)||0;var T=g.length-v;S?(S=Number(S),S>T&&(S=T)):S=T;var L=p.length;S>L/2&&(S=L/2);for(var F=0;F<S;++F){var X=parseInt(p.substr(F*2,2),16);if(zt(X))return F;g[v+F]=X}return F}function D(g,p,v,S){return Ie(ke(p,g.length-v),g,v,S)}function O(g,p,v,S){return Ie(me(p),g,v,S)}function C(g,p,v,S){return Ie(be(p),g,v,S)}function A(g,p,v,S){return Ie(Se(p,g.length-v),g,v,S)}s.prototype.write=function(p,v,S,T){if(v===void 0)T="utf8",S=this.length,v=0;else if(S===void 0&&typeof v=="string")T=v,S=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(S)?(S=S>>>0,T===void 0&&(T="utf8")):(T=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var L=this.length-v;if((S===void 0||S>L)&&(S=L),p.length>0&&(S<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");for(var F=!1;;)switch(T){case"hex":return P(this,p,v,S);case"utf8":case"utf-8":return D(this,p,v,S);case"ascii":case"latin1":case"binary":return O(this,p,v,S);case"base64":return C(this,p,v,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,p,v,S);default:if(F)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),F=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(g,p,v){return p===0&&v===g.length?tc.fromByteArray(g):tc.fromByteArray(g.slice(p,v))}function U(g,p,v){v=Math.min(g.length,v);for(var S=[],T=p;T<v;){var L=g[T],F=null,X=L>239?4:L>223?3:L>191?2:1;if(T+X<=v){var Z,ue,ge,he;switch(X){case 1:L<128&&(F=L);break;case 2:Z=g[T+1],(Z&192)===128&&(he=(L&31)<<6|Z&63,he>127&&(F=he));break;case 3:Z=g[T+1],ue=g[T+2],(Z&192)===128&&(ue&192)===128&&(he=(L&15)<<12|(Z&63)<<6|ue&63,he>2047&&(he<55296||he>57343)&&(F=he));break;case 4:Z=g[T+1],ue=g[T+2],ge=g[T+3],(Z&192)===128&&(ue&192)===128&&(ge&192)===128&&(he=(L&15)<<18|(Z&63)<<12|(ue&63)<<6|ge&63,he>65535&&he<1114112&&(F=he))}}F===null?(F=65533,X=1):F>65535&&(F-=65536,S.push(F>>>10&1023|55296),F=56320|F&1023),S.push(F),T+=X}return W(S)}var q=4096;function W(g){var p=g.length;if(p<=q)return String.fromCharCode.apply(String,g);for(var v="",S=0;S<p;)v+=String.fromCharCode.apply(String,g.slice(S,S+=q));return v}function ae(g,p,v){var S="";v=Math.min(g.length,v);for(var T=p;T<v;++T)S+=String.fromCharCode(g[T]&127);return S}function z(g,p,v){var S="";v=Math.min(g.length,v);for(var T=p;T<v;++T)S+=String.fromCharCode(g[T]);return S}function Q(g,p,v){var S=g.length;(!p||p<0)&&(p=0),(!v||v<0||v>S)&&(v=S);for(var T="",L=p;L<v;++L)T+=Or[g[L]];return T}function H(g,p,v){for(var S=g.slice(p,v),T="",L=0;L<S.length-1;L+=2)T+=String.fromCharCode(S[L]+S[L+1]*256);return T}s.prototype.slice=function(p,v){var S=this.length;p=~~p,v=v===void 0?S:~~v,p<0?(p+=S,p<0&&(p=0)):p>S&&(p=S),v<0?(v+=S,v<0&&(v=0)):v>S&&(v=S),v<p&&(v=p);var T=this.subarray(p,v);return Object.setPrototypeOf(T,s.prototype),T};function K(g,p,v){if(g%1!==0||g<0)throw new RangeError("offset is not uint");if(g+p>v)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(p,v,S){p=p>>>0,v=v>>>0,S||K(p,v,this.length);for(var T=this[p],L=1,F=0;++F<v&&(L*=256);)T+=this[p+F]*L;return T},s.prototype.readUintBE=s.prototype.readUIntBE=function(p,v,S){p=p>>>0,v=v>>>0,S||K(p,v,this.length);for(var T=this[p+--v],L=1;v>0&&(L*=256);)T+=this[p+--v]*L;return T},s.prototype.readUint8=s.prototype.readUInt8=function(p,v){return p=p>>>0,v||K(p,1,this.length),this[p]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(p,v){return p=p>>>0,v||K(p,2,this.length),this[p]|this[p+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(p,v){return p=p>>>0,v||K(p,2,this.length),this[p]<<8|this[p+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(p,v){return p=p>>>0,v||K(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(p,v){return p=p>>>0,v||K(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},s.prototype.readIntLE=function(p,v,S){p=p>>>0,v=v>>>0,S||K(p,v,this.length);for(var T=this[p],L=1,F=0;++F<v&&(L*=256);)T+=this[p+F]*L;return L*=128,T>=L&&(T-=Math.pow(2,8*v)),T},s.prototype.readIntBE=function(p,v,S){p=p>>>0,v=v>>>0,S||K(p,v,this.length);for(var T=v,L=1,F=this[p+--T];T>0&&(L*=256);)F+=this[p+--T]*L;return L*=128,F>=L&&(F-=Math.pow(2,8*v)),F},s.prototype.readInt8=function(p,v){return p=p>>>0,v||K(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},s.prototype.readInt16LE=function(p,v){p=p>>>0,v||K(p,2,this.length);var S=this[p]|this[p+1]<<8;return S&32768?S|4294901760:S},s.prototype.readInt16BE=function(p,v){p=p>>>0,v||K(p,2,this.length);var S=this[p+1]|this[p]<<8;return S&32768?S|4294901760:S},s.prototype.readInt32LE=function(p,v){return p=p>>>0,v||K(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},s.prototype.readInt32BE=function(p,v){return p=p>>>0,v||K(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},s.prototype.readFloatLE=function(p,v){return p=p>>>0,v||K(p,4,this.length),hn.read(this,p,!0,23,4)},s.prototype.readFloatBE=function(p,v){return p=p>>>0,v||K(p,4,this.length),hn.read(this,p,!1,23,4)},s.prototype.readDoubleLE=function(p,v){return p=p>>>0,v||K(p,8,this.length),hn.read(this,p,!0,52,8)},s.prototype.readDoubleBE=function(p,v){return p=p>>>0,v||K(p,8,this.length),hn.read(this,p,!1,52,8)};function ve(g,p,v,S,T,L){if(!s.isBuffer(g))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>T||p<L)throw new RangeError('"value" argument is out of bounds');if(v+S>g.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(p,v,S,T){if(p=+p,v=v>>>0,S=S>>>0,!T){var L=Math.pow(2,8*S)-1;ve(this,p,v,S,L,0)}var F=1,X=0;for(this[v]=p&255;++X<S&&(F*=256);)this[v+X]=p/F&255;return v+S},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(p,v,S,T){if(p=+p,v=v>>>0,S=S>>>0,!T){var L=Math.pow(2,8*S)-1;ve(this,p,v,S,L,0)}var F=S-1,X=1;for(this[v+F]=p&255;--F>=0&&(X*=256);)this[v+F]=p/X&255;return v+S},s.prototype.writeUint8=s.prototype.writeUInt8=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,1,255,0),this[v]=p&255,v+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,2,65535,0),this[v]=p&255,this[v+1]=p>>>8,v+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,2,65535,0),this[v]=p>>>8,this[v+1]=p&255,v+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,4,4294967295,0),this[v+3]=p>>>24,this[v+2]=p>>>16,this[v+1]=p>>>8,this[v]=p&255,v+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,4,4294967295,0),this[v]=p>>>24,this[v+1]=p>>>16,this[v+2]=p>>>8,this[v+3]=p&255,v+4},s.prototype.writeIntLE=function(p,v,S,T){if(p=+p,v=v>>>0,!T){var L=Math.pow(2,8*S-1);ve(this,p,v,S,L-1,-L)}var F=0,X=1,Z=0;for(this[v]=p&255;++F<S&&(X*=256);)p<0&&Z===0&&this[v+F-1]!==0&&(Z=1),this[v+F]=(p/X>>0)-Z&255;return v+S},s.prototype.writeIntBE=function(p,v,S,T){if(p=+p,v=v>>>0,!T){var L=Math.pow(2,8*S-1);ve(this,p,v,S,L-1,-L)}var F=S-1,X=1,Z=0;for(this[v+F]=p&255;--F>=0&&(X*=256);)p<0&&Z===0&&this[v+F+1]!==0&&(Z=1),this[v+F]=(p/X>>0)-Z&255;return v+S},s.prototype.writeInt8=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,1,127,-128),p<0&&(p=255+p+1),this[v]=p&255,v+1},s.prototype.writeInt16LE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,2,32767,-32768),this[v]=p&255,this[v+1]=p>>>8,v+2},s.prototype.writeInt16BE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,2,32767,-32768),this[v]=p>>>8,this[v+1]=p&255,v+2},s.prototype.writeInt32LE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,4,2147483647,-2147483648),this[v]=p&255,this[v+1]=p>>>8,this[v+2]=p>>>16,this[v+3]=p>>>24,v+4},s.prototype.writeInt32BE=function(p,v,S){return p=+p,v=v>>>0,S||ve(this,p,v,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[v]=p>>>24,this[v+1]=p>>>16,this[v+2]=p>>>8,this[v+3]=p&255,v+4};function Dt(g,p,v,S,T,L){if(v+S>g.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function Jt(g,p,v,S,T){return p=+p,v=v>>>0,T||Dt(g,p,v,4),hn.write(g,p,v,S,23,4),v+4}s.prototype.writeFloatLE=function(p,v,S){return Jt(this,p,v,!0,S)},s.prototype.writeFloatBE=function(p,v,S){return Jt(this,p,v,!1,S)};function Lt(g,p,v,S,T){return p=+p,v=v>>>0,T||Dt(g,p,v,8),hn.write(g,p,v,S,52,8),v+8}s.prototype.writeDoubleLE=function(p,v,S){return Lt(this,p,v,!0,S)},s.prototype.writeDoubleBE=function(p,v,S){return Lt(this,p,v,!1,S)},s.prototype.copy=function(p,v,S,T){if(!s.isBuffer(p))throw new TypeError("argument should be a Buffer");if(S||(S=0),!T&&T!==0&&(T=this.length),v>=p.length&&(v=p.length),v||(v=0),T>0&&T<S&&(T=S),T===S||p.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),p.length-v<T-S&&(T=p.length-v+S);var L=T-S;return this===p&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(v,S,T):Uint8Array.prototype.set.call(p,this.subarray(S,T),v),L},s.prototype.fill=function(p,v,S,T){if(typeof p=="string"){if(typeof v=="string"?(T=v,v=0,S=this.length):typeof S=="string"&&(T=S,S=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!s.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(p.length===1){var L=p.charCodeAt(0);(T==="utf8"&&L<128||T==="latin1")&&(p=L)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(v<0||this.length<v||this.length<S)throw new RangeError("Out of range index");if(S<=v)return this;v=v>>>0,S=S===void 0?this.length:S>>>0,p||(p=0);var F;if(typeof p=="number")for(F=v;F<S;++F)this[F]=p;else{var X=s.isBuffer(p)?p:s.from(p,T),Z=X.length;if(Z===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(F=0;F<S-v;++F)this[F+v]=X[F%Z]}return this};var Le=/[^+/0-9A-Za-z-_]/g;function ee(g){if(g=g.split("=")[0],g=g.trim().replace(Le,""),g.length<2)return"";for(;g.length%4!==0;)g=g+"=";return g}function ke(g,p){p=p||1/0;for(var v,S=g.length,T=null,L=[],F=0;F<S;++F){if(v=g.charCodeAt(F),v>55295&&v<57344){if(!T){if(v>56319){(p-=3)>-1&&L.push(239,191,189);continue}else if(F+1===S){(p-=3)>-1&&L.push(239,191,189);continue}T=v;continue}if(v<56320){(p-=3)>-1&&L.push(239,191,189),T=v;continue}v=(T-55296<<10|v-56320)+65536}else T&&(p-=3)>-1&&L.push(239,191,189);if(T=null,v<128){if((p-=1)<0)break;L.push(v)}else if(v<2048){if((p-=2)<0)break;L.push(v>>6|192,v&63|128)}else if(v<65536){if((p-=3)<0)break;L.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((p-=4)<0)break;L.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return L}function me(g){for(var p=[],v=0;v<g.length;++v)p.push(g.charCodeAt(v)&255);return p}function Se(g,p){for(var v,S,T,L=[],F=0;F<g.length&&!((p-=2)<0);++F)v=g.charCodeAt(F),S=v>>8,T=v%256,L.push(T),L.push(S);return L}function be(g){return tc.toByteArray(ee(g))}function Ie(g,p,v,S){for(var T=0;T<S&&!(T+v>=p.length||T>=g.length);++T)p[T+v]=g[T];return T}function Ue(g,p){return g instanceof p||g!=null&&g.constructor!=null&&g.constructor.name!=null&&g.constructor.name===p.name}function zt(g){return g!==g}var Or=(function(){for(var g="0123456789abcdef",p=new Array(256),v=0;v<16;++v)for(var S=v*16,T=0;T<16;++T)p[S+T]=g[v]+g[T];return p})()}),se=ta.Buffer;ta.SlowBuffer;ta.INSPECT_MAX_BYTES;ta.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Pc=function(e,r){return Pc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},Pc(e,r)};function ra(t,e){Pc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Yr=(function(t){ra(e,t);function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),e})(Error),ye=(function(t){ra(e,t);function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),e})(TypeError);function Ki(t){return t&&t.Math==Math&&t}function Z0(){return Ki(typeof globalThis=="object"&&globalThis)||Ki(typeof window=="object"&&window)||Ki(typeof self=="object"&&self)||Ki(typeof global=="object"&&global)||Function("return this")()}function $1(){var t=Z0();return typeof t.navigator=="object"&&t.navigator.product==="ReactNative"}var W1=function(e){var r=$1()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var n=se.alloc(e),o=0;o<e;++o)n[o]=Math.floor(Math.random()*256);return n},G1=function(){{if(typeof window<"u"){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(se.alloc(e))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(e){return global.crypto.getRandomValues(se.alloc(e))}:W1}},em=G1();function H1(t){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(t))}function El(t){return Object.prototype.toString.call(t)==="[object Uint8Array]"}function V1(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function K1(t){return Ci(t)&&Object.prototype.toString.call(t)==="[object Date]"}function Ci(t){return typeof t=="object"&&t!==null}function na(t,e){var r=!1;function n(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return r||(console.warn(e),r=!0),t.apply(this,o)}return n}function Uo(t){if(ArrayBuffer.isView(t))return se.from(t.buffer,t.byteOffset,t.byteLength);if(H1(t))return se.from(t);throw new ye("Must use either Buffer or TypedArray")}var J1=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,tm=function(t){return typeof t=="string"&&J1.test(t)},Dc=function(t){if(!tm(t))throw new ye('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var e=t.replace(/-/g,"");return se.from(e,"hex")},Jp=function(t,e){return e===void 0&&(e=!0),e?t.toString("hex",0,4)+"-"+t.toString("hex",4,6)+"-"+t.toString("hex",6,8)+"-"+t.toString("hex",8,10)+"-"+t.toString("hex",10,16):t.toString("hex")},z1=Math.pow(2,53),Y1=-Math.pow(2,53),rm=4,Qr=(function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(e!=null&&typeof e!="string"&&!ArrayBuffer.isView(e)&&!(e instanceof ArrayBuffer)&&!Array.isArray(e))throw new ye("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??t.BSON_BINARY_SUBTYPE_DEFAULT,e==null?(this.buffer=se.alloc(t.BUFFER_SIZE),this.position=0):(typeof e=="string"?this.buffer=se.from(e,"binary"):Array.isArray(e)?this.buffer=se.from(e):this.buffer=Uo(e),this.position=this.buffer.byteLength)}return t.prototype.put=function(e){if(typeof e=="string"&&e.length!==1)throw new ye("only accepts single character String");if(typeof e!="number"&&e.length!==1)throw new ye("only accepts single character Uint8Array or Array");var r;if(typeof e=="string"?r=e.charCodeAt(0):typeof e=="number"?r=e:r=e[0],r<0||r>255)throw new ye("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=se.alloc(t.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},t.prototype.write=function(e,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+e.length){var n=se.alloc(this.buffer.length+e.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(e)?(this.buffer.set(Uo(e),r),this.position=r+e.byteLength>this.position?r+e.length:this.position):typeof e=="string"&&(this.buffer.write(e,r,e.length,"binary"),this.position=r+e.length>this.position?r+e.length:this.position)},t.prototype.read=function(e,r){return r=r&&r>0?r:this.position,this.buffer.slice(e,e+r)},t.prototype.value=function(e){return e=!!e,e&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},t.prototype.length=function(){return this.position},t.prototype.toJSON=function(){return this.buffer.toString("base64")},t.prototype.toString=function(e){return this.buffer.toString(e)},t.prototype.toExtendedJSON=function(e){e=e||{};var r=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}},t.prototype.toUUID=function(){if(this.sub_type===t.SUBTYPE_UUID)return new zp(this.buffer.slice(0,this.position));throw new Yr('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(t.SUBTYPE_UUID,'" is currently supported.'))},t.fromExtendedJSON=function(e,r){r=r||{};var n,o;if("$binary"in e?r.legacy&&typeof e.$binary=="string"&&"$type"in e?(o=e.$type?parseInt(e.$type,16):0,n=se.from(e.$binary,"base64")):typeof e.$binary!="string"&&(o=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=se.from(e.$binary.base64,"base64")):"$uuid"in e&&(o=4,n=Dc(e.$uuid)),!n)throw new ye("Unexpected Binary Extended JSON format ".concat(JSON.stringify(e)));return o===rm?new zp(n):new t(n,o)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BUFFER_SIZE=256,t.SUBTYPE_DEFAULT=0,t.SUBTYPE_FUNCTION=1,t.SUBTYPE_BYTE_ARRAY=2,t.SUBTYPE_UUID_OLD=3,t.SUBTYPE_UUID=4,t.SUBTYPE_MD5=5,t.SUBTYPE_ENCRYPTED=6,t.SUBTYPE_COLUMN=7,t.SUBTYPE_USER_DEFINED=128,t})();Object.defineProperty(Qr.prototype,"_bsontype",{value:"Binary"});var rc=16,zp=(function(t){ra(e,t);function e(r){var n=this,o,i;if(r==null)o=e.generate();else if(r instanceof e)o=se.from(r.buffer),i=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===rc)o=Uo(r);else if(typeof r=="string")o=Dc(r);else throw new ye("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return n=t.call(this,o,rm)||this,n.__id=i,n}return Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,e.cacheHexString&&(this.__id=Jp(r))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(r){if(r===void 0&&(r=!0),e.cacheHexString&&this.__id)return this.__id;var n=Jp(this.id,r);return e.cacheHexString&&(this.__id=n),n},e.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(r){if(!r)return!1;if(r instanceof e)return r.id.equals(this.id);try{return new e(r).id.equals(this.id)}catch{return!1}},e.prototype.toBinary=function(){return new Qr(this.id,Qr.SUBTYPE_UUID)},e.generate=function(){var r=em(rc);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,se.from(r)},e.isValid=function(r){return r?r instanceof e?!0:typeof r=="string"?tm(r):El(r)?r.length!==rc?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},e.createFromHexString=function(r){var n=Dc(r);return new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},e})(Qr),ia=(function(){function t(e,r){if(!(this instanceof t))return new t(e,r);this.code=e,this.scope=r}return t.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},t.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},t.fromExtendedJSON=function(e){return new t(e.$code,e.$scope)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},t})();Object.defineProperty(ia.prototype,"_bsontype",{value:"Code"});function Q1(t){return Ci(t)&&t.$id!=null&&typeof t.$ref=="string"&&(t.$db==null||typeof t.$db=="string")}var Ii=(function(){function t(e,r,n,o){if(!(this instanceof t))return new t(e,r,n,o);var i=e.split(".");i.length===2&&(n=i.shift(),e=i.shift()),this.collection=e,this.oid=r,this.db=n,this.fields=o||{}}return Object.defineProperty(t.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(e.$db=this.db),e},t.prototype.toExtendedJSON=function(e){e=e||{};var r={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},t.fromExtendedJSON=function(e){var r=Object.assign({},e);return delete r.$ref,delete r.$id,delete r.$db,new t(e.$ref,e.$id,e.$db,r)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},t})();Object.defineProperty(Ii.prototype,"_bsontype",{value:"DBRef"});var dt=void 0;try{dt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var Yp=65536,X1=1<<24,En=Yp*Yp,nm=En*En,Qp=nm/2,Xp={},Zp={},G=(function(){function t(e,r,n){if(e===void 0&&(e=0),!(this instanceof t))return new t(e,r,n);typeof e=="bigint"?Object.assign(this,t.fromBigInt(e,!!r)):typeof e=="string"?Object.assign(this,t.fromString(e,!!r)):(this.low=e|0,this.high=r|0,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return t.fromBits=function(e,r,n){return new t(e,r,n)},t.fromInt=function(e,r){var n,o,i;return r?(e>>>=0,(i=0<=e&&e<256)&&(o=Zp[e],o)?o:(n=t.fromBits(e,(e|0)<0?-1:0,!0),i&&(Zp[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(o=Xp[e],o)?o:(n=t.fromBits(e,e<0?-1:0,!1),i&&(Xp[e]=n),n))},t.fromNumber=function(e,r){if(isNaN(e))return r?t.UZERO:t.ZERO;if(r){if(e<0)return t.UZERO;if(e>=nm)return t.MAX_UNSIGNED_VALUE}else{if(e<=-Qp)return t.MIN_VALUE;if(e+1>=Qp)return t.MAX_VALUE}return e<0?t.fromNumber(-e,r).neg():t.fromBits(e%En|0,e/En|0,r)},t.fromBigInt=function(e,r){return t.fromString(e.toString(),r)},t.fromString=function(e,r,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var o;if((o=e.indexOf("-"))>0)throw Error("interior hyphen");if(o===0)return t.fromString(e.substring(1),r,n).neg();for(var i=t.fromNumber(Math.pow(n,8)),s=t.ZERO,u=0;u<e.length;u+=8){var l=Math.min(8,e.length-u),a=parseInt(e.substring(u,u+l),n);if(l<8){var c=t.fromNumber(Math.pow(n,l));s=s.mul(c).add(t.fromNumber(a))}else s=s.mul(i),s=s.add(t.fromNumber(a))}return s.unsigned=r,s},t.fromBytes=function(e,r,n){return n?t.fromBytesLE(e,r):t.fromBytesBE(e,r)},t.fromBytesLE=function(e,r){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},t.fromBytesBE=function(e,r){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)},t.isLong=function(e){return Ci(e)&&e.__isLong__===!0},t.fromValue=function(e,r){return typeof e=="number"?t.fromNumber(e,r):typeof e=="string"?t.fromString(e,r):t.fromBits(e.low,e.high,typeof r=="boolean"?r:e.unsigned)},t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,i=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,a=e.low&65535,c=0,f=0,d=0,h=0;return h+=i+a,d+=h>>>16,h&=65535,d+=o+l,f+=d>>>16,d&=65535,f+=n+u,c+=f>>>16,f&=65535,c+=r+s,c&=65535,t.fromBits(d<<16|h,c<<16|f,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.prototype.comp=function(e){return this.compare(e)},t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");if(dt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?dt.div_u:dt.div_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,dt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,o,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return t.UZERO;if(e.gt(this.shru(1)))return t.UONE;i=t.UZERO}else{if(this.eq(t.MIN_VALUE)){if(e.eq(t.ONE)||e.eq(t.NEG_ONE))return t.MIN_VALUE;if(e.eq(t.MIN_VALUE))return t.ONE;var s=this.shr(1);return n=s.div(e).shl(1),n.eq(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(o=this.sub(e.mul(n)),i=n.add(o.div(e)),i)}else if(e.eq(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=t.ZERO}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var u=Math.ceil(Math.log(n)/Math.LN2),l=u<=48?1:Math.pow(2,u-48),a=t.fromNumber(n),c=a.mul(e);c.isNegative()||c.gt(o);)n-=l,a=t.fromNumber(n,this.unsigned),c=a.mul(e);a.isZero()&&(a=t.ONE),i=i.add(a),o=o.sub(c)}return i},t.prototype.div=function(e){return this.divide(e)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},t.prototype.eq=function(e){return this.equals(e)},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(t.MIN_VALUE)?64:this.neg().getNumBitsAbs();var e=this.high!==0?this.high:this.low,r;for(r=31;r>0&&(e&1<<r)===0;r--);return this.high!==0?r+33:r+1},t.prototype.greaterThan=function(e){return this.comp(e)>0},t.prototype.gt=function(e){return this.greaterThan(e)},t.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},t.prototype.gte=function(e){return this.greaterThanOrEqual(e)},t.prototype.ge=function(e){return this.greaterThanOrEqual(e)},t.prototype.isEven=function(){return(this.low&1)===0},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isOdd=function(){return(this.low&1)===1},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isZero=function(){return this.high===0&&this.low===0},t.prototype.lessThan=function(e){return this.comp(e)<0},t.prototype.lt=function(e){return this.lessThan(e)},t.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},t.prototype.lte=function(e){return this.lessThanOrEqual(e)},t.prototype.modulo=function(e){if(t.isLong(e)||(e=t.fromValue(e)),dt){var r=(this.unsigned?dt.rem_u:dt.rem_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,dt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},t.prototype.mod=function(e){return this.modulo(e)},t.prototype.rem=function(e){return this.modulo(e)},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),dt){var r=dt.mul(this.low,this.high,e.low,e.high);return t.fromBits(r,dt.get_high(),this.unsigned)}if(e.isZero())return t.ZERO;if(this.eq(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.eq(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(t.TWO_PWR_24)&&e.lt(t.TWO_PWR_24))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,i=this.low>>>16,s=this.low&65535,u=e.high>>>16,l=e.high&65535,a=e.low>>>16,c=e.low&65535,f=0,d=0,h=0,y=0;return y+=s*c,h+=y>>>16,y&=65535,h+=i*c,d+=h>>>16,h&=65535,h+=s*a,d+=h>>>16,h&=65535,d+=o*c,f+=d>>>16,d&=65535,d+=i*a,f+=d>>>16,d&=65535,d+=s*l,f+=d>>>16,d&=65535,f+=n*c+o*a+i*l+s*u,f&=65535,t.fromBits(h<<16|y,f<<16|d,this.unsigned)},t.prototype.mul=function(e){return this.multiply(e)},t.prototype.negate=function(){return!this.unsigned&&this.eq(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=function(){return this.negate()},t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.notEquals=function(e){return!this.equals(e)},t.prototype.neq=function(e){return this.notEquals(e)},t.prototype.ne=function(e){return this.notEquals(e)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=function(e){return this.shiftLeft(e)},t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=function(e){return this.shiftRight(e)},t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),e&=63,e===0)return this;var r=this.high;if(e<32){var n=this.low;return t.fromBits(n>>>e|r<<32-e,r>>>e,this.unsigned)}else return e===32?t.fromBits(r,0,this.unsigned):t.fromBits(r>>>e-32,0,this.unsigned)},t.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},t.prototype.shru=function(e){return this.shiftRightUnsigned(e)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.neg())},t.prototype.sub=function(e){return this.subtract(e)},t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*En+(this.low>>>0):this.high*En+(this.low>>>0)},t.prototype.toBigInt=function(){return BigInt(this.toString())},t.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},t.prototype.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},t.prototype.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},t.prototype.toSigned=function(){return this.unsigned?t.fromBits(this.low,this.high,!1):this},t.prototype.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(t.MIN_VALUE)){var r=t.fromNumber(e),n=this.div(r),o=n.mul(r).sub(this);return n.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=t.fromNumber(Math.pow(e,6),this.unsigned),s=this,u="";;){var l=s.div(i),a=s.sub(l.mul(i)).toInt()>>>0,c=a.toString(e);if(s=l,s.isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},t.prototype.toUnsigned=function(){return this.unsigned?this:t.fromBits(this.low,this.high,!0)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.eqz=function(){return this.isZero()},t.prototype.le=function(e){return this.lessThanOrEqual(e)},t.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},t.fromExtendedJSON=function(e,r){var n=t.fromString(e.$numberLong);return r&&r.relaxed?n.toNumber():n},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},t.TWO_PWR_24=t.fromInt(X1),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t})();Object.defineProperty(G.prototype,"__isLong__",{value:!0});Object.defineProperty(G.prototype,"_bsontype",{value:"Long"});var Z1=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,eS=/^(\+|-)?(Infinity|inf)$/i,tS=/^(\+|-)?NaN$/i,zn=6111,nc=-6176,ev=6176,rS=34,ic=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),tv=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),rv=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),nS=/^([-+])?(\d+)?$/,iS=31,nv=16383,oS=30,aS=31;function iv(t){return!isNaN(parseInt(t,10))}function sS(t){var e=G.fromNumber(1e9),r=G.fromNumber(0);if(!t.parts[0]&&!t.parts[1]&&!t.parts[2]&&!t.parts[3])return{quotient:t,rem:r};for(var n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new G(t.parts[n],0)),t.parts[n]=r.div(e).low,r=r.modulo(e);return{quotient:t,rem:r}}function uS(t,e){if(!t&&!e)return{high:G.fromNumber(0),low:G.fromNumber(0)};var r=t.shiftRightUnsigned(32),n=new G(t.getLowBits(),0),o=e.shiftRightUnsigned(32),i=new G(e.getLowBits(),0),s=r.multiply(o),u=r.multiply(i),l=n.multiply(o),a=n.multiply(i);return s=s.add(u.shiftRightUnsigned(32)),u=new G(u.getLowBits(),0).add(l).add(a.shiftRightUnsigned(32)),s=s.add(u.shiftRightUnsigned(32)),a=u.shiftLeft(32).add(new G(a.getLowBits(),0)),{high:s,low:a}}function cS(t,e){var r=t.high>>>0,n=e.high>>>0;if(r<n)return!0;if(r===n){var o=t.low>>>0,i=e.low>>>0;if(o<i)return!0}return!1}function pn(t,e){throw new ye('"'.concat(t,'" is not a valid Decimal128 string - ').concat(e))}var Sl=(function(){function t(e){if(!(this instanceof t))return new t(e);if(typeof e=="string")this.bytes=t.fromString(e).bytes;else if(El(e)){if(e.byteLength!==16)throw new ye("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new ye("Decimal128 must take a Buffer or string")}return t.fromString=function(e){var r=!1,n=!1,o=!1,i=0,s=0,u=0,l=0,a=0,c=[0],f=0,d=0,h=0,y=0,m=0,b=0,w=new G(0,0),_=new G(0,0),E=0,I=0;if(e.length>=7e3)throw new ye(""+e+" not a valid Decimal128 string");var R=e.match(Z1),x=e.match(eS),P=e.match(tS);if(!R&&!x&&!P||e.length===0)throw new ye(""+e+" not a valid Decimal128 string");if(R){var D=R[2],O=R[4],C=R[5],A=R[6];O&&A===void 0&&pn(e,"missing exponent power"),O&&D===void 0&&pn(e,"missing exponent base"),O===void 0&&(C||A)&&pn(e,"missing e before exponent")}if((e[I]==="+"||e[I]==="-")&&(r=e[I++]==="-"),!iv(e[I])&&e[I]!=="."){if(e[I]==="i"||e[I]==="I")return new t(se.from(r?tv:rv));if(e[I]==="N")return new t(se.from(ic))}for(;iv(e[I])||e[I]===".";){if(e[I]==="."){n&&pn(e,"contains multiple periods"),n=!0,I=I+1;continue}f<34&&(e[I]!=="0"||o)&&(o||(a=s),o=!0,c[d++]=parseInt(e[I],10),f=f+1),o&&(u=u+1),n&&(l=l+1),s=s+1,I=I+1}if(n&&!s)throw new ye(""+e+" not a valid Decimal128 string");if(e[I]==="e"||e[I]==="E"){var N=e.substr(++I).match(nS);if(!N||!N[2])return new t(se.from(ic));m=parseInt(N[0],10),I=I+N[0].length}if(e[I])return new t(se.from(ic));if(h=0,!f)h=0,y=0,c[0]=0,u=1,f=1,i=0;else if(y=f-1,i=u,i!==1)for(;c[a+i-1]===0;)i=i-1;for(m<=l&&l-m>16384?m=nc:m=m-l;m>zn;){if(y=y+1,y-h>rS){var U=c.join("");if(U.match(/^0+$/)){m=zn;break}pn(e,"overflow")}m=m-1}for(;m<nc||f<u;){if(y===0&&i<f){m=nc,i=0;break}if(f<u?u=u-1:y=y-1,m<zn)m=m+1;else{var U=c.join("");if(U.match(/^0+$/)){m=zn;break}pn(e,"overflow")}}if(y-h+1<i){var q=s;n&&(a=a+1,q=q+1),r&&(a=a+1,q=q+1);var W=parseInt(e[a+y+1],10),ae=0;if(W>=5&&(ae=1,W===5)){for(ae=c[y]%2===1?1:0,b=a+y+2;b<q;b++)if(parseInt(e[b],10)){ae=1;break}}if(ae){for(var z=y;z>=0;z--)if(++c[z]>9&&(c[z]=0,z===0))if(m<zn)m=m+1,c[z]=1;else return new t(se.from(r?tv:rv))}}if(w=G.fromNumber(0),_=G.fromNumber(0),i===0)w=G.fromNumber(0),_=G.fromNumber(0);else if(y-h<17){var z=h;for(_=G.fromNumber(c[z++]),w=new G(0,0);z<=y;z++)_=_.multiply(G.fromNumber(10)),_=_.add(G.fromNumber(c[z]))}else{var z=h;for(w=G.fromNumber(c[z++]);z<=y-17;z++)w=w.multiply(G.fromNumber(10)),w=w.add(G.fromNumber(c[z]));for(_=G.fromNumber(c[z++]);z<=y;z++)_=_.multiply(G.fromNumber(10)),_=_.add(G.fromNumber(c[z]))}var Q=uS(w,G.fromString("100000000000000000"));Q.low=Q.low.add(_),cS(Q.low,_)&&(Q.high=Q.high.add(G.fromNumber(1))),E=m+ev;var H={low:G.fromNumber(0),high:G.fromNumber(0)};Q.high.shiftRightUnsigned(49).and(G.fromNumber(1)).equals(G.fromNumber(1))?(H.high=H.high.or(G.fromNumber(3).shiftLeft(61)),H.high=H.high.or(G.fromNumber(E).and(G.fromNumber(16383).shiftLeft(47))),H.high=H.high.or(Q.high.and(G.fromNumber(0x7fffffffffff)))):(H.high=H.high.or(G.fromNumber(E&16383).shiftLeft(49)),H.high=H.high.or(Q.high.and(G.fromNumber(562949953421311)))),H.low=Q.low,r&&(H.high=H.high.or(G.fromString("9223372036854775808")));var K=se.alloc(16);return I=0,K[I++]=H.low.low&255,K[I++]=H.low.low>>8&255,K[I++]=H.low.low>>16&255,K[I++]=H.low.low>>24&255,K[I++]=H.low.high&255,K[I++]=H.low.high>>8&255,K[I++]=H.low.high>>16&255,K[I++]=H.low.high>>24&255,K[I++]=H.high.low&255,K[I++]=H.high.low>>8&255,K[I++]=H.high.low>>16&255,K[I++]=H.high.low>>24&255,K[I++]=H.high.high&255,K[I++]=H.high.high>>8&255,K[I++]=H.high.high>>16&255,K[I++]=H.high.high>>24&255,new t(K)},t.prototype.toString=function(){for(var e,r=0,n=new Array(36),o=0;o<n.length;o++)n[o]=0;var i=0,s=!1,u,l={parts:[0,0,0,0]},a,c,f=[];i=0;var d=this.bytes,h=d[i++]|d[i++]<<8|d[i++]<<16|d[i++]<<24,y=d[i++]|d[i++]<<8|d[i++]<<16|d[i++]<<24,m=d[i++]|d[i++]<<8|d[i++]<<16|d[i++]<<24,b=d[i++]|d[i++]<<8|d[i++]<<16|d[i++]<<24;i=0;var w={low:new G(h,y),high:new G(m,b)};w.high.lessThan(G.ZERO)&&f.push("-");var _=b>>26&iS;if(_>>3===3){if(_===oS)return f.join("")+"Infinity";if(_===aS)return"NaN";e=b>>15&nv,u=8+(b>>14&1)}else u=b>>14&7,e=b>>17&nv;var E=e-ev;if(l.parts[0]=(b&16383)+((u&15)<<14),l.parts[1]=m,l.parts[2]=y,l.parts[3]=h,l.parts[0]===0&&l.parts[1]===0&&l.parts[2]===0&&l.parts[3]===0)s=!0;else for(c=3;c>=0;c--){var I=0,R=sS(l);if(l=R.quotient,I=R.rem.low,!!I)for(a=8;a>=0;a--)n[c*9+a]=I%10,I=Math.floor(I/10)}if(s)r=1,n[i]=0;else for(r=36;!n[i];)r=r-1,i=i+1;var x=r-1+E;if(x>=34||x<=-7||E>0){if(r>34)return f.push("".concat(0)),E>0?f.push("E+".concat(E)):E<0&&f.push("E".concat(E)),f.join("");f.push("".concat(n[i++])),r=r-1,r&&f.push(".");for(var o=0;o<r;o++)f.push("".concat(n[i++]));f.push("E"),x>0?f.push("+".concat(x)):f.push("".concat(x))}else if(E>=0)for(var o=0;o<r;o++)f.push("".concat(n[i++]));else{var P=r+E;if(P>0)for(var o=0;o<P;o++)f.push("".concat(n[i++]));else f.push("0");for(f.push(".");P++<0;)f.push("0");for(var o=0;o<r-Math.max(P-1,0);o++)f.push("".concat(n[i++]))}return f.join("")},t.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},t.fromExtendedJSON=function(e){return t.fromString(e.$numberDecimal)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},t})();Object.defineProperty(Sl.prototype,"_bsontype",{value:"Decimal128"});var oa=(function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toJSON=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},t.fromExtendedJSON=function(e,r){var n=parseFloat(e.$numberDouble);return r&&r.relaxed?n:new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},t})();Object.defineProperty(oa.prototype,"_bsontype",{value:"Double"});var aa=(function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e|0}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},t.fromExtendedJSON=function(e,r){return r&&r.relaxed?parseInt(e.$numberInt,10):new t(e.$numberInt)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},t})();Object.defineProperty(aa.prototype,"_bsontype",{value:"Int32"});var Il=(function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$maxKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MaxKey()"},t})();Object.defineProperty(Il.prototype,"_bsontype",{value:"MaxKey"});var Ol=(function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$minKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MinKey()"},t})();Object.defineProperty(Ol.prototype,"_bsontype",{value:"MinKey"});var lS=new RegExp("^[0-9a-fA-F]{24}$"),Ur=null,Bt=Symbol("id"),gt=(function(){function t(e){if(!(this instanceof t))return new t(e);var r;if(typeof e=="object"&&e&&"id"in e){if(typeof e.id!="string"&&!ArrayBuffer.isView(e.id))throw new ye("Argument passed in must have an id that is of type string or Buffer");"toHexString"in e&&typeof e.toHexString=="function"?r=se.from(e.toHexString(),"hex"):r=e.id}else r=e;if(r==null||typeof r=="number")this[Bt]=t.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[Bt]=r instanceof se?r:Uo(r);else if(typeof r=="string")if(r.length===12){var n=se.from(r);if(n.byteLength===12)this[Bt]=n;else throw new ye("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&lS.test(r))this[Bt]=se.from(r,"hex");else throw new ye("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new ye("Argument passed in does not match the accepted types");t.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(t.prototype,"id",{get:function(){return this[Bt]},set:function(e){this[Bt]=e,t.cacheHexString&&(this.__id=e.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(){if(t.cacheHexString&&this.__id)return this.__id;var e=this.id.toString("hex");return t.cacheHexString&&!this.__id&&(this.__id=e),e},t.getInc=function(){return t.index=(t.index+1)%16777215},t.generate=function(e){typeof e!="number"&&(e=Math.floor(Date.now()/1e3));var r=t.getInc(),n=se.alloc(12);return n.writeUInt32BE(e,0),Ur===null&&(Ur=em(5)),n[4]=Ur[0],n[5]=Ur[1],n[6]=Ur[2],n[7]=Ur[3],n[8]=Ur[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n},t.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(e==null)return!1;if(e instanceof t)return this[Bt][11]===e[Bt][11]&&this[Bt].equals(e[Bt]);if(typeof e=="string"&&t.isValid(e)&&e.length===12&&El(this.id))return e===se.prototype.toString.call(this.id,"latin1");if(typeof e=="string"&&t.isValid(e)&&e.length===24)return e.toLowerCase()===this.toHexString();if(typeof e=="string"&&t.isValid(e)&&e.length===12)return se.from(e).equals(this.id);if(typeof e=="object"&&"toHexString"in e&&typeof e.toHexString=="function"){var r=e.toHexString(),n=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===n}return!1},t.prototype.getTimestamp=function(){var e=new Date,r=this.id.readUInt32BE(0);return e.setTime(Math.floor(r)*1e3),e},t.createPk=function(){return new t},t.createFromTime=function(e){var r=se.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(e,0),new t(r)},t.createFromHexString=function(e){if(typeof e>"u"||e!=null&&e.length!==24)throw new ye("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new t(se.from(e,"hex"))},t.isValid=function(e){if(e==null)return!1;try{return new t(e),!0}catch{return!1}},t.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},t.fromExtendedJSON=function(e){return new t(e.$oid)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},t.index=Math.floor(Math.random()*16777215),t})();Object.defineProperty(gt.prototype,"generate",{value:na(function(t){return gt.generate(t)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(gt.prototype,"getInc",{value:na(function(){return gt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(gt.prototype,"get_inc",{value:na(function(){return gt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(gt,"get_inc",{value:na(function(){return gt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(gt.prototype,"_bsontype",{value:"ObjectID"});function fS(t){return t.split("").sort().join("")}var Oi=(function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(this.pattern=e,this.options=fS(r??""),this.pattern.indexOf("\0")!==-1)throw new Yr("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new Yr("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new Yr("The regular expression option [".concat(this.options[n],"] is not supported"))}return t.parseOptions=function(e){return e?e.split("").sort().join(""):""},t.prototype.toExtendedJSON=function(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},t.fromExtendedJSON=function(e){if("$regex"in e)if(typeof e.$regex!="string"){if(e.$regex._bsontype==="BSONRegExp")return e}else return new t(e.$regex,t.parseOptions(e.$options));if("$regularExpression"in e)return new t(e.$regularExpression.pattern,t.parseOptions(e.$regularExpression.options));throw new ye("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(e)))},t})();Object.defineProperty(Oi.prototype,"_bsontype",{value:"BSONRegExp"});var Al=(function(){function t(e){if(!(this instanceof t))return new t(e);this.value=e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(){return this.value},t.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(){return{$symbol:this.value}},t.fromExtendedJSON=function(e){return new t(e.$symbol)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t})();Object.defineProperty(Al.prototype,"_bsontype",{value:"Symbol"});var dS=G,im=(function(t){ra(e,t);function e(r,n){var o=this;return o instanceof e?(G.isLong(r)?o=t.call(this,r.low,r.high,!0)||this:Ci(r)&&typeof r.t<"u"&&typeof r.i<"u"?o=t.call(this,r.i,r.t,!0)||this:o=t.call(this,r,n,!0)||this,Object.defineProperty(o,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),o):new e(r,n)}return e.prototype.toJSON=function(){return{$timestamp:this.toString()}},e.fromInt=function(r){return new e(G.fromInt(r,!0))},e.fromNumber=function(r){return new e(G.fromNumber(r,!0))},e.fromBits=function(r,n){return new e(r,n)},e.fromString=function(r,n){return new e(G.fromString(r,!0,n))},e.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},e.fromExtendedJSON=function(r){return new e(r.$timestamp)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},e.MAX_VALUE=G.MAX_UNSIGNED_VALUE,e})(dS);function hS(t){return Ci(t)&&Reflect.has(t,"_bsontype")&&typeof t._bsontype=="string"}var om=2147483647,am=-2147483648,sm=9223372036854776e3,um=-9223372036854776e3,pS={$oid:gt,$binary:Qr,$uuid:Qr,$symbol:Al,$numberInt:aa,$numberDecimal:Sl,$numberDouble:oa,$numberLong:G,$minKey:Ol,$maxKey:Il,$regex:Oi,$regularExpression:Oi,$timestamp:im};function cm(t,e){if(e===void 0&&(e={}),typeof t=="number"){if(e.relaxed||e.legacy)return t;if(Math.floor(t)===t){if(t>=am&&t<=om)return new aa(t);if(t>=um&&t<=sm)return G.fromNumber(t)}return new oa(t)}if(t==null||typeof t!="object")return t;if(t.$undefined)return null;for(var r=Object.keys(t).filter(function(f){return f.startsWith("$")&&t[f]!=null}),n=0;n<r.length;n++){var o=pS[r[n]];if(o)return o.fromExtendedJSON(t,e)}if(t.$date!=null){var i=t.$date,s=new Date;return e.legacy?typeof i=="number"?s.setTime(i):typeof i=="string"&&s.setTime(Date.parse(i)):typeof i=="string"?s.setTime(Date.parse(i)):G.isLong(i)?s.setTime(i.toNumber()):typeof i=="number"&&e.relaxed&&s.setTime(i),s}if(t.$code!=null){var u=Object.assign({},t);return t.$scope&&(u.$scope=cm(t.$scope)),ia.fromExtendedJSON(t)}if(Q1(t)||t.$dbPointer){var l=t.$ref?t:t.$dbPointer;if(l instanceof Ii)return l;var a=Object.keys(l).filter(function(f){return f.startsWith("$")}),c=!0;if(a.forEach(function(f){["$ref","$id","$db"].indexOf(f)===-1&&(c=!1)}),c)return Ii.fromExtendedJSON(l)}return t}function vS(t,e){return t.map(function(r,n){e.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return pr(r,e)}finally{e.seenObjects.pop()}})}function ov(t){var e=t.toISOString();return t.getUTCMilliseconds()!==0?e:e.slice(0,-5)+"Z"}function pr(t,e){if((typeof t=="object"||typeof t=="function")&&t!==null){var r=e.seenObjects.findIndex(function(w){return w.obj===t});if(r!==-1){var n=e.seenObjects.map(function(w){return w.propertyName}),o=n.slice(0,r).map(function(w){return"".concat(w," -> ")}).join(""),i=n[r],s=" -> "+n.slice(r+1,n.length-1).map(function(w){return"".concat(w," -> ")}).join(""),u=n[n.length-1],l=" ".repeat(o.length+i.length/2),a="-".repeat(s.length+(i.length+u.length)/2-1);throw new ye(`Converting circular structure to EJSON:
`+"    ".concat(o).concat(i).concat(s).concat(u,`
`)+"    ".concat(l,"\\").concat(a,"/"))}e.seenObjects[e.seenObjects.length-1].obj=t}if(Array.isArray(t))return vS(t,e);if(t===void 0)return null;if(t instanceof Date||K1(t)){var c=t.getTime(),f=c>-1&&c<2534023188e5;return e.legacy?e.relaxed&&f?{$date:t.getTime()}:{$date:ov(t)}:e.relaxed&&f?{$date:ov(t)}:{$date:{$numberLong:t.getTime().toString()}}}if(typeof t=="number"&&(!e.relaxed||!isFinite(t))){if(Math.floor(t)===t){var d=t>=am&&t<=om,h=t>=um&&t<=sm;if(d)return{$numberInt:t.toString()};if(h)return{$numberLong:t.toString()}}return{$numberDouble:t.toString()}}if(t instanceof RegExp||V1(t)){var y=t.flags;if(y===void 0){var m=t.toString().match(/[gimuy]*$/);m&&(y=m[0])}var b=new Oi(t.source,y);return b.toExtendedJSON(e)}return t!=null&&typeof t=="object"?mS(t,e):t}var yS={Binary:function(t){return new Qr(t.value(),t.sub_type)},Code:function(t){return new ia(t.code,t.scope)},DBRef:function(t){return new Ii(t.collection||t.namespace,t.oid,t.db,t.fields)},Decimal128:function(t){return new Sl(t.bytes)},Double:function(t){return new oa(t.value)},Int32:function(t){return new aa(t.value)},Long:function(t){return G.fromBits(t.low!=null?t.low:t.low_,t.low!=null?t.high:t.high_,t.low!=null?t.unsigned:t.unsigned_)},MaxKey:function(){return new Il},MinKey:function(){return new Ol},ObjectID:function(t){return new gt(t)},ObjectId:function(t){return new gt(t)},BSONRegExp:function(t){return new Oi(t.pattern,t.options)},Symbol:function(t){return new Al(t.value)},Timestamp:function(t){return im.fromBits(t.low,t.high)}};function mS(t,e){if(t==null||typeof t!="object")throw new Yr("not an object instance");var r=t._bsontype;if(typeof r>"u"){var n={};for(var o in t){e.seenObjects.push({propertyName:o,obj:null});try{var i=pr(t[o],e);o==="__proto__"?Object.defineProperty(n,o,{value:i,writable:!0,enumerable:!0,configurable:!0}):n[o]=i}finally{e.seenObjects.pop()}}return n}else if(hS(t)){var s=t;if(typeof s.toExtendedJSON!="function"){var u=yS[t._bsontype];if(!u)throw new ye("Unrecognized or invalid _bsontype: "+t._bsontype);s=u(s)}return r==="Code"&&s.scope?s=new ia(s.code,pr(s.scope,e)):r==="DBRef"&&s.oid&&(s=new Ii(pr(s.collection,e),pr(s.oid,e),pr(s.db,e),pr(s.fields,e))),s.toExtendedJSON(e)}else throw new Yr("_bsontype must be a string, but was: "+typeof r)}var at;(function(t){function e(i,s){var u=Object.assign({},{relaxed:!0,legacy:!1},s);return typeof u.relaxed=="boolean"&&(u.strict=!u.relaxed),typeof u.strict=="boolean"&&(u.relaxed=!u.strict),JSON.parse(i,function(l,a){if(l.indexOf("\0")!==-1)throw new Yr("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(l)));return cm(a,u)})}t.parse=e;function r(i,s,u,l){u!=null&&typeof u=="object"&&(l=u,u=0),s!=null&&typeof s=="object"&&!Array.isArray(s)&&(l=s,s=void 0,u=0);var a=Object.assign({relaxed:!0,legacy:!1},l,{seenObjects:[{propertyName:"(root)",obj:null}]}),c=pr(i,a);return JSON.stringify(c,s,u)}t.stringify=r;function n(i,s){return s=s||{},JSON.parse(r(i,s))}t.serialize=n;function o(i,s){return s=s||{},e(JSON.stringify(i),s)}t.deserialize=o})(at||(at={}));var av=Z0();av.Map?av.Map:(function(){function t(e){e===void 0&&(e=[]),this._keys=[],this._values={};for(var r=0;r<e.length;r++)if(e[r]!=null){var n=e[r],o=n[0],i=n[1];this._keys.push(o),this._values[o]={v:i,i:this._keys.length-1}}}return t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(e){var r=this._values[e];return r==null?!1:(delete this._values[e],this._keys.splice(r.i,1),!0)},t.prototype.entries=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?[n,e._values[n].v]:void 0,done:n===void 0}}}},t.prototype.forEach=function(e,r){r=r||this;for(var n=0;n<this._keys.length;n++){var o=this._keys[n];e.call(r,this._values[o].v,o,r)}},t.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},t.prototype.has=function(e){return this._values[e]!=null},t.prototype.keys=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?n:void 0,done:n===void 0}}}},t.prototype.set=function(e,r){return this._values[e]?(this._values[e].v=r,this):(this._keys.push(e),this._values[e]={v:r,i:this._keys.length-1},this)},t.prototype.values=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?e._values[n].v:void 0,done:n===void 0}}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),t})();G.fromNumber(z1);G.fromNumber(Y1);var oc=new Uint8Array(8);new DataView(oc.buffer,oc.byteOffset,oc.byteLength);var gS=1024*1024*17;se.alloc(gS);var _S=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},bS=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},lm=(function(){function t(e,r){this._stages=[],e&&r&&(this._db=e,this._request=new Ge.reqClass(this._db.config),this._collectionName=r)}return t.prototype.end=function(){return _S(this,void 0,void 0,function(){var e;return bS(this,function(r){switch(r.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return e=r.sent(),e&&e.data&&e.data.list?[2,{requestId:e.requestId,data:JSON.parse(e.data.list).map(at.parse)}]:[2,e]}})})},t.prototype.unwrap=function(){return this._stages},t.prototype.done=function(){return this._stages.map(function(e){var r,n=e.stageKey,o=e.stageValue;return r={},r[n]=JSON.parse(o),r})},t.prototype._pipe=function(e,r){return this._stages.push({stageKey:"$"+e,stageValue:JSON.stringify(r)}),this},t.prototype.addFields=function(e){return this._pipe("addFields",e)},t.prototype.bucket=function(e){return this._pipe("bucket",e)},t.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},t.prototype.count=function(e){return this._pipe("count",e)},t.prototype.geoNear=function(e){return e.query&&(e.query=Lo.encode(e.query)),e.distanceMultiplier&&typeof e.distanceMultiplier=="number"&&(e.distanceMultiplier=e.distanceMultiplier),e.near&&(e.near=new tt(e.near.longitude,e.near.latitude).toJSON()),this._pipe("geoNear",e)},t.prototype.group=function(e){return this._pipe("group",e)},t.prototype.limit=function(e){return this._pipe("limit",e)},t.prototype.match=function(e){return this._pipe("match",Lo.encode(e))},t.prototype.project=function(e){return this._pipe("project",e)},t.prototype.lookup=function(e){return this._pipe("lookup",e)},t.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},t.prototype.sample=function(e){return this._pipe("sample",e)},t.prototype.skip=function(e){return this._pipe("skip",e)},t.prototype.sort=function(e){return this._pipe("sort",e)},t.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},t.prototype.unwind=function(e){return this._pipe("unwind",e)},t})(),wS=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),ES=(function(t){wS(e,t);function e(r,n){return t.call(this,r,n)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new Kp(this._db,this._coll,r)},e.prototype.add=function(r,n){var o=new Kp(this._db,this._coll,void 0);return o.create(r,n)},e.prototype.aggregate=function(){return new lm(this._db,this._coll)},e})(T1),SS={eq:function(t){return new Ce(J.EQ,[t])},neq:function(t){return new Ce(J.NEQ,[t])},lt:function(t){return new Ce(J.LT,[t])},lte:function(t){return new Ce(J.LTE,[t])},gt:function(t){return new Ce(J.GT,[t])},gte:function(t){return new Ce(J.GTE,[t])},in:function(t){return new Ce(J.IN,t)},nin:function(t){return new Ce(J.NIN,t)},all:function(t){return new Ce(J.ALL,t)},elemMatch:function(t){return new Ce(J.ELEM_MATCH,[t])},exists:function(t){return new Ce(J.EXISTS,[t])},size:function(t){return new Ce(J.SIZE,[t])},mod:function(t){return new Ce(J.MOD,[t])},geoNear:function(t){return new Ce(J.GEO_NEAR,[t])},geoWithin:function(t){return new Ce(J.GEO_WITHIN,[t])},geoIntersects:function(t){return new Ce(J.GEO_INTERSECTS,[t])},and:function(){var t=_e(arguments[0])?arguments[0]:Array.from(arguments);return new Vr(ut.AND,t)},nor:function(){var t=_e(arguments[0])?arguments[0]:Array.from(arguments);return new Vr(ut.NOR,t)},or:function(){var t=_e(arguments[0])?arguments[0]:Array.from(arguments);return new Vr(ut.OR,t)},not:function(){var t=_e(arguments[0])?arguments[0]:Array.from(arguments);return new Vr(ut.NOT,t)},set:function(t){return new Ae(ne.SET,[t])},remove:function(){return new Ae(ne.REMOVE,[])},inc:function(t){return new Ae(ne.INC,[t])},mul:function(t){return new Ae(ne.MUL,[t])},push:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r;if(wr(t[0])&&t[0].hasOwnProperty("each")){var n=t[0];r={$each:n.each,$position:n.position,$sort:n.sort,$slice:n.slice}}else _e(t[0])?r=t[0]:r=Array.from(t);return new Ae(ne.PUSH,r)},pull:function(t){return new Ae(ne.PULL,t)},pullAll:function(t){return new Ae(ne.PULL_ALL,t)},pop:function(){return new Ae(ne.POP,[])},shift:function(){return new Ae(ne.SHIFT,[])},unshift:function(){var t=_e(arguments[0])?arguments[0]:Array.from(arguments);return new Ae(ne.UNSHIFT,t)},addToSet:function(t){return new Ae(ne.ADD_TO_SET,t)},rename:function(t){return new Ae(ne.RENAME,[t])},bit:function(t){return new Ae(ne.BIT,[t])},max:function(t){return new Ae(ne.MAX,[t])},min:function(t){return new Ae(ne.MIN,[t])},expr:function(t){return{$expr:t}},jsonSchema:function(t){return{$jsonSchema:t}},text:function(t){return _1(t)?{$search:t.search}:{$search:t.search,$language:t.language,$caseSensitive:t.caseSensitive,$diacriticSensitive:t.diacriticSensitive}},aggregate:{pipeline:function(){return new lm},abs:function(t){return new B("abs",t)},add:function(t){return new B("add",t)},ceil:function(t){return new B("ceil",t)},divide:function(t){return new B("divide",t)},exp:function(t){return new B("exp",t)},floor:function(t){return new B("floor",t)},ln:function(t){return new B("ln",t)},log:function(t){return new B("log",t)},log10:function(t){return new B("log10",t)},mod:function(t){return new B("mod",t)},multiply:function(t){return new B("multiply",t)},pow:function(t){return new B("pow",t)},sqrt:function(t){return new B("sqrt",t)},subtract:function(t){return new B("subtract",t)},trunc:function(t){return new B("trunc",t)},arrayElemAt:function(t){return new B("arrayElemAt",t)},arrayToObject:function(t){return new B("arrayToObject",t)},concatArrays:function(t){return new B("concatArrays",t)},filter:function(t){return new B("filter",t)},in:function(t){return new B("in",t)},indexOfArray:function(t){return new B("indexOfArray",t)},isArray:function(t){return new B("isArray",t)},map:function(t){return new B("map",t)},range:function(t){return new B("range",t)},reduce:function(t){return new B("reduce",t)},reverseArray:function(t){return new B("reverseArray",t)},size:function(t){return new B("size",t)},slice:function(t){return new B("slice",t)},zip:function(t){return new B("zip",t)},and:function(t){return new B("and",t)},not:function(t){return new B("not",t)},or:function(t){return new B("or",t)},cmp:function(t){return new B("cmp",t)},eq:function(t){return new B("eq",t)},gt:function(t){return new B("gt",t)},gte:function(t){return new B("gte",t)},lt:function(t){return new B("lt",t)},lte:function(t){return new B("lte",t)},neq:function(t){return new B("ne",t)},cond:function(t){return new B("cond",t)},ifNull:function(t){return new B("ifNull",t)},switch:function(t){return new B("switch",t)},dateFromParts:function(t){return new B("dateFromParts",t)},dateFromString:function(t){return new B("dateFromString",t)},dayOfMonth:function(t){return new B("dayOfMonth",t)},dayOfWeek:function(t){return new B("dayOfWeek",t)},dayOfYear:function(t){return new B("dayOfYear",t)},isoDayOfWeek:function(t){return new B("isoDayOfWeek",t)},isoWeek:function(t){return new B("isoWeek",t)},isoWeekYear:function(t){return new B("isoWeekYear",t)},millisecond:function(t){return new B("millisecond",t)},minute:function(t){return new B("minute",t)},month:function(t){return new B("month",t)},second:function(t){return new B("second",t)},hour:function(t){return new B("hour",t)},week:function(t){return new B("week",t)},year:function(t){return new B("year",t)},literal:function(t){return new B("literal",t)},mergeObjects:function(t){return new B("mergeObjects",t)},objectToArray:function(t){return new B("objectToArray",t)},allElementsTrue:function(t){return new B("allElementsTrue",t)},anyElementTrue:function(t){return new B("anyElementTrue",t)},setDifference:function(t){return new B("setDifference",t)},setEquals:function(t){return new B("setEquals",t)},setIntersection:function(t){return new B("setIntersection",t)},setIsSubset:function(t){return new B("setIsSubset",t)},setUnion:function(t){return new B("setUnion",t)},concat:function(t){return new B("concat",t)},dateToString:function(t){return new B("dateToString",t)},indexOfBytes:function(t){return new B("indexOfBytes",t)},indexOfCP:function(t){return new B("indexOfCP",t)},split:function(t){return new B("split",t)},strLenBytes:function(t){return new B("strLenBytes",t)},strLenCP:function(t){return new B("strLenCP",t)},strcasecmp:function(t){return new B("strcasecmp",t)},substr:function(t){return new B("substr",t)},substrBytes:function(t){return new B("substrBytes",t)},substrCP:function(t){return new B("substrCP",t)},toLower:function(t){return new B("toLower",t)},toUpper:function(t){return new B("toUpper",t)},meta:function(t){return new B("meta",t)},addToSet:function(t){return new B("addToSet",t)},avg:function(t){return new B("avg",t)},first:function(t){return new B("first",t)},last:function(t){return new B("last",t)},max:function(t){return new B("max",t)},min:function(t){return new B("min",t)},push:function(t){return new B("push",t)},stdDevPop:function(t){return new B("stdDevPop",t)},stdDevSamp:function(t){return new B("stdDevSamp",t)},sum:function(t){return new B("sum",t)},let:function(t){return new B("let",t)}},project:{slice:function(t){return new sv("slice",t)},elemMatch:function(t){return new sv("elemMatch",t)}}},B=(function(){function t(e,r){this["$"+e]=r}return t})(),sv=(function(){function t(e,r){this["$"+e]=r}return t})(),IS=(function(){function t(e){var r=e.regexp,n=e.options;if(!r)throw new TypeError("regexp must be a string");this.$regex=r,this.$options=n}return t.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(t.prototype,"_internalType",{get:function(){return H0},enumerable:!0,configurable:!0}),t})();function OS(t){return new IS(t)}var fm={INSERT_DOC_FAIL:{message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT"}},Mt=function(){return Mt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Mt.apply(this,arguments)},Yn=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},Qn=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},AS="database.getInTransaction",uv="database.updateDocInTransaction",TS="database.deleteDocInTransaction",RS="database.insertDocInTransaction",cv=(function(){function t(e,r,n){this._coll=r,this.id=n,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return t.prototype.create=function(e){return Yn(this,void 0,void 0,function(){var r,n,o,i;return Qn(this,function(s){switch(s.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,data:at.stringify(Si(e),{relaxed:!1})},this.id&&(r._id=this.id),[4,this._request.send(RS,r)];case 1:if(n=s.sent(),n.code)throw n;if(o=at.parse(n.inserted),i=at.parse(n.ok),i==1&&o==1)return[2,Mt(Mt({},n),{ok:i,inserted:o})];throw new Error(fm.INSERT_DOC_FAIL.message)}})})},t.prototype.get=function(){return Yn(this,void 0,void 0,function(){var e,r;return Qn(this,function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(AS,e)];case 1:if(r=n.sent(),r.code)throw r;return[2,{data:r.data!=="null"?ea.formatField(at.parse(r.data)):at.parse(r.data),requestId:r.requestId}]}})})},t.prototype.set=function(e){return Yn(this,void 0,void 0,function(){var r,n;return Qn(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:at.stringify(Si(e),{relaxed:!1}),upsert:!0},[4,this._request.send(uv,r)];case 1:if(n=o.sent(),n.code)throw n;return[2,Mt(Mt({},n),{updated:at.parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})]}})})},t.prototype.update=function(e){return Yn(this,void 0,void 0,function(){var r,n;return Qn(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:at.stringify(wl.encode(e),{relaxed:!1})},[4,this._request.send(uv,r)];case 1:if(n=o.sent(),n.code)throw n;return[2,Mt(Mt({},n),{updated:at.parse(n.updated)})]}})})},t.prototype.delete=function(){return Yn(this,void 0,void 0,function(){var e,r;return Qn(this,function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(TS,e)];case 1:if(r=n.sent(),r.code)throw r;return[2,Mt(Mt({},r),{deleted:at.parse(r.deleted)})]}})})},t})(),CS=(function(){function t(e,r){this._coll=r,this._transaction=e}return t})(),xS=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),NS=(function(t){xS(e,t);function e(r,n){return t.call(this,r,n)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new cv(this._transaction,this._coll,r)},e.prototype.add=function(r){var n;r._id!==void 0&&(n=r._id);var o=new cv(this._transaction,this._coll,n);return o.create(r)},e})(CS),Cn=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(c){try{a(n.next(c))}catch(f){s(f)}}function l(c){try{a(n.throw(c))}catch(f){s(f)}}function a(c){c.done?i(c.value):o(c.value).then(u,l)}a((n=n.apply(t,e||[])).next())})},xn=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(c){a=[6,c],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},PS="database.startTransaction",DS="database.commitTransaction",LS="database.abortTransaction",dm=(function(){function t(e){this._db=e,this._request=new Ge.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return t.prototype.init=function(){return Cn(this,void 0,void 0,function(){var e;return xn(this,function(r){switch(r.label){case 0:return[4,this._request.send(PS)];case 1:if(e=r.sent(),e.code)throw e;return this.inited=!0,this._id=e.transactionId,[2]}})})},t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new NS(this,e)},t.prototype.getTransactionId=function(){return this._id},t.prototype.getRequestMethod=function(){return this._request},t.prototype.commit=function(){return Cn(this,void 0,void 0,function(){var e,r;return xn(this,function(n){switch(n.label){case 0:return e={transactionId:this._id},[4,this._request.send(DS,e)];case 1:if(r=n.sent(),r.code)throw r;return this.commited=!0,[2,r]}})})},t.prototype.rollback=function(e){return Cn(this,void 0,void 0,function(){var r,n;return xn(this,function(o){switch(o.label){case 0:return r={transactionId:this._id},[4,this._request.send(LS,r)];case 1:if(n=o.sent(),n.code)throw n;return this.aborted=!0,this.abortReason=e,[2,n]}})})},t})();function US(){return Cn(this,void 0,void 0,function(){var t;return xn(this,function(e){switch(e.label){case 0:return t=new dm(this),[4,t.init()];case 1:return e.sent(),[2,t]}})})}function hm(t,e){return e===void 0&&(e=3),Cn(this,void 0,void 0,function(){var r,n,o,i,s=this;return xn(this,function(u){switch(u.label){case 0:return u.trys.push([0,4,,10]),r=new dm(this),[4,r.init()];case 1:return u.sent(),[4,t(r)];case 2:if(n=u.sent(),r.aborted===!0)throw r.abortReason;return[4,r.commit()];case 3:return u.sent(),[2,n];case 4:if(o=u.sent(),r.inited===!1)throw o;return i=function(l){return Cn(s,void 0,void 0,function(){return xn(this,function(a){switch(a.label){case 0:if(!(!r.aborted&&!r.commited))return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.rollback()];case 2:return a.sent(),[3,4];case 3:return a.sent(),[3,4];case 4:throw l;case 5:throw r.aborted===!0?r.abortReason:l}})})},e<=0?[4,i(o)]:[3,6];case 5:u.sent(),u.label=6;case 6:return o&&o.code===fm.DATABASE_TRANSACTION_CONFLICT.code?[4,hm.bind(this)(t,--e)]:[3,8];case 7:return[2,u.sent()];case 8:return[4,i(o)];case 9:return u.sent(),[3,10];case 10:return[2]}})})}var Ge=(function(){function t(e){this.config=e,this.Geo=E1,this.serverDate=g1,this.command=SS,this.RegExp=OS,this.startTransaction=US,this.runTransaction=hm,this.logicCommand=Vr,this.updateCommand=Ae,this.queryCommand=Ce}return t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new ES(this,e)},t.prototype.createCollection=function(e){var r=new t.reqClass(this.config),n={collectionName:e};return r.send("database.addCollection",n)},t})(),fi=function(){return fi=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},fi.apply(this,arguments)},qS="database";function FS(t){var e=this.platform,r=e.adapter,n=e.runtime;return Ge.reqClass=this.request.constructor,Ge.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},Ge.runtime=n,this.wsClientClass&&(Ge.wsClass=r.wsClass,Ge.wsClientClass=this.wsClientClass),Ge.ws||(Ge.ws=null),new Ge(fi(fi(fi({},this.config),{_fromApp:this}),t))}var pm={name:qS,entity:{database:FS}};try{cloudbase.registerComponent(pm)}catch{}function BS(t){try{t.registerComponent(pm)}catch(e){console.warn(e)}}const jS="2.21.6",MS={version:jS};var kS=MS.version;st.registerVersion(kS);try{D_(st),H_(st),z_(st),BS(st),rE(st),hE(st),RE(st),u1(st),q_(st)}catch{}try{window.cloudbase=st}catch{}const vm=st.init({env:void 0}),$S=vm.auth();$S.signInAnonymously().catch(console.error);const VS=vm.database();export{VS as d};
